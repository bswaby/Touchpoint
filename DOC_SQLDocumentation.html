<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TouchPoint SQL Database Reference - Ben Swaby</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            color: #1a202c;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .header .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
            margin: 0;
        }
        
        .about-section {
            background: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 4px solid #4299e1;
        }
        
        .warning {
            background: #fed7e2;
            border: 2px solid #e53e3e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .toc {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .toc h2 {
            margin-top: 0;
            color: #2d3748;
            border-bottom: 2px solid #4299e1;
            padding-bottom: 10px;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 8px 0;
        }
        
        .toc a {
            color: #4299e1;
            text-decoration: none;
            font-weight: 500;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        
        .toc a:hover {
            background: #ebf8ff;
            text-decoration: underline;
        }
        
        .section {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        h1, h2, h3, h4 {
            color: #2d3748;
        }
        
        h2 {
            border-bottom: 2px solid #4299e1;
            padding-bottom: 10px;
            margin-top: 0;
        }
        
        h3 {
            color: #4299e1;
            margin-top: 25px;
        }
        
        /* Enhanced pre and code styles for GitHub Pages compatibility */
        pre {
            background: #2d3748 !important;
            background-color: #2d3748 !important;
            color: #e2e8f0 !important;
            padding: 15px !important;
            border-radius: 8px !important;
            overflow-x: auto !important;
            font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, 'Droid Sans Mono', monospace !important;
            line-height: 1.4 !important;
            border: none !important;
            margin: 15px 0 !important;
            position: relative;
            display: block !important;
        }
        
        pre code {
            background: transparent !important;
            background-color: transparent !important;
            color: #e2e8f0 !important;
            padding: 0 !important;
            border-radius: 0 !important;
            font-family: inherit !important;
            font-size: 0.95em !important;
            line-height: inherit !important;
            border: none !important;
            display: block !important;
        }
        
        /* Inline code (not in pre blocks) */
        :not(pre) > code {
            background: #edf2f7 !important;
            background-color: #edf2f7 !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', Monaco, monospace !important;
            color: #e53e3e !important;
            font-size: 0.9em !important;
        }
        
        /* Override GitHub Pages' .highlight class if present */
        .highlight pre {
            background: #2d3748 !important;
            background-color: #2d3748 !important;
        }
        
        /* Custom highlight boxes (not code) */
        div.highlight {
            background: #fef5e7;
            border-left: 4px solid #ed8936;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .critical {
            background: #fed7e2;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .success {
            background: #f0fff4;
            border-left: 4px solid #38a169;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4299e1;
            color: white;
            padding: 10px 15px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s;
        }
        
        .back-to-top:hover {
            background: #3182ce;
        }
        
        /* Copy button styling */
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4299e1;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }
        
        .copy-button:hover {
            background: #3182ce;
        }
        
        @media print {
            body { background: white; }
            .section { box-shadow: none; border: 1px solid #e2e8f0; }
            .back-to-top { display: none; }
            .copy-button { display: none; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>TouchPoint SQL Database Reference</h1>
    <p class="subtitle">Ben Swaby's Definitive Guide to TouchPoint's 378-Table (and counting) Database</p>
</div>

<div class="about-section">
    <h3>ğŸ“§ About This Guide</h3>
    <p><strong>Author:</strong> Ben Swaby (<a href="mailto:bswaby@fbchtn.org">bswaby@fbchtn.org</a>)<br>
    <strong>Focus:</strong> SQL Database Schema & Query Reference Only<br>
    <strong>Important Limitations:</strong> This guide covers TouchPoint's SQL database structure for <strong>read-only queries</strong> and analysis.</p>
    
    <div class="critical">
        <h4>ğŸš¨ Critical Database Access Limitations</h4>
        <p><strong>READ-ONLY ACCESS:</strong> TouchPoint's SQL interface provides <strong>read-only access</strong> to the database. You <strong>CANNOT</strong>:</p>
        <ul>
            <li>âŒ INSERT new records</li>
            <li>âŒ UPDATE existing data</li>
            <li>âŒ DELETE records</li>
            <li>âŒ MODIFY any database structure</li>
            <li>âŒ Execute stored procedures that change data</li>
        </ul>
        
        <p><strong>For Data Modifications:</strong> All data changes (adding people, updating records, creating organizations, etc.) must be done through:</p>
        <ul>
            <li>âœ… <strong>TouchPoint's Python scripting system</strong></li>
            <li>âœ… <strong>TouchPoint's web interface</strong></li>
            <li>âœ… <strong>TouchPoint's mobile app</strong></li>
            <li>âœ… <strong>TouchPoint's API endpoints</strong></li>
        </ul>
        
        <p><strong>This Guide's Purpose:</strong> Understand database structure, build reports, create analytics, and extract data for external systems using SQL SELECT statements only.</p>
    </div>
</div>

<div class="toc">
    <h2>ğŸ“š Table of Contents</h2>
    
    <h3>ğŸš€ Quick Start</h3>
    <ul>
        <li><a href="#database-overview">Database Overview & Scale</a></li>
        <li><a href="#critical-rules">Critical Business Rules (READ FIRST)</a></li>
        <li><a href="#essential-filters">Essential Filters & Safety Rules</a></li>
        <li><a href="#common-queries">Most Common Queries (80% of Use Cases)</a></li>
    </ul>

    <h3>ğŸ‘¥ People & Families</h3>
    <ul>
        <li><a href="#people-table">People Table - "Single Source of Truth"</a></li>
        <li><a href="#family-relationships">Family Relationships & Structures</a></li>
        <li><a href="#contact-info">Contact Information & Communication Preferences</a></li>
        <li><a href="#membership-status">Church Membership & Status Tracking</a></li>
    </ul>

    <h3>ğŸ›ï¸ Organizations & Ministry</h3>
    <ul>
        <li><a href="#organizations-table">Organizations Table - "Involvements"</a></li>
        <li><a href="#organization-membership">Organization Membership & Roles</a></li>
        <li><a href="#program-hierarchy">Program â†’ Division â†’ Organization Hierarchy</a></li>
    </ul>

    <h3>ğŸ“… Attendance & Meetings</h3>
    <ul>
        <li><a href="#attend-table">Attend Table - The AttendanceFlag=1 Rule</a></li>
        <li><a href="#meetings-table">Meetings & Event Scheduling</a></li>
        <li><a href="#checkin-system">Check-In System Tables</a></li>
    </ul>

    <h3>ğŸ’° Financial & Giving</h3>
    <ul>
        <li><a href="#contribution-table">Contribution Table - The TypeIdâ‰ 99 Rule</a></li>
        <li><a href="#financial-processing">Financial Processing & Batch System</a></li>
        <li><a href="#outstanding-payments">Outstanding Payments & Fee Tracking</a></li>
    </ul>

    <h3>ğŸ“ Events & Registration</h3>
    <ul>
        <li><a href="#registration-flow">Registration System Flow</a></li>
        <li><a href="#form-questions">Form Questions & Responses</a></li>
        <li><a href="#event-management">Event Management Tables</a></li>
    </ul>

    <h3>ğŸ“§ Communication Systems</h3>
    <ul>
        <li><a href="#email-system">Email Marketing System (3.9M+ records)</a></li>
        <li><a href="#sms-system">SMS/Text Messaging</a></li>
        <li><a href="#task-communication">Task & Ministry Communication</a></li>
    </ul>

    <h3>ğŸ“Š Advanced Analytics</h3>
    <ul>
        <li><a href="#engagement-scoring">Engagement Scoring System (1.4M+ records)</a></li>
        <li><a href="#tag-system">Tag System (138M+ records)</a></li>
        <li><a href="#activity-logging">Activity Logging & Change Tracking</a></li>
    </ul>

    <h3>ğŸ”§ System Administration</h3>
    <ul>
        <li><a href="#users-security">Users, Roles & Security</a></li>
        <li><a href="#settings-framework">Settings & Configuration Framework</a></li>
        <li><a href="#content-management">Content & Template Management</a></li>
    </ul>

    <h3>ğŸ“± Mobile & Integration</h3>
    <ul>
        <li><a href="#mobile-config">Mobile App Configuration Tables</a></li>
        <li><a href="#picture-management">Picture & Media Management</a></li>
        <li><a href="#search-optimization">Search Optimization System</a></li>
    </ul>

    <h3>ğŸ›ï¸ Customization Systems</h3>
    <ul>
        <li><a href="#extra-value-tables">Extra Value Tables (17+ tables)</a></li>
        <li><a href="#lookup-tables">Lookup Tables Reference (67+ tables)</a></li>
        <li><a href="#church-customizations">Church-Specific Customizations</a></li>
    </ul>

    <h3>âš¡ Performance & Best Practices</h3>
    <ul>
        <li><a href="#performance-guidelines">Query Performance Guidelines</a></li>
        <li><a href="#common-patterns">Common Query Patterns</a></li>
        <li><a href="#troubleshooting">Troubleshooting & Data Quality</a></li>
    </ul>

    <h3>ğŸ” Quick Reference</h3>
    <ul>
        <li><a href="#relationships-diagram">Essential Table Relationships Diagram</a></li>
        <li><a href="#filter-checklist">Mandatory Filter Checklist</a></li>
        <li><a href="#large-table-warnings">Large Table Warning List</a></li>
    </ul>
</div>

<div id="database-overview" class="section">
    <h2>ğŸ“Š Database Overview & Scale</h2>
    
    <p>TouchPoint is a comprehensive church management system with a massive, enterprise-level database containing <strong>378 tables and 3,364 columns</strong>. Far more extensive than typical documentation suggests, this is one of the largest church management databases available.</p>

    <div class="highlight">
        <h4>ğŸ—ï¸ Database Architecture:</h4>
        <ul>
            <li><strong>378 total tables</strong> with complex relationships</li>
            <li><strong>3,364 columns</strong> across all tables</li>
            <li><strong>452 foreign key relationships</strong> ensuring data integrity</li>
            <li><strong>67 lookup tables</strong> providing business logic</li>
            <li><strong>17 extra value tables</strong> for unlimited customization</li>
            <li><strong>20 special content tables</strong> for system configuration</li>
            <li><strong>495 stored procedures</strong> for complex operations</li>
        </ul>
    </div>

    <div class="success">
        <h4>ğŸ“ˆ Massive Data Volumes (Real Production Scale):</h4>
        <ul>
            <li><strong>138M+ records:</strong> TagPerson (flexible categorization system)</li>
            <li><strong>3.9M+ records:</strong> EmailResponses (email engagement tracking)</li>
            <li><strong>3.8M+ records:</strong> EmailQueueTo (email recipients)</li>
            <li><strong>3.4M+ records:</strong> ActivityLog (comprehensive audit trail)</li>
            <li><strong>1.7M+ records:</strong> PeopleSearchTokens (search optimization)</li>
            <li><strong>1.4M+ records:</strong> EngagementScoreTag (activity scoring details)</li>
            <li><strong>1.2M+ records:</strong> Attend (attendance tracking)</li>
            <li><strong>673K+ records:</strong> Contribution (financial giving)</li>
            <li><strong>498K+ records:</strong> ChangeDetails (field-level change tracking)</li>
            <li><strong>313K+ records:</strong> CheckInActivity & CheckInTimes (check-in system)</li>
        </ul>
    </div>
</div>

<div id="critical-rules" class="section">
    <h2>ğŸš¨ Critical Business Rules (READ FIRST)</h2>
    
    <div class="critical">
        <h3>âš ï¸ Mandatory Filters (Apply to EVERY Query)</h3>
        <pre><code>-- ğŸš¨ CRITICAL: Always filter active people
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0

-- ğŸš¨ CRITICAL: AttendanceFlag = 1 for actual attendance
WHERE a.AttendanceFlag = 1

-- ğŸš¨ CRITICAL: Exclude event registration fees from giving reports
WHERE c.ContributionTypeId != 99

-- âœ… RECOMMENDED: Current organization members
WHERE om.InactiveDate IS NULL

-- âœ… RECOMMENDED: Active organizations only
WHERE o.OrganizationStatusId = 30

-- âœ… RECOMMENDED: Completed meetings (not cancelled)
WHERE m.DidNotMeet = 0</code></pre>
    </div>

    <div id="essential-filters" class="highlight">
        <h3>ğŸ“‹ Essential Safety Rules</h3>
        <pre><code>-- Communication Compliance
WHERE p.DoNotMailFlag = 0     -- Can mail
WHERE p.DoNotCallFlag = 0     -- Can call  
WHERE p.DoNotVisitFlag = 0    -- Can visit
WHERE p.ReceiveSMS = 1        -- Can text

-- Data Quality
WHERE p.PrimaryBadAddrFlag = 0    -- Good addresses only
WHERE p.CellPhoneIsValid = 1      -- Valid phone numbers

-- Performance (for large tables)
WHERE SomeDate >= DATEADD(month, -6, GETDATE())  -- Use date ranges</code></pre>
    </div>
</div>

<div id="common-queries" class="section">
    <h2>ğŸ¯ Most Common Queries (80% of Use Cases)</h2>
    
    <h3>Quick Start: Essential Patterns</h3>

    <h4>ğŸ‘¥ Who Are Our Active Members?</h4>
    <pre><code>SELECT p.Name, p.EmailAddress, p.CellPhone, ms.Description as Status
FROM People p
JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.MemberStatusId IN (10, 20)  -- Members and Prospects
ORDER BY p.Name;</code></pre>

    <h4>ğŸ“… Who Attended What This Week?</h4>
    <pre><code>SELECT p.Name, o.OrganizationName, m.MeetingDate
FROM People p
JOIN Attend a ON p.PeopleId = a.PeopleId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
WHERE a.AttendanceFlag = 1  -- CRITICAL
  AND m.MeetingDate >= DATEADD(week, -1, GETDATE())
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY m.MeetingDate DESC;</code></pre>

    <h4>ğŸ’° Who Gave What This Month?</h4>
    <pre><code>SELECT p.Name, cf.FundName, SUM(c.ContributionAmount) as Total
FROM People p
JOIN Contribution c ON p.PeopleId = c.PeopleId
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- CRITICAL: Exclude event fees
  AND c.ContributionDate >= DATEADD(month, -1, GETDATE())
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY p.PeopleId, p.Name, cf.FundName
ORDER BY Total DESC;</code></pre>

    <h4>ğŸ¯ Who Needs Follow-Up?</h4>
    <pre><code>-- Recent first-time visitors
SELECT p.Name, p.EmailAddress, o.OrganizationName, a.MeetingDate
FROM People p
JOIN Attend a ON p.PeopleId = a.PeopleId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
WHERE a.AttendanceFlag = 1
  AND at.Guest = 1  -- Guest attendance types
  AND a.MeetingDate >= DATEADD(day, -7, GETDATE())
  AND p.DoNotCallFlag = 0 AND p.DoNotVisitFlag = 0
  -- First visit check
  AND NOT EXISTS (
    SELECT 1 FROM Attend a2 
    WHERE a2.PeopleId = p.PeopleId 
      AND a2.AttendanceFlag = 1
      AND a2.MeetingDate < a.MeetingDate
  )
ORDER BY a.MeetingDate DESC;</code></pre>
</div>

<div id="people-table" class="section">
    <h2>ğŸ‘¥ People Table - "Single Source of Truth"</h2>
    
    <p><strong>Purpose:</strong> Central demographic and contact data serving as the "single source of truth" for all personal details, activities, communication, giving, roles and family relationships<br>
    <strong>Primary Key:</strong> PeopleId<br>  
    <strong>Scale:</strong> 136 columns with 23 foreign key relationships<br>  
    <strong>ğŸš¨ CRITICAL RULE:</strong> Always filter <code>WHERE IsDeceased = 0 AND ArchivedFlag = 0</code></p>

    <h3>ğŸ”‘ Core Identity Fields</h3>
    <pre><code>SELECT 
    -- ğŸ”‘ Primary Identity
    PeopleId,               -- Primary key, unique person identifier
    
    -- ğŸ“› Names (Multiple formats for different uses)
    FirstName,              -- First name
    LastName,               -- Last name  
    NickName,               -- Preferred name (may override FirstName)
    Name,                   -- âœ… Full name (computed field, USE FOR DISPLAY)
    Name2,                  -- âœ… Last, First format (USE FOR SORTING)
    AltName,                -- Alternative name/alias (search optimization)
    MiddleName, MaidenName, SuffixCode, PreferredName,
    
    -- ğŸ‚ Birth Information
    BirthDay,               -- Day of birth (1-31)
    BirthMonth,             -- Month of birth (1-12) 
    BirthYear,              -- Year of birth
    BDate,                  -- âš ï¸ Full birth date (includes time - cast to date for age calc)
    Age,                    -- âœ… Current age in years (computed, updated regularly)
    
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0  -- ğŸš¨ MANDATORY FILTER</code></pre>

    <h3>ğŸ‘¤ Demographics & Classification</h3>
    <pre><code>SELECT 
    p.PeopleId, p.Name,
    
    -- ğŸ‘¤ Basic Demographics
    g.Description as Gender,            -- â†’ lookup.Gender.Id
    ms.Description as MaritalStatus,    -- â†’ lookup.MaritalStatus.Id
    fp.Description as FamilyPosition,   -- â†’ lookup.FamilyPosition.Id
    tc.Description as Title,            -- â†’ lookup.TitleCode.Id (Mr., Mrs., Dr.)
    gl.Description as GradeLevel,       -- â†’ lookup.GradeLevel.Id
    ss.Description as ShirtSize,        -- â†’ lookup.ShirtSize.Id
    
    -- ğŸ›ï¸ Church Classification
    memstat.Description as MemberStatus,    -- â†’ lookup.MemberStatus.Id (CRITICAL)
    ep.Description as EntryPoint,           -- â†’ lookup.EntryPoint.Id (how found church)
    ip.Description as InterestPoint,        -- â†’ lookup.InterestPoint.Id (what attracted)
    rc.Description as ResidentCode,         -- â†’ lookup.ResidentCode.Id (proximity)
    c.Description as Campus,                -- â†’ lookup.Campus.Id
    
FROM People p
LEFT JOIN lookup.Gender g ON p.GenderId = g.Id
LEFT JOIN lookup.MaritalStatus ms ON p.MaritalStatusId = ms.Id
LEFT JOIN lookup.FamilyPosition fp ON p.PositionInFamilyId = fp.Id
LEFT JOIN lookup.TitleCode tc ON p.TitleCode = tc.Id
LEFT JOIN lookup.GradeLevel gl ON p.GradeLevelId = gl.Id
LEFT JOIN lookup.ShirtSize ss ON p.ShirtSizeId = ss.Id
LEFT JOIN lookup.MemberStatus memstat ON p.MemberStatusId = memstat.Id
LEFT JOIN lookup.EntryPoint ep ON p.EntryPointId = ep.Id
LEFT JOIN lookup.InterestPoint ip ON p.InterestPointId = ip.Id
LEFT JOIN lookup.ResidentCode rc ON p.ResCodeId = rc.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>
</div>

<div id="family-relationships" class="section">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Relationships & Structures</h2>
    
    <div class="highlight">
        <h3>ğŸ—ï¸ Understanding TouchPoint Family Logic</h3>
        <p>TouchPoint uses <strong>dual relationship tracking:</strong></p>
        <ul>
            <li><strong>FamilyId:</strong> Groups all family members together</li>
            <li><strong>SpouseId:</strong> Direct link between spouses (more reliable than family grouping)</li>
        </ul>
    </div>

    <h3>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Complete Family Analysis</h3>
    <pre><code>SELECT 
    f.FamilyId,
    primary_adult.Name as PrimaryAdult,
    spouse.Name as Spouse,
    child.Name as Child,
    child.Age as ChildAge,
    
    -- Family Stats
    COUNT(family_members.PeopleId) as FamilySize,
    SUM(CASE WHEN family_members.MemberStatusId = 10 THEN 1 ELSE 0 END) as MembersInFamily
    
FROM Families f
-- Primary Adult (head of household)
LEFT JOIN People primary_adult ON f.FamilyId = primary_adult.FamilyId 
    AND primary_adult.PositionInFamilyId = 10  -- Primary Adult
    AND primary_adult.IsDeceased = 0 AND primary_adult.ArchivedFlag = 0
-- Spouse (through direct link - more reliable)
LEFT JOIN People spouse ON primary_adult.SpouseId = spouse.PeopleId
    AND spouse.IsDeceased = 0 AND spouse.ArchivedFlag = 0
-- Children
LEFT JOIN People child ON f.FamilyId = child.FamilyId
    AND child.PositionInFamilyId = 30  -- Child
    AND child.IsDeceased = 0 AND child.ArchivedFlag = 0
-- All family members for stats
LEFT JOIN People family_members ON f.FamilyId = family_members.FamilyId
    AND family_members.IsDeceased = 0 AND family_members.ArchivedFlag = 0
    
GROUP BY f.FamilyId, primary_adult.Name, spouse.Name, child.Name, child.Age
HAVING COUNT(family_members.PeopleId) > 1  -- Multi-person families only
ORDER BY primary_adult.Name;</code></pre>
</div>

<div id="contact-info" class="section">
    <h2>ğŸ“ Contact Information & Communication Preferences</h2>
    
    <div class="critical">
        <p><strong>CRITICAL:</strong> Always check communication preferences before sending emails, calls, or mail</p>
    </div>

    <h3>ğŸ“§ Contact Data with Permissions</h3>
    <pre><code>SELECT 
    p.PeopleId, p.Name,
    
    -- ğŸ“§ Email Information
    p.EmailAddress,         -- Primary email
    p.EmailAddress2,        -- Secondary email  
    p.SendEmailAddress1,    -- âœ… Permission for primary email
    p.SendEmailAddress2,    -- âœ… Permission for secondary email
    
    -- ğŸ“± Phone Information
    p.CellPhone,            -- Cell phone (formatted)
    p.HomePhone,            -- Home phone (10 digits)
    p.WorkPhone,            -- Work phone
    p.CellPhoneValidated,   -- Cell phone verified
    p.CellPhoneIsValid,     -- Cell phone working
    p.ReceiveSMS,           -- âœ… Permission for SMS
    
    -- ğŸ  Address Information (Use Primary* fields)
    p.PrimaryAddress,       -- âœ… Primary street address
    p.PrimaryAddress2,      -- Apartment/suite
    p.PrimaryCity,          -- City
    p.PrimaryState,         -- State
    p.PrimaryZip,           -- ZIP code
    p.PrimaryBadAddrFlag,   -- âŒ Address is invalid
    
    -- ğŸš« Communication Restrictions (CRITICAL)
    p.DoNotMailFlag,        -- âŒ No postal mail
    p.DoNotCallFlag,        -- âŒ No phone calls  
    p.DoNotVisitFlag,       -- âŒ No visits
    p.DoNotPublishPhones,   -- âŒ Don't publish in directory
    
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>

    <h3>ğŸ’Œ Safe Communication Query Pattern</h3>
    <pre><code>-- People you CAN email safely
SELECT p.Name, p.EmailAddress
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotMailFlag = 0  -- Permission to mail
  AND p.SendEmailAddress1 = 1  -- Permission for primary email
  AND p.EmailAddress IS NOT NULL AND p.EmailAddress != ''
  AND p.PrimaryBadAddrFlag = 0;  -- Good address

-- People you CAN text safely  
SELECT p.Name, p.CellPhone
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotCallFlag = 0  -- Permission to call/text
  AND p.ReceiveSMS = 1  -- Permission for SMS
  AND p.CellPhoneIsValid = 1;  -- Valid phone number</code></pre>
</div>

<div id="membership-status" class="section">
    <h2>ğŸ›ï¸ Church Membership & Status Tracking</h2>
    
    <div class="highlight">
        <h3>ğŸ“Š Understanding TouchPoint's Membership Workflow</h3>
        <p><strong>Just Added â†’ Prospect â†’ Member</strong></p>
    </div>

    <pre><code>SELECT 
    p.PeopleId, p.Name,
    ms.Description as MemberStatus,
    
    -- ğŸ“… Key Membership Dates
    p.JoinDate,                 -- Date joined church
    p.DropDate,                 -- Date left church  
    dt.Description as DropReason,
    
    -- âœï¸ Baptism Tracking
    p.BaptismDate,              -- Date baptized
    bs.Description as BaptismStatus,
    bt.Description as BaptismType,
    p.BaptismSchedDate,         -- Scheduled baptism date
    
    -- ğŸ™ Decision Information  
    p.DecisionDate,             -- Date of salvation decision
    dt2.Description as DecisionType,
    
    -- ğŸ“ New Member Process
    p.NewMemberClassDate,       -- Class completion
    nmcs.Description as NewMemberClassStatus,
    
FROM People p
JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.DropType dt ON p.DropCodeId = dt.Id  
LEFT JOIN lookup.BaptismStatus bs ON p.BaptismStatusId = bs.Id
LEFT JOIN lookup.BaptismType bt ON p.BaptismTypeId = bt.Id
LEFT JOIN lookup.DecisionType dt2 ON p.DecisionTypeId = dt2.Id
LEFT JOIN lookup.NewMemberClassStatus nmcs ON p.NewMemberClassStatusId = nmcs.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>
</div>

<div id="organizations-table" class="section">
    <h2>ğŸ›ï¸ Organizations Table - "Involvements"</h2>
    
    <p><strong>Purpose:</strong> Groups, classes, ministries, events (called "Involvements" in UI)<br>  
    <strong>Primary Key:</strong> OrganizationId<br>  
    <strong>Scale:</strong> 188 columns with 16 foreign key relationships<br>  
    <strong>UI Note:</strong> These are called "Involvements" in the TouchPoint interface</p>

    <h3>ğŸ¢ Basic Organization Information</h3>
    <pre><code>SELECT 
    o.OrganizationId,
    o.OrganizationName,     -- Display name
    o.Description,          -- Detailed description
    
    -- ğŸ“Š Status & Classification
    os.Description as Status,           -- Active/Inactive
    ot.Description as OrgType,          -- Class, Ministry, Event
    c.Description as Campus,            -- Campus location
    
    -- ğŸ‘‘ Leadership
    leader.Name as Leader,
    main_leader.Name as MainLeader,
    
    -- ğŸ“ˆ Membership Statistics
    o.MemberCount,          -- Current members (auto-updated)
    o.PrevMemberCount,      -- Previous count
    o.ProspectCount,        -- Prospects
    o.Limit,                -- Maximum capacity
    o.ClassFilled,          -- At capacity flag
    
FROM Organizations o
LEFT JOIN lookup.OrganizationStatus os ON o.OrganizationStatusId = os.Id
LEFT JOIN lookup.OrganizationType ot ON o.OrganizationTypeId = ot.Id  
LEFT JOIN lookup.Campus c ON o.CampusId = c.Id
LEFT JOIN People leader ON o.LeaderId = leader.PeopleId
LEFT JOIN People main_leader ON o.MainLeaderId = main_leader.PeopleId
WHERE o.OrganizationStatusId = 30  -- âœ… Active organizations only</code></pre>
</div>

<div id="organization-membership" class="section">
    <h2>ğŸ‘¥ Organization Membership & Roles</h2>
    
    <h3>ğŸ­ Organization Members with Roles</h3>
    <pre><code>SELECT 
    o.OrganizationName,
    p.Name,
    mt.Description as Role,
    om.JoinDate,
    om.InactiveDate,
    om.IsPending,
    om.IsMemChecked,
    
FROM OrganizationMembers om
JOIN People p ON om.PeopleId = p.PeopleId
JOIN Organizations o ON om.OrganizationId = o.OrganizationId
LEFT JOIN lookup.MemberType mt ON om.MemberTypeId = mt.Id
WHERE om.InactiveDate IS NULL  -- Current members only
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND o.OrganizationStatusId = 30
ORDER BY o.OrganizationName, mt.Description, p.Name;</code></pre>
</div>

<div id="program-hierarchy" class="section">
    <h2>ğŸ“Š Program â†’ Division â†’ Organization Hierarchy</h2>
    
    <h3>ğŸ—ï¸ Understanding the Three-Level Hierarchy</h3>
    <pre><code>SELECT 
    pr.Name as Program,
    d.Name as Division,
    o.OrganizationName,
    o.MemberCount,
    
FROM Organizations o
LEFT JOIN Division d ON o.DivisionId = d.Id
LEFT JOIN Program pr ON d.ProgId = pr.Id
WHERE o.OrganizationStatusId = 30
ORDER BY pr.Name, d.Name, o.OrganizationName;</code></pre>
</div>

<div id="attend-table" class="section">
    <h2>ğŸ“… Attend Table - The AttendanceFlag=1 Rule</h2>
    
    <div class="critical">
        <p><strong>ğŸš¨ CRITICAL RULE:</strong> <code>AttendanceFlag = 1</code> for actual attendance, <code>0</code> for absences</p>
    </div>

    <p><strong>Purpose:</strong> Individual attendance records - tracks who attended what meeting<br>  
    <strong>Scale:</strong> 1.2M+ records<br>  
    <strong>Key Fields:</strong> AttendId (Primary), PeopleId + MeetingId + OrganizationId</p>

    <h3>ğŸ“… Basic Attendance Tracking</h3>
    <pre><code>SELECT 
    a.AttendId,             -- Primary key
    a.PeopleId,             -- â†’ People.PeopleId
    a.MeetingId,            -- â†’ Meetings.MeetingId  
    a.OrganizationId,       -- â†’ Organizations.OrganizationId
    a.MeetingDate,          -- Meeting date/time
    a.AttendanceFlag,       -- ğŸš¨ CRITICAL: 1=present, 0=absent
    
    -- ğŸ­ Attendance Classification
    at.Description as AttendanceType,   -- Member, Leader, Guest, etc.
    mt.Description as DetailedRole,     -- Specific role
    
    -- ğŸ“ Additional Details
    a.SubGroupName,         -- Sub-group within organization
    a.Commitment,           -- Attendance commitment level: (99 OR NULL)=UNCOMMITTED; 0=REGRETS; 1=ATTENDING; 2=FIND_SUB; 3=SUB_FOUND
    a.NoShow,               -- Registered but didn't attend
    a.Registered,           -- Was registered for meeting
    
FROM Attend a
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
JOIN lookup.MemberType mt ON a.MemberTypeId = mt.Id
WHERE a.AttendanceFlag = 1  -- ğŸš¨ MUST FILTER: only actual attendance
  AND a.MeetingDate >= DATEADD(month, -3, GETDATE())</code></pre>
</div>

<div id="meetings-table" class="section">
    <h2>ğŸ“… Meetings & Event Scheduling</h2>
    
    <h3>ğŸ—“ï¸ Meeting Records</h3>
    <pre><code>SELECT 
    m.MeetingId,
    m.OrganizationId,
    o.OrganizationName,
    m.MeetingDate,
    m.Location,
    m.NumPresent,           -- Attendance count
    m.NumMembers,           -- Member attendance
    m.NumGuests,            -- Guest attendance
    m.HeadCount,            -- Total head count
    m.DidNotMeet,           -- Meeting cancelled flag
    
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
WHERE m.DidNotMeet = 0  -- Only completed meetings
  AND m.MeetingDate >= DATEADD(month, -1, GETDATE())
ORDER BY m.MeetingDate DESC;</code></pre>
</div>

<div id="checkin-system" class="section">
    <h2>ğŸ« Check-In System Tables</h2>
    
    <h3>ğŸ“± Check-In Activity</h3>
    <pre><code>SELECT 
    cia.Id,
    p.Name,
    cia.CheckInTime,
    cia.SecurityCode,
    cia.AccessTypeId,
    bl.Name as CheckInLocation,
    
FROM CheckInActivity cia
JOIN People p ON cia.PeopleId = p.PeopleId
LEFT JOIN BuildingLabel bl ON cia.LabelId = bl.Id
WHERE cia.CheckInTime >= DATEADD(day, -7, GETDATE())
ORDER BY cia.CheckInTime DESC;</code></pre>
</div>

<div id="contribution-table" class="section">
    <h2>ğŸ’° Contribution Table - The TypeIdâ‰ 99 Rule</h2>
    
    <div class="critical">
        <p><strong>ğŸš¨ CRITICAL RULE:</strong> <code>ContributionTypeId = 99</code> represents event registration fees, NOT charitable donations</p>
    </div>

    <p><strong>Purpose:</strong> Financial giving records<br>  
    <strong>Primary Key:</strong> ContributionId<br>  
    <strong>Scale:</strong> 673K+ records</p>

    <h3>ğŸ’° Basic Giving Analysis</h3>
    <pre><code>SELECT 
    c.ContributionId,
    p.Name as Giver,
    c.ContributionAmount,   -- Gift amount
    c.ContributionDate,     -- Date of gift
    cf.FundName,            -- Fund designation
    c.ContributionTypeId,   -- ğŸš¨ CRITICAL: 99 = event fee (NOT donation)
    c.CheckNo,              -- Check number or payment reference
    
FROM Contribution c
JOIN People p ON c.PeopleId = p.PeopleId
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- ğŸš¨ EXCLUDE event registration fees
  AND c.ContributionDate >= '2024-01-01'
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY c.ContributionDate DESC, c.ContributionAmount DESC;</code></pre>
</div>

<div id="financial-processing" class="section">
    <h2>ğŸ’³ Financial Processing & Batch System</h2>
    
    <h3>ğŸ“¦ Batch Processing</h3>
    <pre><code>SELECT 
    bh.Id as BatchId,
    bh.BatchDate,
    bh.TotalCash,
    bh.TotalChecks,
    bh.TotalEnvelopes,
    bh.TotalOnline,
    bh.TotalCredit,
    bh.IsOpen,
    
FROM BundleHeader bh
WHERE bh.BatchDate >= DATEADD(month, -1, GETDATE())
ORDER BY bh.BatchDate DESC;</code></pre>
</div>

<div id="outstanding-payments" class="section">
    <h2>ğŸ’³ Outstanding Payments & Fee Tracking</h2>
    
    <h3>ğŸ“Š Outstanding Transactions</h3>
    <pre><code>SELECT 
    p.Name,
    t.TransactionDate,
    t.OriginalAmount,
    t.AmountDue,
    t.AmountPaid,
    t.Description,
    
FROM TransactionPeople tp
JOIN People p ON tp.PeopleId = p.PeopleId
JOIN Transactions t ON tp.TransactionId = t.Id
WHERE t.AmountDue > 0  -- Outstanding balance
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY t.TransactionDate DESC;</code></pre>
</div>

<div id="registration-flow" class="section">
    <h2>ğŸŸï¸ Registration System Flow</h2>
    
    <h3>ğŸ“ Registration â†’ People â†’ Answers</h3>
    <pre><code>-- Registration with participant details
SELECT 
    r.Id as RegistrationId,
    o.OrganizationName as Event,
    p.Name as Participant,
    rp.DateRegistered,
    rp.AmountToPay,
    rp.AmountPaid,
    
FROM Registration r
JOIN Organizations o ON r.OrganizationId = o.OrganizationId
JOIN RegPeople rp ON r.Id = rp.RegistrationId
JOIN People p ON rp.PeopleId = p.PeopleId
WHERE r.Completed = 1  -- Completed registrations
  AND rp.DateRegistered >= DATEADD(month, -3, GETDATE())
ORDER BY rp.DateRegistered DESC;</code></pre>
</div>

<div id="form-questions" class="section">
    <h2>ğŸ“‹ Form Questions & Responses</h2>
    
    <h3>â“ Registration Form Answers</h3>
    <pre><code>SELECT 
    p.Name,
    rq.Question,
    ra.Text as Answer,
    
FROM RegAnswer ra
JOIN RegPeople rp ON ra.RegPersonId = rp.Id
JOIN People p ON rp.PeopleId = p.PeopleId
JOIN RegQuestion rq ON ra.QuestionId = rq.Id
WHERE rp.DateRegistered >= DATEADD(month, -1, GETDATE())
ORDER BY p.Name, rq.Question;</code></pre>
</div>

<div id="event-management" class="section">
    <h2>ğŸ¯ Event Management Tables</h2>
    
    <h3>ğŸ“… Scheduled Events</h3>
    <pre><code>SELECT 
    s.Id,
    s.Name as EventName,
    s.MeetingTime,
    s.Location,
    cat.Description as Category,
    
FROM Schedule s
LEFT JOIN lookup.ScheduleCategory cat ON s.CategoryId = cat.Id
WHERE s.MeetingTime >= GETDATE()
ORDER BY s.MeetingTime;</code></pre>
</div>

<div id="email-system" class="section">
    <h2>ğŸ“§ Email Marketing System (3.9M+ records)</h2>
    
    <div class="warning">
        <p><strong>âš ï¸ PERFORMANCE WARNING:</strong> EmailResponses table has 3.9M+ records - ALWAYS use date filters</p>
    </div>

    <h3>ğŸ“§ Email Campaign Management</h3>
    <pre><code>-- Email campaigns with engagement metrics
SELECT 
    eq.Id,
    eq.Subject,             -- Email subject
    sender.Name as Sender,
    eq.SendAt,              -- When sent
    
    -- ğŸ“Š Engagement Metrics
    COUNT(eqt.Id) as Recipients,
    COUNT(CASE WHEN er.Event = 'open' THEN 1 END) as Opens,
    COUNT(CASE WHEN er.Event = 'click' THEN 1 END) as Clicks,
    COUNT(CASE WHEN er.Event = 'bounce' THEN 1 END) as Bounces,
    
    -- ğŸ“ˆ Engagement Rates
    CAST(COUNT(CASE WHEN er.Event = 'open' THEN 1 END) AS FLOAT) / 
        NULLIF(COUNT(eqt.Id), 0) * 100 as OpenRate,
    CAST(COUNT(CASE WHEN er.Event = 'click' THEN 1 END) AS FLOAT) / 
        NULLIF(COUNT(eqt.Id), 0) * 100 as ClickRate
    
FROM EmailQueue eq
JOIN People sender ON eq.QueuedBy = sender.PeopleId
LEFT JOIN EmailQueueTo eqt ON eq.Id = eqt.EmailQueueId
LEFT JOIN EmailResponses er ON eqt.Id = er.EmailQueueToId
WHERE eq.SendAt >= DATEADD(month, -1, GETDATE())  -- âš ï¸ PERFORMANCE: Date filter required
GROUP BY eq.Id, eq.Subject, sender.Name, eq.SendAt
HAVING COUNT(eqt.Id) > 0
ORDER BY eq.SendAt DESC;</code></pre>
</div>

<div id="sms-system" class="section">
    <h2>ğŸ“± SMS/Text Messaging</h2>
    
    <h3>ğŸ’¬ SMS Messages</h3>
    <pre><code>SELECT 
    sm.Id,
    p.Name as Recipient,
    sm.Message,
    sm.SentDate,
    sm.Delivered,
    sm.Status,
    
FROM SMSMessage sm
JOIN People p ON sm.PeopleId = p.PeopleId
WHERE sm.SentDate >= DATEADD(week, -1, GETDATE())
ORDER BY sm.SentDate DESC;</code></pre>
</div>

<div id="task-communication" class="section">
    <h2>ğŸ“‹ Task & Ministry Communication</h2>
    
    <h3>âœ… Task Management</h3>
    <pre><code>SELECT 
    tn.Id,
    owner.Name as Owner,
    assigned.Name as AssignedTo,
    tn.CreatedOn,
    tn.DueDate,
    tn.Notes,
    tn.CompletedOn,
    
FROM TaskNote tn
JOIN People owner ON tn.OwnerId = owner.PeopleId
LEFT JOIN People assigned ON tn.AboutId = assigned.PeopleId
WHERE tn.CompletedOn IS NULL  -- Open tasks
ORDER BY tn.DueDate;</code></pre>
</div>

<div id="engagement-scoring" class="section">
    <h2>ğŸ“Š Engagement Scoring System (1.4M+ records)</h2>
    
    <div class="warning">
        <p><strong>âš ï¸ PERFORMANCE WARNING:</strong> EngagementScoreTag table has 1.4M+ records - ALWAYS use date filters</p>
    </div>

    <h3>ğŸ“ˆ Engagement Scores</h3>
    <pre><code>SELECT 
    p.Name,
    es.WeekDate,
    es.Attended,
    es.Gave,
    es.Served,
    es.TotalScore,
    
FROM EngagementScore es
JOIN People p ON es.PeopleId = p.PeopleId
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())  -- âš ï¸ PERFORMANCE
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY es.WeekDate DESC, es.TotalScore DESC;</code></pre>
</div>

<div id="tag-system" class="section">
    <h2>ğŸ·ï¸ Tag System (138M+ records)</h2>
    
    <div class="critical">
        <p><strong>ğŸš¨ EXTREME PERFORMANCE WARNING:</strong> TagPerson table has 138M+ records - NEVER query without date filters!</p>
    </div>

    <h3>ğŸ·ï¸ Tag Management</h3>
    <pre><code>-- Recent tags only (CRITICAL for performance)
SELECT TOP 1000
    p.Name,
    t.Name as TagName,
    tp.DateCreated,
    
FROM TagPerson tp
JOIN People p ON tp.PeopleId = p.PeopleId
JOIN Tag t ON tp.TagId = t.Id
WHERE tp.DateCreated >= DATEADD(day, -7, GETDATE())  -- ğŸš¨ CRITICAL
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY tp.DateCreated DESC;</code></pre>
</div>

<div id="activity-logging" class="section">
    <h2>ğŸ“ Activity Logging & Change Tracking</h2>
    
    <h3>ğŸ” Activity Log (3.4M+ records)</h3>
    <pre><code>SELECT TOP 100
    al.ActivityDate,
    u.Name as User,
    al.Machine,
    al.PageUrl,
    al.Activity,
    
FROM ActivityLog al
LEFT JOIN Users u ON al.UserId = u.UserId
WHERE al.ActivityDate >= DATEADD(day, -1, GETDATE())  -- âš ï¸ PERFORMANCE
ORDER BY al.ActivityDate DESC;</code></pre>
</div>

<div id="users-security" class="section">
    <h2>ğŸ” Users, Roles & Security</h2>
    
    <h3>ğŸ‘¤ User Management</h3>
    <pre><code>SELECT 
    u.UserId,
    u.Name,
    u.EmailAddress,
    u.LastActivityDate,
    u.MustChangePassword,
    r.RoleName,
    
FROM Users u
LEFT JOIN UserRole ur ON u.UserId = ur.UserId
LEFT JOIN Roles r ON ur.RoleId = r.RoleId
WHERE u.IsApproved = 1
ORDER BY u.Name;</code></pre>
</div>

<div id="settings-framework" class="section">
    <h2>âš™ï¸ Settings & Configuration Framework</h2>
    
    <h3>ğŸ”§ System Settings</h3>
    <pre><code>SELECT 
    SettingId,
    Setting,
    Description,
    DataType,
    
FROM Setting
WHERE UserId = 0  -- System-wide settings
ORDER BY Setting;</code></pre>
</div>

<div id="content-management" class="section">
    <h2>ğŸ“„ Content & Template Management</h2>
    
    <h3>ğŸ“ Content Management</h3>
    <pre><code>SELECT 
    c.Id,
    c.Name,
    c.Title,
    c.Body,
    c.DateCreated,
    c.DateModified,
    ct.Description as ContentType,
    
FROM Content c
LEFT JOIN lookup.ContentType ct ON c.TypeId = ct.Id
ORDER BY c.DateModified DESC;</code></pre>
</div>

<div id="mobile-config" class="section">
    <h2>ğŸ“± Mobile App Configuration Tables</h2>
    
    <h3>ğŸ“² Mobile App Settings</h3>
    <pre><code>SELECT 
    mas.Id,
    mas.SettingName,
    mas.SettingValue,
    mas.LastModified,
    
FROM MobileAppSettings mas
ORDER BY mas.SettingName;</code></pre>
</div>

<div id="picture-management" class="section">
    <h2>ğŸ–¼ï¸ Picture & Media Management</h2>
    
    <h3>ğŸ“¸ Picture Storage</h3>
    <pre><code>SELECT 
    p.Name,
    pic.PictureId,
    pic.CreatedDate,
    pic.ThumbId,
    pic.SmallId,
    pic.MediumId,
    pic.LargeId,
    
FROM Picture pic
JOIN People p ON pic.PeopleId = p.PeopleId
WHERE pic.CreatedDate >= DATEADD(month, -1, GETDATE())
ORDER BY pic.CreatedDate DESC;</code></pre>
</div>

<div id="search-optimization" class="section">
    <h2>ğŸ” Search Optimization System</h2>
    
    <h3>ğŸ” Search Tokens (1.7M+ records)</h3>
    <pre><code>-- Search optimization tokens
SELECT TOP 100
    pst.PeopleId,
    pst.Token,
    pst.TokenType,
    
FROM PeopleSearchTokens pst
WHERE pst.Token LIKE 'smith%'  -- Example search
ORDER BY pst.PeopleId;</code></pre>
</div>

<div id="extra-value-tables" class="section">
    <h2>ğŸ›ï¸ Extra Value Tables (17+ tables)</h2>
    
    <h3>ğŸ“Š Custom Field Storage</h3>
    <pre><code>-- People Extra Values
SELECT 
    p.Name,
    pev.Field,
    pev.StrValue,
    pev.DateValue,
    pev.IntValue,
    pev.BitValue,
    
FROM PeopleExtra pev
JOIN People p ON pev.PeopleId = p.PeopleId
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name, pev.Field;</code></pre>
</div>

<div id="lookup-tables" class="section">
    <h2>ğŸ“š Lookup Tables Reference (67+ tables)</h2>
    
    <h3>ğŸ›ï¸ Church Membership (Most Important)</h3>
    <pre><code>-- Member Status (CRITICAL for targeting)
SELECT Id, Description FROM lookup.MemberStatus;
-- 10=Member, 20=Prospect, 30=Not Member, 40=Previous Member, 50=Just Added

-- Attendance Classification (CRITICAL for roles)
SELECT Id, Description, Worker, Guest FROM lookup.AttendType;
-- 10=Member, 20=Leader, 30=Volunteer, 40=New Guest, 50=Recent Guest

-- Detailed Member Roles
SELECT Id, Description, AttendanceTypeId FROM lookup.MemberType;</code></pre>

    <h3>ğŸ‘¤ Demographics & Personal</h3>
    <pre><code>SELECT Id, Description FROM lookup.Gender;          -- 1=Male, 2=Female
SELECT Id, Description FROM lookup.MaritalStatus;   -- 1=Single, 2=Married, 3=Divorced, 4=Widowed
SELECT Id, Description FROM lookup.FamilyPosition;  -- 10=Primary Adult, 20=Secondary Adult, 30=Child
SELECT Id, Description FROM lookup.GradeLevel;      -- School grades
SELECT Id, Description FROM lookup.ShirtSize;       -- Event/volunteer sizing</code></pre>

    <h3>ğŸ’° Financial (CRITICAL)</h3>
    <pre><code>SELECT Id, Description FROM lookup.ContributionType;    -- ğŸš¨ CRITICAL: 99=event registration
SELECT Id, Description FROM lookup.ContributionStatus;
SELECT Id, Description FROM lookup.AccountCode;</code></pre>
</div>

<div id="church-customizations" class="section">
    <h2>â›ª Church-Specific Customizations</h2>
    
    <h3>ğŸ›ï¸ Custom Reports</h3>
    <pre><code>SELECT 
    cr.Id,
    cr.Name,
    cr.Description,
    cr.Body,  -- SQL or Python code
    cr.IsPublic,
    
FROM CustomReports cr
WHERE cr.IsPublic = 1
ORDER BY cr.Name;</code></pre>
</div>

<div id="performance-guidelines" class="section">
    <h2>âš¡ Query Performance Guidelines</h2>
    
    <h3>ğŸš¨ Large Table Performance Rules</h3>
    
    <div class="critical">
        <h4>Always Filter These High-Volume Tables:</h4>
        <pre><code>-- TagPerson (138M+ records) - ALWAYS use date ranges
WHERE tp.DateCreated >= DATEADD(month, -1, GETDATE())

-- EmailResponses (3.9M+ records) - ALWAYS use date ranges  
WHERE er.EventTime >= DATEADD(week, -1, GETDATE())

-- ActivityLog (3.4M+ records) - ALWAYS use date ranges
WHERE al.ActivityDate >= DATEADD(month, -1, GETDATE())

-- EngagementScoreTag (1.4M+ records) - ALWAYS use date ranges
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())</code></pre>
    </div>

    <h3>ğŸ“ Safe Exploration Pattern</h3>
    <pre><code>-- Use TOP for initial exploration
SELECT TOP 100 * 
FROM LargeTableName
WHERE DateField >= DATEADD(week, -1, GETDATE())
ORDER BY DateField DESC;</code></pre>
</div>

<div id="common-patterns" class="section">
    <h2>ğŸ¯ Common Query Patterns</h2>
    
    <h3>ğŸ“Š Dashboard Metrics</h3>
    <pre><code>-- Church Dashboard Metrics
SELECT 
    (SELECT COUNT(*) FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0 AND MemberStatusId = 10) as ActiveMembers,
    (SELECT COUNT(*) FROM Attend WHERE AttendanceFlag = 1 AND MeetingDate >= DATEADD(week, -1, GETDATE())) as WeeklyAttendance,
    (SELECT SUM(ContributionAmount) FROM Contribution WHERE ContributionTypeId != 99 AND ContributionDate >= DATEADD(month, -1, GETDATE())) as MonthlyGiving,
    (SELECT COUNT(*) FROM Organizations WHERE OrganizationStatusId = 30) as ActiveOrganizations;</code></pre>
</div>

<div id="troubleshooting" class="section">
    <h2>ğŸ”§ Troubleshooting & Data Quality</h2>
    
    <h3>ğŸš‘ Common Issues & Solutions</h3>
    
    <div class="warning">
        <h4>Problem: Query Times Out</h4>
        <p><strong>Solution:</strong> Add date filters, use TOP clause, check for missing indexes</p>
    </div>
    
    <div class="warning">
        <h4>Problem: Attendance Numbers Don't Match</h4>
        <p><strong>Solution:</strong> Verify <code>AttendanceFlag = 1</code> filter is applied</p>
    </div>
    
    <div class="warning">
        <h4>Problem: Giving Reports Include Event Fees</h4>
        <p><strong>Solution:</strong> Add <code>WHERE ContributionTypeId != 99</code> filter</p>
    </div>
    
    <div class="warning">
        <h4>Problem: Deceased People Appearing</h4>
        <p><strong>Solution:</strong> Always include <code>WHERE IsDeceased = 0 AND ArchivedFlag = 0</code></p>
    </div>
