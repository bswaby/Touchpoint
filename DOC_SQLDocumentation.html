<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swaby's Touchpoint SQL Database Reference Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            color: #1a202c;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 15px 0;
            font-size: 2.8em;
            font-weight: 700;
        }
        
        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
            margin: 0 0 20px 0;
        }
        
        .header .version {
            font-size: 1em;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .intro-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .warning {
            background: #fed7e2;
            border: 2px solid #e53e3e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info {
            background: #bee3f8;
            border: 2px solid #3182ce;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success {
            background: #c6f6d5;
            border: 2px solid #38a169;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .toc {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .toc h2 {
            margin-top: 0;
            color: #2d3748;
            border-bottom: 3px solid #4299e1;
            padding-bottom: 10px;
            font-size: 2em;
        }
        
        .toc h3 {
            color: #4299e1;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .toc li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #4299e1;
        }
        
        .toc a {
            color: #4299e1;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .toc a:hover {
            color: #2c5282;
            text-decoration: underline;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        h1, h2, h3, h4 {
            color: #2d3748;
        }
        
        h2 {
            border-bottom: 3px solid #4299e1;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.8em;
        }
        
        h3 {
            color: #4299e1;
            margin-top: 25px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #4a5568;
            margin-top: 20px;
            font-size: 1.2em;
        }
        
        pre {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
            padding: 20px !important;
            border-radius: 8px !important;
            overflow-x: auto !important;
            font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, monospace !important;
            line-height: 1.5 !important;
            font-size: 0.95em !important;
            position: relative;
            margin: 15px 0 !important;
        }
        
        pre code {
            background: transparent !important;
            color: #e2e8f0 !important;
            padding: 0 !important;
            font-size: inherit !important;
        }
        
        :not(pre) > code {
            background: #edf2f7 !important;
            padding: 3px 6px !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', Monaco, monospace !important;
            color: #e53e3e !important;
            font-size: 0.9em !important;
        }
        
        .critical {
            background: #fed7e2;
            border-left: 5px solid #e53e3e;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .highlight {
            background: #fef5e7;
            border-left: 5px solid #ed8936;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4299e1;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            font-weight: 600;
            z-index: 1000;
        }
        
        .back-to-top:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4299e1;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .copy-button:hover {
            background: #3182ce;
        }
        
        .field-table {
            font-size: 0.95em;
        }
        
        .field-table th:first-child {
            width: 25%;
        }
        
        .field-table th:nth-child(2) {
            width: 15%;
        }
        
        .field-table code {
            font-size: 0.9em !important;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-critical {
            background: #fed7e2;
            color: #c53030;
        }
        
        .badge-new {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .badge-performance {
            background: #fef5e7;
            color: #c05621;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section, .toc {
                padding: 20px;
            }
            
            pre {
                padding: 15px !important;
                font-size: 0.85em !important;
            }
        }
        
        @media print {
            body { background: white; }
            .section { box-shadow: none; border: 1px solid #e2e8f0; }
            .back-to-top { display: none; }
            .copy-button { display: none; }
            .toc { page-break-after: always; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Swaby's TouchPoint SQL Database Reference</h1>
    <p class="subtitle">My Personal Guide to the TouchPoint's Church Management Database</p>
    <div class="version">Version: The smothered, covered, chunked, diced, and occasionally topped version</div>
</div>

<div class="intro-section">
    <h2>ğŸ“š About This Guide</h2>
    <p>I could keep up with all the tables and relationships, so started creating my own documented version of the structure to take at least a small bite out of TouchPoint's extensive SQL database structure.</p>
    
    <div class="info">
        <h3>ğŸ‘¥ Who This Guide Is For</h3>
        <ul>
            <li><strong>Church Database Administrators</strong> - Managing and querying church data</li>
            <li><strong>Report Writers</strong> - Creating custom reports and analytics</li>
            <li><strong>Developers</strong> - Building integrations and custom solutions</li>
            <li><strong>Church Leadership</strong> - Understanding data capabilities</li>
        </ul>
    </div>
    
    <div class="warning">
        <h3>âš ï¸ Critical: TouchPoint SQL is READ-ONLY</h3>
        <p><strong>The SQL interface provides READ-ONLY access to the database.</strong> You cannot INSERT, UPDATE, or DELETE records through SQL. All data modifications must be done through:</p>
        <ul>
            <li>âœ… TouchPoint's web interface</li>
            <li>âœ… TouchPoint's Python scripting system</li>
            <li>âœ… TouchPoint's API endpoints</li>
            <li>âœ… TouchPoint's mobile app</li>
        </ul>
        <p>This guide focuses on SELECT queries for reporting, analysis, and data extraction.</p>
    </div>
    
    <div class="success">
        <h3>âœ¨ What's New in this Documentation</h3>
        <ul>
            <li>ğŸ“Š Complete coverage of all 378 tables and 3,364 columns</li>
            <li>ğŸš€ Performance guidelines for tables with millions of records</li>
            <li>ğŸ”§ Advanced systems documentation (Tags, Email, Engagement)</li>
            <li>ğŸ“ Registration and Check-in system details</li>
            <li>ğŸ›ï¸ Custom field system (Extra Values) documentation</li>
            <li>ğŸ“± Mobile app integration fields</li>
            <li>âœ… Corrected OrganizationStatusId values and other critical fixes</li>
        </ul>
    </div>
</div>

<div class="toc">
    <h2>ğŸ“– Table of Contents</h2>
    
    <h3>ğŸš€ Getting Started</h3>
    <ul>
        <li><a href="#database-overview">Database Overview & Architecture</a></li>
        <li><a href="#critical-rules">Critical Business Rules - READ THIS FIRST</a></li>
        <li><a href="#performance-guidelines">Performance Guidelines & Large Table Warnings</a></li>
        <li><a href="#common-queries">Most Common Queries (Quick Reference)</a></li>
    </ul>

    <h3>ğŸ‘¥ People & Families</h3>
    <ul>
        <li><a href="#people-table">People Table - Complete Reference</a></li>
        <li><a href="#family-structure">Family Relationships & Household Management</a></li>
        <li><a href="#contact-permissions">Contact Information & Communication Permissions</a></li>
        <li><a href="#membership-workflow">Church Membership Status & Workflow</a></li>
    </ul>

    <h3>ğŸ›ï¸ Organizations & Groups</h3>
    <ul>
        <li><a href="#organizations-table">Organizations Table (Involvements)</a></li>
        <li><a href="#organization-members">Organization Membership & Roles</a></li>
        <li><a href="#program-hierarchy">Program â†’ Division â†’ Organization Structure</a></li>
        <li><a href="#organization-types">Organization Types & Classification</a></li>
    </ul>

    <h3>ğŸ“… Attendance & Meetings</h3>
    <ul>
        <li><a href="#attend-table">Attend Table - The AttendanceFlag Rule</a></li>
        <li><a href="#meetings-table">Meetings & Scheduling</a></li>
        <li><a href="#attendance-types">Attendance Types & Classifications</a></li>
        <li><a href="#attendance-analytics">Attendance Analytics & Patterns</a></li>
    </ul>

    <h3>ğŸ’° Financial & Contributions</h3>
    <ul>
        <li><a href="#contribution-table">Contribution Table - The TypeIdâ‰ 99 Rule</a></li>
        <li><a href="#contribution-funds">Funds & Designations</a></li>
        <li><a href="#bundle-system">Bundle & Batch Processing</a></li>
        <li><a href="#transaction-system">Transactions & Outstanding Balances</a></li>
    </ul>

    <h3>ğŸ“ Events & Registration</h3>
    <ul>
        <li><a href="#registration-system">Registration System Architecture</a></li>
        <li><a href="#registration-questions">Custom Forms & Questions</a></li>
        <li><a href="#registration-fees">Registration Fees & Payments</a></li>
        <li><a href="#event-management">Event Management & Scheduling</a></li>
    </ul>

    <h3>ğŸ« Check-In System</h3>
    <ul>
        <li><a href="#checkin-overview">Check-In System Overview</a></li>
        <li><a href="#checkin-activity">Check-In Activity & Times</a></li>
        <li><a href="#checkin-configuration">Check-In Configuration & Settings</a></li>
        <li><a href="#barcode-system">Barcode & Security Labels</a></li>
    </ul>

    <h3>ğŸ“§ Communication Systems</h3>
    <ul>
        <li><a href="#email-system">Email Marketing System (3.9M+ records)</a></li>
        <li><a href="#sms-system">SMS/Text Messaging System</a></li>
        <li><a href="#task-system">Tasks & Ministry Communication</a></li>
        <li><a href="#notification-preferences">Notification Preferences & Opt-outs</a></li>
    </ul>

    <h3>ğŸ“Š Advanced Analytics</h3>
    <ul>
        <li><a href="#engagement-scoring">Engagement Scoring System (1.4M+ records)</a></li>
        <li><a href="#tag-system">Tag System (138M+ records)</a></li>
        <li><a href="#activity-logging">Activity Logging & Audit Trail</a></li>
        <li><a href="#change-tracking">Change Tracking & History</a></li>
    </ul>

    <h3>ğŸ›ï¸ Customization Systems</h3>
    <ul>
        <li><a href="#extra-values">Extra Value Tables (Custom Fields)</a></li>
        <li><a href="#lookup-tables">Lookup Tables Reference (67+ tables)</a></li>
        <li><a href="#settings-framework">Settings & Configuration Framework</a></li>
        <li><a href="#content-management">Content & Template Management</a></li>
    </ul>

    <h3>ğŸ“± Mobile & Integration</h3>
    <ul>
        <li><a href="#mobile-app">Mobile App Configuration</a></li>
        <li><a href="#picture-system">Picture & Media Management</a></li>
        <li><a href="#search-optimization">Search Optimization System</a></li>
        <li><a href="#api-integration">API Integration Points</a></li>
    </ul>

    <h3>ğŸ” Security & Administration</h3>
    <ul>
        <li><a href="#users-roles">Users, Roles & Permissions</a></li>
        <li><a href="#security-settings">Security Settings & Access Control</a></li>
        <li><a href="#data-privacy">Data Privacy & Protection</a></li>
    </ul>

    <h3>ğŸ“ˆ Reporting & Analytics</h3>
    <ul>
        <li><a href="#common-reports">Common Report Patterns</a></li>
        <li><a href="#dashboard-queries">Dashboard & KPI Queries</a></li>
        <li><a href="#growth-analytics">Growth & Trend Analytics</a></li>
        <li><a href="#financial-reports">Financial Reporting Queries</a></li>
    </ul>

    <h3>ğŸ”§ Reference & Troubleshooting</h3>
    <ul>
        <li><a href="#field-reference">Complete Field Reference</a></li>
        <li><a href="#relationship-diagram">Table Relationship Diagrams</a></li>
        <li><a href="#common-issues">Common Issues & Solutions</a></li>
        <li><a href="#best-practices">Best Practices & Tips</a></li>
    </ul>
</div>

<div id="database-overview" class="section">
    <h2>ğŸ“Š Database Overview & Architecture</h2>
    
    <p>TouchPoint is an enterprise-level church management system with one of the most comprehensive databases in the church software industry. Understanding its scale and architecture is crucial for effective use.</p>

    <h3>ğŸ—ï¸ Database Scale</h3>
    <table>
        <tr>
            <th>Metric</th>
            <th>Count</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><strong>Total Tables</strong></td>
            <td>378</td>
            <td>Complete system coverage from people to analytics</td>
        </tr>
        <tr>
            <td><strong>Total Columns</strong></td>
            <td>3,364</td>
            <td>Extensive data points for comprehensive tracking</td>
        </tr>
        <tr>
            <td><strong>Foreign Keys</strong></td>
            <td>452</td>
            <td>Complex relationships ensuring data integrity</td>
        </tr>
        <tr>
            <td><strong>Lookup Tables</strong></td>
            <td>67</td>
            <td>Business logic and validation rules</td>
        </tr>
        <tr>
            <td><strong>Extra Value Tables</strong></td>
            <td>17</td>
            <td>Unlimited custom field capabilities</td>
        </tr>
        <tr>
            <td><strong>Stored Procedures</strong></td>
            <td>495</td>
            <td>Complex operations and reporting</td>
        </tr>
    </table>

    <h3>ğŸ“ˆ Production Data Volumes</h3>
    <div class="highlight">
        <p><strong>Real-world production databases can contain massive data volumes:</strong></p>
        <table>
            <tr>
                <th>Table</th>
                <th>Record Count</th>
                <th>Purpose</th>
                <th>Performance Impact</th>
            </tr>
            <tr>
                <td><code>TagPerson</code></td>
                <td>138M+</td>
                <td>Flexible categorization</td>
                <td><span class="badge badge-critical">EXTREME</span></td>
            </tr>
            <tr>
                <td><code>EmailResponses</code></td>
                <td>3.9M+</td>
                <td>Email engagement tracking</td>
                <td><span class="badge badge-critical">HIGH</span></td>
            </tr>
            <tr>
                <td><code>EmailQueueTo</code></td>
                <td>3.8M+</td>
                <td>Email recipients</td>
                <td><span class="badge badge-critical">HIGH</span></td>
            </tr>
            <tr>
                <td><code>ActivityLog</code></td>
                <td>3.4M+</td>
                <td>Audit trail</td>
                <td><span class="badge badge-critical">HIGH</span></td>
            </tr>
            <tr>
                <td><code>PeopleSearchTokens</code></td>
                <td>1.7M+</td>
                <td>Search optimization</td>
                <td><span class="badge badge-performance">MEDIUM</span></td>
            </tr>
            <tr>
                <td><code>EngagementScoreTag</code></td>
                <td>1.4M+</td>
                <td>Activity scoring</td>
                <td><span class="badge badge-performance">MEDIUM</span></td>
            </tr>
            <tr>
                <td><code>Attend</code></td>
                <td>1.2M+</td>
                <td>Attendance records</td>
                <td><span class="badge badge-performance">MEDIUM</span></td>
            </tr>
            <tr>
                <td><code>Contribution</code></td>
                <td>673K+</td>
                <td>Financial giving</td>
                <td>LOW</td>
            </tr>
        </table>
    </div>

    <h3>ğŸ›ï¸ Core System Architecture</h3>
    <pre><code>-- Core Entity Relationships
People (PeopleId) 
    â”œâ”€â”€ FamilyId â†’ Groups family members
    â”œâ”€â”€ SpouseId â†’ Direct spouse link
    â””â”€â”€ OrganizationMembers â†’ Group participation
        â””â”€â”€ Organizations (OrganizationId)
            â”œâ”€â”€ Meetings â†’ Scheduled events
            â””â”€â”€ Attend â†’ Attendance records

People (PeopleId)
    â”œâ”€â”€ Contribution â†’ Financial giving
    â”‚   â””â”€â”€ ContributionFund â†’ Designated funds
    â”œâ”€â”€ TaskNote â†’ Tasks and notes
    â””â”€â”€ Registration â†’ Event signups
        â””â”€â”€ RegPeople â†’ Participants
            â””â”€â”€ RegAnswer â†’ Form responses</code></pre>
</div>

<div id="critical-rules" class="section">
    <h2>ğŸš¨ Critical Business Rules - READ THIS FIRST</h2>
    
    <div class="critical">
        <h3>âš ï¸ Rule #1: ALWAYS Use TOP Clause for Exploration</h3>
        <p>TouchPoint databases can contain millions of records. <strong>Never run unlimited queries without the TOP clause</strong> during exploration or testing.</p>
        <pre><code>-- âœ… CORRECT: Always start with TOP
SELECT TOP 100 * FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0

-- âŒ WRONG: Never run unlimited on large tables
SELECT * FROM TagPerson  -- This table has 138M+ records!</code></pre>
    </div>

    <div class="critical">
        <h3>âš ï¸ Rule #2: Mandatory Filters for Every Query</h3>
        <pre><code>-- ğŸš¨ FILTER #1: Active People Only
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0

-- ğŸš¨ FILTER #2: Actual Attendance (not absences)
WHERE a.AttendanceFlag = 1  -- 1 = present, 0 = absent

-- ğŸš¨ FILTER #3: Real Donations (not event fees)
WHERE c.ContributionTypeId != 99  -- 99 = event registration fee

-- ğŸš¨ FILTER #4: Active Organizations
WHERE o.OrganizationStatusId = 30  -- 30 = Active

-- ğŸš¨ FILTER #5: Current Members Only
WHERE om.InactiveDate IS NULL

-- ğŸš¨ FILTER #6: Completed Meetings
WHERE m.DidNotMeet = 0</code></pre>
    </div>

    <div class="highlight">
        <h3>ğŸ“‹ Communication Compliance Rules</h3>
        <pre><code>-- Always check permissions before communication
WHERE p.DoNotMailFlag = 0      -- Can send mail
WHERE p.DoNotCallFlag = 0      -- Can make calls
WHERE p.DoNotVisitFlag = 0     -- Can visit
WHERE p.ReceiveSMS = 1         -- Can send texts
WHERE p.SendEmailAddress1 = 1  -- Can email primary
WHERE p.SendEmailAddress2 = 1  -- Can email secondary</code></pre>
    </div>

    <div class="warning">
        <h3>âš ï¸ Data Quality Filters</h3>
        <pre><code>-- Ensure good data quality
WHERE p.PrimaryBadAddrFlag = 0  -- Valid addresses only
WHERE p.CellPhoneIsValid = 1    -- Valid phone numbers
WHERE p.EmailAddress IS NOT NULL AND p.EmailAddress != ''</code></pre>
    </div>
</div>

<div id="performance-guidelines" class="section">
    <h2>âš¡ Performance Guidelines & Large Table Warnings</h2>
    
    <h3>ğŸ¯ TOP Clause Usage Guidelines</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>TOP Value</th>
            <th>Use Case</th>
        </tr>
        <tr>
            <td>Initial Exploration</td>
            <td><code>TOP 100</code></td>
            <td>Testing queries, understanding data structure</td>
        </tr>
        <tr>
            <td>Sample Review</td>
            <td><code>TOP 500</code></td>
            <td>Reviewing data patterns, quality checks</td>
        </tr>
        <tr>
            <td>Larger Analysis</td>
            <td><code>TOP 1000</code></td>
            <td>Statistical sampling, trend analysis</td>
        </tr>
        <tr>
            <td>Comprehensive Sample</td>
            <td><code>TOP 5000</code></td>
            <td>Large samples (use with caution)</td>
        </tr>
        <tr>
            <td>Full Dataset</td>
            <td>No TOP</td>
            <td>ONLY for final production reports after testing</td>
        </tr>
    </table>

    <h3>ğŸš¨ High-Volume Table Requirements</h3>
    <div class="critical">
        <p><strong>These tables REQUIRE date filters and TOP clauses:</strong></p>
        <pre><code>-- TagPerson (138M+ records) - EXTREME CAUTION
SELECT TOP 100 * FROM TagPerson tp
WHERE tp.DateCreated >= DATEADD(day, -30, GETDATE())

-- EmailResponses (3.9M+ records)
SELECT TOP 100 * FROM EmailResponses er
WHERE er.Dt >= DATEADD(week, -1, GETDATE())

-- ActivityLog (3.4M+ records)
SELECT TOP 100 * FROM ActivityLog al
WHERE al.ActivityDate >= DATEADD(day, -7, GETDATE())

-- EngagementScoreTag (1.4M+ records)
SELECT TOP 100 * FROM EngagementScoreTag est
JOIN EngagementScore es ON est.EngagementScoreId = es.Id
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())

-- EmailQueueTo (3.8M+ records)
SELECT TOP 100 * FROM EmailQueueTo eqt
JOIN EmailQueue eq ON eqt.Id = eq.Id
WHERE eq.Sent >= DATEADD(month, -1, GETDATE())</code></pre>
    </div>

    <h3>âœ… Safe Query Development Process</h3>
    <pre><code>-- STEP 1: Start with minimal data
SELECT TOP 10 * 
FROM YourTable
WHERE DateField >= DATEADD(day, -1, GETDATE())

-- STEP 2: Verify query logic with small sample
SELECT TOP 100 
    SpecificColumns,
    YouNeed
FROM YourTable
WHERE DateField >= DATEADD(week, -1, GETDATE())
  AND OtherFilters = 'Applied'

-- STEP 3: Expand sample if needed
SELECT TOP 1000 
    -- your final column list
FROM YourTable
WHERE -- all your filters
ORDER BY -- your sort

-- STEP 4: Remove TOP only for production reports
-- after confirming performance is acceptable</code></pre>
</div>

<div id="common-queries" class="section">
    <h2>ğŸ¯ Most Common Queries (Quick Reference)</h2>
    
    <h3>ğŸ‘¥ Active Church Members</h3>
    <pre><code>SELECT TOP 1000 
    p.PeopleId,
    p.Name,
    p.EmailAddress,
    p.CellPhone,
    ms.Description as MemberStatus,
    DATEDIFF(year, p.BDate, GETDATE()) as Age,
    c.Description as Campus
FROM People p
JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
  AND p.MemberStatusId = 10  -- Members only
ORDER BY p.Name</code></pre>

    <h3>ğŸ“… Recent Attendance</h3>
    <pre><code>SELECT TOP 500
    p.Name,
    o.OrganizationName,
    m.MeetingDate,
    at.Description as AttendanceType
FROM Attend a
JOIN People p ON a.PeopleId = p.PeopleId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
WHERE a.AttendanceFlag = 1  -- Critical: actual attendance
  AND m.MeetingDate >= DATEADD(week, -1, GETDATE())
  AND m.DidNotMeet = 0
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY m.MeetingDate DESC, o.OrganizationName, p.Name</code></pre>

    <h3>ğŸ’° Recent Giving</h3>
    <pre><code>SELECT TOP 500
    p.Name,
    c.ContributionDate,
    c.ContributionAmount,
    cf.FundName,
    c.CheckNo
FROM Contribution c
JOIN People p ON c.PeopleId = p.PeopleId
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- Exclude event fees
  AND c.ContributionDate >= DATEADD(month, -1, GETDATE())
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY c.ContributionDate DESC, c.ContributionAmount DESC</code></pre>

    <h3>ğŸ†• First-Time Visitors</h3>
    <pre><code>-- Recent first-time visitors for follow-up
WITH FirstVisit AS (
    SELECT 
        p.PeopleId,
        MIN(a.MeetingDate) as FirstVisitDate
    FROM Attend a
    JOIN People p ON a.PeopleId = p.PeopleId
    WHERE a.AttendanceFlag = 1
      AND a.AttendanceTypeId IN (40, 50)  -- New Guest, Recent Guest
    GROUP BY p.PeopleId
)
SELECT TOP 100
    p.Name,
    p.EmailAddress,
    p.CellPhone,
    fv.FirstVisitDate,
    DATEDIFF(day, fv.FirstVisitDate, GETDATE()) as DaysSinceVisit
FROM FirstVisit fv
JOIN People p ON fv.PeopleId = p.PeopleId
WHERE fv.FirstVisitDate >= DATEADD(week, -2, GETDATE())
  AND p.DoNotCallFlag = 0
  AND p.DoNotVisitFlag = 0
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
ORDER BY fv.FirstVisitDate DESC</code></pre>

    <h3>ğŸ“Š Organization Summary</h3>
    <pre><code>SELECT TOP 100
    o.OrganizationName,
    o.Location,
    leader.Name as Leader,
    o.MemberCount,
    o.Limit as Capacity,
    CASE 
        WHEN o.Limit > 0 THEN 
            CAST(o.MemberCount as float) / o.Limit * 100 
        ELSE 0 
    END as PercentFull,
    o.FirstMeetingDate,
    o.LastMeetingDate
FROM Organizations o
LEFT JOIN People leader ON o.LeaderId = leader.PeopleId
WHERE o.OrganizationStatusId = 30  -- Active
ORDER BY o.MemberCount DESC</code></pre>
</div>

<div id="people-table" class="section">
    <h2>ğŸ‘¥ People Table - Complete Reference</h2>
    
    <p><strong>Purpose:</strong> Central repository for all person and family data<br>
    <strong>Primary Key:</strong> <code>PeopleId</code><br>
    <strong>Scale:</strong> 136 columns with 23 foreign key relationships<br>
    <strong>Critical Rule:</strong> Always filter <code>WHERE IsDeceased = 0 AND ArchivedFlag = 0</code></p>

    <h3>Core Identity Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>PeopleExtra</code></td>
            <td>Mixed</td>
            <td>Person-specific custom fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueBit</code></td>
            <td>Boolean</td>
            <td>Yes/No fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueDate</code></td>
            <td>DateTime</td>
            <td>Date fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueInt</code></td>
            <td>Integer</td>
            <td>Number fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueText</code></td>
            <td>Text</td>
            <td>Text fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueCode</code></td>
            <td>Code</td>
            <td>Dropdown/lookup fields</td>
        </tr>
        <tr>
            <td><code>OrgExtra</code></td>
            <td>Mixed</td>
            <td>Organization custom fields</td>
        </tr>
        <tr>
            <td><code>MeetingExtra</code></td>
            <td>Mixed</td>
            <td>Meeting custom fields</td>
        </tr>
        <tr>
            <td><code>ContributionExtra</code></td>
            <td>Mixed</td>
            <td>Contribution custom fields</td>
        </tr>
    </table>

    <h3>Discovering Custom Fields</h3>
    <pre><code>-- Find what custom fields your church uses
SELECT TOP 500
    'PeopleExtra' as TableType,
    Field,
    COUNT(*) as RecordCount,
    COUNT(DISTINCT PeopleId) as PeopleWithValue
FROM PeopleExtra
GROUP BY Field
ORDER BY COUNT(*) DESC

-- Example: Using a custom field
SELECT 
    p.Name,
    pev.Field,
    pev.Data as Value
FROM People p
JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE pev.Field = 'MembershipCovenant'  -- Church-specific field
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name</code></pre>

    <h3>Custom Field Analysis</h3>
    <pre><code>-- Analyze custom field usage patterns
WITH CustomFieldStats AS (
    SELECT 
        Field,
        COUNT(*) as Uses,
        COUNT(DISTINCT PeopleId) as UniquePeople,
        MIN(CAST(Data as datetime)) as EarliestDate,
        MAX(CAST(Data as datetime)) as LatestDate
    FROM PeopleExtra
    WHERE Field LIKE '%Date%'  -- Date-type fields
      AND ISDATE(Data) = 1
    GROUP BY Field
)
SELECT 
    Field,
    Uses,
    UniquePeople,
    EarliestDate,
    LatestDate,
    DATEDIFF(day, EarliestDate, LatestDate) as DateRange
FROM CustomFieldStats
ORDER BY Uses DESC</code></pre>
</div>

<div id="lookup-tables" class="section">
    <h2>ğŸ“š Lookup Tables Reference</h2>
    
    <p>TouchPoint includes 67+ lookup tables that provide business logic, validation rules, and categorization throughout the system.</p>

    <h3>Critical Lookup Tables</h3>
    
    <h4>lookup.MemberStatus <span class="badge badge-critical">Most Important</span></h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Member</td>
            <td>Full church members - voting, leadership eligible</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Prospect</td>
            <td>Potential members - follow-up focus</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Not Member</td>
            <td>Regular attenders, not members</td>
        </tr>
        <tr>
            <td>40</td>
            <td>Previous Member</td>
            <td>Former members - different communication</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Just Added</td>
            <td>New records - need data cleanup</td>
        </tr>
    </table>

    <h4>lookup.AttendType <span class="badge badge-critical">Important</span></h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Worker</th>
            <th>Guest</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Member</td>
            <td>0</td>
            <td>0</td>
            <td>Regular members</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Leader</td>
            <td>1</td>
            <td>0</td>
            <td>Leadership roles</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Volunteer</td>
            <td>1</td>
            <td>0</td>
            <td>Volunteer workers</td>
        </tr>
        <tr>
            <td>40</td>
            <td>New Guest</td>
            <td>0</td>
            <td>1</td>
            <td>First-time visitors</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Recent Guest</td>
            <td>0</td>
            <td>1</td>
            <td>Return visitors</td>
        </tr>
        <tr>
            <td>60</td>
            <td>Visiting Member</td>
            <td>0</td>
            <td>0</td>
            <td>Members from other churches</td>
        </tr>
    </table>

    <h4>lookup.FamilyPosition</h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Primary Adult</td>
            <td>Head of household</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Secondary Adult</td>
            <td>Spouse/partner</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Child</td>
            <td>Dependent children</td>
        </tr>
    </table>

    <h4>Other Important Lookup Tables</h4>
    <pre><code>-- Common lookup tables and their purposes
SELECT 'Gender' as LookupTable, Id, Description FROM lookup.Gender
UNION ALL
SELECT 'MaritalStatus', Id, Description FROM lookup.MaritalStatus
UNION ALL
SELECT 'Campus', Id, Description FROM lookup.Campus
UNION ALL
SELECT 'OrganizationStatus', Id, Description FROM lookup.OrganizationStatus
UNION ALL
SELECT 'ContributionType', Id, Description FROM lookup.ContributionType
UNION ALL
SELECT 'BaptismStatus', Id, Description FROM lookup.BaptismStatus
UNION ALL
SELECT 'DecisionType', Id, Description FROM lookup.DecisionType
UNION ALL
SELECT 'DropType', Id, Description FROM lookup.DropType
ORDER BY LookupTable, Id</code></pre>
</div>

<div id="common-reports" class="section">
    <h2>ğŸ“ˆ Common Report Patterns</h2>
    
    <h3>Church Dashboard Metrics</h3>
    <pre><code>-- Executive Dashboard Query
WITH Metrics AS (
    SELECT 
        -- People Metrics
        (SELECT COUNT(*) FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0 AND MemberStatusId = 10) as ActiveMembers,
        (SELECT COUNT(*) FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0 AND MemberStatusId = 20) as Prospects,
        
        -- Attendance Metrics (Last Week)
        (SELECT COUNT(DISTINCT a.PeopleId) 
         FROM Attend a 
         WHERE a.AttendanceFlag = 1 
           AND a.MeetingDate >= DATEADD(week, -1, GETDATE())) as WeeklyAttendance,
        
        -- Attendance Metrics (Last Month)
        (SELECT COUNT(DISTINCT a.PeopleId) 
         FROM Attend a 
         WHERE a.AttendanceFlag = 1 
           AND a.MeetingDate >= DATEADD(month, -1, GETDATE())) as MonthlyAttendance,
        
        -- Financial Metrics
        (SELECT SUM(ContributionAmount) 
         FROM Contribution 
         WHERE ContributionTypeId != 99 
           AND ContributionDate >= DATEADD(month, -1, GETDATE())) as MonthlyGiving,
        
        (SELECT COUNT(DISTINCT PeopleId) 
         FROM Contribution 
         WHERE ContributionTypeId != 99 
           AND ContributionDate >= DATEADD(month, -1, GETDATE())) as MonthlyGivers,
        
        -- Organization Metrics
        (SELECT COUNT(*) FROM Organizations WHERE OrganizationStatusId = 30) as ActiveOrganizations,
        
        -- New People
        (SELECT COUNT(*) 
         FROM People 
         WHERE CreatedDate >= DATEADD(month, -1, GETDATE()) 
           AND IsDeceased = 0 AND ArchivedFlag = 0) as NewPeopleThisMonth
)
SELECT * FROM Metrics</code></pre>

    <h3>Attendance Trends Report</h3>
    <pre><code>-- Weekly attendance trends over 12 weeks
WITH WeeklyAttendance AS (
    SELECT 
        DATEPART(year, a.MeetingDate) as Year,
        DATEPART(week, a.MeetingDate) as Week,
        MIN(CAST(a.MeetingDate as DATE)) as WeekStart,
        COUNT(DISTINCT a.PeopleId) as UniqueAttenders,
        COUNT(*) as TotalAttendances,
        COUNT(DISTINCT a.OrganizationId) as OrgsWithMeetings,
        COUNT(DISTINCT CASE WHEN at.Guest = 1 THEN a.PeopleId END) as Guests,
        COUNT(DISTINCT CASE WHEN at.Worker = 1 THEN a.PeopleId END) as Workers
    FROM Attend a
    JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
    WHERE a.AttendanceFlag = 1
      AND a.MeetingDate >= DATEADD(week, -12, GETDATE())
    GROUP BY DATEPART(year, a.MeetingDate), DATEPART(week, a.MeetingDate)
)
SELECT 
    WeekStart,
    UniqueAttenders,
    Guests,
    Workers,
    UniqueAttenders - Guests - Workers as Members,
    TotalAttendances,
    OrgsWithMeetings,
    CAST(TotalAttendances as float) / NULLIF(UniqueAttenders, 0) as AvgAttendancesPerPerson
FROM WeeklyAttendance
ORDER BY WeekStart DESC</code></pre>

    <h3>Giving Analysis Report</h3>
    <pre><code>-- Comprehensive giving analysis
WITH GivingStats AS (
    SELECT 
        p.PeopleId,
        p.Name,
        COUNT(*) as GiftCount,
        SUM(c.ContributionAmount) as TotalGiven,
        MIN(c.ContributionDate) as FirstGift,
        MAX(c.ContributionDate) as LastGift,
        DATEDIFF(day, MAX(c.ContributionDate), GETDATE()) as DaysSinceLastGift
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
    GROUP BY p.PeopleId, p.Name
)
SELECT 
    CASE 
        WHEN TotalGiven >= 10000 THEN 'Major Donor ($10K+)'
        WHEN TotalGiven >= 5000 THEN 'Significant Donor ($5K-$10K)'
        WHEN TotalGiven >= 1000 THEN 'Regular Donor ($1K-$5K)'
        WHEN TotalGiven >= 100 THEN 'Small Donor ($100-$1K)'
        ELSE 'Micro Donor (<$100)'
    END as DonorLevel,
    COUNT(*) as DonorCount,
    SUM(TotalGiven) as TotalFromLevel,
    AVG(TotalGiven) as AvgGiftPerDonor,
    AVG(GiftCount) as AvgGiftsPerDonor
FROM GivingStats
GROUP BY 
    CASE 
        WHEN TotalGiven >= 10000 THEN 'Major Donor ($10K+)'
        WHEN TotalGiven >= 5000 THEN 'Significant Donor ($5K-$10K)'
        WHEN TotalGiven >= 1000 THEN 'Regular Donor ($1K-$5K)'
        WHEN TotalGiven >= 100 THEN 'Small Donor ($100-$1K)'
        ELSE 'Micro Donor (<$100)'
    END
ORDER BY MIN(TotalGiven) DESC</code></pre>

    <h3>Group Health Report</h3>
    <pre><code>-- Organization/group health metrics
SELECT TOP 500
    o.OrganizationName,
    o.Location,
    leader.Name as Leader,
    o.MemberCount,
    o.Limit as Capacity,
    
    -- Capacity Metrics
    CASE 
        WHEN o.Limit > 0 THEN CAST(o.MemberCount as float) / o.Limit * 100 
        ELSE NULL 
    END as PercentFull,
    
    -- Meeting Metrics
    (SELECT COUNT(*) 
     FROM Meetings m 
     WHERE m.OrganizationId = o.OrganizationId 
       AND m.MeetingDate >= DATEADD(month, -3, GETDATE())
       AND m.DidNotMeet = 0) as MeetingsLast3Months,
    
    -- Attendance Metrics
    (SELECT AVG(CAST(NumPresent as float))
     FROM Meetings m 
     WHERE m.OrganizationId = o.OrganizationId 
       AND m.MeetingDate >= DATEADD(month, -3, GETDATE())
       AND m.DidNotMeet = 0) as AvgAttendance,
    
    -- Engagement
    (SELECT AVG(om.AttendPct)
     FROM OrganizationMembers om
     WHERE om.OrganizationId = o.OrganizationId
       AND om.InactiveDate IS NULL) as AvgMemberEngagement,
    
    -- Growth
    (SELECT COUNT(*)
     FROM OrganizationMembers om
     WHERE om.OrganizationId = o.OrganizationId
       AND om.EnrollmentDate >= DATEADD(month, -3, GETDATE())) as NewMembersLast3Months
    
FROM Organizations o
LEFT JOIN People leader ON o.LeaderId = leader.PeopleId
WHERE o.OrganizationStatusId = 30
ORDER BY o.MemberCount DESC</code></pre>
</div>

<div id="common-issues" class="section">
    <h2>ğŸ”§ Common Issues & Solutions</h2>
    
    <h3>Issue: Query Times Out</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Query runs forever or times out</p>
        <p><strong>Solutions:</strong></p>
        <ol>
            <li>Add <code>TOP 100</code> to limit results</li>
            <li>Add date filters: <code>WHERE DateField >= DATEADD(month, -1, GETDATE())</code></li>
            <li>Check for missing filters on large tables (TagPerson, EmailResponses, etc.)</li>
            <li>Verify indexes exist on join columns</li>
        </ol>
    </div>

    <h3>Issue: Attendance Numbers Don't Match UI</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Attendance counts differ from TouchPoint interface</p>
        <p><strong>Solution:</strong> Verify these filters are applied:</p>
        <pre><code>WHERE a.AttendanceFlag = 1  -- Only count actual attendance
  AND m.DidNotMeet = 0      -- Exclude cancelled meetings
  AND p.IsDeceased = 0      -- Exclude deceased
  AND p.ArchivedFlag = 0    -- Exclude archived</code></pre>
    </div>

    <h3>Issue: Giving Reports Include Event Fees</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Donation totals are inflated</p>
        <p><strong>Solution:</strong> Always exclude event registration fees:</p>
        <pre><code>WHERE c.ContributionTypeId != 99  -- Exclude event fees</code></pre>
    </div>

    <h3>Issue: Deceased People Appearing</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Reports include deceased individuals</p>
        <p><strong>Solution:</strong> Always include both filters:</p>
        <pre><code>WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>
    </div>

    <h3>Issue: Organizations Show as Inactive</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Active organizations not appearing</p>
        <p><strong>Solution:</strong> Use correct status value:</p>
        <pre><code>WHERE o.OrganizationStatusId = 30  -- NOT 1!</code></pre>
    </div>

    <h3>Issue: Can't Find Custom Fields</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Church-specific fields not found</p>
        <p><strong>Solution:</strong> Query Extra Value tables:</p>
        <pre><code>-- Discover available custom fields
SELECT DISTINCT Field, COUNT(*) as Uses
FROM PeopleExtra
GROUP BY Field
ORDER BY COUNT(*) DESC</code></pre>
    </div>
</div>

<div id="best-practices" class="section">
    <h2>âœ… Best Practices & Tips</h2>
    
    <h3>ğŸ¯ Query Development Process</h3>
    <ol>
        <li><strong>Start Small:</strong> Use <code>TOP 10</code> to test logic</li>
        <li><strong>Add Filters Early:</strong> Apply mandatory filters immediately</li>
        <li><strong>Test Incrementally:</strong> Build complex queries step by step</li>
        <li><strong>Check Performance:</strong> Monitor execution time</li>
        <li><strong>Document Assumptions:</strong> Comment your business logic</li>
    </ol>

    <h3>ğŸ“‹ Mandatory Filter Checklist</h3>
    <pre><code>-- Copy this template for every query
WHERE 1=1
  -- People filters
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
  
  -- Attendance filters
  AND a.AttendanceFlag = 1
  AND m.DidNotMeet = 0
  
  -- Organization filters
  AND o.OrganizationStatusId = 30
  AND om.InactiveDate IS NULL
  
  -- Contribution filters
  AND c.ContributionTypeId != 99
  
  -- Performance filters
  AND DateField >= DATEADD(month, -3, GETDATE())</code></pre>

    <h3>ğŸš€ Performance Optimization</h3>
    <table>
        <tr>
            <th>Technique</th>
            <th>When to Use</th>
            <th>Example</th>
        </tr>
        <tr>
            <td>Use TOP</td>
            <td>Exploration & testing</td>
            <td><code>SELECT TOP 100</code></td>
        </tr>
        <tr>
            <td>Date filters</td>
            <td>Always on large tables</td>
            <td><code>WHERE Date >= DATEADD(month, -1, GETDATE())</code></td>
        </tr>
        <tr>
            <td>Specific IDs</td>
            <td>When possible</td>
            <td><code>WHERE PeopleId IN (1,2,3)</code></td>
        </tr>
        <tr>
            <td>EXISTS vs JOIN</td>
            <td>Checking existence</td>
            <td><code>WHERE EXISTS (SELECT 1...)</code></td>
        </tr>
        <tr>
            <td>Column list</td>
            <td>Always specify</td>
            <td>Avoid <code>SELECT *</code></td>
        </tr>
    </table>

    <h3>ğŸ“ Documentation Standards</h3>
    <pre><code>-- Query: Monthly Giving Summary
-- Purpose: Summarize giving by fund for board report
-- Author: [Your Name]
-- Date: [Current Date]
-- Performance: ~2 seconds on production
-- Dependencies: Contribution, ContributionFund, People tables
-- Business Rules:
--   - Excludes event fees (TypeId != 99)
--   - Only includes completed transactions
--   - Groups by calendar month

SELECT TOP 500
    /* Month grouping */
    YEAR(c.ContributionDate) as GiftYear,
    MONTH(c.ContributionDate) as GiftMonth,
    
    /* Fund analysis */
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as UniqueGivers,
    SUM(c.ContributionAmount) as TotalAmount
    
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- Exclude event fees
  AND c.ContributionDate >= '2024-01-01'
GROUP BY 
    YEAR(c.ContributionDate),
    MONTH(c.ContributionDate),
    cf.FundId,
    cf.FundName
ORDER BY 
    GiftYear DESC,
    GiftMonth DESC,
    TotalAmount DESC</code></pre>
</div>

<div id="relationship-diagram" class="section">
    <h2>ğŸ”— Essential Table Relationships</h2>
    
    <h3>Core Relationships</h3>
    <pre><code>People (PeopleId) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                        â”‚
    â”œâ”€â”€â†’ Families (FamilyId)                 â”‚
    â”‚    Groups family members               â”‚
    â”‚                                        â”‚
    â”œâ”€â”€â†’ People (SpouseId)                   â”‚
    â”‚    Direct spouse link                  â”‚
    â”‚                                        â”‚
    â”œâ”€â”€â†’ OrganizationMembers â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚    â”‚                                   â”‚
    â”‚    â””â”€â”€â†’ Organizations (OrganizationId) â”‚
    â”‚         â”‚                              â”‚
    â”‚         â”œâ”€â”€â†’ Meetings (MeetingId) â†â”€â”€â”€â”€â”¤
    â”‚         â”‚                              â”‚
    â”‚         â””â”€â”€â†’ Attend â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚              (PeopleId + MeetingId + OrganizationId)
    â”‚
    â”œâ”€â”€â†’ Contribution (ContributionId)
    â”‚    â”‚
    â”‚    â””â”€â”€â†’ ContributionFund (FundId)
    â”‚
    â”œâ”€â”€â†’ Registration (RegistrationId)
    â”‚    â”‚
    â”‚    â””â”€â”€â†’ RegPeople (RegPeopleId)
    â”‚         â”‚
    â”‚         â””â”€â”€â†’ RegAnswer (RegAnswerId)
    â”‚              â”‚
    â”‚              â””â”€â”€â†’ RegQuestion (RegQuestionId)
    â”‚
    â”œâ”€â”€â†’ TaskNote (TaskNoteId)
    â”‚    About person tasks/notes
    â”‚
    â”œâ”€â”€â†’ EmailQueueTo (EmailQueueToId)
    â”‚    â”‚
    â”‚    â””â”€â”€â†’ EmailResponses (Event tracking)
    â”‚
    â””â”€â”€â†’ TagPerson (138M+ records!)
         â”‚
         â””â”€â”€â†’ Tag (TagId)</code></pre>

    <h3>Lookup Relationships</h3>
    <pre><code>People Table Lookups:
    â”œâ”€â”€â†’ lookup.MemberStatus (MemberStatusId)
    â”œâ”€â”€â†’ lookup.Gender (GenderId)
    â”œâ”€â”€â†’ lookup.MaritalStatus (MaritalStatusId)
    â”œâ”€â”€â†’ lookup.FamilyPosition (PositionInFamilyId)
    â”œâ”€â”€â†’ lookup.Campus (CampusId)
    â”œâ”€â”€â†’ lookup.EntryPoint (EntryPointId)
    â”œâ”€â”€â†’ lookup.BaptismStatus (BaptismStatusId)
    â””â”€â”€â†’ lookup.DropType (DropCodeId)

Organization Table Lookups:
    â”œâ”€â”€â†’ lookup.OrganizationStatus (OrganizationStatusId = 30 for Active)
    â”œâ”€â”€â†’ lookup.OrganizationType (OrganizationTypeId)
    â”œâ”€â”€â†’ lookup.Campus (CampusId)
    â””â”€â”€â†’ Division â†’ Program (Hierarchy)

Attendance Lookups:
    â”œâ”€â”€â†’ lookup.AttendType (AttendanceTypeId)
    â””â”€â”€â†’ lookup.MemberType (MemberTypeId)
         â””â”€â”€â†’ lookup.AttendType (AttendanceTypeId)</code></pre>
</div>

<div class="section">
    <h2>ğŸ‰ Conclusion</h2>
    
    <p>This comprehensive guide covers TouchPoint's extensive database architecture, from basic queries to advanced analytics. Remember these key principles:</p>
    
    <div class="success">
        <h3>âœ… Key Takeaways</h3>
        <ul>
            <li><strong>Always use TOP clauses</strong> when exploring data</li>
            <li><strong>Apply mandatory filters</strong> (IsDeceased, ArchivedFlag, AttendanceFlag)</li>
            <li><strong>Use date ranges</strong> on large tables</li>
            <li><strong>Exclude event fees</strong> from giving reports (TypeId != 99)</li>
            <li><strong>Check OrganizationStatusId = 30</strong> for active organizations</li>
            <li><strong>Respect communication preferences</strong> before contacting people</li>
            <li><strong>Test incrementally</strong> with small datasets first</li>
        </ul>
    </div>
    
    <div class="info">
        <h3>ğŸ“š Additional Resources</h3>
        <ul>
            <li><strong>TouchPoint Documentation:</strong> <a href="https://docs.touchpoint.church">docs.touchpoint.church</a></li>
            <li><strong>Community Forum:</strong> <a href="https://community.touchpoint.church">community.touchpoint.church</a></li>
            <li><strong>GitHub Repository:</strong> <a href="https://github.com/bswaby/touchpoint">github.com/bswaby/touchpoint</a></li>
        </ul>
    </div>
    
    <div class="highlight">
        <h3>ğŸ™ Contributing</h3>
        <p>This guide is maintained by the TouchPoint community. If you discover new patterns, corrections, or useful queries, please contribute back to help other churches maximize their use of TouchPoint.</p>
        <p><strong>Contact:</strong> For questions or contributions, please open an issue on GitHub or contact the community forum.</p>
    </div>
</div>

<a href="#" class="back-to-top">â†‘ Top</a>

<script>
// Add copy buttons to code blocks
document.addEventListener('DOMContentLoaded', function() {
    const codeBlocks = document.querySelectorAll('pre');
    
    codeBlocks.forEach(function(block) {
        // Create copy button
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        
        // Make pre position relative for absolute button positioning
        block.style.position = 'relative';
        
        // Add click handler
        button.addEventListener('click', function() {
            const code = block.querySelector('code');
            const text = code ? code.textContent : block.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                button.textContent = 'Copied!';
                setTimeout(function() {
                    button.textContent = 'Copy';
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                    }, 2000);
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                }
                document.body.removeChild(textarea);
            });
        });
        
        block.appendChild(button);
    });
    
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Back to top button visibility
    const backToTop = document.querySelector('.back-to-top');
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            backToTop.style.display = 'block';
        } else {
            backToTop.style.display = 'none';
        }
    });
});
</script>

<!-- ============================== -->
<!-- ADDITIONAL CRITICAL TABLES SECTION -->
<!-- ============================== -->

<div id="families-system" class="section">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Families & Household Management</h2>
    
    <div class="warning">
        <strong>Critical Relationship Table:</strong> The Families table is central to TouchPoint's household structure. Always join with People table for complete household information.
    </div>

    <h3>Families Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Links to People.FamilyId</td>
        </tr>
        <tr>
            <td><code>HeadOfHouseholdId</code></td>
            <td>int</td>
            <td>Primary adult</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>HeadOfHouseholdSpouseId</code></td>
            <td>int</td>
            <td>Spouse</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>CoupleFlag</code></td>
            <td>int</td>
            <td>Married couple</td>
            <td>1 = Couple, 0 = Single</td>
        </tr>
        <tr>
            <td><code>AddressLineOne</code></td>
            <td>nvarchar</td>
            <td>Primary address</td>
            <td>Family's main address</td>
        </tr>
        <tr>
            <td><code>HomePhone</code></td>
            <td>nvarchar</td>
            <td>Home phone</td>
            <td>Shared family phone</td>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Family photo</td>
            <td>â†’ Picture.PictureId</td>
        </tr>
    </table>

    <h3>Family Queries</h3>
    <pre><code>-- Get complete family information
SELECT 
    f.FamilyId,
    head.Name as HeadOfHousehold,
    spouse.Name as Spouse,
    f.AddressLineOne + ', ' + f.CityName + ', ' + f.StateCode + ' ' + f.ZipCode as FullAddress,
    COUNT(DISTINCT p.PeopleId) as FamilySize,
    COUNT(DISTINCT CASE WHEN p.PositionInFamilyId = 30 THEN p.PeopleId END) as ChildCount
FROM Families f
LEFT JOIN People head ON f.HeadOfHouseholdId = head.PeopleId
LEFT JOIN People spouse ON f.HeadOfHouseholdSpouseId = spouse.PeopleId
LEFT JOIN People p ON f.FamilyId = p.FamilyId
WHERE f.BadAddressFlag = 0
GROUP BY f.FamilyId, head.Name, spouse.Name, 
         f.AddressLineOne, f.CityName, f.StateCode, f.ZipCode
ORDER BY head.Name

-- Find single-parent families
SELECT 
    f.FamilyId,
    head.Name as SingleParent,
    COUNT(p.PeopleId) as ChildrenCount
FROM Families f
JOIN People head ON f.HeadOfHouseholdId = head.PeopleId
JOIN People p ON f.FamilyId = p.FamilyId AND p.PositionInFamilyId = 30
WHERE f.CoupleFlag = 0
  AND EXISTS (SELECT 1 FROM People WHERE FamilyId = f.FamilyId AND PositionInFamilyId = 30)
GROUP BY f.FamilyId, head.Name
HAVING COUNT(p.PeopleId) > 0</code></pre>
</div>

<div id="financial-system" class="section">
    <h2>ğŸ’° Financial & Transaction Management</h2>
    
    <div class="critical">
        <strong>âš ï¸ Financial Data Warning:</strong> These tables contain sensitive financial information. Always use appropriate security filters and never expose raw transaction data in reports.
    </div>

    <h3>Transaction Table (85K+ records)</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Critical Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Transaction ID</td>
            <td>Primary key</td>
        </tr>
        <tr>
            <td><code>OrgId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations.OrganizationId</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Amt</code></td>
            <td>decimal</td>
            <td>Amount</td>
            <td>Transaction amount</td>
        </tr>
        <tr>
            <td><code>TransactionDate</code></td>
            <td>datetime</td>
            <td>Date</td>
            <td>When processed</td>
        </tr>
        <tr>
            <td><code>PaymentType</code></td>
            <td>nvarchar</td>
            <td>Payment method</td>
            <td>Credit, Check, Cash, etc.</td>
        </tr>
        <tr>
            <td><code>Approved</code></td>
            <td>bit</td>
            <td>Status</td>
            <td>1 = Approved</td>
        </tr>
    </table>

    <h3>EnrollmentTransaction Table (317K+ records)</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>Key Fields</th>
            <th>Links To</th>
        </tr>
        <tr>
            <td>Registration payments</td>
            <td>TransactionId, RegPersonId, Amt</td>
            <td>Transaction, RecReg, People</td>
        </tr>
    </table>

    <h3>Financial Queries</h3>
    <pre><code>-- Monthly giving summary by fund
SELECT 
    YEAR(c.ContributionDate) as Year,
    MONTH(c.ContributionDate) as Month,
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as Givers,
    COUNT(*) as Gifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionDate >= DATEADD(month, -12, GETDATE())
  AND c.ContributionStatusId = 0  -- Posted
GROUP BY YEAR(c.ContributionDate), MONTH(c.ContributionDate), cf.FundName
ORDER BY Year DESC, Month DESC, TotalAmount DESC

-- Registration revenue by event
SELECT 
    o.OrganizationName,
    COUNT(DISTINCT et.RegPersonId) as Registrants,
    SUM(et.Amt) as TotalRevenue,
    AVG(et.Amt) as AvgPayment,
    MIN(t.TransactionDate) as FirstPayment,
    MAX(t.TransactionDate) as LastPayment
FROM EnrollmentTransaction et
JOIN Transaction t ON et.TransactionId = t.Id
JOIN Organizations o ON t.OrgId = o.OrganizationId
WHERE t.Approved = 1
  AND t.TransactionDate >= DATEADD(year, -1, GETDATE())
GROUP BY o.OrganizationName
HAVING SUM(et.Amt) > 0
ORDER BY TotalRevenue DESC</code></pre>
</div>

<div id="sms-communication" class="section">
    <h2>ğŸ“± SMS & Text Messaging System</h2>
    
    <h3>SMS System Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Records</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>SMSGroups</code></td>
            <td>Varies</td>
            <td>Text groups</td>
            <td>Id, Name, Description</td>
        </tr>
        <tr>
            <td><code>SMSGroupMembers</code></td>
            <td>Varies</td>
            <td>Group membership</td>
            <td>GroupId, PeopleId</td>
        </tr>
        <tr>
            <td><code>SMSItems</code></td>
            <td>332K+</td>
            <td>Individual messages</td>
            <td>Id, PeopleId, Message, Sent</td>
        </tr>
        <tr>
            <td><code>SMSList</code></td>
            <td>147K+</td>
            <td>Bulk messages</td>
            <td>Id, SenderId, Message, SendAt</td>
        </tr>
        <tr>
            <td><code>SmsReceived</code></td>
            <td>Varies</td>
            <td>Incoming texts</td>
            <td>FromPeopleId, Body, DateReceived</td>
        </tr>
    </table>

    <h3>SMS Queries</h3>
    <pre><code>-- SMS group activity summary
SELECT 
    sg.Name as GroupName,
    COUNT(DISTINCT sgm.PeopleId) as Members,
    COUNT(DISTINCT si.Id) as MessagesSent,
    MAX(si.Sent) as LastActivity
FROM SMSGroups sg
LEFT JOIN SMSGroupMembers sgm ON sg.Id = sgm.GroupId
LEFT JOIN SMSItems si ON sgm.PeopleId = si.PeopleId
GROUP BY sg.Name
ORDER BY Members DESC

-- Text messaging engagement
SELECT 
    p.Name,
    COUNT(DISTINCT sl.ID) as MessagesSent,
    COUNT(DISTINCT sr.ID) as MessagesReceived,
    MAX(sl.SendAt) as LastSent,
    MAX(sr.DateReceived) as LastReceived
FROM People p
LEFT JOIN SMSList sl ON p.PeopleId = sl.SenderID AND sl.Sent = 1
LEFT JOIN SmsReceived sr ON p.PeopleId = sr.FromPeopleId
WHERE sl.ID IS NOT NULL OR sr.ID IS NOT NULL
GROUP BY p.PeopleId, p.Name
HAVING COUNT(DISTINCT sl.ID) + COUNT(DISTINCT sr.ID) > 10
ORDER BY (COUNT(DISTINCT sl.ID) + COUNT(DISTINCT sr.ID)) DESC</code></pre>
</div>

<div id="security-users" class="section">
    <h2>ğŸ” Security & User Management</h2>
    
    <h3>Users Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Security Notes</th>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>User ID</td>
            <td>Primary key</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person link</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Username</code></td>
            <td>nvarchar</td>
            <td>Login name</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>IsOnline</code></td>
            <td>bit</td>
            <td>Currently active</td>
            <td>Real-time status</td>
        </tr>
        <tr>
            <td><code>LastActivityDate</code></td>
            <td>datetime</td>
            <td>Last action</td>
            <td>Audit tracking</td>
        </tr>
        <tr>
            <td><code>FailedPasswordAttemptCount</code></td>
            <td>int</td>
            <td>Failed logins</td>
            <td>Security monitoring</td>
        </tr>
    </table>

    <h3>BackgroundChecks Table</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>Key Fields</th>
            <th>Critical for</th>
        </tr>
        <tr>
            <td>Volunteer screening</td>
            <td>PeopleId, Status, DateCompleted, ExpirationDate</td>
            <td>Children's ministry, youth work</td>
        </tr>
    </table>

    <h3>Security Queries</h3>
    <pre><code>-- Active users with failed login attempts
SELECT 
    u.Username,
    p.Name,
    u.LastActivityDate,
    u.FailedPasswordAttemptCount,
    u.IsLockedOut,
    DATEDIFF(day, u.LastActivityDate, GETDATE()) as DaysSinceActive
FROM Users u
JOIN People p ON u.PeopleId = p.PeopleId
WHERE u.FailedPasswordAttemptCount > 0
   OR u.IsLockedOut = 1
ORDER BY u.FailedPasswordAttemptCount DESC

-- Background check status for volunteers
SELECT 
    p.Name,
    bc.Status,
    bc.DateCompleted,
    bc.ExpirationDate,
    DATEDIFF(day, GETDATE(), bc.ExpirationDate) as DaysUntilExpiry,
    STRING_AGG(o.OrganizationName, ', ') as VolunteerRoles
FROM BackgroundChecks bc
JOIN People p ON bc.PeopleId = p.PeopleId
LEFT JOIN OrganizationMembers om ON p.PeopleId = om.PeopleId
LEFT JOIN Organizations o ON om.OrganizationId = o.OrganizationId
WHERE om.MemberTypeId IN (140, 150, 160, 710)  -- Leader/volunteer types
  AND om.InactiveDate IS NULL
GROUP BY p.Name, bc.Status, bc.DateCompleted, bc.ExpirationDate
ORDER BY bc.ExpirationDate</code></pre>
</div>

<div id="registration-system" class="section">
    <h2>ğŸ“ Registration & Event Management</h2>
    
    <h3>Registration Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Records</th>
            <th>Purpose</th>
            <th>Key Relationships</th>
        </tr>
        <tr>
            <td><code>RecReg</code></td>
            <td>Varies</td>
            <td>Registration setup</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>RegistrationData</code></td>
            <td>179K+</td>
            <td>Form responses</td>
            <td>â†’ People, Organizations</td>
        </tr>
        <tr>
            <td><code>RegPeople</code></td>
            <td>Varies</td>
            <td>Registrants</td>
            <td>â†’ People, RecReg</td>
        </tr>
    </table>

    <h3>Registration Queries</h3>
    <pre><code>-- Event registration summary
SELECT 
    o.OrganizationName,
    COUNT(DISTINCT rd.PeopleId) as Registrants,
    COUNT(DISTINCT rd.Id) as TotalResponses,
    MIN(rd.Stamp) as FirstRegistration,
    MAX(rd.Stamp) as LastRegistration
FROM RegistrationData rd
JOIN Organizations o ON rd.OrganizationId = o.OrganizationId
WHERE rd.Stamp >= DATEADD(month, -6, GETDATE())
GROUP BY o.OrganizationName
ORDER BY Registrants DESC

-- Registration form field analysis
SELECT 
    rd.Field,
    COUNT(*) as ResponseCount,
    COUNT(DISTINCT rd.PeopleId) as UniqueResponders
FROM RegistrationData rd
WHERE rd.OrganizationId = 123  -- Specific event
GROUP BY rd.Field
ORDER BY ResponseCount DESC</code></pre>
</div>

<div id="resource-facilities" class="section">
    <h2>ğŸ¢ Resource & Facility Management</h2>
    
    <h3>Resource System Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>Resource</code></td>
            <td>Resource definitions</td>
            <td>ResourceId, Name, Type, Capacity</td>
        </tr>
        <tr>
            <td><code>Reservable</code></td>
            <td>Reservation settings</td>
            <td>ResourceId, StartTime, EndTime</td>
        </tr>
        <tr>
            <td><code>Calendar</code></td>
            <td>Scheduled events</td>
            <td>Id, ResourceId, StartTime, EndTime</td>
        </tr>
    </table>

    <h3>Facility Queries</h3>
    <pre><code>-- Room utilization analysis
SELECT 
    r.Name as ResourceName,
    r.Type,
    r.Capacity,
    COUNT(c.Id) as TotalReservations,
    SUM(DATEDIFF(hour, c.StartTime, c.EndTime)) as TotalHours,
    AVG(DATEDIFF(hour, c.StartTime, c.EndTime)) as AvgHours
FROM Resource r
LEFT JOIN Calendar c ON r.ResourceId = c.ResourceId
WHERE c.StartTime >= DATEADD(month, -3, GETDATE())
GROUP BY r.Name, r.Type, r.Capacity
ORDER BY TotalReservations DESC</code></pre>
</div>

<div id="lookup-tables" class="section">
    <h2>ğŸ“‹ Critical Lookup Tables Reference</h2>
    
    <div class="info">
        <strong>Schema Note:</strong> Most lookup tables are in the <code>lookup</code> schema. Always use <code>lookup.TableName</code> when joining.
    </div>

    <h3>Key Lookup Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Common Values</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>lookup.AttendType</code></td>
            <td>10=Leader, 20=Volunteer, 30=Member, 60=Guest</td>
            <td>Attendance categories</td>
        </tr>
        <tr>
            <td><code>lookup.MemberType</code></td>
            <td>140=Leader, 220=Member, 230=Prospect, 500=Visitor</td>
            <td>Organization roles</td>
        </tr>
        <tr>
            <td><code>lookup.PositionInFamily</code></td>
            <td>10=Primary Adult, 20=Secondary Adult, 30=Child</td>
            <td>Family relationships</td>
        </tr>
        <tr>
            <td><code>lookup.MaritalStatus</code></td>
            <td>10=Single, 20=Married, 30=Divorced, 40=Widowed</td>
            <td>Marital status</td>
        </tr>
        <tr>
            <td><code>lookup.DecisionType</code></td>
            <td>10=Statement of Faith, 20=Baptism, 30=Membership</td>
            <td>Spiritual decisions</td>
        </tr>
        <tr>
            <td><code>lookup.BaptismStatus</code></td>
            <td>10=Scheduled, 20=Completed, 30=Cancelled</td>
            <td>Baptism tracking</td>
        </tr>
        <tr>
            <td><code>lookup.OrganizationStatus</code></td>
            <td>30=Active, 40=Inactive</td>
            <td>Org status</td>
        </tr>
        <tr>
            <td><code>lookup.ResidentCode</code></td>
            <td>10=Metro, 20=Marginal, 30=Non-Resident</td>
            <td>Geographic zones</td>
        </tr>
    </table>

    <h3>Lookup Usage Example</h3>
    <pre><code>-- Complete person profile with all lookups
SELECT 
    p.Name,
    pf.Description as FamilyPosition,
    ms.Description as MaritalStatus,
    at.Description as AttendanceType,
    rc.Description as ResidenceZone,
    bs.Description as BaptismStatus
FROM People p
LEFT JOIN lookup.PositionInFamily pf ON p.PositionInFamilyId = pf.Id
LEFT JOIN lookup.MaritalStatus ms ON p.MaritalStatusId = ms.Id
LEFT JOIN lookup.AttendType at ON p.AttendTypeId = at.Id
LEFT JOIN lookup.ResidentCode rc ON p.ResCodeId = rc.Id
LEFT JOIN lookup.BaptismStatus bs ON p.BaptismStatusId = bs.Id
WHERE p.PeopleId = 12345</code></pre>
</div>

<div id="performance-warnings" class="section">
    <h2>âš ï¸ Performance-Critical Tables</h2>
    
    <div class="critical">
        <h3>ğŸš¨ EXTREME CAUTION - Tables Over 1M Records</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Record Count</th>
                <th>Required Filters</th>
            </tr>
            <tr>
                <td><code>ActivityLog</code></td>
                <td>3.7M+</td>
                <td>ALWAYS use date filter</td>
            </tr>
            <tr>
                <td><code>PeopleSearchTokens</code></td>
                <td>1.7M+</td>
                <td>Use specific PeopleId</td>
            </tr>
            <tr>
                <td><code>EngagementScoreTag</code></td>
                <td>1.5M+</td>
                <td>Date range required</td>
            </tr>
            <tr>
                <td><code>EngagementScore</code></td>
                <td>1.4M+</td>
                <td>WeekDate filter mandatory</td>
            </tr>
            <tr>
                <td><code>Tag</code></td>
                <td>986K+</td>
                <td>Use specific TagId or Name</td>
            </tr>
            <tr>
                <td><code>Contribution</code></td>
                <td>687K+</td>
                <td>Date range required</td>
            </tr>
            <tr>
                <td><code>BundleDetail</code></td>
                <td>687K+</td>
                <td>Join through BundleHeader</td>
            </tr>
        </table>
    </div>

    <h3>Safe Query Patterns for Large Tables</h3>
    <pre><code>-- GOOD: ActivityLog with date filter
SELECT TOP 1000 * 
FROM ActivityLog 
WHERE ActivityDate >= DATEADD(day, -7, GETDATE())

-- BAD: Never do this!
-- SELECT * FROM ActivityLog

-- GOOD: EngagementScore with filters
SELECT es.* 
FROM EngagementScore es
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())
  AND es.PeopleId IN (SELECT PeopleId FROM ...)

-- GOOD: Contribution with date range
SELECT c.*
FROM Contribution c
WHERE c.ContributionDate BETWEEN '2024-01-01' AND '2024-12-31'
  AND c.FundId = 1</code></pre>
</div>

</body>
</html> Notes</th>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique person identifier</td>
        </tr>
        <tr>
            <td><code>FirstName</code></td>
            <td>nvarchar(25)</td>
            <td>First name</td>
            <td>Legal first name</td>
        </tr>
        <tr>
            <td><code>LastName</code></td>
            <td>nvarchar(100)</td>
            <td>Last name</td>
            <td>Family name</td>
        </tr>
        <tr>
            <td><code>NickName</code></td>
            <td>nvarchar(25)</td>
            <td>Preferred name</td>
            <td>May override FirstName in displays</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(139)</td>
            <td>Full name (computed)</td>
            <td>âœ… USE FOR DISPLAY</td>
        </tr>
        <tr>
            <td><code>Name2</code></td>
            <td>nvarchar(139)</td>
            <td>Last, First format</td>
            <td>âœ… USE FOR SORTING</td>
        </tr>
        <tr>
            <td><code>AltName</code></td>
            <td>nvarchar(100)</td>
            <td>Alternative name</td>
            <td>Used for search optimization</td>
        </tr>
    </table>

    <h3>Demographics</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BirthDay</code></td>
            <td>int</td>
            <td>Day of birth</td>
            <td>1-31</td>
        </tr>
        <tr>
            <td><code>BirthMonth</code></td>
            <td>int</td>
            <td>Month of birth</td>
            <td>1-12</td>
        </tr>
        <tr>
            <td><code>BirthYear</code></td>
            <td>int</td>
            <td>Year of birth</td>
            <td>4-digit year</td>
        </tr>
        <tr>
            <td><code>BDate</code></td>
            <td>datetime</td>
            <td>Full birth date</td>
            <td>âš ï¸ Includes time, cast to date</td>
        </tr>
        <tr>
            <td><code>Age</code></td>
            <td>int</td>
            <td>Current age</td>
            <td>Computed, updated regularly</td>
        </tr>
        <tr>
            <td><code>GenderId</code></td>
            <td>int</td>
            <td>Gender</td>
            <td>â†’ lookup.Gender (1=Male, 2=Female)</td>
        </tr>
        <tr>
            <td><code>MaritalStatusId</code></td>
            <td>int</td>
            <td>Marital status</td>
            <td>â†’ lookup.MaritalStatus</td>
        </tr>
    </table>

    <h3>Family Relationships</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Family grouping</td>
            <td>â†’ Families.FamilyId</td>
        </tr>
        <tr>
            <td><code>SpouseId</code></td>
            <td>int</td>
            <td>Spouse link</td>
            <td>â†’ People.PeopleId (direct link)</td>
        </tr>
        <tr>
            <td><code>PositionInFamilyId</code></td>
            <td>int</td>
            <td>Family position</td>
            <td>â†’ lookup.FamilyPosition</td>
        </tr>
    </table>

    <h3>Contact Information</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>EmailAddress</code></td>
            <td>nvarchar(150)</td>
            <td>Primary email</td>
            <td>Main contact email</td>
        </tr>
        <tr>
            <td><code>EmailAddress2</code></td>
            <td>nvarchar(150)</td>
            <td>Secondary email</td>
            <td>Alternative email</td>
        </tr>
        <tr>
            <td><code>SendEmailAddress1</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Email permission 1</td>
            <td>Check before emailing</td>
        </tr>
        <tr>
            <td><code>SendEmailAddress2</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Email permission 2</td>
            <td>Check before emailing</td>
        </tr>
        <tr>
            <td><code>CellPhone</code></td>
            <td>nvarchar(20)</td>
            <td>Cell phone</td>
            <td>Formatted number</td>
        </tr>
        <tr>
            <td><code>HomePhone</code></td>
            <td>nvarchar(20)</td>
            <td>Home phone</td>
            <td>10 digits</td>
        </tr>
        <tr>
            <td><code>WorkPhone</code></td>
            <td>nvarchar(20)</td>
            <td>Work phone</td>
            <td>Business number</td>
        </tr>
        <tr>
            <td><code>CellPhoneValidated</code></td>
            <td>bit</td>
            <td>Phone verified</td>
            <td>Verification status</td>
        </tr>
        <tr>
            <td><code>CellPhoneIsValid</code></td>
            <td>bit</td>
            <td>Phone working</td>
            <td>Active number check</td>
        </tr>
        <tr>
            <td><code>ReceiveSMS</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>SMS permission</td>
            <td>Check before texting</td>
        </tr>
    </table>

    <h3>Address Information</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>PrimaryAddress</code></td>
            <td>nvarchar(100)</td>
            <td>Street address</td>
            <td>âœ… Use for mailings</td>
        </tr>
        <tr>
            <td><code>PrimaryAddress2</code></td>
            <td>nvarchar(100)</td>
            <td>Apt/Suite</td>
            <td>Secondary line</td>
        </tr>
        <tr>
            <td><code>PrimaryCity</code></td>
            <td>nvarchar(30)</td>
            <td>City</td>
            <td>Primary city</td>
        </tr>
        <tr>
            <td><code>PrimaryState</code></td>
            <td>nvarchar(20)</td>
            <td>State</td>
            <td>State abbreviation</td>
        </tr>
        <tr>
            <td><code>PrimaryZip</code></td>
            <td>nvarchar(15)</td>
            <td>ZIP code</td>
            <td>Postal code</td>
        </tr>
        <tr>
            <td><code>PrimaryCountry</code></td>
            <td>nvarchar(40)</td>
            <td>Country</td>
            <td>Country name</td>
        </tr>
        <tr>
            <td><code>PrimaryBadAddrFlag</code></td>
            <td>bit</td>
            <td>Invalid address</td>
            <td>Filter bad addresses</td>
        </tr>
    </table>

    <h3>Church Membership</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MemberStatusId</code> <span class="badge badge-critical">Critical</span></td>
            <td>int</td>
            <td>Member status</td>
            <td>â†’ lookup.MemberStatus</td>
        </tr>
        <tr>
            <td><code>JoinDate</code></td>
            <td>datetime</td>
            <td>Joined church</td>
            <td>Membership start</td>
        </tr>
        <tr>
            <td><code>DropDate</code></td>
            <td>datetime</td>
            <td>Left church</td>
            <td>Membership end</td>
        </tr>
        <tr>
            <td><code>DropCodeId</code></td>
            <td>int</td>
            <td>Reason left</td>
            <td>â†’ lookup.DropType</td>
        </tr>
        <tr>
            <td><code>BaptismDate</code></td>
            <td>datetime</td>
            <td>Baptized date</td>
            <td>Baptism completion</td>
        </tr>
        <tr>
            <td><code>BaptismStatusId</code></td>
            <td>int</td>
            <td>Baptism status</td>
            <td>â†’ lookup.BaptismStatus</td>
        </tr>
        <tr>
            <td><code>DecisionDate</code></td>
            <td>datetime</td>
            <td>Salvation date</td>
            <td>Faith decision</td>
        </tr>
        <tr>
            <td><code>NewMemberClassDate</code></td>
            <td>datetime</td>
            <td>Class completion</td>
            <td>New member training</td>
        </tr>
    </table>

    <h3>Communication Preferences</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>DoNotMailFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No postal mail</td>
            <td>Filter marketing</td>
        </tr>
        <tr>
            <td><code>DoNotCallFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No phone calls</td>
            <td>Filter campaigns</td>
        </tr>
        <tr>
            <td><code>DoNotVisitFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No visits</td>
            <td>Filter assignments</td>
        </tr>
        <tr>
            <td><code>DoNotPublishPhones</code></td>
            <td>bit</td>
            <td>Directory privacy</td>
            <td>Hide from directory</td>
        </tr>
        <tr>
            <td><code>ElectronicStatement</code></td>
            <td>bit</td>
            <td>Email statements</td>
            <td>Prefers electronic</td>
        </tr>
    </table>

    <h3>System & Status Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>IsDeceased</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Person deceased</td>
            <td>ALWAYS filter = 0</td>
        </tr>
        <tr>
            <td><code>ArchivedFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Record archived</td>
            <td>ALWAYS filter = 0</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Record created</td>
            <td>Creation timestamp</td>
        </tr>
        <tr>
            <td><code>CreatedBy</code></td>
            <td>int</td>
            <td>Created by</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>ModifiedDate</code></td>
            <td>datetime</td>
            <td>Last modified</td>
            <td>Update timestamp</td>
        </tr>
        <tr>
            <td><code>ModifiedBy</code></td>
            <td>int</td>
            <td>Modified by</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>CampusId</code></td>
            <td>int</td>
            <td>Campus</td>
            <td>â†’ lookup.Campus</td>
        </tr>
    </table>

    <h3>Mobile & Check-in</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BlockMobileAccess</code></td>
            <td>bit</td>
            <td>Block mobile app</td>
            <td>Security restriction</td>
        </tr>
        <tr>
            <td><code>BarcodeId</code></td>
            <td>bigint</td>
            <td>Check-in barcode</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>BarcodeExpires</code></td>
            <td>datetime</td>
            <td>Barcode expiration</td>
            <td>Security timeout</td>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Profile photo</td>
            <td>â†’ Picture.PictureId</td>
        </tr>
    </table>
</div>

<div id="family-structure" class="section">
    <h2>ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Relationships & Household Management</h2>
    
    <h3>Understanding TouchPoint's Family Model</h3>
    <div class="highlight">
        <p><strong>TouchPoint uses dual relationship tracking:</strong></p>
        <ul>
            <li><strong>FamilyId:</strong> Groups all household members together</li>
            <li><strong>SpouseId:</strong> Direct link between married couples (more reliable than family grouping)</li>
            <li><strong>PositionInFamilyId:</strong> Defines role within household (Primary Adult, Secondary Adult, Child)</li>
        </ul>
    </div>

    <h3>Family Structure Query</h3>
    <pre><code>-- Complete family units with all members
WITH FamilyStructure AS (
    SELECT TOP 500
        f.FamilyId,
        p.PeopleId,
        p.Name,
        p.Age,
        fp.Description as FamilyPosition,
        p.SpouseId,
        ROW_NUMBER() OVER (PARTITION BY f.FamilyId ORDER BY p.PositionInFamilyId, p.Age DESC) as PersonOrder
    FROM Families f
    JOIN People p ON f.FamilyId = p.FamilyId
    JOIN lookup.FamilyPosition fp ON p.PositionInFamilyId = fp.Id
    WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
)
SELECT 
    fs.FamilyId,
    MAX(CASE WHEN fs.FamilyPosition = 'Primary Adult' THEN fs.Name END) as PrimaryAdult,
    MAX(CASE WHEN fs.FamilyPosition = 'Secondary Adult' THEN fs.Name END) as SecondaryAdult,
    STRING_AGG(CASE WHEN fs.FamilyPosition = 'Child' THEN fs.Name END, ', ') as Children,
    COUNT(*) as FamilySize
FROM FamilyStructure fs
GROUP BY fs.FamilyId
HAVING COUNT(*) > 1  -- Multi-person families only
ORDER BY FamilySize DESC</code></pre>

    <h3>Spouse Relationships</h3>
    <pre><code>-- Direct spouse relationships (most reliable)
SELECT 
    p1.PeopleId as Person1Id,
    p1.Name as Person1,
    p2.PeopleId as Person2Id,
    p2.Name as Person2,
    p1.WeddingDate,
    DATEDIFF(year, p1.WeddingDate, GETDATE()) as YearsMarried
FROM People p1
JOIN People p2 ON p1.SpouseId = p2.PeopleId
WHERE p1.IsDeceased = 0 AND p1.ArchivedFlag = 0
  AND p2.IsDeceased = 0 AND p2.ArchivedFlag = 0
  AND p1.PeopleId < p2.PeopleId  -- Avoid duplicates
ORDER BY p1.Name</code></pre>

    <h3>Children and Parents</h3>
    <pre><code>-- Find all children with their parents
SELECT TOP 500
    child.Name as ChildName,
    child.Age,
    primary_adult.Name as Parent1,
    secondary_adult.Name as Parent2,
    f.FamilyId
FROM People child
JOIN Families f ON child.FamilyId = f.FamilyId
LEFT JOIN People primary_adult ON f.FamilyId = primary_adult.FamilyId 
    AND primary_adult.PositionInFamilyId = 10  -- Primary Adult
    AND primary_adult.IsDeceased = 0 AND primary_adult.ArchivedFlag = 0
LEFT JOIN People secondary_adult ON f.FamilyId = secondary_adult.FamilyId 
    AND secondary_adult.PositionInFamilyId = 20  -- Secondary Adult
    AND secondary_adult.IsDeceased = 0 AND secondary_adult.ArchivedFlag = 0
WHERE child.PositionInFamilyId = 30  -- Child
  AND child.Age < 18
  AND child.IsDeceased = 0 AND child.ArchivedFlag = 0
ORDER BY child.Age DESC, child.Name</code></pre>
</div>

<div id="contact-permissions" class="section">
    <h2>ğŸ“ Contact Information & Communication Permissions</h2>
    
    <div class="critical">
        <h3>âš ï¸ Critical: Always Check Permissions Before Communication</h3>
        <p>TouchPoint tracks detailed communication preferences. <strong>Violating these preferences can result in complaints and legal issues.</strong></p>
    </div>

    <h3>Safe Email List</h3>
    <pre><code>-- People who CAN receive emails
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.EmailAddress,
    p.EmailAddress2,
    CASE 
        WHEN p.SendEmailAddress1 = 1 AND p.EmailAddress IS NOT NULL THEN p.EmailAddress
        WHEN p.SendEmailAddress2 = 1 AND p.EmailAddress2 IS NOT NULL THEN p.EmailAddress2
        ELSE NULL
    END as PreferredEmail
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotMailFlag = 0  -- General mail permission
  AND (
    (p.SendEmailAddress1 = 1 AND p.EmailAddress IS NOT NULL AND p.EmailAddress != '')
    OR 
    (p.SendEmailAddress2 = 1 AND p.EmailAddress2 IS NOT NULL AND p.EmailAddress2 != '')
  )
  AND p.PrimaryBadAddrFlag = 0  -- Good address on file
ORDER BY p.Name</code></pre>

    <h3>Safe Text/SMS List</h3>
    <pre><code>-- People who CAN receive text messages
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.CellPhone,
    p.CellPhoneValidated,
    p.CellPhoneIsValid
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotCallFlag = 0      -- Can call/text
  AND p.ReceiveSMS = 1         -- SMS specifically allowed
  AND p.CellPhoneIsValid = 1   -- Valid phone number
  AND p.CellPhone IS NOT NULL AND p.CellPhone != ''
ORDER BY p.Name</code></pre>

    <h3>Safe Mailing List</h3>
    <pre><code>-- People who CAN receive postal mail
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.PrimaryAddress,
    p.PrimaryAddress2,
    p.PrimaryCity,
    p.PrimaryState,
    p.PrimaryZip
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotMailFlag = 0        -- Mail allowed
  AND p.PrimaryBadAddrFlag = 0   -- Valid address
  AND p.PrimaryAddress IS NOT NULL AND p.PrimaryAddress != ''
ORDER BY p.PrimaryZip, p.Name</code></pre>

    <h3>Visitation List</h3>
    <pre><code>-- People who CAN be visited
  SELECT TOP 1000
      p.PeopleId,
      p.Name,
      p.PrimaryAddress,
      p.PrimaryCity,
      p.CellPhone,
      rc.Description as ResidentCode
  FROM People p
  LEFT JOIN lookup.ResidentCode rc ON p.ResCodeId = rc.Id
  WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
    AND p.DoNotVisitFlag = 0       -- Visits allowed
    AND p.PrimaryBadAddrFlag = 0   -- Valid address
    AND p.ResCodeId IN (10, 20)    -- Metro or Marginal (close enough to visit)
  ORDER BY p.PrimaryCity, p.Name</code></pre>
</div>

<div id="membership-workflow" class="section">
    <h2>ğŸ›ï¸ Church Membership Status & Workflow</h2>
    
    <h3>Membership Status Values</h3>
    <table>
        <tr>
            <th>Id</th>
            <th>Status</th>
            <th>Description</th>
            <th>Typical Use</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Member</td>
            <td>Full church member</td>
            <td>Voting, leadership eligible</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Prospect</td>
            <td>Potential member</td>
            <td>Follow-up, engagement tracking</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Not Member</td>
            <td>Regular attender</td>
            <td>Non-member participant</td>
        </tr>
        <tr>
            <td>40</td>
            <td>Previous Member</td>
            <td>Former member</td>
            <td>Different communication approach</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Just Added</td>
            <td>New record</td>
            <td>Needs data validation</td>
        </tr>
    </table>

    <h3>Membership Journey Tracking</h3>
    <pre><code>-- Complete membership journey analysis
SELECT TOP 500
    p.PeopleId,
    p.Name,
    ms.Description as CurrentStatus,
    
    -- Key Dates
    p.CreatedDate as FirstRecorded,
    p.DecisionDate,
    p.BaptismDate,
    p.NewMemberClassDate,
    p.JoinDate,
    p.DropDate,
    
    -- Status Details
    dt.Description as DecisionType,
    bs.Description as BaptismStatus,
    nmcs.Description as NewMemberClassStatus,
    drop_type.Description as DropReason,
    
    -- Journey Metrics
    DATEDIFF(day, p.CreatedDate, p.JoinDate) as DaysToMembership,
    DATEDIFF(day, p.DecisionDate, p.BaptismDate) as DaysToBaptism,
    CASE 
        WHEN p.DropDate IS NOT NULL THEN 'Inactive'
        WHEN p.JoinDate IS NOT NULL THEN 'Member'
        WHEN p.BaptismDate IS NOT NULL THEN 'Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN 'Decided'
        ELSE 'Exploring'
    END as JourneyStage
    
FROM People p
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.DecisionType dt ON p.DecisionTypeId = dt.Id
LEFT JOIN lookup.BaptismStatus bs ON p.BaptismStatusId = bs.Id
LEFT JOIN lookup.NewMemberClassStatus nmcs ON p.NewMemberClassStatusId = nmcs.Id
LEFT JOIN lookup.DropType drop_type ON p.DropCodeId = drop_type.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.JoinDate DESC</code></pre>

    <h3>New Member Pipeline</h3>
    <pre><code>-- Track new member pipeline
SELECT TOP 500
    CASE 
        WHEN p.JoinDate IS NOT NULL THEN '5. Member'
        WHEN p.NewMemberClassDate IS NOT NULL THEN '4. Class Complete'
        WHEN p.BaptismDate IS NOT NULL THEN '3. Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN '2. Decision Made'
        WHEN p.MemberStatusId = 20 THEN '1. Prospect'
        ELSE '0. Visitor'
    END as Stage,
    COUNT(*) as PeopleCount,
    AVG(DATEDIFF(day, p.CreatedDate, GETDATE())) as AvgDaysInStage
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.CreatedDate >= DATEADD(year, -1, GETDATE())
  AND p.MemberStatusId IN (20, 50)  -- Prospects and Just Added
GROUP BY 
    CASE 
        WHEN p.JoinDate IS NOT NULL THEN '5. Member'
        WHEN p.NewMemberClassDate IS NOT NULL THEN '4. Class Complete'
        WHEN p.BaptismDate IS NOT NULL THEN '3. Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN '2. Decision Made'
        WHEN p.MemberStatusId = 20 THEN '1. Prospect'
        ELSE '0. Visitor'
    END
ORDER BY Stage</code></pre>
</div>

<div id="organizations-table" class="section">
    <h2>ğŸ›ï¸ Organizations Table (Involvements)</h2>
    
    <p><strong>Purpose:</strong> Groups, classes, ministries, events (called "Involvements" in UI)<br>
    <strong>Primary Key:</strong> <code>OrganizationId</code><br>
    <strong>Scale:</strong> 188 columns with 16 foreign key relationships<br>
    <strong>Hierarchy:</strong> Program â†’ Division â†’ Organization</p>

    <div class="info">
        <p><strong>Note:</strong> Organizations are called "Involvements" in the TouchPoint user interface</p>
    </div>

    <h3>Core Organization Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>OrganizationName</code></td>
            <td>nvarchar(100)</td>
            <td>Display name</td>
            <td>Public name</td>
        </tr>
        <tr>
            <td><code>Description</code></td>
            <td>ntext</td>
            <td>Detailed description</td>
            <td>Full text description</td>
        </tr>
        <tr>
            <td><code>OrganizationStatusId</code> <span class="badge badge-critical">Critical</span></td>
            <td>int</td>
            <td>Status</td>
            <td>30 = Active (not 1!)</td>
        </tr>
        <tr>
            <td><code>OrganizationTypeId</code></td>
            <td>int</td>
            <td>Type</td>
            <td>â†’ lookup.OrganizationType</td>
        </tr>
        <tr>
            <td><code>DivisionId</code></td>
            <td>int</td>
            <td>Division</td>
            <td>â†’ Division.Id</td>
        </tr>
        <tr>
            <td><code>CampusId</code></td>
            <td>int</td>
            <td>Campus</td>
            <td>â†’ lookup.Campus</td>
        </tr>
    </table>

    <h3>Leadership & Management</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>LeaderId</code></td>
            <td>int</td>
            <td>Primary leader</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>LeaderName</code></td>
            <td>nvarchar(50)</td>
            <td>Leader name</td>
            <td>Computed field</td>
        </tr>
        <tr>
            <td><code>MainLeaderId</code></td>
            <td>int</td>
            <td>Main leader</td>
            <td>If different from Leader</td>
        </tr>
        <tr>
            <td><code>LeaderMemberTypeId</code></td>
            <td>int</td>
            <td>Leader role</td>
            <td>â†’ lookup.MemberType</td>
        </tr>
    </table>

    <h3>Membership & Capacity</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MemberCount</code></td>
            <td>int</td>
            <td>Current members</td>
            <td>Auto-updated</td>
        </tr>
        <tr>
            <td><code>PrevMemberCount</code></td>
            <td>int</td>
            <td>Previous count</td>
            <td>Historical tracking</td>
        </tr>
        <tr>
            <td><code>ProspectCount</code></td>
            <td>int</td>
            <td>Prospects</td>
            <td>Potential members</td>
        </tr>
        <tr>
            <td><code>Limit</code></td>
            <td>int</td>
            <td>Max capacity</td>
            <td>Room/resource limit</td>
        </tr>
        <tr>
            <td><code>ClassFilled</code></td>
            <td>bit</td>
            <td>At capacity</td>
            <td>Registration closed</td>
        </tr>
    </table>

    <h3>Registration System Fields <span class="badge badge-new">Important</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegistrationTypeId</code></td>
            <td>int</td>
            <td>Registration type</td>
            <td>0=none, others=form types</td>
        </tr>
        <tr>
            <td><code>RegStart</code></td>
            <td>datetime</td>
            <td>Registration opens</td>
            <td>Start accepting signups</td>
        </tr>
        <tr>
            <td><code>RegEnd</code></td>
            <td>datetime</td>
            <td>Registration closes</td>
            <td>Stop accepting signups</td>
        </tr>
        <tr>
            <td><code>RegLimit</code></td>
            <td>int</td>
            <td>Registration limit</td>
            <td>Max registrations</td>
        </tr>
        <tr>
            <td><code>RegistrationClosed</code></td>
            <td>bit</td>
            <td>Manually closed</td>
            <td>Override dates</td>
        </tr>
        <tr>
            <td><code>RegFeePerPerson</code></td>
            <td>money</td>
            <td>Fee amount</td>
            <td>Cost per person</td>
        </tr>
        <tr>
            <td><code>RegFeeType</code></td>
            <td>int</td>
            <td>Fee type</td>
            <td>â†’ lookup.ContributionType</td>
        </tr>
        <tr>
            <td><code>RegDepositAmount</code></td>
            <td>money</td>
            <td>Deposit required</td>
            <td>Upfront payment</td>
        </tr>
        <tr>
            <td><code>RegFundId</code></td>
            <td>int</td>
            <td>Payment fund</td>
            <td>â†’ ContributionFund</td>
        </tr>
    </table>

    <h3>Check-In System Fields <span class="badge badge-new">Important</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>CanSelfCheckin</code></td>
            <td>bit</td>
            <td>Allow self check-in</td>
            <td>Kiosk enabled</td>
        </tr>
        <tr>
            <td><code>NumCheckInLabels</code></td>
            <td>int</td>
            <td>Labels per person</td>
            <td>Print count</td>
        </tr>
        <tr>
            <td><code>NumWorkerCheckInLabels</code></td>
            <td>int</td>
            <td>Worker labels</td>
            <td>Volunteer labels</td>
        </tr>
        <tr>
            <td><code>ShowOnlyRegisteredAtCheckIn</code></td>
            <td>bit</td>
            <td>Restrict check-in</td>
            <td>Members only</td>
        </tr>
        <tr>
            <td><code>AllowNonCampusCheckIn</code></td>
            <td>bit</td>
            <td>Cross-campus</td>
            <td>Other locations OK</td>
        </tr>
        <tr>
            <td><code>SuspendCheckin</code></td>
            <td>bit</td>
            <td>Disable check-in</td>
            <td>Temporary hold</td>
        </tr>
        <tr>
            <td><code>EarlyCheckin</code></td>
            <td>int</td>
            <td>Minutes early</td>
            <td>Before meeting time</td>
        </tr>
        <tr>
            <td><code>LateCheckin</code></td>
            <td>int</td>
            <td>Minutes late</td>
            <td>After meeting time</td>
        </tr>
    </table>

    <h3>Mobile App Integration <span class="badge badge-new">New</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>AllowMobileView</code></td>
            <td>bit</td>
            <td>Show in app</td>
            <td>Mobile visibility</td>
        </tr>
        <tr>
            <td><code>ShowInSites</code></td>
            <td>bit</td>
            <td>Show in sites</td>
            <td>Web visibility</td>
        </tr>
        <tr>
            <td><code>RecommendInMobile</code></td>
            <td>bit</td>
            <td>Recommend</td>
            <td>Featured in app</td>
        </tr>
        <tr>
            <td><code>CategoryMobileId</code></td>
            <td>int</td>
            <td>Mobile category</td>
            <td>App organization</td>
        </tr>
    </table>

    <h3>Mission Trips <span class="badge badge-new">Special</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>IsMissionTrip</code></td>
            <td>bit</td>
            <td>Mission trip flag</td>
            <td>Special handling</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesEnable</code></td>
            <td>bit</td>
            <td>Funding pages</td>
            <td>Fundraising enabled</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesPublic</code></td>
            <td>bit</td>
            <td>Public funding</td>
            <td>External visibility</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesShowAmounts</code></td>
            <td>bit</td>
            <td>Show amounts</td>
            <td>Display progress</td>
        </tr>
    </table>
</div>

<div id="organization-members" class="section">
    <h2>ğŸ‘¥ Organization Membership & Roles</h2>
    
    <p><strong>Purpose:</strong> Links people to organizations with specific roles<br>
    <strong>Composite Key:</strong> <code>OrganizationId + PeopleId</code><br>
    <strong>Critical Rule:</strong> Use <code>InactiveDate IS NULL</code> for current members</p>

    <h3>OrganizationMembers Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>MemberTypeId</code></td>
            <td>int</td>
            <td>Role in org</td>
            <td>â†’ lookup.MemberType</td>
        </tr>
        <tr>
            <td><code>EnrollmentDate</code></td>
            <td>datetime</td>
            <td>Joined date</td>
            <td>When enrolled</td>
        </tr>
        <tr>
            <td><code>InactiveDate</code></td>
            <td>datetime</td>
            <td>Left date</td>
            <td>NULL = active</td>
        </tr>
        <tr>
            <td><code>LastAttended</code></td>
            <td>datetime</td>
            <td>Last attendance</td>
            <td>Most recent</td>
        </tr>
        <tr>
            <td><code>AttendPct</code></td>
            <td>decimal</td>
            <td>Attendance %</td>
            <td>Engagement metric</td>
        </tr>
        <tr>
            <td><code>Pending</code></td>
            <td>bit</td>
            <td>Pending approval</td>
            <td>Awaiting confirmation</td>
        </tr>
        <tr>
            <td><code>Hidden</code></td>
            <td>bit</td>
            <td>Hide from lists</td>
            <td>Privacy setting</td>
        </tr>
    </table>

    <h3>Organization Roster Query</h3>
    <pre><code>-- Complete organization roster with roles
SELECT TOP 500
    o.OrganizationName,
    p.Name,
    mt.Description as Role,
    at.Description as RoleCategory,
    om.EnrollmentDate,
    om.LastAttended,
    om.AttendPct,
    CASE 
        WHEN at.Worker = 1 THEN 'Worker'
        WHEN at.Guest = 1 THEN 'Guest'
        ELSE 'Member'
    END as PersonType
FROM OrganizationMembers om
JOIN People p ON om.PeopleId = p.PeopleId
JOIN Organizations o ON om.OrganizationId = o.OrganizationId
JOIN lookup.MemberType mt ON om.MemberTypeId = mt.Id
JOIN lookup.AttendType at ON mt.AttendanceTypeId = at.Id
WHERE om.InactiveDate IS NULL  -- Current members only
  AND o.OrganizationStatusId = 30  -- Active orgs
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY o.OrganizationName, at.Worker DESC, p.Name</code></pre>

    <h3>Leadership Analysis</h3>
    <pre><code>  -- Find all leaders across organizations
  SELECT TOP 500
      p.Name as LeaderName,
      STRING_AGG(o.OrganizationName, ', ') as Organizations,
      COUNT(*) as LeadershipRoles
  FROM OrganizationMembers om
  JOIN People p ON om.PeopleId = p.PeopleId
  JOIN Organizations o ON om.OrganizationId = o.OrganizationId
  JOIN lookup.MemberType mt ON om.MemberTypeId = mt.Id
  WHERE om.InactiveDate IS NULL
    AND mt.AttendanceTypeId = 10  -- Leaders (not volunteers)
    AND o.OrganizationStatusId = 30
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name
  HAVING COUNT(*) > 1  -- Leading multiple orgs
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="program-hierarchy" class="section">
    <h2>ğŸ“Š Program â†’ Division â†’ Organization Structure</h2>
    
    <div class="highlight">
        <h3>Three-Level Hierarchy</h3>
        <ul>
            <li><strong>Program:</strong> Top level (e.g., "Adult Ministry", "Children's Ministry")</li>
            <li><strong>Division:</strong> Second level (e.g., "Small Groups", "Sunday School")</li>
            <li><strong>Organization:</strong> Third level - actual groups/classes (e.g., "Men's Bible Study")</li>
        </ul>
    </div>

    <h3>Organization Structure View</h3>
    <pre><code>-- Complete organizational hierarchy
SELECT TOP 500
    Program,        -- Top level
    Division,       -- Second level
    Organization,   -- Third level (actual group)
    OrgStatus,
    Members,
    Previous,
    Vistors,
    Meetings,
    ProgId,         -- Program ID for joins
    DivId,          -- Division ID for joins
    OrgId           -- Organization ID for joins
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
ORDER BY Program, Division, Organization</code></pre>

    <h3>Program Summary</h3>
    <pre><code>-- Program-level statistics
SELECT TOP 500
    Program,
    COUNT(DISTINCT DivId) as Divisions,
    COUNT(DISTINCT OrgId) as Organizations,
    SUM(Members) as TotalMembers,
    SUM(Vistors) as TotalVisitors,
    SUM(Meetings) as TotalMeetings
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
GROUP BY Program, ProgId
ORDER BY SUM(Members) DESC</code></pre>

    <h3>Division Analysis</h3>
    <pre><code>-- Division-level breakdown
SELECT TOP 500
    Program,
    Division,
    COUNT(OrgId) as OrgCount,
    SUM(Members) as TotalMembers,
    AVG(Members) as AvgOrgSize,
    MAX(Members) as LargestOrg,
    SUM(CASE WHEN Members >= Limit AND Limit > 0 THEN 1 ELSE 0 END) as AtCapacity
FROM OrganizationStructure os
JOIN Organizations o ON os.OrgId = o.OrganizationId
WHERE os.OrgStatus = 'Active'
GROUP BY Program, Division, DivId
ORDER BY Program, Division</code></pre>
</div>

<div id="attend-table" class="section">
    <h2>ğŸ“… Attend Table - The AttendanceFlag Rule</h2>
    
    <div class="critical">
        <h3>ğŸš¨ CRITICAL RULE: AttendanceFlag = 1</h3>
        <p><strong>AttendanceFlag = 1</strong> means the person attended<br>
        <strong>AttendanceFlag = 0</strong> means the person was absent<br>
        <strong>ALWAYS filter WHERE AttendanceFlag = 1 for attendance counts</strong></p>
    </div>

    <h3>Attend Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>AttendId</code></td>
            <td>bigint</td>
            <td>Primary key</td>
            <td>Unique record ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Meeting</td>
            <td>â†’ Meetings</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingDate</code></td>
            <td>datetime</td>
            <td>Meeting date/time</td>
            <td>When it occurred</td>
        </tr>
        <tr>
            <td><code>AttendanceFlag</code> <span class="badge badge-critical">CRITICAL</span></td>
            <td>bit</td>
            <td>Present/Absent</td>
            <td>1=present, 0=absent</td>
        </tr>
        <tr>
            <td><code>AttendanceTypeId</code></td>
            <td>int</td>
            <td>Attendance type</td>
            <td>â†’ lookup.AttendType</td>
        </tr>
        <tr>
            <td><code>MemberTypeId</code></td>
            <td>int</td>
            <td>Detailed role</td>
            <td>â†’ lookup.MemberType</td>
        </tr>
        <tr>
            <td><code>NoShow</code></td>
            <td>bit</td>
            <td>No-show flag</td>
            <td>Registered but absent</td>
        </tr>
        <tr>
            <td><code>SubGroupName</code></td>
            <td>nvarchar</td>
            <td>Sub-group</td>
            <td>Group within org</td>
        </tr>
        <tr>
            <td><code>Commitment</code></td>
            <td>int</td>
            <td>RSVP status</td>
            <td>99/NULL=uncommitted, 0=regrets, 1=attending</td>
        </tr>
    </table>

    <h3>Basic Attendance Query</h3>
    <pre><code>-- Attendance records with full details
SELECT TOP 500
    p.Name,
    o.OrganizationName,
    m.MeetingDate,
    m.Location,
    at.Description as AttendanceType,
    mt.Description as SpecificRole,
    a.SubGroupName,
    CASE a.Commitment
        WHEN 1 THEN 'Attending'
        WHEN 0 THEN 'Regrets'
        WHEN 2 THEN 'Find Sub'
        WHEN 3 THEN 'Sub Found'
        ELSE 'Uncommitted'
    END as CommitmentStatus
FROM Attend a
JOIN People p ON a.PeopleId = p.PeopleId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
JOIN lookup.MemberType mt ON a.MemberTypeId = mt.Id
WHERE a.AttendanceFlag = 1  -- CRITICAL: Only actual attendance
  AND m.MeetingDate >= DATEADD(month, -1, GETDATE())
  AND m.DidNotMeet = 0  -- Meeting actually happened
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY m.MeetingDate DESC, o.OrganizationName, p.Name</code></pre>

    <h3>Attendance Patterns</h3>
    <pre><code>-- Individual attendance patterns
WITH AttendanceHistory AS (
    SELECT 
        p.PeopleId,
        p.Name,
        COUNT(*) as TimesAttended,
        COUNT(DISTINCT a.OrganizationId) as DifferentOrgs,
        COUNT(DISTINCT CAST(a.MeetingDate as DATE)) as UniqueDays,
        MIN(a.MeetingDate) as FirstAttended,
        MAX(a.MeetingDate) as LastAttended
    FROM Attend a
    JOIN People p ON a.PeopleId = p.PeopleId
    WHERE a.AttendanceFlag = 1
      AND a.MeetingDate >= DATEADD(month, -6, GETDATE())
      AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
    GROUP BY p.PeopleId, p.Name
)
SELECT 
    Name,
    TimesAttended,
    DifferentOrgs,
    UniqueDays,
    DATEDIFF(day, FirstAttended, LastAttended) as DaySpan,
    CAST(TimesAttended as float) / NULLIF(DATEDIFF(week, FirstAttended, LastAttended), 0) as AvgPerWeek
FROM AttendanceHistory
WHERE TimesAttended > 1
ORDER BY TimesAttended DESC</code></pre>
</div>

<div id="meetings-table" class="section">
    <h2>ğŸ“… Meetings & Scheduling</h2>
    
    <h3>Meetings Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique meeting ID</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingDate</code></td>
            <td>datetime</td>
            <td>Start time</td>
            <td>Meeting begins</td>
        </tr>
        <tr>
            <td><code>MeetingEnd</code></td>
            <td>datetime</td>
            <td>End time</td>
            <td>Meeting ends</td>
        </tr>
        <tr>
            <td><code>Location</code></td>
            <td>nvarchar</td>
            <td>Location</td>
            <td>Where held</td>
        </tr>
        <tr>
            <td><code>NumPresent</code></td>
            <td>int</td>
            <td>Total attendance</td>
            <td>Recorded count</td>
        </tr>
        <tr>
            <td><code>HeadCount</code></td>
            <td>int</td>
            <td>Manual count</td>
            <td>Override count</td>
        </tr>
        <tr>
            <td><code>NumMembers</code></td>
            <td>int</td>
            <td>Members present</td>
            <td>Regular members</td>
        </tr>
        <tr>
            <td><code>NumNewVisit</code></td>
            <td>int</td>
            <td>First-time visitors</td>
            <td>New guests</td>
        </tr>
        <tr>
            <td><code>NumRepeatVst</code></td>
            <td>int</td>
            <td>Repeat visitors</td>
            <td>Returning guests</td>
        </tr>
        <tr>
            <td><code>DidNotMeet</code> <span class="badge badge-critical">Important</span></td>
            <td>bit</td>
            <td>Cancelled</td>
            <td>1=cancelled, 0=held</td>
        </tr>
    </table>

    <h3>Meeting Schedule Query</h3>
    <pre><code>-- Upcoming meetings schedule
SELECT 
    o.OrganizationName,
    m.MeetingDate,
    m.MeetingEnd,
    m.Location,
    DATEDIFF(minute, m.MeetingDate, m.MeetingEnd) as DurationMinutes,
    p.Name as Leader
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
LEFT JOIN People p ON o.LeaderId = p.PeopleId
WHERE m.MeetingDate >= GETDATE()
  AND m.MeetingDate <= DATEADD(week, 2, GETDATE())
  AND m.DidNotMeet = 0  -- Not cancelled
  AND o.OrganizationStatusId = 30  -- Active orgs
ORDER BY m.MeetingDate</code></pre>

    <h3>Meeting Analytics</h3>
    <pre><code>-- Meeting attendance analytics
SELECT 
    o.OrganizationName,
    COUNT(*) as MeetingsHeld,
    AVG(m.NumPresent) as AvgAttendance,
    MAX(m.NumPresent) as MaxAttendance,
    MIN(m.NumPresent) as MinAttendance,
    SUM(m.NumNewVisit) as TotalNewVisitors,
    SUM(m.NumRepeatVst) as TotalRepeatVisitors,
    AVG(CAST(m.NumPresent as float) / NULLIF(o.MemberCount, 0)) * 100 as AvgAttendancePct
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
WHERE m.MeetingDate >= DATEADD(month, -3, GETDATE())
  AND m.DidNotMeet = 0  -- Actually met
  AND o.OrganizationStatusId = 30
GROUP BY o.OrganizationId, o.OrganizationName, o.MemberCount
HAVING COUNT(*) > 3  -- At least 3 meetings
ORDER BY AVG(m.NumPresent) DESC</code></pre>
</div>

<div id="contribution-table" class="section">
    <h2>ğŸ’° Contribution Table - The TypeIdâ‰ 99 Rule</h2>
    
    <div class="critical">
        <h3>ğŸš¨ CRITICAL RULE: ContributionTypeId = 99</h3>
        <p><strong>ContributionTypeId = 99</strong> represents EVENT REGISTRATION FEES, not charitable donations<br>
        <strong>ALWAYS exclude these from giving reports:</strong> <code>WHERE ContributionTypeId != 99</code></p>
    </div>

    <h3>Contribution Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>ContributionId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique gift ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Giver</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>ContributionAmount</code></td>
            <td>money</td>
            <td>Gift amount</td>
            <td>Dollar value</td>
        </tr>
        <tr>
            <td><code>ContributionDate</code></td>
            <td>datetime</td>
            <td>Gift date</td>
            <td>When received</td>
        </tr>
        <tr>
            <td><code>FundId</code></td>
            <td>int</td>
            <td>Fund designation</td>
            <td>â†’ ContributionFund</td>
        </tr>
        <tr>
            <td><code>ContributionTypeId</code> <span class="badge badge-critical">CRITICAL</span></td>
            <td>int</td>
            <td>Gift type</td>
            <td>99 = event fee!</td>
        </tr>
        <tr>
            <td><code>ContributionStatusId</code></td>
            <td>int</td>
            <td>Processing status</td>
            <td>â†’ lookup.ContributionStatus</td>
        </tr>
        <tr>
            <td><code>CheckNo</code></td>
            <td>nvarchar</td>
            <td>Check number</td>
            <td>Payment reference</td>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Batch ID</td>
            <td>â†’ BundleHeader</td>
        </tr>
    </table>

    <h3>Giving Analysis Query</h3>
    <pre><code>-- Individual giving summary
SELECT 
    g.Name,
    COUNT(*) AS GiftCount,
    SUM(g.ContributionAmount) AS TotalGiven,
    AVG(g.ContributionAmount) AS AvgGift,
    MIN(g.ContributionDate) AS FirstGift,
    MAX(g.ContributionDate) AS LastGift,
    STRING_AGG(CAST(df.FundName AS nvarchar(max)), ',') AS Funds
FROM (
    -- All gift rows for normal counts/sums
    SELECT 
        p.PeopleId,
        p.Name,
        c.ContributionAmount,
        c.ContributionDate,
        cf.FundName
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    JOIN ContributionFund cf ON c.FundId = cf.FundId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0
      AND p.ArchivedFlag = 0
) AS g
JOIN (
    -- Distinct funds per person
    SELECT DISTINCT 
        p.PeopleId,
        cf.FundName
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    JOIN ContributionFund cf ON c.FundId = cf.FundId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0
      AND p.ArchivedFlag = 0
) AS df
    ON g.PeopleId = df.PeopleId
GROUP BY g.PeopleId, g.Name
HAVING SUM(g.ContributionAmount) > 0
ORDER BY SUM(g.ContributionAmount) DESC;
</code></pre>

    <h3>Fund Analysis</h3>
    <pre><code>-- Giving by fund
SELECT 
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as Givers,
    COUNT(*) as Gifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift,
    MAX(c.ContributionAmount) as LargestGift
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99
  AND c.ContributionDate >= DATEADD(month, -3, GETDATE())
GROUP BY cf.FundId, cf.FundName
ORDER BY SUM(c.ContributionAmount) DESC</code></pre>

    <h3>Giving Trends</h3>
    <pre><code>-- Monthly giving trends
SELECT 
    YEAR(c.ContributionDate) as Year,
    MONTH(c.ContributionDate) as Month,
    DATENAME(month, c.ContributionDate) as MonthName,
    COUNT(DISTINCT c.PeopleId) as UniqueGivers,
    COUNT(*) as TotalGifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift
FROM Contribution c
WHERE c.ContributionTypeId != 99
  AND c.ContributionDate >= DATEADD(year, -2, GETDATE())
GROUP BY YEAR(c.ContributionDate), MONTH(c.ContributionDate), DATENAME(month, c.ContributionDate)
ORDER BY Year DESC, Month DESC</code></pre>
</div>

<div id="registration-system" class="section">
    <h2>ğŸ“ Registration System Architecture</h2>
    
    <div class="highlight">
        <h3>Registration Flow</h3>
        <p><strong>Registration</strong> â†’ <strong>RegPeople</strong> â†’ <strong>RegAnswer</strong></p>
        <ul>
            <li><strong>Registration:</strong> Overall registration transaction</li>
            <li><strong>RegPeople:</strong> Individual people in the registration</li>
            <li><strong>RegAnswer:</strong> Their answers to custom questions</li>
            <li><strong>RegQuestion:</strong> The questions being answered</li>
        </ul>
    </div>

    <h3>Registration Tables</h3>
    
    <h4>Registration Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegistrationId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Registration ID</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Event/Org</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Registrant</td>
            <td>Person who registered</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Started</td>
            <td>Registration begun</td>
        </tr>
        <tr>
            <td><code>CompletedDate</code></td>
            <td>datetime</td>
            <td>Completed</td>
            <td>Registration finished</td>
        </tr>
    </table>

    <h4>RegPeople Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegPeopleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Person in registration</td>
        </tr>
        <tr>
            <td><code>RegistrationId</code></td>
            <td>int</td>
            <td>Registration</td>
            <td>â†’ Registration</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>FirstName</code></td>
            <td>nvarchar</td>
            <td>First name</td>
            <td>As entered</td>
        </tr>
        <tr>
            <td><code>LastName</code></td>
            <td>nvarchar</td>
            <td>Last name</td>
            <td>As entered</td>
        </tr>
        <tr>
            <td><code>Email</code></td>
            <td>nvarchar</td>
            <td>Email</td>
            <td>Contact email</td>
        </tr>
        <tr>
            <td><code>Fee</code></td>
            <td>money</td>
            <td>Fee amount</td>
            <td>Cost for this person</td>
        </tr>
    </table>

    <h3>Registration Report Query</h3>
    <pre><code>-- Event registration details
SELECT TOP 500
    o.OrganizationName as Event,
    r.RegistrationId,
    registrant.Name as RegisteredBy,
    r.CreatedDate as RegistrationStarted,
    r.CompletedDate as RegistrationCompleted,
    rp.FirstName + ' ' + rp.LastName as Participant,
    rp.Email,
    rp.Fee,
    CASE 
        WHEN rp.CompletedDate IS NOT NULL THEN 'Complete'
        ELSE 'Incomplete'
    END as Status
FROM Registration r
JOIN Organizations o ON r.OrganizationId = o.OrganizationId
JOIN People registrant ON r.PeopleId = registrant.PeopleId
JOIN RegPeople rp ON r.RegistrationId = rp.RegistrationId
WHERE o.RegistrationTypeId > 0  -- Has registration
  AND r.CreatedDate >= DATEADD(month, -3, GETDATE())
ORDER BY r.CreatedDate DESC</code></pre>

    <h3>Registration Questions & Answers</h3>
    <pre><code>-- Custom form responses
SELECT TOP 1000
    o.OrganizationName,
    p.Name as Participant,
    rq.Label as Question,
    rq.[Order] as QuestionOrder,
    ra.AnswerValue as Answer,
    CASE 
        WHEN rq.IsRequired = 1 THEN 'Required'
        ELSE 'Optional'
    END as QuestionType
FROM RegAnswer ra
JOIN RegPeople rp ON ra.RegPeopleId = rp.RegPeopleId
JOIN People p ON rp.PeopleId = p.PeopleId
JOIN RegQuestion rq ON ra.RegQuestionId = rq.RegQuestionId
JOIN Registration r ON rp.RegistrationId = r.RegistrationId
JOIN Organizations o ON r.OrganizationId = o.OrganizationId
WHERE r.CompletedDate >= DATEADD(month, -1, GETDATE())
ORDER BY o.OrganizationName, p.Name, rq.[Order]</code></pre>
</div>

<div id="checkin-overview" class="section">
    <h2>ğŸ« Check-In System Overview</h2>
    
    <p>TouchPoint's check-in system provides secure child and event check-in with barcode scanning, security labels, and real-time tracking.</p>

    <h3>Check-In Tables</h3>
    
    <h4>CheckInActivities Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Activity record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>CheckInTime</code></td>
            <td>datetime</td>
            <td>Check-in time</td>
            <td>When checked in</td>
        </tr>
        <tr>
            <td><code>CheckInBy</code></td>
            <td>int</td>
            <td>Checked in by</td>
            <td>â†’ People (worker)</td>
        </tr>
    </table>

    <h4>CheckInTimes Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Time record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>â†’ Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Meeting</td>
            <td>â†’ Meetings</td>
        </tr>
        <tr>
            <td><code>CheckInTime</code></td>
            <td>datetime</td>
            <td>Time stamp</td>
            <td>Exact check-in</td>
        </tr>
    </table>

    <h3>Check-In Activity Query</h3>
    <pre><code>  -- Recent check-in activity
  SELECT TOP 100
      cia.Name as PersonName,
      o.OrganizationName,
      cia.CheckInTime,
      cia.AccessType,
      cia.Location,
      DATEDIFF(minute, cia.ActivityTime, cia.CheckInTime) as MinutesEarlyLate
  FROM CheckInActivities cia
  JOIN Organizations o ON cia.OrganizationId = o.OrganizationId
  WHERE cia.CheckInTime >= DATEADD(day, -7, GETDATE())
  ORDER BY cia.CheckInTime DESC</code></pre>

    <h3>Check-In Statistics</h3>
    <pre><code>  -- Check-in statistics by organization
  SELECT TOP 500
      o.OrganizationName,
      COUNT(DISTINCT cia.PeopleId) as UniqueCheckIns,
      COUNT(*) as TotalCheckIns,
      MIN(cia.CheckInTime) as EarliestCheckIn,
      MAX(cia.CheckInTime) as LatestCheckIn
  FROM CheckInActivities cia
  JOIN Organizations o ON cia.OrganizationId = o.OrganizationId
  WHERE cia.CheckInTime >= DATEADD(month, -1, GETDATE())
  GROUP BY o.OrganizationId, o.OrganizationName
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="email-system" class="section">
    <h2>ğŸ“§ Email Marketing System</h2>
    
    <div class="warning">
        <h3>âš ï¸ Performance Warning</h3>
        <p>Email tables contain millions of records. <strong>Always use date filters and TOP clauses:</strong></p>
        <ul>
            <li>EmailResponses: 3.9M+ records</li>
            <li>EmailQueueTo: 3.8M+ records</li>
        </ul>
    </div>

    <h3>Email System Tables</h3>
    
    <h4>EmailQueue Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Email campaign ID</td>
        </tr>
        <tr>
            <td><code>Subject</code></td>
            <td>nvarchar(100)</td>
            <td>Email subject</td>
            <td>Subject line</td>
        </tr>
        <tr>
            <td><code>Body</code></td>
            <td>ntext</td>
            <td>Email content</td>
            <td>HTML/text body</td>
        </tr>
        <tr>
            <td><code>FromAddress</code></td>
            <td>nvarchar(50)</td>
            <td>From email</td>
            <td>Sender address</td>
        </tr>
        <tr>
            <td><code>QueuedBy</code></td>
            <td>int</td>
            <td>Queued by</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>SendAt</code></td>
            <td>datetime</td>
            <td>Send time</td>
            <td>Scheduled/sent</td>
        </tr>
    </table>

    <h3>Email Campaign Analytics</h3>
    <pre><code> -- Email campaign performance (with date filter for performance)
  SELECT TOP 100
      eq.Id,
      eq.Subject,
      eq.SendWhen,
      sender.Name as SentBy,
      COUNT(DISTINCT eqt.PeopleId) as Recipients,
      COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN er.PeopleId END) as UniqueOpens,
      COUNT(DISTINCT CASE WHEN eqt.Bounced = 1 THEN eqt.PeopleId END) as Bounces,
      CAST(COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN er.PeopleId END) as float) /
          NULLIF(COUNT(DISTINCT eqt.PeopleId), 0) * 100 as OpenRate
  FROM EmailQueue eq
  JOIN People sender ON eq.QueuedBy = sender.PeopleId
  LEFT JOIN EmailQueueTo eqt ON eq.Id = eqt.Id
  LEFT JOIN EmailResponses er ON eq.Id = er.EmailQueueId
  WHERE eq.SendWhen >= DATEADD(month, -1, GETDATE())  -- REQUIRED for performance
  GROUP BY eq.Id, eq.Subject, eq.SendWhen, sender.Name
  ORDER BY eq.SendWhen DESC</code></pre>

    <h3>Email Engagement by Person</h3>
    <pre><code>-- Individual email engagement (limited timeframe for performance)
  SELECT TOP 500
      p.Name,
      p.EmailAddress,
      COUNT(DISTINCT eq.Id) as EmailsReceived,
      COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) as EmailsOpened,
      MAX(CASE WHEN er.Type = 'o' THEN er.Dt END) as LastOpened,
      CAST(CASE
          WHEN COUNT(DISTINCT eq.Id) > 0
          THEN COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) * 100.0 / COUNT(DISTINCT eq.Id)
          ELSE 0
      END AS DECIMAL(5,2)) as OpenRate
  FROM People p
  JOIN EmailQueueTo eqt ON p.PeopleId = eqt.PeopleId
  JOIN EmailQueue eq ON eqt.Id = eq.Id
  LEFT JOIN EmailResponses er ON eq.Id = er.EmailQueueId AND p.PeopleId = er.PeopleId
  WHERE eq.SendWhen >= DATEADD(month, -3, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name, p.EmailAddress
  HAVING COUNT(DISTINCT eq.Id) > 0
  ORDER BY COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) DESC</code></pre>
</div>

<div id="engagement-scoring" class="section">
    <h2>ğŸ“Š Engagement Scoring System</h2>
    
    <div class="warning">
        <p><strong>âš ï¸ Performance Note:</strong> EngagementScoreTag has 1.4M+ records. Always filter by WeekDate.</p>
    </div>

    <h3>Engagement Tables</h3>
    
    <h4>EngagementScore Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Score record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>â†’ People</td>
        </tr>
        <tr>
            <td><code>WeekDate</code></td>
            <td>datetime</td>
            <td>Week</td>
            <td>Week of scoring</td>
        </tr>
        <tr>
            <td><code>TotalScore</code></td>
            <td>int</td>
            <td>Total points</td>
            <td>Week's total</td>
        </tr>
    </table>

    <h3>Engagement Analysis</h3>
    <pre><code>  -- Top engaged members (recent)
  SELECT TOP 100
      p.Name,
      SUM(es.TotalScore) as TotalEngagement,
      AVG(es.TotalScore) as AvgWeeklyScore,
      COUNT(DISTINCT es.WeekDate) as ActiveWeeks,
      STRING_AGG(sfl.Name, ', ') as Activities
  FROM EngagementScore es
  JOIN People p ON es.PeopleId = p.PeopleId
  LEFT JOIN EngagementScoreTag est ON es.Id = est.EngagementScoreId
  LEFT JOIN StatusFlagList sfl ON est.StatusFlagId = sfl.Flag
  WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name
  HAVING SUM(es.TotalScore) > 0</code></pre>

    <h3>Engagement Trends</h3>
    <pre><code>-- Weekly engagement trends
SELECT 
    es.WeekDate,
    COUNT(DISTINCT es.PeopleId) as EngagedPeople,
    SUM(es.TotalScore) as TotalPoints,
    AVG(es.TotalScore) as AvgScore,
    MAX(es.TotalScore) as MaxScore
FROM EngagementScore es
WHERE es.WeekDate >= DATEADD(month, -6, GETDATE())
GROUP BY es.WeekDate
ORDER BY es.WeekDate DESC</code></pre>
</div>

<div id="tag-system" class="section">
    <h2>ğŸ·ï¸ Tag System</h2>
    
    <div class="critical">
        <h3>ğŸš¨ EXTREME PERFORMANCE WARNING</h3>
        <p><strong>TagPerson table contains 138 MILLION+ records!</strong></p>
        <p><strong>NEVER query without:</strong></p>
        <ul>
            <li>TOP clause (TOP 100 or less)</li>
            <li>Date filter on DateCreated</li>
            <li>Specific TagId or PeopleId filter</li>
        </ul>
    </div>

    <h3>Tag System Tables</h3>
    
    <h4>Tag Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Tag ID</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(100)</td>
            <td>Tag name</td>
            <td>Display name</td>
        </tr>
        <tr>
            <td><code>TypeId</code></td>
            <td>int</td>
            <td>Tag type</td>
            <td>â†’ TagType</td>
        </tr>
        <tr>
            <td><code>Owner</code></td>
            <td>int</td>
            <td>Tag owner</td>
            <td>â†’ People</td>
        </tr>
    </table>

    <h3>Safe Tag Query Pattern</h3>
    <pre><code>-- SAFE: Query specific tag with date filter
  SELECT TOP 100
      t.Name as TagName,
      p.Name as PersonName,
      tp.DateCreated
  FROM TagPerson tp
  JOIN Tag t ON tp.Id = t.Id
  JOIN People p ON tp.PeopleId = p.PeopleId
  WHERE t.Name = 'Volunteer'  -- Specific tag
    AND tp.DateCreated >= DATEADD(month, -1, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  ORDER BY tp.DateCreated DESC

-- NEVER DO THIS:
-- SELECT * FROM TagPerson  -- 138M+ records!</code></pre>

    <h3>Tag Summary</h3>
    <pre><code> -- Tag usage summary (aggregated, not detail)
  SELECT TOP 50
      t.Name as TagName,
      COUNT(*) as PeopleTagged,
      MIN(tp.DateCreated) as FirstUsed,
      MAX(tp.DateCreated) as LastUsed
  FROM Tag t
  JOIN TagPerson tp ON t.Id = tp.Id
  WHERE tp.DateCreated >= DATEADD(month, -6, GETDATE())  -- REQUIRED
  GROUP BY t.Id, t.Name
  HAVING COUNT(*) > 10
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="extra-values-complete" class="section">
    <h2>ğŸ›ï¸ Extra Value Tables (Custom Fields) - Complete</h2>
    
    <p>TouchPoint provides 17 Extra Value tables allowing churches to add unlimited custom fields without modifying the database schema.</p>

    <h3>Extra Value Table Types</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Data Type</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>PeopleExtra</code></td>
            <td>Mixed</td>
            <td>Person-specific custom fields (most common)</td>
        </tr>
        <tr>
            <td><code>ExtraValueBit</code></td>
            <td>Boolean</td>
            <td>Yes/No checkbox fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueDate</code></td>
            <td>DateTime</td>
            <td>Date picker fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueInt</code></td>
            <td>Integer</td>
            <td>Whole number fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueText</code></td>
            <td>Text</td>
            <td>Free text fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueCode</code></td>
            <td>Code</td>
            <td>Dropdown/lookup fields</td>
        </tr>
        <tr>
            <td><code>OrgExtra</code></td>
            <td>Mixed</td>
            <td>Organization-specific custom fields</td>
        </tr>
        <tr>
            <td><code>MeetingExtra</code></td>
            <td>Mixed</td>
            <td>Meeting-specific custom fields</td>
        </tr>
        <tr>
            <td><code>ContributionExtra</code></td>
            <td>Mixed</td>
            <td>Contribution custom fields</td>
        </tr>
        <tr>
            <td><code>FamilyExtra</code></td>
            <td>Mixed</td>
            <td>Family-level custom fields</td>
        </tr>
        <tr>
            <td><code>ContactExtra</code></td>
            <td>Mixed</td>
            <td>Contact-specific fields</td>
        </tr>
        <tr>
            <td><code>TaskExtra</code></td>
            <td>Mixed</td>
            <td>Task custom fields</td>
        </tr>
        <tr>
            <td><code>VolunteerExtra</code></td>
            <td>Mixed</td>
            <td>Volunteer-specific fields</td>
        </tr>
        <tr>
            <td><code>MemberExtra</code></td>
            <td>Mixed</td>
            <td>Membership custom fields</td>
        </tr>
        <tr>
            <td><code>ResourceExtra</code></td>
            <td>Mixed</td>
            <td>Resource tracking fields</td>
        </tr>
        <tr>
            <td><code>EventExtra</code></td>
            <td>Mixed</td>
            <td>Event-specific fields</td>
        </tr>
        <tr>
            <td><code>AdminExtra</code></td>
            <td>Mixed</td>
            <td>Administrative custom fields</td>
        </tr>
    </table>

    <h3>Discovering Custom Fields in Your Database</h3>
    <pre><code>-- Find all custom fields in use
SELECT 
    'PeopleExtra' as TableType,
    Field,
    COUNT(*) as RecordCount,
    COUNT(DISTINCT PeopleId) as PeopleWithValue,
    MIN(TransactionTime) as FirstUsed,
    MAX(TransactionTime) as LastUsed
FROM PeopleExtra
GROUP BY Field
HAVING COUNT(*) > 10  -- Only show fields with significant usage
ORDER BY COUNT(*) DESC

-- Find custom fields for a specific person
SELECT 
    p.Name,
    'PeopleExtra' as Source,
    pev.Field,
    pev.Data as Value,
    pev.TransactionTime as LastUpdated
FROM People p
JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE p.PeopleId = 12345  -- Specific person
ORDER BY pev.Field</code></pre>

    <h3>Working with Custom Fields</h3>
    <pre><code>-- Example: Church-specific membership covenant field
SELECT TOP 500
    p.Name,
    p.MemberStatusId,
    pev.Data as MembershipCovenantDate
FROM People p
LEFT JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId 
    AND pev.Field = 'MembershipCovenant'
WHERE p.MemberStatusId = 10  -- Members only
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name

-- Example: Multiple custom fields
SELECT 
    p.Name,
    MAX(CASE WHEN pev.Field = 'BackgroundCheck' THEN pev.Data END) as BackgroundCheckDate,
    MAX(CASE WHEN pev.Field = 'SafetyTraining' THEN pev.Data END) as SafetyTrainingDate,
    MAX(CASE WHEN pev.Field = 'VolunteerAgreement' THEN pev.Data END) as VolunteerAgreement
FROM People p
LEFT JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE pev.Field IN ('BackgroundCheck', 'SafetyTraining', 'VolunteerAgreement')
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY p.PeopleId, p.Name
HAVING MAX(CASE WHEN pev.Field = 'BackgroundCheck' THEN pev.Data END) IS NOT NULL</code></pre>

    <h3>Organization Extra Values</h3>
    <pre><code>  -- Find custom fields on organizations
  SELECT
      o.OrganizationName,
      oev.Field,
      oev.Data,
      oev.StrValue,
      oev.DateValue,
      oev.IntValue,
      oev.BitValue,
      oev.TransactionTime
  FROM Organizations o
  JOIN OrganizationExtra oev ON o.OrganizationId = oev.OrganizationId
  WHERE o.OrganizationStatusId = 30
  ORDER BY o.OrganizationName, oev.Field</code></pre>
</div>

<div id="sms-system-complete" class="section">
    <h2>ğŸ“± SMS/Text Messaging System</h2>
    
    <h3>SMS System Tables</h3>
    
    <h4>SMSList Table (Sent Messages)</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>ID</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Message batch ID</td>
        </tr>
        <tr>
            <td><code>SenderID</code></td>
            <td>int</td>
            <td>Sender</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Message</code></td>
            <td>ntext</td>
            <td>SMS content</td>
            <td>Message text</td>
        </tr>
        <tr>
            <td><code>SendAt</code></td>
            <td>datetime</td>
            <td>Send timestamp</td>
            <td>When sent</td>
        </tr>
        <tr>
            <td><code>SentSMS</code></td>
            <td>int</td>
            <td>Count sent</td>
            <td>Number of recipients</td>
        </tr>
        <tr>
            <td><code>Sent</code></td>
            <td>bit</td>
            <td>Sent flag</td>
            <td>Successfully sent</td>
        </tr>
    </table>

    <h4>SmsReceived Table (Incoming Messages)</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Received message ID</td>
        </tr>
        <tr>
            <td><code>FromPeopleId</code></td>
            <td>int</td>
            <td>Sender</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>FromNumber</code></td>
            <td>nvarchar(15)</td>
            <td>Sender phone</td>
            <td>Phone number</td>
        </tr>
        <tr>
            <td><code>Body</code></td>
            <td>ntext</td>
            <td>Message content</td>
            <td>Text received</td>
        </tr>
        <tr>
            <td><code>DateReceived</code></td>
            <td>datetime</td>
            <td>Received timestamp</td>
            <td>When received</td>
        </tr>
    </table>

    <h3>SMS Analytics Query</h3>
    <pre><code>-- SMS engagement analytics
WITH SMSMetrics AS (
    SELECT 
        -- Sent messages
        (SELECT COUNT(*) FROM SMSList WHERE Sent = 1 AND SendAt >= DATEADD(month, -1, GETDATE())) as MessagesSent,
        (SELECT SUM(SentSMS) FROM SMSList WHERE Sent = 1 AND SendAt >= DATEADD(month, -1, GETDATE())) as TotalRecipients,
        
        -- Received messages
        (SELECT COUNT(*) FROM SmsReceived WHERE DateReceived >= DATEADD(month, -1, GETDATE())) as MessagesReceived,
        (SELECT COUNT(DISTINCT FromPeopleId) FROM SmsReceived WHERE DateReceived >= DATEADD(month, -1, GETDATE()) AND FromPeopleId IS NOT NULL) as UniqueResponders
)
SELECT 
    MessagesSent,
    TotalRecipients,
    MessagesReceived,
    UniqueResponders,
    CASE 
        WHEN TotalRecipients > 0 
        THEN CAST(UniqueResponders as float) / TotalRecipients * 100 
        ELSE 0 
    END as ResponseRate
FROM SMSMetrics</code></pre>

    <h3>Text Conversation Threading</h3>
    <pre><code>-- SMS conversation history for a person
SELECT TOP 100
    COALESCE(p.Name, 'Unknown') as Person,
    CASE 
        WHEN sl.ID IS NOT NULL THEN 'Sent'
        ELSE 'Received'
    END as Direction,
    COALESCE(sl.Message, sr.Body) as Message,
    COALESCE(sl.SendAt, sr.DateReceived) as MessageTime
FROM (
    SELECT SenderID as PeopleId, Message, SendAt, NULL as DateReceived 
    FROM SMSList 
    WHERE Sent = 1 AND SendAt >= DATEADD(month, -6, GETDATE())
    UNION ALL
    SELECT FromPeopleId, Body, NULL, DateReceived 
    FROM SmsReceived
    WHERE DateReceived >= DATEADD(month, -6, GETDATE())
) messages
LEFT JOIN People p ON messages.PeopleId = p.PeopleId
LEFT JOIN SMSList sl ON messages.SendAt IS NOT NULL
LEFT JOIN SmsReceived sr ON messages.DateReceived IS NOT NULL
WHERE p.PeopleId = 12345  -- Specific person
ORDER BY MessageTime DESC</code></pre>
</div>

<div id="task-system-complete" class="section">
    <h2>ğŸ“‹ Tasks & Ministry Communication</h2>
    
    <h3>TaskNote Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>TaskNoteId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Task/Note ID</td>
        </tr>
        <tr>
            <td><code>AboutPersonId</code></td>
            <td>int</td>
            <td>Subject person</td>
            <td>â†’ People (about whom)</td>
        </tr>
        <tr>
            <td><code>OwnerId</code></td>
            <td>int</td>
            <td>Task owner</td>
            <td>â†’ People (responsible)</td>
        </tr>
        <tr>
            <td><code>AssigneeId</code></td>
            <td>int</td>
            <td>Assigned to</td>
            <td>â†’ People (doing task)</td>
        </tr>
        <tr>
            <td><code>IsNote</code></td>
            <td>bit</td>
            <td>Type flag</td>
            <td>1=note, 0=task</td>
        </tr>
        <tr>
            <td><code>StatusId</code></td>
            <td>int</td>
            <td>Task status</td>
            <td>â†’ lookup.TaskStatus</td>
        </tr>
        <tr>
            <td><code>Instructions</code></td>
            <td>ntext</td>
            <td>Task description</td>
            <td>What to do</td>
        </tr>
        <tr>
            <td><code>Notes</code></td>
            <td>ntext</td>
            <td>Additional notes</td>
            <td>Extra information</td>
        </tr>
        <tr>
            <td><code>DueDate</code></td>
            <td>datetime</td>
            <td>Due date</td>
            <td>Task deadline</td>
        </tr>
        <tr>
            <td><code>CompletedDate</code></td>
            <td>datetime</td>
            <td>Completion date</td>
            <td>When finished</td>
        </tr>
    </table>

    <h3>Task Management Queries</h3>
    <pre><code>-- Open tasks by assignee
 SELECT TOP 500
      assignee.Name as AssignedTo,
      owner.Name as TaskOwner,
      about.Name as AboutPerson,
      tn.Instructions,
      tn.DueDate,
      CASE
          WHEN tn.DueDate IS NULL THEN NULL
          WHEN tn.DueDate >= GETDATE() THEN DATEDIFF(day, GETDATE(), tn.DueDate)
          ELSE -DATEDIFF(day, tn.DueDate, GETDATE())
      END as DaysTillDue,
      ts.Description as Status
  FROM TaskNote tn
  JOIN People assignee ON tn.AssigneeId = assignee.PeopleId
  JOIN People owner ON tn.OwnerId = owner.PeopleId
  LEFT JOIN People about ON tn.AboutPersonId = about.PeopleId
  LEFT JOIN lookup.TaskStatus ts ON tn.StatusId = ts.Id
  WHERE tn.IsNote = 0  -- Tasks only
    AND tn.CompletedDate IS NULL  -- Not completed
  ORDER BY
      CASE WHEN tn.DueDate IS NULL THEN 1 ELSE 0 END,  -- NULL dates last
      tn.DueDate,
      assignee.Name

-- Overdue tasks
SELECT TOP 500
    assignee.Name as AssignedTo,
    tn.Instructions,
    tn.DueDate,
    DATEDIFF(day, tn.DueDate, GETDATE()) as DaysOverdue,
    owner.Name as TaskOwner
FROM TaskNote tn
JOIN People assignee ON tn.AssigneeId = assignee.PeopleId
JOIN People owner ON tn.OwnerId = owner.PeopleId
WHERE tn.IsNote = 0  -- Tasks only
  AND tn.CompletedDate IS NULL  -- Not completed
  AND tn.DueDate < GETDATE()  -- Overdue
ORDER BY tn.DueDate</code></pre>

    <h3>Ministry Notes</h3>
    <pre><code>-- Recent notes about people
SELECT TOP 500
    about.Name as AboutPerson,
    creator.Name as CreatedBy,
    tn.CreatedDate,
    tn.Instructions as NoteContent,
    tn.Notes as AdditionalInfo
FROM TaskNote tn
JOIN People about ON tn.AboutPersonId = about.PeopleId
JOIN People creator ON tn.CreatedBy = creator.PeopleId
WHERE tn.IsNote = 1  -- Notes only
  AND tn.CreatedDate >= DATEADD(month, -1, GETDATE())
ORDER BY tn.CreatedDate DESC</code></pre>
</div>

<div id="mobile-app-complete" class="section">
    <h2>ğŸ“± Mobile App Configuration</h2>
    
    <h3>Mobile Configuration Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>lookup.CategoryMobile</code></td>
            <td>Mobile app categories</td>
            <td>Id, Code, Description, SortOrder</td>
        </tr>
        <tr>
            <td><code>LocationMobile</code></td>
            <td>Mobile location types</td>
            <td>Id, Description, Address</td>
        </tr>
        <tr>
            <td><code>RegistrationMobile</code></td>
            <td>Mobile registration types</td>
            <td>Id, Type, Settings</td>
        </tr>
        <tr>
            <td><code>AnswersMobileSettings</code></td>
            <td>Mobile form answers</td>
            <td>Id, QuestionId, Answer</td>
        </tr>
        <tr>
            <td><code>QuestionsMobileSettings</code></td>
            <td>Mobile form questions</td>
            <td>Id, Question, Type</td>
        </tr>
    </table>

    <h3>Mobile-Enabled Organizations</h3>
    <pre><code>  -- Organizations visible in mobile app
  SELECT TOP 500
      o.OrganizationName,
      cm.Description as MobileCategory,
      o.AllowMobileView,
      o.RecommendInMobile,
      o.ShowInSites,
      o.ShowMobileRegStart,
      o.ShowMobileRegEnd,
      o.ShowMobileButtonText
  FROM Organizations o
  LEFT JOIN lookup.CategoryMobile cm ON o.CategoryMobileId = cm.Id
  WHERE o.AllowMobileView = 1
    AND o.OrganizationStatusId = 30
  ORDER BY cm.SortOrder, o.OrganizationName</code></pre>
</div>

<div id="picture-system-complete" class="section">
    <h2>ğŸ–¼ï¸ Picture & Media Management</h2>
    
    <h3>Picture Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Picture ID</td>
        </tr>
        <tr>
            <td><code>ThumbUrl</code></td>
            <td>nvarchar</td>
            <td>Thumbnail URL</td>
            <td>Small preview</td>
        </tr>
        <tr>
            <td><code>SmallUrl</code></td>
            <td>nvarchar</td>
            <td>Small size URL</td>
            <td>Mobile size</td>
        </tr>
        <tr>
            <td><code>MediumUrl</code></td>
            <td>nvarchar</td>
            <td>Medium size URL</td>
            <td>Standard display</td>
        </tr>
        <tr>
            <td><code>LargeUrl</code></td>
            <td>nvarchar</td>
            <td>Large size URL</td>
            <td>Full resolution</td>
        </tr>
    </table>

    <div class="warning">
        <p><strong>Note:</strong> When a picture is uploaded, it takes up to 15 minutes for ThumbUrl, SmallUrl, and MediumUrl to be generated</p>
    </div>

    <h3>Picture Usage Query</h3>
    <pre><code>-- People with pictures
SELECT TOP 1000
    p.Name,
    pic.PictureId,
    pic.ThumbUrl,
    pic.MediumUrl,
    pic.LargeUrl,
    CASE 
        WHEN pic.ThumbUrl IS NOT NULL THEN 'Processed'
        ELSE 'Processing'
    END as Status
FROM People p
JOIN Picture pic ON p.PictureId = pic.PictureId
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name</code></pre>
</div>

<div id="users-roles-complete" class="section">
    <h2>ğŸ” Users, Roles & Permissions</h2>
    
    <h3>Users Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>User account ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person link</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Username</code></td>
            <td>nvarchar</td>
            <td>Login name</td>
            <td>Unique username</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar</td>
            <td>Display name</td>
            <td>User's full name</td>
        </tr>
        <tr>
            <td><code>EmailAddress</code></td>
            <td>nvarchar</td>
            <td>Login email</td>
            <td>Authentication email</td>
        </tr>
        <tr>
            <td><code>IsApproved</code></td>
            <td>bit</td>
            <td>Account active</td>
            <td>Can login</td>
        </tr>
        <tr>
            <td><code>LastLoginDate</code></td>
            <td>datetime</td>
            <td>Last login</td>
            <td>Most recent access</td>
        </tr>
        <tr>
            <td><code>MustChangePassword</code></td>
            <td>bit</td>
            <td>Password reset</td>
            <td>Force change</td>
        </tr>
        <tr>
            <td><code>MFAEnabled</code></td>
            <td>bit</td>
            <td>2FA enabled</td>
            <td>Multi-factor auth</td>
        </tr>
    </table>

    <h3>Roles Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RoleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Role ID</td>
        </tr>
        <tr>
            <td><code>RoleName</code></td>
            <td>nvarchar</td>
            <td>Role name</td>
            <td>Admin, Finance, etc.</td>
        </tr>
    </table>

    <h3>User Security Report</h3>
    <pre><code>-- Active users with roles
SELECT TOP 500
    u.UserId,
    u.Username,
    u.Name,
    u.EmailAddress,
    u.LastLoginDate,
    DATEDIFF(day, u.LastLoginDate, GETDATE()) as DaysSinceLogin,
    u.MFAEnabled,
    STRING_AGG(r.RoleName, ', ') as Roles
FROM Users u
LEFT JOIN UserRole ur ON u.UserId = ur.UserId
LEFT JOIN Roles r ON ur.RoleId = r.RoleId
WHERE u.IsApproved = 1
GROUP BY u.UserId, u.Username, u.Name, u.EmailAddress, u.LastLoginDate, u.MFAEnabled
ORDER BY u.LastLoginDate DESC

-- Users who haven't logged in recently
SELECT TOP 100
    u.Name,
    u.Username,
    u.LastLoginDate,
    DATEDIFF(day, u.LastLoginDate, GETDATE()) as DaysInactive
FROM Users u
WHERE u.IsApproved = 1
  AND u.LastLoginDate < DATEADD(month, -3, GETDATE())
ORDER BY u.LastLoginDate</code></pre>
</div>

<div id="activity-logging-complete" class="section">
    <h2>ğŸ“ Activity Logging & Audit Trail</h2>
    
    <div class="warning">
        <p><strong>âš ï¸ Performance Warning:</strong> ActivityLog contains 3.4M+ records. Always use date filters.</p>
    </div>

    <h3>ActivityLog Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>bigint</td>
            <td>Primary key</td>
            <td>Activity ID</td>
        </tr>
        <tr>
            <td><code>ActivityDate</code></td>
            <td>datetime</td>
            <td>When occurred</td>
            <td>Timestamp</td>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>User</td>
            <td>â†’ Users.UserId</td>
        </tr>
        <tr>
            <td><code>ActivityType</code></td>
            <td>nvarchar(50)</td>
            <td>Activity type</td>
            <td>Login, Update, etc.</td>
        </tr>
        <tr>
            <td><code>Machine</code></td>
            <td>nvarchar(50)</td>
            <td>Computer/device</td>
            <td>Client info</td>
        </tr>
        <tr>
            <td><code>Activity</code></td>
            <td>ntext</td>
            <td>Activity details</td>
            <td>Full description</td>
        </tr>
    </table>

    <h3>Audit Queries</h3>
    <pre><code>  -- Recent user activity (MUST have date filter)
  SELECT TOP 100
      al.ActivityDate,
      u.Name as UserName,  -- Changed from 'User' to avoid reserved keyword
      al.Activity,
      al.Machine,
      al.PageUrl
  FROM ActivityLog al
  LEFT JOIN Users u ON al.UserId = u.UserId
  WHERE al.ActivityDate >= DATEADD(day, -7, GETDATE())  -- REQUIRED
  ORDER BY al.ActivityDate DESC

  -- Activity summary
  SELECT
      al.Activity,
      COUNT(*) as ActivityCount,
      COUNT(DISTINCT al.UserId) as UniqueUsers,
      MIN(al.ActivityDate) as FirstOccurrence,
      MAX(al.ActivityDate) as LastOccurrence
  FROM ActivityLog al
  WHERE al.ActivityDate >= DATEADD(month, -1, GETDATE())  -- REQUIRED
  GROUP BY al.Activity
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="change-tracking-complete" class="section">
    <h2>ğŸ”„ Change Tracking & History</h2>
    
    <h3>Change Tracking Tables</h3>
    
    <h4>ChangeLog Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Change ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person changed</td>
            <td>â†’ People.PeopleId (NULL for non-person changes)</td>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Family changed</td>
            <td>â†’ Family.FamilyId (NULL for non-family changes)</td>
        </tr>
        <tr>
            <td><code>UserPeopleId</code></td>
            <td>int</td>
            <td>Who made the change</td>
            <td>â†’ People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Created</code></td>
            <td>datetime</td>
            <td>When changed</td>
            <td>Timestamp of change</td>
        </tr>
        <tr>
            <td><code>Field</code></td>
            <td>nvarchar</td>
            <td>Field changed</td>
            <td>Column name that was modified</td>
        </tr>
        <tr>
            <td><code>Data</code></td>
            <td>nvarchar</td>
            <td>Additional data</td>
            <td>Extra context about the change</td>
        </tr>
        <tr>
            <td><code>Before</code></td>
            <td>nvarchar</td>
            <td>Old value</td>
            <td>Previous data</td>
        </tr>
        <tr>
            <td><code>After</code></td>
            <td>nvarchar</td>
            <td>New value</td>
            <td>Updated data</td>
        </tr>
    </table>

    <div class="info">
        <strong>Note:</strong> TouchPoint stores all change information in a single ChangeLog table. The ChangeDetails table exists but is not used in the standard change tracking queries. All change data (before/after values) is stored directly in the ChangeLog table.
    </div>

    <h3>Change History Queries</h3>
    <pre><code>-- Recent changes to People records
  SELECT TOP 100
      cl.Created,
      p.Name as ChangedBy,
      cl.Field,
      cl.Before,
      cl.After
  FROM ChangeLog cl
  JOIN People p ON cl.UserPeopleId = p.PeopleId
  WHERE cl.PeopleId IS NOT NULL  -- Changes to people records
    AND cl.Created >= DATEADD(day, -7, GETDATE())
  ORDER BY cl.Created DESC

  -- Track specific person's history
  SELECT
      cl.Created,
      modifier.Name as ModifiedBy,
      cl.Field,
      cl.Before,
      cl.After
  FROM ChangeLog cl
  LEFT JOIN People modifier ON cl.UserPeopleId = modifier.PeopleId
  WHERE cl.PeopleId = 12345  -- Specific PeopleId
  ORDER BY cl.Created DESC</code></pre>
</div>

<div id="financial-system-complete" class="section">
    <h2>ğŸ’³ Financial System Details</h2>
    
    <h3>Bundle System (Batch Processing)</h3>
    
    <h4>BundleHeader Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Batch ID</td>
        </tr>
        <tr>
            <td><code>ContributionDate</code></td>
            <td>datetime</td>
            <td>Contribution date</td>
            <td>When received</td>
        </tr>
        <tr>
            <td><code>DepositDate</code></td>
            <td>datetime</td>
            <td>Bank deposit</td>
            <td>When deposited</td>
        </tr>
        <tr>
            <td><code>TotalCash</code></td>
            <td>money</td>
            <td>Cash total</td>
            <td>Cash in batch</td>
        </tr>
        <tr>
            <td><code>TotalChecks</code></td>
            <td>money</td>
            <td>Check total</td>
            <td>Checks in batch</td>
        </tr>
        <tr>
            <td><code>TotalEnvelopes</code></td>
            <td>int</td>
            <td>Envelope count</td>
            <td>Number processed</td>
        </tr>
    </table>

    <h4>BundleDetail Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BundleDetailId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Detail ID</td>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Batch</td>
            <td>â†’ BundleHeader</td>
        </tr>
        <tr>
            <td><code>ContributionId</code></td>
            <td>int</td>
            <td>Contribution</td>
            <td>â†’ Contribution</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Entry date</td>
            <td>When entered</td>
        </tr>
    </table>

    <h3>Batch Processing Queries</h3>
    <pre><code>-- Recent batch summary
SELECT TOP 500
    bh.BundleHeaderId,
    bh.ContributionDate,
    bh.DepositDate,
    bh.TotalCash + bh.TotalChecks as TotalAmount,
    bh.TotalEnvelopes,
    COUNT(bd.BundleDetailId) as ContributionCount
FROM BundleHeader bh
LEFT JOIN BundleDetail bd ON bh.BundleHeaderId = bd.BundleHeaderId
WHERE bh.ContributionDate >= DATEADD(month, -1, GETDATE())
GROUP BY bh.BundleHeaderId, bh.ContributionDate, bh.DepositDate, 
         bh.TotalCash, bh.TotalChecks, bh.TotalEnvelopes
ORDER BY bh.ContributionDate DESC</code></pre>
</div>

<div id="transaction-system-complete" class="section">
    <h2>ğŸ’° Transactions & Outstanding Balances</h2>
    
    <h3>Transaction Tables</h3>
    
    <h4>Transaction Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Transaction ID</td>
        </tr>
        <tr>
            <td><code>TransactionDate</code></td>
            <td>datetime</td>
            <td>Date</td>
            <td>When occurred</td>
        </tr>
        <tr>
            <td><code>amt</code></td>
            <td>money</td>
            <td>Amount</td>
            <td>Total amount</td>
        </tr>
        <tr>
            <td><code>amtdue</code></td>
            <td>money</td>
            <td>Amount due</td>
            <td>Outstanding balance</td>
        </tr>
        <tr>
            <td><code>Description</code></td>
            <td>nvarchar</td>
            <td>Description</td>
            <td>Transaction details</td>
        </tr>
    </table>

    <h3>Outstanding Balance Query</h3>
    <pre><code>-- People with outstanding balances
SELECT TOP 500
    p.Name,
    SUM(t.amtdue) as TotalDue,
    COUNT(*) as OpenTransactions,
    MIN(t.TransactionDate) as OldestTransaction,
    DATEDIFF(day, MIN(t.TransactionDate), GETDATE()) as DaysOutstanding
FROM TransactionPeople tp
JOIN People p ON tp.PeopleId = p.PeopleId
JOIN [Transaction] t ON tp.Id = t.Id
WHERE t.amtdue > 0
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY p.PeopleId, p.Name
HAVING SUM(t.amtdue) > 0
ORDER BY SUM(t.amtdue) DESC</code></pre>
</div>

<!-- Add the complete JavaScript section -->
<script>
// Complete JavaScript for all interactive features
document.addEventListener('DOMContentLoaded', function() {
    // Add copy buttons to all code blocks
    const codeBlocks = document.querySelectorAll('pre');
    
    codeBlocks.forEach(function(block) {
        // Create copy button
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.style.position = 'absolute';
        button.style.top = '10px';
        button.style.right = '10px';
        button.style.background = '#4299e1';
        button.style.color = 'white';
        button.style.border = 'none';
        button.style.padding = '6px 12px';
        button.style.borderRadius = '4px';
        button.style.cursor = 'pointer';
        button.style.fontSize = '12px';
        button.style.fontWeight = '500';
        
        // Make pre position relative for absolute button positioning
        block.style.position = 'relative';
        
        // Add click handler
        button.addEventListener('click', function() {
            const code = block.querySelector('code');
            const text = code ? code.textContent : block.textContent;
            
            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function() {
                    button.textContent = 'Copied!';
                    button.style.background = '#38a169';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                }).catch(function(err) {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    button.style.background = '#38a169';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                } catch (err) {
                    button.textContent = 'Failed';
                    button.style.background = '#e53e3e';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                }
                document.body.removeChild(textarea);
            }
        });
        
        block.appendChild(button);
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            } else {
                const target = document.querySelector(targetId);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });
    });
    
    // Back to top button visibility
    const backToTop = document.querySelector('.back-to-top');
    if (backToTop) {
        // Hide initially
        backToTop.style.display = 'none';
        
        // Show/hide based on scroll position
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        });
    }
    
    // Add table of contents highlighting based on scroll position
    const sections = document.querySelectorAll('.section[id]');
    const tocLinks = document.querySelectorAll('.toc a[href^="#"]');
    
    window.addEventListener('scroll', function() {
        let current = '';
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (pageYOffset >= sectionTop - 100) {
                current = section.getAttribute('id');
            }
        });
        
        tocLinks.forEach(link => {
            link.style.fontWeight = '500';
            link.style.background = 'transparent';
            if (link.getAttribute('href') === '#' + current) {
                link.style.fontWeight = '700';
                link.style.background = '#ebf8ff';
                link.style.padding = '5px 10px';
                link.style.borderRadius = '5px';
            }
        });
    });
});
</script>

<!-- CSS for missing styles -->
<style>
.section {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.field-table {
    font-size: 0.95em;
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

.field-table th {
    background: #edf2f7;
    font-weight: 600;
    padding: 12px;
    text-align: left;
    border: 1px solid #e2e8f0;
}

.field-table td {
    padding: 10px 12px;
    border: 1px solid #e2e8f0;
}

.field-table th:first-child {
    width: 25%;
}

.field-table th:nth-child(2) {
    width: 15%;
}

.field-table code {
    background: #f7fafc !important;
    color: #e53e3e !important;
    padding: 2px 6px !important;
    border-radius: 3px !important;
    font-size: 0.9em !important;
}

.warning {
    background: #fed7e2;
    border: 2px solid #e53e3e;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
}

.info {
    background: #bee3f8;
    border: 2px solid #3182ce;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
}

.highlight {
    background: #fef5e7;
    border-left: 5px solid #ed8936;
    padding: 15px;
    margin: 20px 0;
    border-radius: 0 8px 8px 0;
}

.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 600;
    margin-left: 8px;
}

.badge-critical {
    background: #fed7e2;
    color: #c53030;
}

.badge-new {
    background: #c6f6d5;
    color: #22543d;
}

.badge-performance {
    background: #fef5e7;
    color: #c05621;
}
</style>
