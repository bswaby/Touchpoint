<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swaby's Touchpoint SQL Database Reference Guide</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
            color: #1a202c;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 15px 0;
            font-size: 2.8em;
            font-weight: 700;
        }
        
        .header .subtitle {
            font-size: 1.3em;
            opacity: 0.95;
            margin: 0 0 20px 0;
        }
        
        .header .version {
            font-size: 1em;
            opacity: 0.9;
            background: rgba(255,255,255,0.2);
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
        }
        
        .intro-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .warning {
            background: #fed7e2;
            border: 2px solid #e53e3e;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info {
            background: #bee3f8;
            border: 2px solid #3182ce;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .success {
            background: #c6f6d5;
            border: 2px solid #38a169;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .toc {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .toc h2 {
            margin-top: 0;
            color: #2d3748;
            border-bottom: 3px solid #4299e1;
            padding-bottom: 10px;
            font-size: 2em;
        }
        
        .toc h3 {
            color: #4299e1;
            margin-top: 25px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .toc ul {
            list-style: none;
            padding-left: 0;
        }
        
        .toc li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }
        
        .toc li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: #4299e1;
        }
        
        .toc a {
            color: #4299e1;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .toc a:hover {
            color: #2c5282;
            text-decoration: underline;
        }
        
        .section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        h1, h2, h3, h4 {
            color: #2d3748;
        }
        
        h2 {
            border-bottom: 3px solid #4299e1;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 1.8em;
        }
        
        h3 {
            color: #4299e1;
            margin-top: 25px;
            font-size: 1.4em;
        }
        
        h4 {
            color: #4a5568;
            margin-top: 20px;
            font-size: 1.2em;
        }
        
        pre {
            background: #2d3748 !important;
            color: #e2e8f0 !important;
            padding: 20px !important;
            border-radius: 8px !important;
            overflow-x: auto !important;
            font-family: 'SF Mono', Monaco, 'Inconsolata', 'Roboto Mono', Consolas, monospace !important;
            line-height: 1.5 !important;
            font-size: 0.95em !important;
            position: relative;
            margin: 15px 0 !important;
        }
        
        pre code {
            background: transparent !important;
            color: #e2e8f0 !important;
            padding: 0 !important;
            font-size: inherit !important;
        }
        
        :not(pre) > code {
            background: #edf2f7 !important;
            padding: 3px 6px !important;
            border-radius: 4px !important;
            font-family: 'SF Mono', Monaco, monospace !important;
            color: #e53e3e !important;
            font-size: 0.9em !important;
        }
        
        .critical {
            background: #fed7e2;
            border-left: 5px solid #e53e3e;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .highlight {
            background: #fef5e7;
            border-left: 5px solid #ed8936;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
        }
        
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
        }
        
        tr:nth-child(even) {
            background: #f7fafc;
        }
        
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4299e1;
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            font-weight: 600;
            z-index: 1000;
        }
        
        .back-to-top:hover {
            background: #3182ce;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .copy-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4299e1;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .copy-button:hover {
            background: #3182ce;
        }
        
        .field-table {
            font-size: 0.95em;
        }
        
        .field-table th:first-child {
            width: 25%;
        }
        
        .field-table th:nth-child(2) {
            width: 15%;
        }
        
        .field-table code {
            font-size: 0.9em !important;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .badge-critical {
            background: #fed7e2;
            color: #c53030;
        }
        
        .badge-new {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .badge-performance {
            background: #fef5e7;
            color: #c05621;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section, .toc {
                padding: 20px;
            }
            
            pre {
                padding: 15px !important;
                font-size: 0.85em !important;
            }
        }
        
        @media print {
            body { background: white; }
            .section { box-shadow: none; border: 1px solid #e2e8f0; }
            .back-to-top { display: none; }
            .copy-button { display: none; }
            .toc { page-break-after: always; }
        }
    </style>
</head>
<body>

<div class="header">
    <h1>Swaby's TouchPoint SQL Database Reference</h1>
    <p class="subtitle">My Personal Guide to the TouchPoint's Church Management Database</p>
    <div class="version">Version: The smothered, covered, chunked, diced, and occasionally topped version</div>
</div>

<div class="intro-section">
    <h2>üìö About This Guide</h2>
    <p>I could no longer keep up with all the tables and relationships, so started creating my own documented version of the structure to take at least a small bite out of TouchPoint's extensive SQL database structure.</p>
    
    <div class="success">
        <h3>üôè Special Thanks</h3>
        <p><strong>Ryanne at 2PC Memphis</strong> - Thank you for your invaluable contributions, insights, and corrections that have made this documentation more accurate and comprehensive!</p>
    </div>
    
    <div class="info">
        <h3>üë• Who This Guide Is For</h3>
        <ul>
            <li><strong>Church Database Administrators</strong> - Managing and querying church data</li>
            <li><strong>Report Writers</strong> - Creating custom reports and analytics</li>
            <li><strong>Developers</strong> - Building integrations and custom solutions</li>
            <li><strong>Church Leadership</strong> - Understanding data capabilities</li>
        </ul>
    </div>
    
    <div class="warning">
        <h3>‚ö†Ô∏è Critical: TouchPoint SQL is READ-ONLY (but temp tables work!)</h3>
        <p><strong>The SQL interface provides READ-ONLY access to the database.</strong> You cannot INSERT, UPDATE, or DELETE records in TouchPoint tables. All data modifications must be done through:</p>
        <ul>
            <li>‚úÖ TouchPoint's web interface</li>
            <li>‚úÖ TouchPoint's Python scripting system</li>
            <li>‚úÖ TouchPoint's API endpoints</li>
            <li>‚úÖ TouchPoint's mobile app</li>
        </ul>
        <p class="info"><strong>üí° TIP:</strong> While you can't modify TouchPoint tables, you CAN create and use temporary tables (#TempTableName) within your SQL scripts for complex queries, data staging, and intermediate calculations. Temp tables are session-specific and automatically cleaned up.</p>
        <p>This guide focuses on SELECT queries for reporting, analysis, and data extraction.</p>
    </div>
    
    <div class="success">
        <h3>‚ú® What's New in this Documentation (Updated!)</h3>
        <ul>
            <li>üìä Complete coverage of all 389 tables across 3 schemas (dbo, lookup, custom)</li>
            <li>üÜï Table Quick Reference Guide with all core tables by category</li>
            <li>üÜï Common JOIN Patterns for organization hierarchy and relationships</li>
            <li>üÜï Complete Lookup Tables Reference with key values</li>
            <li>üÜï Users, Roles & Security documentation</li>
            <li>üÜï Program ‚Üí Division ‚Üí Organization hierarchy documentation</li>
            <li>üÜï PeopleExtra, OrganizationExtra, FamilyExtra custom fields</li>
            <li>üÜï TaskNote and task management system (174K+ records)</li>
            <li>üÜï Meetings table documentation (61K+ records)</li>
            <li>üöÄ Performance guidelines for tables with millions of records</li>
            <li>üîß Advanced systems documentation (Tags, Email, Engagement)</li>
            <li>üìù Registration and Check-in system details</li>
        </ul>
    </div>
</div>

<div class="toc">
    <h2>üìñ Table of Contents</h2>
    
    <h3>üöÄ Getting Started</h3>
    <ul>
        <li><a href="#database-overview">Database Overview & Architecture</a></li>
        <li><a href="#critical-rules">Critical Business Rules - READ THIS FIRST</a></li>
        <li><a href="#performance-guidelines">Performance Guidelines & Large Table Warnings</a></li>
        <li><a href="#table-quick-reference">üìö Table Quick Reference Guide (NEW)</a></li>
        <li><a href="#common-join-patterns">üîß Common JOIN Patterns (NEW)</a></li>
        <li><a href="#lookup-tables-reference">üìã Critical Lookup Tables Reference (NEW)</a></li>
        <li><a href="#common-queries">Most Common Queries (Quick Reference)</a></li>
    </ul>

    <h3>üë• People & Families</h3>
    <ul>
        <li><a href="#people-table">People Table - Complete Reference</a></li>
        <li><a href="#family-structure">Family Relationships & Household Management</a></li>
        <li><a href="#contact-permissions">Contact Information & Communication Permissions</a></li>
        <li><a href="#membership-workflow">Church Membership Status & Workflow</a></li>
    </ul>

    <h3>üèõÔ∏è Organizations & Groups</h3>
    <ul>
        <li><a href="#organizations-table">Organizations Table (Involvements)</a></li>
        <li><a href="#organization-members">Organization Membership & Roles</a></li>
        <li><a href="#program-hierarchy">Program ‚Üí Division ‚Üí Organization Structure</a></li>
        <li><a href="#organization-types">Organization Types & Classification</a></li>
    </ul>

    <h3>üìÖ Attendance & Meetings</h3>
    <ul>
        <li><a href="#attend-table">Attend Table - The AttendanceFlag Rule</a></li>
        <li><a href="#meetings-table">Meetings & Scheduling</a></li>
        <li><a href="#attendance-types">Attendance Types & Classifications</a></li>
        <li><a href="#attendance-analytics">Attendance Analytics & Patterns</a></li>
    </ul>

    <h3>üí∞ Financial & Contributions</h3>
    <ul>
        <li><a href="#contribution-table">Contribution Table - The TypeId‚â†99 Rule</a></li>
        <li><a href="#contribution-funds">Funds & Designations</a></li>
        <li><a href="#bundle-system">Bundle & Batch Processing</a></li>
        <li><a href="#transaction-system">Transactions & Outstanding Balances</a></li>
    </ul>

    <h3>üìù Events & Registration</h3>
    <ul>
        <li><a href="#registration-system">Registration System Architecture</a></li>
        <li><a href="#registration-questions">Custom Forms & Questions</a></li>
        <li><a href="#registration-fees">Registration Fees & Payments</a></li>
        <li><a href="#event-management">Event Management & Scheduling</a></li>
    </ul>

    <h3>üé´ Check-In System</h3>
    <ul>
        <li><a href="#checkin-overview">Check-In System Overview</a></li>
        <li><a href="#checkin-activity">Check-In Activity & Times</a></li>
        <li><a href="#checkin-configuration">Check-In Configuration & Settings</a></li>
        <li><a href="#barcode-system">Barcode & Security Labels</a></li>
    </ul>

    <h3>üìß Communication Systems</h3>
    <ul>
        <li><a href="#email-system">Email Marketing System (3.9M+ records)</a></li>
        <li><a href="#sms-system">SMS/Text Messaging System</a></li>
        <li><a href="#task-system">Tasks & Ministry Communication</a></li>
        <li><a href="#notification-preferences">Notification Preferences & Opt-outs</a></li>
    </ul>

    <h3>üìä Advanced Analytics</h3>
    <ul>
        <li><a href="#engagement-scoring">Engagement Scoring System (1.4M+ records)</a></li>
        <li><a href="#tag-system">Tag System (138M+ records)</a></li>
        <li><a href="#activity-logging">Activity Logging & Audit Trail</a></li>
        <li><a href="#change-tracking">Change Tracking & History</a></li>
    </ul>

    <h3>üéõÔ∏è Customization Systems</h3>
    <ul>
        <li><a href="#database-views">Database Views Documentation</a></li>
        <li><a href="#extra-values">Extra Value Tables (Custom Fields)</a></li>
        <li><a href="#lookup-tables">Lookup Tables Reference (67+ tables)</a></li>
        <li><a href="#settings-framework">Settings & Configuration Framework</a></li>
        <li><a href="#content-management">Content & Template Management</a></li>
    </ul>

    <h3>üì± Mobile & Integration</h3>
    <ul>
        <li><a href="#mobile-app">Mobile App Configuration</a></li>
        <li><a href="#picture-system">Picture & Media Management</a></li>
        <li><a href="#search-optimization">Search Optimization System</a></li>
        <li><a href="#api-integration">API Integration Points</a></li>
    </ul>

    <h3>üîê Security & Administration</h3>
    <ul>
        <li><a href="#users-roles">Users, Roles & Permissions</a></li>
        <li><a href="#security-settings">Security Settings & Access Control</a></li>
        <li><a href="#data-privacy">Data Privacy & Protection</a></li>
    </ul>

    <h3>üìà Reporting & Analytics</h3>
    <ul>
        <li><a href="#common-reports">Common Report Patterns</a></li>
        <li><a href="#dashboard-queries">Dashboard & KPI Queries</a></li>
        <li><a href="#growth-analytics">Growth & Trend Analytics</a></li>
        <li><a href="#financial-reports">Financial Reporting Queries</a></li>
    </ul>

    <h3>üîß Reference & Troubleshooting</h3>
    <ul>
        <li><a href="#field-reference">Complete Field Reference</a></li>
        <li><a href="#relationship-diagram">Table Relationship Diagrams</a></li>
        <li><a href="#common-issues">Common Issues & Solutions</a></li>
        <li><a href="#best-practices">Best Practices & Tips</a></li>
    </ul>
</div>

<div id="database-overview" class="section">
    <h2>üìä Database Overview & Architecture</h2>
    
    <p>TouchPoint is an enterprise-level church management system with one of the most comprehensive databases in the church software industry. Understanding its scale and architecture is crucial for effective use.</p>

    <h3>üèóÔ∏è Database Scale (Verified from Local Database)</h3>
    <table>
        <tr>
            <th>Metric</th>
            <th>Count</th>
            <th>Description</th>
        </tr>
        <tr>
            <td><strong>Total Tables</strong></td>
            <td>389</td>
            <td>Complete system coverage from people to analytics</td>
        </tr>
        <tr>
            <td><strong>Total Columns</strong></td>
            <td>4,451</td>
            <td>Extensive data points for comprehensive tracking</td>
        </tr>
        <tr>
            <td><strong>Foreign Keys</strong></td>
            <td>460</td>
            <td>Complex relationships ensuring data integrity</td>
        </tr>
        <tr>
            <td><strong>Lookup Tables</strong></td>
            <td>66</td>
            <td>Business logic and validation rules (lookup schema)</td>
        </tr>
        <tr>
            <td><strong>Extra Value Tables</strong></td>
            <td>17</td>
            <td>Unlimited custom field capabilities</td>
        </tr>
        <tr>
            <td><strong>Stored Procedures</strong></td>
            <td>161</td>
            <td>Complex operations and reporting</td>
        </tr>
    </table>

    <h3>üìà Production Data Volumes (from Local Database)</h3>
    <div class="highlight">
        <p><strong>Real-world production databases contain massive data volumes (actual counts from local DB):</strong></p>
        <table>
            <tr>
                <th>Table</th>
                <th>Record Count</th>
                <th>Purpose</th>
                <th>Performance Impact</th>
            </tr>
            <tr>
                <td><code>TagPerson</code></td>
                <td>159.3M</td>
                <td>Flexible categorization</td>
                <td><span class="badge badge-critical">EXTREME - Always use filters!</span></td>
            </tr>
            <tr>
                <td><code>EmailResponses</code></td>
                <td>4.6M</td>
                <td>Email engagement tracking</td>
                <td><span class="badge badge-critical">HIGH</span></td>
            </tr>
            <tr>
                <td><code>ActivityLog</code></td>
                <td>3.8M</td>
                <td>Audit trail</td>
                <td><span class="badge badge-critical">HIGH</span></td>
            </tr>
            <tr>
                <td><code>Attend</code></td>
                <td>1.5M</td>
                <td>Attendance records</td>
                <td><span class="badge badge-performance">MEDIUM</span></td>
            </tr>
            <tr>
                <td><code>Contribution</code></td>
                <td>691K</td>
                <td>Financial giving</td>
                <td><span class="badge badge-performance">MEDIUM</span></td>
            </tr>
            <tr>
                <td><code>EmailQueue</code></td>
                <td>195K</td>
                <td>Email messages sent</td>
                <td>LOW</td>
            </tr>
            <tr>
                <td><code>TaskNote</code></td>
                <td>175K</td>
                <td>Tasks and notes</td>
                <td>LOW</td>
            </tr>
            <tr>
                <td><code>People</code></td>
                <td>51K</td>
                <td>Person records</td>
                <td>LOW</td>
            </tr>
            <tr>
                <td><code>Families</code></td>
                <td>31K</td>
                <td>Family units</td>
                <td>LOW</td>
            </tr>
        </table>
    </div>

    <h3>üèõÔ∏è Core System Architecture</h3>
    <pre><code>-- Core Entity Relationships
People (PeopleId) 
    ‚îú‚îÄ‚îÄ FamilyId ‚Üí Groups family members
    ‚îú‚îÄ‚îÄ SpouseId ‚Üí Direct spouse link
    ‚îî‚îÄ‚îÄ OrganizationMembers ‚Üí Group participation
        ‚îî‚îÄ‚îÄ Organizations (OrganizationId)
            ‚îú‚îÄ‚îÄ Meetings ‚Üí Scheduled events
            ‚îî‚îÄ‚îÄ Attend ‚Üí Attendance records

People (PeopleId)
    ‚îú‚îÄ‚îÄ Contribution ‚Üí Financial giving
    ‚îÇ   ‚îî‚îÄ‚îÄ ContributionFund ‚Üí Designated funds
    ‚îú‚îÄ‚îÄ TaskNote ‚Üí Tasks and notes
    ‚îî‚îÄ‚îÄ Registration ‚Üí Event signups
        ‚îî‚îÄ‚îÄ RegPeople ‚Üí Participants
            ‚îî‚îÄ‚îÄ RegAnswer ‚Üí Form responses</code></pre>
</div>

<div id="critical-rules" class="section">
    <h2>üö® Critical Business Rules - READ THIS FIRST</h2>
    
    <div class="critical">
        <h3>‚ö†Ô∏è Rule #1: ALWAYS Use TOP Clause for Exploration</h3>
        <p>TouchPoint databases can contain millions of records. <strong>Never run unlimited queries without the TOP clause</strong> during exploration or testing.</p>
        <pre><code>-- ‚úÖ CORRECT: Always start with TOP
SELECT TOP 100 * FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0

-- ‚ùå WRONG: Never run unlimited on large tables
SELECT * FROM TagPerson  -- This table has 138M+ records!</code></pre>
    </div>

    <div class="critical">
        <h3>‚ö†Ô∏è Rule #2: Mandatory Filters for Every Query</h3>
        <pre><code>-- üö® FILTER #1: Active People Only
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0

-- üö® FILTER #2: Actual Attendance (not absences)
WHERE a.AttendanceFlag = 1  -- 1 = present, 0 = absent

-- üö® FILTER #3: Real Donations (not event fees)
WHERE c.ContributionTypeId != 99  -- 99 = event registration fee

-- üö® FILTER #4: Active Organizations
WHERE o.OrganizationStatusId = 30  -- 30 = Active

-- üö® FILTER #5: Current Members Only
WHERE om.InactiveDate IS NULL

-- üö® FILTER #6: Completed Meetings
WHERE m.DidNotMeet = 0</code></pre>
    </div>

    <div class="highlight">
        <h3>üìã Communication Compliance Rules</h3>
        <pre><code>-- Always check permissions before communication
WHERE p.DoNotMailFlag = 0      -- Can send mail
WHERE p.DoNotCallFlag = 0      -- Can make calls
WHERE p.DoNotVisitFlag = 0     -- Can visit
WHERE p.ReceiveSMS = 1         -- Can send texts
WHERE p.SendEmailAddress1 = 1  -- Can email primary
WHERE p.SendEmailAddress2 = 1  -- Can email secondary</code></pre>
    </div>

    <div class="warning">
        <h3>‚ö†Ô∏è Data Quality Filters</h3>
        <pre><code>-- Ensure good data quality
WHERE p.PrimaryBadAddrFlag = 0  -- Valid addresses only
WHERE p.CellPhoneIsValid = 1    -- Valid phone numbers
WHERE p.EmailAddress IS NOT NULL AND p.EmailAddress != ''</code></pre>
    </div>
</div>

<div id="performance-guidelines" class="section">
    <h2>‚ö° Performance Guidelines & Large Table Warnings</h2>
    
    <h3>üéØ TOP Clause Usage Guidelines</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>TOP Value</th>
            <th>Use Case</th>
        </tr>
        <tr>
            <td>Initial Exploration</td>
            <td><code>TOP 100</code></td>
            <td>Testing queries, understanding data structure</td>
        </tr>
        <tr>
            <td>Sample Review</td>
            <td><code>TOP 500</code></td>
            <td>Reviewing data patterns, quality checks</td>
        </tr>
        <tr>
            <td>Larger Analysis</td>
            <td><code>TOP 1000</code></td>
            <td>Statistical sampling, trend analysis</td>
        </tr>
        <tr>
            <td>Comprehensive Sample</td>
            <td><code>TOP 5000</code></td>
            <td>Large samples (use with caution)</td>
        </tr>
        <tr>
            <td>Full Dataset</td>
            <td>No TOP</td>
            <td>ONLY for final production reports after testing</td>
        </tr>
    </table>

    <h3>üö® High-Volume Table Requirements</h3>
    <div class="critical">
        <p><strong>These tables REQUIRE date filters and TOP clauses:</strong></p>
        <pre><code>-- TagPerson (138M+ records) - EXTREME CAUTION
SELECT TOP 100 * FROM TagPerson tp
WHERE tp.DateCreated >= DATEADD(day, -30, GETDATE())

-- EmailResponses (3.9M+ records)
SELECT TOP 100 * FROM EmailResponses er
WHERE er.Dt >= DATEADD(week, -1, GETDATE())

-- ActivityLog (3.4M+ records)
SELECT TOP 100 * FROM ActivityLog al
WHERE al.ActivityDate >= DATEADD(day, -7, GETDATE())

-- EngagementScoreTag (1.4M+ records)
SELECT TOP 100 * FROM EngagementScoreTag est
JOIN EngagementScore es ON est.EngagementScoreId = es.Id
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())

-- EmailQueueTo (3.8M+ records)
SELECT TOP 100 * FROM EmailQueueTo eqt
JOIN EmailQueue eq ON eqt.Id = eq.Id
WHERE eq.Sent >= DATEADD(month, -1, GETDATE())</code></pre>
    </div>

    <h3>‚úÖ Safe Query Development Process</h3>
    <pre><code>-- STEP 1: Start with minimal data
SELECT TOP 10 * 
FROM YourTable
WHERE DateField >= DATEADD(day, -1, GETDATE())

-- STEP 2: Verify query logic with small sample
SELECT TOP 100 
    SpecificColumns,
    YouNeed
FROM YourTable
WHERE DateField >= DATEADD(week, -1, GETDATE())
  AND OtherFilters = 'Applied'

-- STEP 3: Expand sample if needed
SELECT TOP 1000 
    -- your final column list
FROM YourTable
WHERE -- all your filters
ORDER BY -- your sort

-- STEP 4: Remove TOP only for production reports
-- after confirming performance is acceptable</code></pre>
</div>

<div id="table-quick-reference" class="section">
    <h2>üìö Table Quick Reference Guide</h2>
    
    <div class="info">
        <p><strong>Database Structure:</strong> TouchPoint uses 3 schemas with 389+ tables total</p>
        <ul>
            <li><code>dbo</code> - Main application tables (322 tables)</li>
            <li><code>lookup</code> - Reference/lookup tables (66 tables)</li>
            <li><code>custom</code> - Church-specific customizations (1+ tables)</li>
        </ul>
    </div>

    <h3>üóÇÔ∏è Core Tables by Category</h3>
    <pre><code>-- PEOPLE & IDENTITY (Primary Keys and Relationships)
People              -- 50K+ records, PeopleId primary key
PeopleExtra         -- 213K+ records, custom fields for people
Families            -- Family units, FamilyId primary key
FamilyExtra         -- Custom fields for families
Users               -- 7K+ records, links PeopleId to system users

-- ORGANIZATIONAL HIERARCHY (3-Level Structure)
Program             -- 42 records, top level (e.g., "Adult Ministry")
Division            -- 217 records, second level, links to Program via ProgId
Organizations       -- 1.5K+ records, actual groups/classes, links to Division
DivOrg              -- Links Divisions to Organizations (if org has multiple divisions)
ProgDiv             -- Links Programs to Divisions
OrganizationMembers -- People's involvement in organizations
OrganizationExtra   -- Custom fields for organizations

-- ATTENDANCE & MEETINGS
Attend              -- 2.6M+ records, attendance records (CHECK AttendanceFlag!)
Meetings            -- 61K+ records, scheduled gatherings
MeetingExtra        -- Custom meeting fields

-- FINANCIAL
Contribution        -- 687K+ records, donations (EXCLUDE TypeId=99)
ContributionFund    -- Fund designations
Transaction         -- Financial transactions
TransactionPeople   -- Links transactions to people

-- COMMUNICATION
EmailQueue          -- 3.9M+ records, email campaigns
EmailQueueTo        -- Recipients for emails
EmailResponses      -- Email opens/clicks
SMSList             -- Text messages sent
SmsReceived         -- Incoming texts

-- TASKS & NOTES
TaskNote            -- 174K+ records, ministry tasks and notes
TaskList            -- Task categories
TaskStatus          -- Task workflow states

-- TAGS & SEGMENTATION
Tag                 -- Tag definitions
TagPerson           -- 138M+ records! ALWAYS use date filters
TagShare            -- Shared tag permissions

-- REGISTRATION & EVENTS
Registration        -- Event registrations
RegPeople           -- People registered for events
RegAnswer           -- Form responses
RegSetting          -- Registration configuration</code></pre>

    <h3>üîó Critical Table Relationships</h3>
    <pre><code>-- User Authentication Chain
Users.PeopleId ‚Üí People.PeopleId
Users.UserId ‚Üí UserRole.UserId ‚Üí Roles.RoleId

-- Organization Hierarchy
Program.Id ‚Üí Division.ProgId ‚Üí Organizations.DivisionId

-- Family Structure
People.FamilyId ‚Üí Families.FamilyId
Families.HeadOfHouseholdId ‚Üí People.PeopleId
Families.HeadOfHouseholdSpouseId ‚Üí People.PeopleId

-- Attendance Chain
People.PeopleId ‚Üí Attend.PeopleId
Attend.MeetingId ‚Üí Meetings.MeetingId
Meetings.OrganizationId ‚Üí Organizations.OrganizationId

-- Email System
EmailQueue.Id = EmailQueueTo.Id (direct match, not FK)
EmailQueueTo.PeopleId ‚Üí People.PeopleId
EmailResponses.EmailQueueId ‚Üí EmailQueue.Id

-- Tag System (Special!)
TagPerson.Id = Tag.Id (NOT TagPerson.TagId!)
TagPerson.PeopleId ‚Üí People.PeopleId</code></pre>
</div>

<div id="common-join-patterns" class="section">
    <h2>üîß Common JOIN Patterns</h2>
    
    <h3>Organization Hierarchy Join</h3>
    <pre><code>-- Complete hierarchy from Program to Organization
SELECT 
    p.Name as Program,
    d.Name as Division,
    o.OrganizationName,
    o.OrganizationId
FROM Organizations o
JOIN Division d ON o.DivisionId = d.Id
JOIN Program p ON d.ProgId = p.Id
WHERE o.OrganizationStatusId = 30  -- Active only</code></pre>

    <h3>User to Person Join</h3>
    <pre><code>-- Link system users to people records
SELECT 
    u.Username,
    p.Name,
    p.EmailAddress,
    r.RoleName
FROM Users u
JOIN People p ON u.PeopleId = p.PeopleId
LEFT JOIN UserRole ur ON u.UserId = ur.UserId
LEFT JOIN Roles r ON ur.RoleId = r.RoleId
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>

    <h3>Family Members Join</h3>
    <pre><code>-- Get all family members with relationships
-- Note: Families table does not have FamilyName column - use household names instead
SELECT 
    COALESCE(hoh.Name, '') + 
        CASE WHEN spouse.Name IS NOT NULL THEN ' & ' + spouse.Name ELSE '' END as HouseholdName,
    p.Name,
    fp.Description as FamilyPosition,
    CASE 
        WHEN p.PeopleId = f.HeadOfHouseholdId THEN 'Head'
        WHEN p.PeopleId = f.HeadOfHouseholdSpouseId THEN 'Spouse'
        ELSE 'Member'
    END as Role
FROM People p
JOIN Families f ON p.FamilyId = f.FamilyId
LEFT JOIN People hoh ON f.HeadOfHouseholdId = hoh.PeopleId
LEFT JOIN People spouse ON f.HeadOfHouseholdSpouseId = spouse.PeopleId
JOIN lookup.FamilyPosition fp ON p.PositionInFamilyId = fp.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY HouseholdName, p.PositionInFamilyId</code></pre>

    <h3>Attendance with Full Context</h3>
    <pre><code>-- Attendance with complete organizational context
SELECT 
    p.Name,
    prog.Name as Program,
    div.Name as Division,
    o.OrganizationName,
    m.MeetingDate,
    at.Description as AttendType
FROM Attend a
JOIN People p ON a.PeopleId = p.PeopleId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
JOIN Division div ON o.DivisionId = div.Id
JOIN Program prog ON div.ProgId = prog.Id
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
WHERE a.AttendanceFlag = 1  -- Present only
  AND m.DidNotMeet = 0      -- Meeting occurred
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>

    <h3>Custom Fields (Extra Values) Join</h3>
    <pre><code>-- Get people with their custom fields
SELECT 
    p.Name,
    pe.Field as CustomField,
    pe.Data as Value,
    pe.Type as DataType
FROM People p
LEFT JOIN PeopleExtra pe ON p.PeopleId = pe.PeopleId
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND pe.Field IN ('Status', 'LifeStage', 'MembershipDate')
ORDER BY p.Name, pe.Field</code></pre>
</div>

<div id="lookup-tables-reference" class="section">
    <h2>üìã Critical Lookup Tables Reference</h2>
    
    <h3>Most Important Lookup Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Purpose</th>
            <th>Key Values</th>
        </tr>
        <tr>
            <td><code>lookup.MemberStatus</code></td>
            <td>Church membership status</td>
            <td>10=Member, 20=Regular Attender, 30=Visitor, 40=Previous Member</td>
        </tr>
        <tr>
            <td><code>lookup.MemberType</code></td>
            <td>Organization role types</td>
            <td>140=Leader, 220=Member, 230=Prospect, 710=Volunteer</td>
        </tr>
        <tr>
            <td><code>lookup.AttendType</code></td>
            <td>Attendance classifications</td>
            <td>10=Leader, 20=Volunteer, 30=Member, 60=Guest, 70=New Guest</td>
        </tr>
        <tr>
            <td><code>lookup.OrganizationStatus</code></td>
            <td>Organization states</td>
            <td>30=Active, 40=Inactive, 50=Pending</td>
        </tr>
        <tr>
            <td><code>lookup.FamilyPosition</code></td>
            <td>Position in family</td>
            <td>10=Primary Adult (both spouses), 20=Secondary/Other Adult, 30=Child</td>
        </tr>
        <tr>
            <td><code>lookup.DecisionType</code></td>
            <td>Spiritual decisions</td>
            <td>10=Statement of Faith, 20=Baptism, 30=Membership, 40=Rededication</td>
        </tr>
        <tr>
            <td><code>lookup.Campus</code></td>
            <td>Multi-site locations</td>
            <td>Church-specific IDs</td>
        </tr>
        <tr>
            <td><code>lookup.Gender</code></td>
            <td>Gender codes</td>
            <td>1=Male, 2=Female, 9=Unknown</td>
        </tr>
        <tr>
            <td><code>lookup.MaritalStatus</code></td>
            <td>Marital status</td>
            <td>10=Married, 20=Single, 30=Divorced, 40=Widowed</td>
        </tr>
        <tr>
            <td><code>lookup.ContributionType</code></td>
            <td>Donation types</td>
            <td>1=Check, 5=Cash, 7=Credit Card, 99=Event Fee (exclude!)</td>
        </tr>
    </table>

    <h3>Complete Lookup Schema Tables</h3>
    <pre><code>-- Query all lookup tables
SELECT TABLE_NAME, 
       (SELECT COUNT(*) FROM [lookup].[' + TABLE_NAME + ']) as RecordCount
FROM INFORMATION_SCHEMA.TABLES 
WHERE TABLE_SCHEMA = 'lookup'
ORDER BY TABLE_NAME

-- Common lookup tables include:
lookup.AccountCode          -- Financial account codes
lookup.AddressType          -- Home, Work, Other
lookup.AttendCredit         -- Attendance credit types
lookup.BaptismStatus        -- Baptism tracking
lookup.BaptismType          -- Baptism methods
lookup.Campus               -- Multi-site campuses
lookup.ContactPreference    -- Preferred contact method
lookup.ContactReason        -- Contact reason codes
lookup.ContributionStatus   -- Donation status
lookup.Country              -- Country codes
lookup.DecisionType         -- Spiritual decisions
lookup.EntryPoint           -- How people found church
lookup.EnvelopeOption       -- Giving envelope options
lookup.FamilyRelationship   -- Family relationships
lookup.Gender               -- Gender codes
lookup.InterestPoint        -- Ministry interests
lookup.JoinType             -- How people joined
lookup.MaritalStatus        -- Marital status codes
lookup.MemberStatus         -- Membership status
lookup.MemberType           -- Organization member types
lookup.Ministry             -- Ministry areas
lookup.OrganizationStatus   -- Org active/inactive
lookup.OrganizationType     -- Types of organizations
lookup.Origin               -- Person origin tracking
lookup.PositionInFamily     -- Family position
lookup.ResidentCode         -- Resident/non-resident
lookup.SecurityLabel        -- Check-in security labels
lookup.State                -- State/province codes
lookup.VolunteerCode        -- Volunteer classifications</code></pre>
</div>

<div id="common-queries" class="section">
    <h2>üéØ Most Common Queries (Quick Reference)</h2>
    
    <h3>üë• Active Church Members</h3>
    <pre><code>SELECT TOP 1000 
    p.PeopleId,
    p.Name,
    p.EmailAddress,
    p.CellPhone,
    ms.Description as MemberStatus,
    DATEDIFF(year, p.BDate, GETDATE()) as Age,
    c.Description as Campus
FROM People p
JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
  AND p.MemberStatusId = 10  -- Members only
ORDER BY p.Name</code></pre>

    <h3>üìÖ Recent Attendance</h3>
    <pre><code>SELECT TOP 500
    p.Name,
    o.OrganizationName,
    m.MeetingDate,
    at.Description as AttendanceType
FROM Attend a
JOIN People p ON a.PeopleId = p.PeopleId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
WHERE a.AttendanceFlag = 1  -- Critical: actual attendance
  AND m.MeetingDate >= DATEADD(week, -1, GETDATE())
  AND m.DidNotMeet = 0
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY m.MeetingDate DESC, o.OrganizationName, p.Name</code></pre>

    <h3>üí∞ Recent Giving</h3>
    <pre><code>SELECT TOP 500
    p.Name,
    c.ContributionDate,
    c.ContributionAmount,
    cf.FundName,
    c.CheckNo
FROM Contribution c
JOIN People p ON c.PeopleId = p.PeopleId
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- Exclude event fees
  AND c.ContributionDate >= DATEADD(month, -1, GETDATE())
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY c.ContributionDate DESC, c.ContributionAmount DESC</code></pre>

    <h3>üí° Using Temporary Tables for Complex Analysis</h3>
    <pre><code>-- Example: Using temp tables to stage data for complex reporting
-- Temp tables are allowed in TouchPoint SQL and are very useful!

-- Create a temp table with attendance summary
SELECT 
    p.PeopleId,
    p.Name,
    COUNT(DISTINCT a.MeetingDate) as AttendanceCount,
    MAX(a.MeetingDate) as LastAttended
INTO #AttendanceSummary
FROM People p
JOIN Attend a ON p.PeopleId = a.PeopleId
WHERE a.MeetingDate >= DATEADD(month, -6, GETDATE())
GROUP BY p.PeopleId, p.Name

-- Create another temp table with giving summary
SELECT 
    p.PeopleId,
    SUM(c.ContributionAmount) as TotalGiving,
    COUNT(c.ContributionId) as GiftCount
INTO #GivingSummary
FROM People p
JOIN Contribution c ON p.PeopleId = c.PeopleId
WHERE c.ContributionDate >= DATEADD(month, -6, GETDATE())
  AND c.ContributionTypeId NOT IN (8, 99)
GROUP BY p.PeopleId

-- Now join the temp tables for final analysis
SELECT 
    a.Name,
    a.AttendanceCount,
    a.LastAttended,
    ISNULL(g.TotalGiving, 0) as TotalGiving,
    ISNULL(g.GiftCount, 0) as GiftCount,
    CASE 
        WHEN a.AttendanceCount > 10 AND g.TotalGiving > 500 THEN 'Highly Engaged'
        WHEN a.AttendanceCount > 5 OR g.TotalGiving > 100 THEN 'Engaged'
        ELSE 'New/Occasional'
    END as EngagementLevel
FROM #AttendanceSummary a
LEFT JOIN #GivingSummary g ON a.PeopleId = g.PeopleId
ORDER BY a.AttendanceCount DESC, g.TotalGiving DESC

-- Temp tables are automatically cleaned up when your session ends
-- Or you can manually drop them:
-- DROP TABLE #AttendanceSummary
-- DROP TABLE #GivingSummary</code></pre>

    <h3>üÜï First-Time Visitors</h3>
    <pre><code>-- Recent first-time visitors for follow-up
-- Note: AttendType values vary by church. Common values: 60=New Guest, 50=Recent Guest
-- Always check your lookup.AttendType table for actual values
WITH FirstVisit AS (
    SELECT 
        p.PeopleId,
        MIN(a.MeetingDate) as FirstVisitDate
    FROM Attend a
    JOIN People p ON a.PeopleId = p.PeopleId
    WHERE a.AttendanceFlag = 1
      AND a.AttendanceTypeId IN (50, 60)  -- Recent Guest, New Guest (verify your IDs)
    GROUP BY p.PeopleId
)
SELECT TOP 100
    p.Name,
    p.EmailAddress,
    p.CellPhone,
    fv.FirstVisitDate,
    DATEDIFF(day, fv.FirstVisitDate, GETDATE()) as DaysSinceVisit
FROM FirstVisit fv
JOIN People p ON fv.PeopleId = p.PeopleId
WHERE fv.FirstVisitDate >= DATEADD(week, -2, GETDATE())
  AND p.DoNotCallFlag = 0
  AND p.DoNotVisitFlag = 0
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
ORDER BY fv.FirstVisitDate DESC</code></pre>

    <h3>üìä Organization Summary</h3>
    <pre><code>SELECT TOP 100
    o.OrganizationName,
    o.Location,
    leader.Name as Leader,
    o.MemberCount,
    o.Limit as Capacity,
    CASE 
        WHEN o.Limit > 0 THEN 
            CAST(o.MemberCount as float) / o.Limit * 100 
        ELSE 0 
    END as PercentFull,
    o.FirstMeetingDate,
    o.LastMeetingDate
FROM Organizations o
LEFT JOIN People leader ON o.LeaderId = leader.PeopleId
WHERE o.OrganizationStatusId = 30  -- Active
ORDER BY o.MemberCount DESC</code></pre>
</div>

<div id="people-table" class="section">
    <h2>üë• People Table - Complete Reference</h2>
    
    <p><strong>Purpose:</strong> Central repository for all person and family data<br>
    <strong>Primary Key:</strong> <code>PeopleId</code><br>
    <strong>Scale:</strong> 136 columns with 23 foreign key relationships<br>
    <strong>Critical Rule:</strong> Always filter <code>WHERE IsDeceased = 0 AND ArchivedFlag = 0</code></p>

    <h3>Core Identity Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>PeopleExtra</code></td>
            <td>Mixed</td>
            <td>Person-specific custom fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueBit</code></td>
            <td>Boolean</td>
            <td>Yes/No fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueDate</code></td>
            <td>DateTime</td>
            <td>Date fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueInt</code></td>
            <td>Integer</td>
            <td>Number fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueText</code></td>
            <td>Text</td>
            <td>Text fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueCode</code></td>
            <td>Code</td>
            <td>Dropdown/lookup fields</td>
        </tr>
        <tr>
            <td><code>OrgExtra</code></td>
            <td>Mixed</td>
            <td>Organization custom fields</td>
        </tr>
        <tr>
            <td><code>MeetingExtra</code></td>
            <td>Mixed</td>
            <td>Meeting custom fields</td>
        </tr>
        <tr>
            <td><code>ContributionExtra</code></td>
            <td>Mixed</td>
            <td>Contribution custom fields</td>
        </tr>
    </table>

    <h3>Discovering Custom Fields</h3>
    <pre><code>-- Find what custom fields your church uses
SELECT TOP 500
    'PeopleExtra' as TableType,
    Field,
    COUNT(*) as RecordCount,
    COUNT(DISTINCT PeopleId) as PeopleWithValue
FROM PeopleExtra
GROUP BY Field
ORDER BY COUNT(*) DESC

-- Example: Using a custom field
SELECT 
    p.Name,
    pev.Field,
    pev.Data as Value
FROM People p
JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE pev.Field = 'MembershipCovenant'  -- Church-specific field
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name</code></pre>

    <h3>Custom Field Analysis</h3>
    <pre><code>-- Analyze custom field usage patterns
WITH CustomFieldStats AS (
    SELECT 
        Field,
        COUNT(*) as Uses,
        COUNT(DISTINCT PeopleId) as UniquePeople,
        MIN(CAST(DateValue as datetime)) as EarliestDate,
        MAX(CAST(DateValue as datetime)) as LatestDate
    FROM PeopleExtra
    WHERE DateValue IS NOT NULL  -- Only date-type fields
    GROUP BY Field
)
SELECT 
    Field,
    Uses,
    UniquePeople,
    EarliestDate,
    LatestDate,
    DATEDIFF(day, EarliestDate, LatestDate) as DateRange
FROM CustomFieldStats
ORDER BY Uses DESC</code></pre>
</div>

<div id="lookup-tables" class="section">
    <h2>üìö Lookup Tables Reference</h2>
    
    <p>TouchPoint includes 67+ lookup tables that provide business logic, validation rules, and categorization throughout the system.</p>

    <h3>Critical Lookup Tables</h3>
    
    <div class="info">
        <p><strong>‚ö†Ô∏è Important Note:</strong> Common lookup values shown below may not match your church's configuration. Always verify the actual values in your database by querying the lookup tables directly. Each church customizes these values for their specific needs.</p>
    </div>
    
    <h4>lookup.MemberStatus <span class="badge badge-critical">Most Important</span></h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Member</td>
            <td>Full church members - voting, leadership eligible</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Prospect</td>
            <td>Potential members - follow-up focus</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Not Member</td>
            <td>Regular attenders, not members</td>
        </tr>
        <tr>
            <td>40</td>
            <td>Previous Member</td>
            <td>Former members - different communication</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Just Added</td>
            <td>New records - need data cleanup</td>
        </tr>
    </table>

    <h4>lookup.AttendType <span class="badge badge-critical">Important - Values Vary by Church</span></h4>
    
    <div class="info">
        <p><strong>‚ö†Ô∏è Important:</strong> AttendType values are customized per church. Always verify your actual values with <code>SELECT * FROM lookup.AttendType</code></p>
    </div>
    
    <table>
        <tr>
            <th>Common Id</th>
            <th>Typical Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Leader</td>
            <td>Leadership roles</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Volunteer</td>
            <td>Volunteer workers</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Member</td>
            <td>Regular members</td>
        </tr>
        <tr>
            <td>40</td>
            <td>Visiting Member</td>
            <td>Members from other churches</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Recent Guest</td>
            <td>Return visitors</td>
        </tr>
        <tr>
            <td>60</td>
            <td>New Guest</td>
        </tr>
    </table>

    <h4>lookup.FamilyPosition</h4>
    <table>
        <tr>
            <th>Id</th>
            <th>Description</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Primary Adult</td>
            <td>Both spouses/parents in nuclear family (distinguished by HeadOfHouseholdId and HeadOfHouseholdSpouseId in Families table)</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Secondary Adult (or Other Adult)</td>
            <td>Adults outside nuclear family structure (e.g., grandparent living with family, adult sibling)</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Child</td>
            <td>Dependent children of the Primary Adults</td>
        </tr>
    </table>

    <h4>lookup.ContributionType <span class="badge badge-critical">Important for Reporting</span></h4>
    <table>
        <tr>
            <th>Common Ids</th>
            <th>Typical Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td>1</td>
            <td>Tax Deductible</td>
            <td>Standard charitable contribution</td>
        </tr>
        <tr>
            <td>6</td>
            <td>Returned Check</td>
            <td>EXCLUDE from reports - failed payment</td>
        </tr>
        <tr>
            <td>7</td>
            <td>Reversed</td>
            <td>EXCLUDE from reports - reversed transaction</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Pledge</td>
            <td>EXCLUDE from contribution reports - commitment only</td>
        </tr>
        <tr>
            <td>99</td>
            <td>Event Registration Fee</td>
            <td>EXCLUDE from giving reports - not a donation</td>
        </tr>
    </table>
    <p class="info"><strong>Note:</strong> Your church may have different contribution types. Query <code>SELECT * FROM lookup.ContributionType</code> to see your specific values. Types like Cash, Check, Credit Card are typically NOT in this table but may be tracked elsewhere.</p>

    <h4>Other Important Lookup Tables</h4>
    <pre><code>-- Common lookup tables and their purposes
SELECT 'Gender' as LookupTable, Id, Description FROM lookup.Gender
UNION ALL
SELECT 'MaritalStatus', Id, Description FROM lookup.MaritalStatus
UNION ALL
SELECT 'Campus', Id, Description FROM lookup.Campus
UNION ALL
SELECT 'OrganizationStatus', Id, Description FROM lookup.OrganizationStatus
UNION ALL
SELECT 'ContributionType', Id, Description FROM lookup.ContributionType
UNION ALL
SELECT 'BaptismStatus', Id, Description FROM lookup.BaptismStatus
UNION ALL
SELECT 'DecisionType', Id, Description FROM lookup.DecisionType
UNION ALL
SELECT 'DropType', Id, Description FROM lookup.DropType
ORDER BY LookupTable, Id</code></pre>
</div>

<div id="common-reports" class="section">
    <h2>üìà Common Report Patterns</h2>
    
    <h3>Church Dashboard Metrics</h3>
    <pre><code>-- Executive Dashboard Query
WITH Metrics AS (
    SELECT 
        -- People Metrics
        (SELECT COUNT(*) FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0 AND MemberStatusId = 10) as ActiveMembers,
        (SELECT COUNT(*) FROM People WHERE IsDeceased = 0 AND ArchivedFlag = 0 AND MemberStatusId = 20) as Prospects,
        
        -- Attendance Metrics (Last Week)
        (SELECT COUNT(DISTINCT a.PeopleId) 
         FROM Attend a 
         WHERE a.AttendanceFlag = 1 
           AND a.MeetingDate >= DATEADD(week, -1, GETDATE())) as WeeklyAttendance,
        
        -- Attendance Metrics (Last Month)
        (SELECT COUNT(DISTINCT a.PeopleId) 
         FROM Attend a 
         WHERE a.AttendanceFlag = 1 
           AND a.MeetingDate >= DATEADD(month, -1, GETDATE())) as MonthlyAttendance,
        
        -- Financial Metrics
        (SELECT SUM(ContributionAmount) 
         FROM Contribution 
         WHERE ContributionTypeId != 99 
           AND ContributionDate >= DATEADD(month, -1, GETDATE())) as MonthlyGiving,
        
        (SELECT COUNT(DISTINCT PeopleId) 
         FROM Contribution 
         WHERE ContributionTypeId != 99 
           AND ContributionDate >= DATEADD(month, -1, GETDATE())) as MonthlyGivers,
        
        -- Organization Metrics
        (SELECT COUNT(*) FROM Organizations WHERE OrganizationStatusId = 30) as ActiveOrganizations,
        
        -- New People
        (SELECT COUNT(*) 
         FROM People 
         WHERE CreatedDate >= DATEADD(month, -1, GETDATE()) 
           AND IsDeceased = 0 AND ArchivedFlag = 0) as NewPeopleThisMonth
)
SELECT * FROM Metrics</code></pre>

    <h3>Attendance Trends Report</h3>
    <pre><code>-- Weekly attendance trends over 12 weeks
WITH WeeklyAttendance AS (
    SELECT 
        DATEPART(year, a.MeetingDate) as Year,
        DATEPART(week, a.MeetingDate) as Week,
        MIN(CAST(a.MeetingDate as DATE)) as WeekStart,
        COUNT(DISTINCT a.PeopleId) as UniqueAttenders,
        COUNT(*) as TotalAttendances,
        COUNT(DISTINCT a.OrganizationId) as OrgsWithMeetings,
        COUNT(DISTINCT CASE WHEN at.Guest = 1 THEN a.PeopleId END) as Guests,
        COUNT(DISTINCT CASE WHEN at.Worker = 1 THEN a.PeopleId END) as Workers
    FROM Attend a
    JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
    WHERE a.AttendanceFlag = 1
      AND a.MeetingDate >= DATEADD(week, -12, GETDATE())
    GROUP BY DATEPART(year, a.MeetingDate), DATEPART(week, a.MeetingDate)
)
SELECT 
    WeekStart,
    UniqueAttenders,
    Guests,
    Workers,
    UniqueAttenders - Guests - Workers as Members,
    TotalAttendances,
    OrgsWithMeetings,
    CAST(TotalAttendances as float) / NULLIF(UniqueAttenders, 0) as AvgAttendancesPerPerson
FROM WeeklyAttendance
ORDER BY WeekStart DESC</code></pre>

    <h3>Giving Analysis Report</h3>
    <pre><code>-- Comprehensive giving analysis
WITH GivingStats AS (
    SELECT 
        p.PeopleId,
        p.Name,
        COUNT(*) as GiftCount,
        SUM(c.ContributionAmount) as TotalGiven,
        MIN(c.ContributionDate) as FirstGift,
        MAX(c.ContributionDate) as LastGift,
        DATEDIFF(day, MAX(c.ContributionDate), GETDATE()) as DaysSinceLastGift
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
    GROUP BY p.PeopleId, p.Name
)
SELECT 
    CASE 
        WHEN TotalGiven >= 10000 THEN 'Major Donor ($10K+)'
        WHEN TotalGiven >= 5000 THEN 'Significant Donor ($5K-$10K)'
        WHEN TotalGiven >= 1000 THEN 'Regular Donor ($1K-$5K)'
        WHEN TotalGiven >= 100 THEN 'Small Donor ($100-$1K)'
        ELSE 'Micro Donor (<$100)'
    END as DonorLevel,
    COUNT(*) as DonorCount,
    SUM(TotalGiven) as TotalFromLevel,
    AVG(TotalGiven) as AvgGiftPerDonor,
    AVG(GiftCount) as AvgGiftsPerDonor
FROM GivingStats
GROUP BY 
    CASE 
        WHEN TotalGiven >= 10000 THEN 'Major Donor ($10K+)'
        WHEN TotalGiven >= 5000 THEN 'Significant Donor ($5K-$10K)'
        WHEN TotalGiven >= 1000 THEN 'Regular Donor ($1K-$5K)'
        WHEN TotalGiven >= 100 THEN 'Small Donor ($100-$1K)'
        ELSE 'Micro Donor (<$100)'
    END
ORDER BY MIN(TotalGiven) DESC</code></pre>

    <h3>Group Health Report</h3>
    <pre><code>-- Organization/group health metrics
SELECT TOP 500
    o.OrganizationName,
    o.Location,
    leader.Name as Leader,
    o.MemberCount,
    o.Limit as Capacity,
    
    -- Capacity Metrics
    CASE 
        WHEN o.Limit > 0 THEN CAST(o.MemberCount as float) / o.Limit * 100 
        ELSE NULL 
    END as PercentFull,
    
    -- Meeting Metrics
    (SELECT COUNT(*) 
     FROM Meetings m 
     WHERE m.OrganizationId = o.OrganizationId 
       AND m.MeetingDate >= DATEADD(month, -3, GETDATE())
       AND m.DidNotMeet = 0) as MeetingsLast3Months,
    
    -- Attendance Metrics
    (SELECT AVG(CAST(NumPresent as float))
     FROM Meetings m 
     WHERE m.OrganizationId = o.OrganizationId 
       AND m.MeetingDate >= DATEADD(month, -3, GETDATE())
       AND m.DidNotMeet = 0) as AvgAttendance,
    
    -- Engagement
    (SELECT AVG(om.AttendPct)
     FROM OrganizationMembers om
     WHERE om.OrganizationId = o.OrganizationId
       AND om.InactiveDate IS NULL) as AvgMemberEngagement,
    
    -- Growth
    (SELECT COUNT(*)
     FROM OrganizationMembers om
     WHERE om.OrganizationId = o.OrganizationId
       AND om.EnrollmentDate >= DATEADD(month, -3, GETDATE())) as NewMembersLast3Months
    
FROM Organizations o
LEFT JOIN People leader ON o.LeaderId = leader.PeopleId
WHERE o.OrganizationStatusId = 30
ORDER BY o.MemberCount DESC</code></pre>
</div>

<div id="common-issues" class="section">
    <h2>üîß Common Issues & Solutions</h2>
    
    <h3>Issue: Query Times Out</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Query runs forever or times out</p>
        <p><strong>Solutions:</strong></p>
        <ol>
            <li>Add <code>TOP 100</code> to limit results</li>
            <li>Add date filters: <code>WHERE DateField >= DATEADD(month, -1, GETDATE())</code></li>
            <li>Check for missing filters on large tables (TagPerson, EmailResponses, etc.)</li>
            <li>Verify indexes exist on join columns</li>
        </ol>
    </div>

    <h3>Issue: Attendance Numbers Don't Match UI</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Attendance counts differ from TouchPoint interface</p>
        <p><strong>Solution:</strong> Verify these filters are applied:</p>
        <pre><code>WHERE a.AttendanceFlag = 1  -- Only count actual attendance
  AND m.DidNotMeet = 0      -- Exclude cancelled meetings
  AND p.IsDeceased = 0      -- Exclude deceased
  AND p.ArchivedFlag = 0    -- Exclude archived</code></pre>
    </div>

    <h3>Issue: Giving Reports Include Event Fees</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Donation totals are inflated</p>
        <p><strong>Solution:</strong> Always exclude event registration fees:</p>
        <pre><code>WHERE c.ContributionTypeId != 99  -- Exclude event fees</code></pre>
    </div>

    <h3>Issue: Deceased People Appearing</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Reports include deceased individuals</p>
        <p><strong>Solution:</strong> Always include both filters:</p>
        <pre><code>WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0</code></pre>
    </div>

    <h3>Issue: Organizations Show as Inactive</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Active organizations not appearing</p>
        <p><strong>Solution:</strong> Use correct status value:</p>
        <pre><code>WHERE o.OrganizationStatusId = 30  -- NOT 1!</code></pre>
    </div>

    <h3>Issue: Can't Find Custom Fields</h3>
    <div class="warning">
        <p><strong>Problem:</strong> Church-specific fields not found</p>
        <p><strong>Solution:</strong> Query Extra Value tables:</p>
        <pre><code>-- Discover available custom fields
SELECT DISTINCT Field, COUNT(*) as Uses
FROM PeopleExtra
GROUP BY Field
ORDER BY COUNT(*) DESC</code></pre>
    </div>
</div>

<div id="best-practices" class="section">
    <h2>‚úÖ Best Practices & Tips</h2>
    
    <h3>üéØ Query Development Process</h3>
    <ol>
        <li><strong>Start Small:</strong> Use <code>TOP 10</code> to test logic</li>
        <li><strong>Add Filters Early:</strong> Apply mandatory filters immediately</li>
        <li><strong>Test Incrementally:</strong> Build complex queries step by step</li>
        <li><strong>Check Performance:</strong> Monitor execution time</li>
        <li><strong>Document Assumptions:</strong> Comment your business logic</li>
    </ol>

    <h3>üìã Mandatory Filter Checklist</h3>
    <pre><code>-- Copy this template for every query
WHERE 1=1
  -- People filters
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
  
  -- Attendance filters
  AND a.AttendanceFlag = 1
  AND m.DidNotMeet = 0
  
  -- Organization filters
  AND o.OrganizationStatusId = 30
  AND om.InactiveDate IS NULL
  
  -- Contribution filters
  AND c.ContributionTypeId != 99
  
  -- Performance filters
  AND DateField >= DATEADD(month, -3, GETDATE())</code></pre>

    <h3>üöÄ Performance Optimization</h3>
    <table>
        <tr>
            <th>Technique</th>
            <th>When to Use</th>
            <th>Example</th>
        </tr>
        <tr>
            <td>Use TOP</td>
            <td>Exploration & testing</td>
            <td><code>SELECT TOP 100</code></td>
        </tr>
        <tr>
            <td>Date filters</td>
            <td>Always on large tables</td>
            <td><code>WHERE Date >= DATEADD(month, -1, GETDATE())</code></td>
        </tr>
        <tr>
            <td>Specific IDs</td>
            <td>When possible</td>
            <td><code>WHERE PeopleId IN (1,2,3)</code></td>
        </tr>
        <tr>
            <td>EXISTS vs JOIN</td>
            <td>Checking existence</td>
            <td><code>WHERE EXISTS (SELECT 1...)</code></td>
        </tr>
        <tr>
            <td>Column list</td>
            <td>Always specify</td>
            <td>Avoid <code>SELECT *</code></td>
        </tr>
    </table>

    <h3>üìù Documentation Standards</h3>
    <pre><code>-- Query: Monthly Giving Summary
-- Purpose: Summarize giving by fund for board report
-- Author: [Your Name]
-- Date: [Current Date]
-- Performance: ~2 seconds on production
-- Dependencies: Contribution, ContributionFund, People tables
-- Business Rules:
--   - Excludes event fees (TypeId != 99)
--   - Only includes completed transactions
--   - Groups by calendar month

SELECT TOP 500
    /* Month grouping */
    YEAR(c.ContributionDate) as GiftYear,
    MONTH(c.ContributionDate) as GiftMonth,
    
    /* Fund analysis */
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as UniqueGivers,
    SUM(c.ContributionAmount) as TotalAmount
    
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99  -- Exclude event fees
  AND c.ContributionDate >= '2024-01-01'
GROUP BY 
    YEAR(c.ContributionDate),
    MONTH(c.ContributionDate),
    cf.FundId,
    cf.FundName
ORDER BY 
    GiftYear DESC,
    GiftMonth DESC,
    TotalAmount DESC</code></pre>
</div>

<div id="relationship-diagram" class="section">
    <h2>üîó Essential Table Relationships</h2>
    
    <h3>Core Relationships</h3>
    <pre><code>People (PeopleId) ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ                                        ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí Families (FamilyId)                 ‚îÇ
    ‚îÇ    Groups family members               ‚îÇ
    ‚îÇ                                        ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí People (SpouseId)                   ‚îÇ
    ‚îÇ    Direct spouse link                  ‚îÇ
    ‚îÇ                                        ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí OrganizationMembers ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ    ‚îÇ                                   ‚îÇ
    ‚îÇ    ‚îî‚îÄ‚îÄ‚Üí Organizations (OrganizationId) ‚îÇ
    ‚îÇ         ‚îÇ                              ‚îÇ
    ‚îÇ         ‚îú‚îÄ‚îÄ‚Üí Meetings (MeetingId) ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚î§
    ‚îÇ         ‚îÇ                              ‚îÇ
    ‚îÇ         ‚îî‚îÄ‚îÄ‚Üí Attend ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ              (PeopleId + MeetingId + OrganizationId)
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí Contribution (ContributionId)
    ‚îÇ    ‚îÇ
    ‚îÇ    ‚îî‚îÄ‚îÄ‚Üí ContributionFund (FundId)
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí Registration (RegistrationId)
    ‚îÇ    ‚îÇ
    ‚îÇ    ‚îî‚îÄ‚îÄ‚Üí RegPeople (RegPeopleId)
    ‚îÇ         ‚îÇ
    ‚îÇ         ‚îî‚îÄ‚îÄ‚Üí RegAnswer (RegAnswerId)
    ‚îÇ              ‚îÇ
    ‚îÇ              ‚îî‚îÄ‚îÄ‚Üí RegQuestion (RegQuestionId)
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí TaskNote (TaskNoteId)
    ‚îÇ    About person tasks/notes
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚Üí EmailQueueTo (EmailQueueToId)
    ‚îÇ    ‚îÇ
    ‚îÇ    ‚îî‚îÄ‚îÄ‚Üí EmailResponses (Event tracking)
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚Üí TagPerson (138M+ records!)
         ‚îÇ
         ‚îî‚îÄ‚îÄ‚Üí Tag (TagId)</code></pre>

    <h3>Lookup Relationships</h3>
    <pre><code>People Table Lookups:
    ‚îú‚îÄ‚îÄ‚Üí lookup.MemberStatus (MemberStatusId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.Gender (GenderId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.MaritalStatus (MaritalStatusId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.FamilyPosition (PositionInFamilyId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.Campus (CampusId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.EntryPoint (EntryPointId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.BaptismStatus (BaptismStatusId)
    ‚îî‚îÄ‚îÄ‚Üí lookup.DropType (DropCodeId)

Organization Table Lookups:
    ‚îú‚îÄ‚îÄ‚Üí lookup.OrganizationStatus (OrganizationStatusId = 30 for Active)
    ‚îú‚îÄ‚îÄ‚Üí lookup.OrganizationType (OrganizationTypeId)
    ‚îú‚îÄ‚îÄ‚Üí lookup.Campus (CampusId)
    ‚îî‚îÄ‚îÄ‚Üí Division ‚Üí Program (Hierarchy)

Attendance Lookups:
    ‚îú‚îÄ‚îÄ‚Üí lookup.AttendType (AttendanceTypeId)
    ‚îî‚îÄ‚îÄ‚Üí lookup.MemberType (MemberTypeId)
         ‚îî‚îÄ‚îÄ‚Üí lookup.AttendType (AttendanceTypeId)</code></pre>
</div>

<div class="section" id="database-views">
    <h2>üîç Database Views Documentation</h2>

    <p>TouchPoint uses SQL Server views to provide simplified access to complex data relationships. Views are virtual tables that combine data from multiple tables through joins and can include calculated fields.</p>

    <div class="info">
        <h3>üìä Understanding Database Views</h3>
        <p>Views in TouchPoint are virtual tables that:</p>
        <ul>
            <li><strong>Combine multiple tables</strong> - Pre-join commonly used table relationships</li>
            <li><strong>Calculate derived fields</strong> - Compute totals, percentages, and aggregations</li>
            <li><strong>Simplify complex queries</strong> - Encapsulate business logic in reusable structures</li>
            <li><strong>Improve performance</strong> - Some views materialize data for faster access</li>
        </ul>
        <p><strong>Important:</strong> Views are different from lookup tables. Views compute data dynamically, while lookup tables store reference data.</p>
    </div>

    <h3>View Discovery Queries</h3>
    <pre><code class="sql">-- Discover all available views in your TouchPoint database
SELECT
    v.TABLE_SCHEMA,
    v.TABLE_NAME,
    'VIEW' as OBJECT_TYPE,
    COUNT(c.COLUMN_NAME) as COLUMN_COUNT
FROM INFORMATION_SCHEMA.VIEWS v
LEFT JOIN INFORMATION_SCHEMA.COLUMNS c
    ON v.TABLE_SCHEMA = c.TABLE_SCHEMA
    AND v.TABLE_NAME = c.TABLE_NAME
WHERE v.TABLE_SCHEMA NOT IN ('sys', 'INFORMATION_SCHEMA')
GROUP BY v.TABLE_SCHEMA, v.TABLE_NAME
ORDER BY v.TABLE_NAME;

-- Get detailed column information for a specific view
SELECT
    c.COLUMN_NAME,
    c.DATA_TYPE,
    c.CHARACTER_MAXIMUM_LENGTH,
    c.IS_NULLABLE,
    c.ORDINAL_POSITION
FROM INFORMATION_SCHEMA.COLUMNS c
WHERE c.TABLE_SCHEMA = 'lookup'  -- Change schema name
    AND c.TABLE_NAME = 'MemberStatus'  -- Change view name
ORDER BY c.ORDINAL_POSITION;</code></pre>

    <h3>All TouchPoint Database Views</h3>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Schema</th>
                    <th>View Name</th>
                    <th>Purpose</th>
                    <th>Key Columns</th>
                    <th>Common Usage</th>
                </tr>
            </thead>
            <tbody>
                <tr class="category-row">
                    <td colspan="5"><strong>üè¢ Core Reporting Views</strong> - Heavily used for organization and financial reporting</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>OrganizationStructure</td>
                    <td>Flattened org hierarchy with counts</td>
                    <td>ProgId, Program, DivId, Division, OrgId, Organization, OrgStatus, Members, Previous, Vistors (typo in view), Meetings</td>
                    <td>Organization hierarchy reporting, member counts, meeting statistics</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>TransactionSummary</td>
                    <td>Financial summary and balances</td>
                    <td>RegId, PeopleId, OrganizationId, TranDate, TotDue, TotPaid, IndDue, IndAmt, TotalAmt, IsLatestTransaction</td>
                    <td>Payment tracking, balance reports, registration financials</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>CheckInActivities</td>
                    <td>Denormalized check-in data with names</td>
                    <td>PeopleId, Name, CheckInTime, Activities, Location, AccessType, OrganizationId, ActivityTime</td>
                    <td>Check-in reporting, attendance analysis</td>
                </tr>
                <tr class="category-row">
                    <td colspan="5"><strong>üí∞ Financial Views</strong> - Mission trips and financial calculations</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>MissionTripTotals</td>
                    <td>Mission trip financial summary</td>
                    <td>InvolvementId, Trip, PeopleId, Name, SortOrder, TripCost, Raised, Due</td>
                    <td>Mission trip funding reports, amount raised vs due</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>TransactionBalances</td>
                    <td>Outstanding balance calculations</td>
                    <td>Various balance fields</td>
                    <td>Track outstanding balances for events and registrations</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>RegistrationTransactionSummary</td>
                    <td>Registration financial details</td>
                    <td>Registration and transaction summary fields</td>
                    <td>Complete registration financial information</td>
                </tr>
                <tr class="category-row">
                    <td colspan="5"><strong>üìä Analytics & Reporting Views</strong> - Data aggregations and reports</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>VolunteerTimes</td>
                    <td>Volunteer time tracking</td>
                    <td>Volunteer schedule and time tracking fields</td>
                    <td>Track volunteer hours and schedules</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>FirstAttends</td>
                    <td>First attendance dates by organization</td>
                    <td>PeopleId, Name2, OrganizationId, OrganizationName, FirstAttend</td>
                    <td>Track when people first attended each org</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>LastAttends</td>
                    <td>Last attendance with contact info</td>
                    <td>PeopleId, Name2, OrganizationId, OrganizationName, LastAttend, HomePhone, CellPhone, EmailAddress</td>
                    <td>Track most recent attendance with contact details</td>
                </tr>
                <tr>
                    <td>dbo</td>
                    <td>PreviousMemberCounts</td>
                    <td>Previous organization member counts</td>
                    <td>OrganizationId, prevcount</td>
                    <td>Compare previous membership counts</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="info">
        <h3>üìä Additional Views Available</h3>
        <p>The TouchPoint database contains 84+ views in the dbo schema. Notable additional views include:</p>
        <ul>
            <li><strong>MissionTripTotals</strong> - Mission trip financial summaries</li>
            <li><strong>RegistrationTransactionSummary</strong> - Registration financial details</li>
            <li><strong>ContributionsBasic</strong> - Simplified contribution data</li>
            <li><strong>MemberData</strong> - Comprehensive member information</li>
            <li><strong>OrganizationLeaders</strong> - Organization leadership details</li>
            <li><strong>TransactionBalances</strong> - Outstanding balance calculations</li>
            <li><strong>RecurringGivingDueForToday</strong> - Scheduled giving due today</li>
            <li><strong>StatusFlagList</strong> - All status flags with details</li>
            <li><strong>FirstAttends</strong> / <strong>LastAttends</strong> - First and last attendance dates</li>
            <li><strong>PreviousMemberCounts</strong> - Historical member counts</li>
        </ul>
        <p>Use the discovery query above to explore all available views in your database.</p>
    </div>

    <h3>Using Views in Queries</h3>

    <div class="highlight">
        <h4>Core Reporting Views - OrganizationStructure</h4>
        <pre><code class="sql">-- Use OrganizationStructure for hierarchy and member counts
-- NOTE: Column is misspelled as 'Vistors' in the view (missing 'i')
SELECT
    Program,
    Division,
    Organization,
    OrgStatus,
    Members,
    Previous,
    Vistors,  -- Note: typo in actual view column name
    Meetings,
    CAST(ISNULL(Vistors * 100.0 / NULLIF(Members, 0), 0) as DECIMAL(10,2)) as VisitorPercent
FROM OrganizationStructure
WHERE ProgId = 1  -- Specific program
    AND Members > 0
ORDER BY Program, Division, Organization;

-- Group summary by division
SELECT
    Program,
    Division,
    COUNT(DISTINCT OrgId) as OrgCount,
    SUM(Members) as TotalMembers,
    SUM(Vistors) as TotalVisitors,  -- Note: typo in column name
    SUM(Meetings) as TotalMeetings
FROM OrganizationStructure
WHERE Members > 0
GROUP BY ProgId, Program, DivId, Division
ORDER BY Program, Division;</code></pre>
    </div>

    <div class="highlight">
        <h4>Financial Views - TransactionSummary</h4>
        <pre><code class="sql">-- Get outstanding balances by person
SELECT
    ts.PeopleId,
    p.Name2,
    ts.OrganizationId,
    o.OrganizationName,
    ts.TotDue,
    ts.TotPaid,
    (ts.TotDue - ts.TotPaid) as Balance,
    ts.TranDate as LastTransaction
FROM TransactionSummary ts
JOIN People p ON ts.PeopleId = p.PeopleId
JOIN Organizations o ON ts.OrganizationId = o.OrganizationId
WHERE ts.IsLatestTransaction = 1
    AND (ts.TotDue - ts.TotPaid) > 0  -- Outstanding balance
ORDER BY Balance DESC;

-- Mission trip financial analysis
-- NOTE: GoerSenderAmounts view doesn't exist - use MissionTripTotals instead
SET QUOTED_IDENTIFIER ON;  -- Required for this view
SELECT
    m.InvolvementId,
    m.Trip,
    m.PeopleId,
    m.Name,
    m.TripCost,
    m.Raised,
    m.Due,
    CAST(ISNULL(m.Raised * 100.0 / NULLIF(m.TripCost, 0), 0) as DECIMAL(10,2)) as PercentRaised
FROM MissionTripTotals m
WHERE m.PeopleId IS NOT NULL  -- Exclude undesignated funds
    AND m.TripCost > 0
ORDER BY m.Due DESC;</code></pre>
    </div>

    <div class="highlight">
        <h4>Analytics & Reporting Views</h4>
        <pre><code class="sql">-- First and Last Attendance Analysis
-- Note: Views already include person names and org details
SELECT
    p.PeopleId,
    p.Name2,
    fa.OrganizationName,
    fa.FirstAttend,
    la.LastAttend,
    DATEDIFF(day, fa.FirstAttend, la.LastAttend) as DaysAttending,
    DATEDIFF(day, la.LastAttend, GETDATE()) as DaysSinceLastAttend,
    la.EmailAddress,
    la.CellPhone
FROM People p
LEFT JOIN (
    SELECT PeopleId, MIN(FirstAttend) as FirstAttend,
           MAX(OrganizationName) as OrganizationName
    FROM FirstAttends
    GROUP BY PeopleId
) fa ON p.PeopleId = fa.PeopleId
LEFT JOIN (
    SELECT PeopleId, MAX(LastAttend) as LastAttend,
           MAX(EmailAddress) as EmailAddress,
           MAX(CellPhone) as CellPhone
    FROM LastAttends
    GROUP BY PeopleId
) la ON p.PeopleId = la.PeopleId
WHERE p.IsDeceased = 0
    AND p.ArchivedFlag = 0
    AND la.LastAttend >= DATEADD(year, -1, GETDATE())
ORDER BY DaysSinceLastAttend;

-- Organization Member Count Comparison
-- Note: PreviousMemberCounts only has OrganizationId and prevcount
SELECT TOP 100
    os.Organization,
    pmc.prevcount as PreviousCount,
    os.Members as CurrentCount,
    (os.Members - pmc.prevcount) as Change,
    CAST(ISNULL((os.Members - pmc.prevcount) * 100.0 / NULLIF(pmc.prevcount, 0), 0) as DECIMAL(10,2)) as PercentChange
FROM PreviousMemberCounts pmc
JOIN OrganizationStructure os ON pmc.OrganizationId = os.OrgId
WHERE pmc.prevcount > 0
    AND os.Members IS NOT NULL
ORDER BY ABS(os.Members - pmc.prevcount) DESC;</code></pre>
    </div>

    <div class="highlight">
        <h4>Basic Lookup Table Query Pattern</h4>
        <pre><code class="sql">-- Join lookup TABLES (not views) for human-readable values
-- NOTE: These are TABLES in the lookup schema, not views
SELECT
    p.PeopleId,
    p.Name2,
    p.EmailAddress,
    ms.Description as MemberStatus,  -- From lookup TABLE
    g.Description as Gender,          -- From lookup TABLE
    c.Description as Campus           -- From lookup TABLE
FROM People p
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.Gender g ON p.GenderId = g.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0
    AND p.ArchivedFlag = 0;</code></pre>
    </div>

    <div class="highlight">
        <h4>Organization Hierarchy with Lookup Tables</h4>
        <pre><code class="sql">-- Use lookup tables for complete organization details
-- NOTE: Organization -> Division -> Program hierarchy
SELECT
    o.OrganizationId,
    o.OrganizationName,
    p.Name as ProgramName,
    d.Name as DivisionName,
    os.Description as Status,        -- From lookup TABLE
    ot.Description as OrgType,        -- From lookup TABLE
    c.Description as Campus,          -- From lookup TABLE
    mt.Description as LeaderType      -- From lookup TABLE
FROM Organizations o
LEFT JOIN Division d ON o.DivisionId = d.Id  -- Division first
LEFT JOIN Program p ON d.ProgId = p.Id       -- Then Program through Division
LEFT JOIN lookup.OrganizationStatus os ON o.OrganizationStatusId = os.Id
LEFT JOIN lookup.OrganizationType ot ON o.OrganizationTypeId = ot.Id
LEFT JOIN lookup.Campus c ON o.CampusId = c.Id
LEFT JOIN lookup.MemberType mt ON o.LeaderMemberTypeId = mt.Id
WHERE o.OrganizationStatusId = 30;  -- Active organizations</code></pre>
    </div>

    <div class="highlight">
        <h4>Volunteer Tracking with Lookup Tables</h4>
        <pre><code class="sql">-- Volunteer status tracking using lookup tables
-- Note: Volunteer table has StatusId, MVRStatusId, and TrainingStatusId
SELECT
    p.Name2 as VolunteerName,
    v.ProcessedDate,
    vs.Description as ApplicationStatus,     -- From lookup view
    mvrs.Description as MVRStatus,           -- From lookup view
    ts.Description as TrainingStatus,        -- From lookup view
    ms.Description as MemberStatus,          -- From lookup view
    v.Standard,
    v.Children,
    v.Leader
FROM Volunteer v
JOIN People p ON v.PeopleId = p.PeopleId
LEFT JOIN lookup.VolApplicationStatus vs ON v.StatusId = vs.Id
LEFT JOIN lookup.VolApplicationStatus mvrs ON v.MVRStatusId = mvrs.Id
LEFT JOIN lookup.VolApplicationStatus ts ON v.TrainingStatusId = ts.Id
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
WHERE v.StatusId > 0
ORDER BY v.ProcessedDate DESC;</code></pre>
    </div>

    <h3>Performance Considerations for Views</h3>

    <div class="warning">
        <h4>‚ö†Ô∏è View Query Best Practices</h4>
        <ul>
            <li><strong>Always filter large views:</strong> Use WHERE clauses to limit result sets</li>
            <li><strong>Use TOP clauses:</strong> Prevent returning entire view contents</li>
            <li><strong>Apply NOLOCK hint:</strong> For read-only operations on busy views</li>
            <li><strong>Cache lookup data:</strong> Store frequently-used lookup values in variables</li>
            <li><strong>Check execution plans:</strong> Views can hide complex operations</li>
        </ul>
    </div>

    <pre><code class="sql">-- GOOD: Filtered view query with TOP
SELECT TOP 1000 *
FROM MyComplexView WITH (NOLOCK)
WHERE DateColumn >= DATEADD(month, -1, GETDATE())
ORDER BY DateColumn DESC;

-- BAD: Unfiltered view query (may timeout)
SELECT * FROM MyComplexView;

-- GOOD: Cache lookup values for repeated use
DECLARE @MemberStatusLookup TABLE (
    Id INT,
    Description NVARCHAR(100)
);
INSERT INTO @MemberStatusLookup
SELECT Id, Description FROM lookup.MemberStatus;</code></pre>

    <h3>Simulating Views with Temporary Tables</h3>

    <div class="warning">
        <h4>‚ö†Ô∏è Important: TouchPoint SQL is READ-ONLY</h4>
        <p><strong>You CANNOT create views</strong> in TouchPoint. All SQL access is read-only. However, you can use temporary tables within a session to simulate view functionality.</p>
    </div>

    <div class="info">
        <h4>üìù Using Temporary Tables Instead of Views</h4>
        <pre><code class="sql">-- Create a temporary table to simulate a view for active adult members
-- Temp tables exist only for your current session
SELECT
    p.PeopleId,
    p.Name2 as FullName,
    p.EmailAddress,
    p.CellPhone,
    p.Age,
    ms.Description as MemberStatus,
    fp.Description as FamilyPosition,
    c.Description as Campus,
    p.LastAttended,
    DATEDIFF(day, p.LastAttended, GETDATE()) as DaysSinceAttended
INTO #ActiveAdultMembers  -- Creates temporary table
FROM People p
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.FamilyPosition fp ON p.PositionInFamilyId = fp.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0
    AND p.ArchivedFlag = 0
    AND p.MemberStatusId = 10  -- Members only
    AND p.Age >= 18             -- Adults only
    AND p.PositionInFamilyId IN (10, 20);  -- Primary/Secondary adults

-- Now use the temp table like a view
SELECT * FROM #ActiveAdultMembers
WHERE DaysSinceAttended <= 30
ORDER BY DaysSinceAttended;

-- Temp table automatically drops when session ends</code></pre>
    </div>

    <h3>View Metadata Queries</h3>

    <pre><code class="sql">-- Check if a view exists
SELECT COUNT(*) as ViewExists
FROM INFORMATION_SCHEMA.VIEWS
WHERE TABLE_SCHEMA = 'lookup'
    AND TABLE_NAME = 'MemberStatus';

-- Get view definition (if permissions allow)
SELECT VIEW_DEFINITION
FROM INFORMATION_SCHEMA.VIEWS
WHERE TABLE_SCHEMA = 'dbo'
    AND TABLE_NAME = 'vw_ActiveAdultMembers';

-- List all columns in a view with data types
SELECT
    COLUMN_NAME,
    DATA_TYPE,
    CHARACTER_MAXIMUM_LENGTH,
    NUMERIC_PRECISION,
    NUMERIC_SCALE,
    IS_NULLABLE
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'lookup'
    AND TABLE_NAME = 'MemberStatus'
ORDER BY ORDINAL_POSITION;

-- Find views that reference a specific table
SELECT DISTINCT
    v.TABLE_SCHEMA,
    v.TABLE_NAME as ViewName
FROM INFORMATION_SCHEMA.VIEWS v
WHERE v.VIEW_DEFINITION LIKE '%People%'
    AND v.TABLE_SCHEMA NOT IN ('sys', 'INFORMATION_SCHEMA')
ORDER BY v.TABLE_SCHEMA, v.TABLE_NAME;</code></pre>

    <h3>Common View Patterns by Use Case</h3>

    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Use Case</th>
                    <th>Views to Use</th>
                    <th>Example Query Pattern</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Member Reports</td>
                    <td>lookup.MemberStatus, lookup.Campus, lookup.FamilyPosition</td>
                    <td>Join People table with status and campus views</td>
                </tr>
                <tr>
                    <td>Organization Lists</td>
                    <td>lookup.OrganizationStatus, lookup.OrganizationType, lookup.MemberType</td>
                    <td>Filter by OrganizationStatusId = 30 for active</td>
                </tr>
                <tr>
                    <td>Attendance Analysis</td>
                    <td>lookup.AttendType, lookup.MemberType</td>
                    <td>Group by AttendType for categorized counts</td>
                </tr>
                <tr>
                    <td>Giving Reports</td>
                    <td>lookup.ContributionType, lookup.ContributionFund</td>
                    <td>Exclude TypeId = 99 (event fees)</td>
                </tr>
                <tr>
                    <td>Volunteer Management</td>
                    <td>lookup.VolApplicationStatus, lookup.MemberStatus</td>
                    <td>Track application and approval processes</td>
                </tr>
                <tr>
                    <td>Family Structure</td>
                    <td>lookup.FamilyPosition, lookup.MaritalStatus</td>
                    <td>Identify heads of household and relationships</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3>üîç Key View SQL Examples</h3>

    <div class="info">
        <h4>‚ö†Ô∏è OrganizationStructure View - IMPORTANT NOTES</h4>
        <ul>
            <li><strong>Column Typo:</strong> The view has "Vistors" (missing 'i') instead of "Visitors"</li>
            <li><strong>ProgId Values:</strong> In most databases, ProgId values start at 1108+, not 1</li>
            <li><strong>Performance:</strong> This view is pre-calculated for fast reporting</li>
        </ul>
    </div>

    <h4>OrganizationStructure Examples</h4>
    <pre><code class="sql">-- Example 1: Organization analysis with visitor percentage
-- NOTE: Column is misspelled as 'Vistors' in the view
SELECT
    Program,
    Division,
    Organization,
    OrgStatus,
    Members,
    Previous,
    Vistors,  -- Note: typo in actual view column name
    Meetings,
    CAST(ISNULL(Vistors * 100.0 / NULLIF(Members, 0), 0) as DECIMAL(10,2)) as VisitorPercent
FROM OrganizationStructure
WHERE ProgId = 1115  -- Adults program (verify your ProgIds!)
    AND Members > 0
ORDER BY Program, Division, Organization;

-- Example 2: Program summary statistics
SELECT
    Program,
    COUNT(DISTINCT OrgId) as TotalOrgs,
    SUM(Members) as TotalMembers,
    SUM(Vistors) as TotalVisitors,
    SUM(Meetings) as TotalMeetings,
    CAST(AVG(CAST(Members as FLOAT)) as DECIMAL(10,2)) as AvgMembersPerOrg
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
GROUP BY ProgId, Program
ORDER BY TotalMembers DESC;

-- Example 3: Find high-visitor organizations (growth opportunities)
SELECT TOP 20
    Program,
    Division,
    Organization,
    Members,
    Vistors,
    CAST(Vistors * 100.0 / NULLIF(Members, 0) as DECIMAL(10,2)) as VisitorRate
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
    AND Members > 5  -- Exclude very small groups
    AND Vistors > 0
ORDER BY VisitorRate DESC;</code></pre>

    <h4>CheckInActivities Examples</h4>
    <pre><code class="sql">-- Real-time check-in monitoring (last 3 hours)
SELECT
    PeopleId,
    Name,
    Activity,
    AccessType,
    CheckInTime,
    DATEDIFF(minute, CheckInTime, GETDATE()) as MinutesAgo
FROM CheckInActivities
WHERE CheckInTime >= DATEADD(hour, -3, GETDATE())
ORDER BY CheckInTime DESC;

-- Check-in patterns by hour of day
SELECT
    DATEPART(hour, CheckInTime) as Hour,
    Activity,
    COUNT(*) as CheckInCount,
    COUNT(DISTINCT PeopleId) as UniquePeople
FROM CheckInActivities
WHERE CheckInTime >= DATEADD(day, -7, GETDATE())
GROUP BY DATEPART(hour, CheckInTime), Activity
ORDER BY Hour, Activity;</code></pre>

    <h4>Lookup View Examples</h4>
    <pre><code class="sql">-- Member status distribution with percentages
SELECT
    ms.Description as Status,
    COUNT(*) as Count,
    CAST(COUNT(*) * 100.0 / SUM(COUNT(*)) OVER() as DECIMAL(5,2)) as Percentage
FROM People p
JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY ms.Id, ms.Description
ORDER BY ms.Id;

-- Guest retention analysis using AttendType
WITH GuestAttendance AS (
    SELECT
        a.PeopleId,
        MIN(a.MeetingDate) as FirstVisit,
        MAX(a.MeetingDate) as LastVisit,
        COUNT(*) as VisitCount
    FROM Attend a
    WHERE a.AttendanceTypeId IN (30, 50, 60)  -- Guest types
        AND a.AttendanceFlag = 1
        AND a.MeetingDate >= DATEADD(month, -6, GETDATE())
    GROUP BY a.PeopleId
)
SELECT
    CASE
        WHEN VisitCount = 1 THEN 'One-time visitor'
        WHEN VisitCount BETWEEN 2 AND 3 THEN 'Returning guest'
        WHEN VisitCount > 3 THEN 'Regular attender'
    END as Category,
    COUNT(*) as PeopleCount
FROM GuestAttendance
GROUP BY
    CASE
        WHEN VisitCount = 1 THEN 'One-time visitor'
        WHEN VisitCount BETWEEN 2 AND 3 THEN 'Returning guest'
        WHEN VisitCount > 3 THEN 'Regular attender'
    END;</code></pre>

    <h4>Financial Views Examples</h4>
    <pre><code class="sql">-- Mission trip funding status using MissionTripTotals
SELECT
    Trip,
    COUNT(*) as Participants,
    SUM(TripCost) as TotalCost,
    SUM(Raised) as TotalRaised,
    SUM(Due) as TotalDue,
    CAST(SUM(Raised) * 100.0 / NULLIF(SUM(TripCost), 0) as DECIMAL(5,2)) as PercentRaised
FROM MissionTripTotals
WHERE Due > 0
GROUP BY Trip
ORDER BY TotalDue DESC;

-- Outstanding balances by organization using TransactionSummary
SELECT
    o.OrganizationName,
    COUNT(DISTINCT ts.PeopleId) as PeopleWithBalances,
    SUM(ts.IndDue - ts.IndAmt) as TotalOutstanding
FROM TransactionSummary ts
JOIN Organizations o ON ts.OrganizationId = o.OrganizationId
WHERE ts.IsLatestTransaction = 1
    AND (ts.IndDue - ts.IndAmt) > 0
GROUP BY o.OrganizationId, o.OrganizationName
HAVING SUM(ts.IndDue - ts.IndAmt) > 0
ORDER BY TotalOutstanding DESC;</code></pre>

    <div class="success">
        <h3>‚úÖ View Usage Checklist</h3>
        <ul>
            <li>‚òëÔ∏è Use views for complex joins and calculations</li>
            <li>‚òëÔ∏è Apply filters to views to improve performance</li>
            <li>‚òëÔ∏è Test view performance with realistic data volumes</li>
            <li>‚òëÔ∏è Document custom views with descriptive names</li>
            <li>‚òëÔ∏è Handle NULL values from views in application code</li>
        </ul>
    </div>
</div>

<div class="section" id="lookup-tables">
    <h2>üìö Lookup Tables Documentation</h2>

    <p>The lookup schema contains reference tables (NOT views) that store descriptive text for ID values used throughout TouchPoint. These are physical tables containing static reference data.</p>

    <div class="warning">
        <h3>‚ö†Ô∏è Critical Distinction: Tables vs Views</h3>
        <ul>
            <li><strong>Lookup items are TABLES</strong> - Physical storage with actual rows of data</li>
            <li><strong>NOT views</strong> - They don't compute or join data dynamically</li>
            <li><strong>Schema:</strong> All in the <code>lookup</code> schema (e.g., <code>lookup.MemberStatus</code>)</li>
            <li><strong>Purpose:</strong> Convert ID values to human-readable descriptions</li>
        </ul>
    </div>

    <h3>Common Lookup Tables</h3>
    <div class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>Table Name</th>
                    <th>Purpose</th>
                    <th>Key Columns</th>
                    <th>Common Values</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><code>lookup.MemberStatus</code></td>
                    <td>Member status descriptions</td>
                    <td>Id, Code, Description</td>
                    <td>10=Member, 20=Prospect, 30=Not Member, 40=Previous Member</td>
                </tr>
                <tr>
                    <td><code>lookup.MemberType</code></td>
                    <td>Organization roles</td>
                    <td>Id, Code, Description, AttendanceTypeId</td>
                    <td>140=Leader, 220=Member, 310=Org Leader, 710=Volunteer</td>
                </tr>
                <tr>
                    <td><code>lookup.AttendType</code></td>
                    <td>Attendance classifications</td>
                    <td>Id, Code, Description</td>
                    <td>10=Leader, 20=Member, 30=Visitor, 60=New Guest</td>
                </tr>
                <tr>
                    <td><code>lookup.FamilyPosition</code></td>
                    <td>Position in family</td>
                    <td>Id, Code, Description</td>
                    <td>10=Primary Adult, 20=Secondary Adult, 30=Child</td>
                </tr>
                <tr>
                    <td><code>lookup.Gender</code></td>
                    <td>Gender classifications</td>
                    <td>Id, Code, Description</td>
                    <td>1=Male, 2=Female, 9=Unknown</td>
                </tr>
                <tr>
                    <td><code>lookup.MaritalStatus</code></td>
                    <td>Marital status options</td>
                    <td>Id, Code, Description</td>
                    <td>10=Married, 20=Single, 30=Divorced, 40=Widowed</td>
                </tr>
                <tr>
                    <td><code>lookup.Campus</code></td>
                    <td>Campus locations</td>
                    <td>Id, Code, Description</td>
                    <td>0=All Campuses, plus site-specific values</td>
                </tr>
                <tr>
                    <td><code>lookup.OrganizationStatus</code></td>
                    <td>Organization status</td>
                    <td>Id, Code, Description</td>
                    <td>30=Active, 40=Inactive</td>
                </tr>
                <tr>
                    <td><code>lookup.ContributionType</code></td>
                    <td>Contribution types</td>
                    <td>Id, Description</td>
                    <td>1=Tax Deductible, 6=Returned Check, 99=Event Fee</td>
                </tr>
                <tr>
                    <td><code>lookup.DecisionType</code></td>
                    <td>Spiritual decisions</td>
                    <td>Id, Code, Description</td>
                    <td>10=Faith Statement, 20=Baptism, 30=Membership</td>
                </tr>
            </tbody>
        </table>
    </div>

    <h3>Using Lookup Tables in Queries</h3>

    <div class="highlight">
        <h4>Basic Lookup Table Pattern</h4>
        <pre><code class="sql">-- Join lookup TABLES for human-readable values
SELECT
    p.PeopleId,
    p.Name2,
    p.EmailAddress,
    ms.Description as MemberStatus,  -- From lookup TABLE
    g.Description as Gender,          -- From lookup TABLE
    c.Description as Campus           -- From lookup TABLE
FROM People p
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.Gender g ON p.GenderId = g.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.IsDeceased = 0
    AND p.ArchivedFlag = 0;</code></pre>
    </div>

    <div class="highlight">
        <h4>Organization Hierarchy with Lookup Tables</h4>
        <pre><code class="sql">-- Join through Division to get Program, then use lookup tables
SELECT
    o.OrganizationId,
    o.OrganizationName,
    p.Name as ProgramName,
    d.Name as DivisionName,
    os.Description as Status,        -- From lookup TABLE
    ot.Description as OrgType,        -- From lookup TABLE
    c.Description as Campus,          -- From lookup TABLE
    mt.Description as LeaderType      -- From lookup TABLE
FROM Organizations o
LEFT JOIN Division d ON o.DivisionId = d.Id  -- Division first
LEFT JOIN Program p ON d.ProgId = p.Id       -- Program via Division.ProgId
LEFT JOIN lookup.OrganizationStatus os ON o.OrganizationStatusId = os.Id
LEFT JOIN lookup.OrganizationType ot ON o.OrganizationTypeId = ot.Id
LEFT JOIN lookup.Campus c ON o.CampusId = c.Id
LEFT JOIN lookup.MemberType mt ON o.LeaderMemberTypeId = mt.Id
WHERE o.OrganizationStatusId = 30;</code></pre>
    </div>

    <div class="highlight">
        <h4>Volunteer Tracking with Lookup Tables</h4>
        <pre><code class="sql">-- Volunteer status tracking using lookup tables
SELECT
    p.Name2 as VolunteerName,
    v.ProcessedDate,
    vs.Description as ApplicationStatus,     -- From lookup TABLE
    ms.Description as MemberStatus,          -- From lookup TABLE
    v.Standard,
    v.Children,
    v.Leader
FROM Volunteer v
JOIN People p ON v.PeopleId = p.PeopleId
LEFT JOIN lookup.VolApplicationStatus vs ON v.StatusId = vs.Id
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
WHERE v.ProcessedDate IS NOT NULL;</code></pre>
    </div>

    <h3>Complete List of Lookup Tables</h3>
    <pre><code class="sql">-- Get all lookup tables in your database
SELECT
    TABLE_NAME,
    (SELECT COUNT(*) FROM INFORMATION_SCHEMA.COLUMNS c
     WHERE c.TABLE_SCHEMA = t.TABLE_SCHEMA
     AND c.TABLE_NAME = t.TABLE_NAME) as ColumnCount
FROM INFORMATION_SCHEMA.TABLES t
WHERE TABLE_SCHEMA = 'lookup'
    AND TABLE_TYPE = 'BASE TABLE'
ORDER BY TABLE_NAME;

-- Common lookup tables (66 total):
-- AccountCode, AddressType, AttendCredit, AttendType, BaptismStatus,
-- BaptismType, Campus, ContributionType, Country, DecisionType,
-- FamilyPosition, Gender, MaritalStatus, MemberStatus, MemberType,
-- OrganizationStatus, OrganizationType, and many more...</code></pre>

    <div class="info">
        <h3>üí° Lookup Table Best Practices</h3>
        <ul>
            <li><strong>Always use LEFT JOIN</strong> - Handle cases where the ID might be NULL</li>
            <li><strong>Cache lookups in code</strong> - These values rarely change</li>
            <li><strong>Check ID meanings</strong> - Same ID can mean different things per church</li>
            <li><strong>Verify with SELECT * FROM lookup.TableName</strong> - Always check actual values</li>
        </ul>
    </div>
</div>

<div class="section">
    <h2>üéâ Conclusion</h2>
    
    <p>This comprehensive guide covers TouchPoint's extensive database architecture, from basic queries to advanced analytics. Remember these key principles:</p>
    
    <div class="success">
        <h3>‚úÖ Key Takeaways</h3>
        <ul>
            <li><strong>Always use TOP clauses</strong> when exploring data</li>
            <li><strong>Apply mandatory filters</strong> (IsDeceased, ArchivedFlag, AttendanceFlag)</li>
            <li><strong>Use date ranges</strong> on large tables</li>
            <li><strong>Exclude event fees</strong> from giving reports (TypeId != 99)</li>
            <li><strong>Check OrganizationStatusId = 30</strong> for active organizations</li>
            <li><strong>Respect communication preferences</strong> before contacting people</li>
            <li><strong>Test incrementally</strong> with small datasets first</li>
        </ul>
    </div>
    
    <div class="info">
        <h3>üìö Additional Resources</h3>
        <ul>
            <li><strong>TouchPoint Documentation:</strong> <a href="https://docs.touchpoint.church">docs.touchpoint.church</a></li>
            <li><strong>Community Forum:</strong> <a href="https://community.touchpoint.church">community.touchpoint.church</a></li>
            <li><strong>GitHub Repository:</strong> <a href="https://github.com/bswaby/touchpoint">github.com/bswaby/touchpoint</a></li>
        </ul>
    </div>
    
    <div class="highlight">
        <h3>üôè Contributing</h3>
        <p>This guide is maintained by the TouchPoint community. If you discover new patterns, corrections, or useful queries, please contribute back to help other churches maximize their use of TouchPoint.</p>
        <p><strong>Contact:</strong> For questions or contributions, please open an issue on GitHub or contact the community forum.</p>
    </div>
</div>

<a href="#" class="back-to-top">‚Üë Top</a>

<script>
// Add copy buttons to code blocks
document.addEventListener('DOMContentLoaded', function() {
    const codeBlocks = document.querySelectorAll('pre');
    
    codeBlocks.forEach(function(block) {
        // Create copy button
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        
        // Make pre position relative for absolute button positioning
        block.style.position = 'relative';
        
        // Add click handler
        button.addEventListener('click', function() {
            const code = block.querySelector('code');
            const text = code ? code.textContent : block.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                button.textContent = 'Copied!';
                setTimeout(function() {
                    button.textContent = 'Copy';
                }, 2000);
            }).catch(function(err) {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                    }, 2000);
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                }
                document.body.removeChild(textarea);
            });
        });
        
        block.appendChild(button);
    });
    
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Back to top button visibility
    const backToTop = document.querySelector('.back-to-top');
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            backToTop.style.display = 'block';
        } else {
            backToTop.style.display = 'none';
        }
    });
});
</script>

<!-- ============================== -->
<!-- ADDITIONAL CRITICAL TABLES SECTION -->
<!-- ============================== -->

<div id="families-system" class="section">
    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Families & Household Management</h2>
    
    <div class="warning">
        <strong>Critical Relationship Table:</strong> The Families table is central to TouchPoint's household structure. Always join with People table for complete household information.
    </div>

    <h3>Families Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Links to People.FamilyId</td>
        </tr>
        <tr>
            <td><code>HeadOfHouseholdId</code></td>
            <td>int</td>
            <td>Primary adult</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>HeadOfHouseholdSpouseId</code></td>
            <td>int</td>
            <td>Spouse</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>CoupleFlag</code></td>
            <td>int</td>
            <td>Married couple</td>
            <td>1 = Couple, 0 = Single</td>
        </tr>
        <tr>
            <td><code>AddressLineOne</code></td>
            <td>nvarchar</td>
            <td>Primary address</td>
            <td>Family's main address</td>
        </tr>
        <tr>
            <td><code>HomePhone</code></td>
            <td>nvarchar</td>
            <td>Home phone</td>
            <td>Shared family phone</td>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Family photo</td>
            <td>‚Üí Picture.PictureId</td>
        </tr>
    </table>

    <h3>Family Queries</h3>
    <pre><code>-- Get complete family information
SELECT 
    f.FamilyId,
    head.Name as HeadOfHousehold,
    spouse.Name as Spouse,
    f.AddressLineOne + ', ' + f.CityName + ', ' + f.StateCode + ' ' + f.ZipCode as FullAddress,
    COUNT(DISTINCT p.PeopleId) as FamilySize,
    COUNT(DISTINCT CASE WHEN p.PositionInFamilyId = 30 THEN p.PeopleId END) as ChildCount
FROM Families f
LEFT JOIN People head ON f.HeadOfHouseholdId = head.PeopleId
LEFT JOIN People spouse ON f.HeadOfHouseholdSpouseId = spouse.PeopleId
LEFT JOIN People p ON f.FamilyId = p.FamilyId
WHERE f.BadAddressFlag = 0
GROUP BY f.FamilyId, head.Name, spouse.Name, 
         f.AddressLineOne, f.CityName, f.StateCode, f.ZipCode
ORDER BY head.Name

-- Find single-parent families
SELECT 
    f.FamilyId,
    head.Name as SingleParent,
    COUNT(p.PeopleId) as ChildrenCount
FROM Families f
JOIN People head ON f.HeadOfHouseholdId = head.PeopleId
JOIN People p ON f.FamilyId = p.FamilyId AND p.PositionInFamilyId = 30
WHERE f.CoupleFlag = 0
  AND EXISTS (SELECT 1 FROM People WHERE FamilyId = f.FamilyId AND PositionInFamilyId = 30)
GROUP BY f.FamilyId, head.Name
HAVING COUNT(p.PeopleId) > 0</code></pre>
</div>

<div id="financial-system" class="section">
    <h2>üí∞ Financial & Transaction Management</h2>
    
    <div class="critical">
        <strong>‚ö†Ô∏è Financial Data Warning:</strong> These tables contain sensitive financial information. Always use appropriate security filters and never expose raw transaction data in reports.
    </div>

    <h3>Transaction Table (85K+ records)</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Critical Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Transaction ID</td>
            <td>Primary key</td>
        </tr>
        <tr>
            <td><code>OrgId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations.OrganizationId</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Amt</code></td>
            <td>decimal</td>
            <td>Amount</td>
            <td>Transaction amount</td>
        </tr>
        <tr>
            <td><code>TransactionDate</code></td>
            <td>datetime</td>
            <td>Date</td>
            <td>When processed</td>
        </tr>
        <tr>
            <td><code>PaymentType</code></td>
            <td>nvarchar</td>
            <td>Payment method</td>
            <td>Credit, Check, Cash, etc.</td>
        </tr>
        <tr>
            <td><code>Approved</code></td>
            <td>bit</td>
            <td>Status</td>
            <td>1 = Approved</td>
        </tr>
    </table>

    <h3>EnrollmentTransaction Table (317K+ records)</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>Key Fields</th>
            <th>Links To</th>
        </tr>
        <tr>
            <td>Registration payments</td>
            <td>TransactionId, RegPersonId, Amt</td>
            <td>Transaction, RecReg, People</td>
        </tr>
    </table>

    <h3>Financial Queries</h3>
    <pre><code>-- Monthly giving summary by fund
SELECT 
    YEAR(c.ContributionDate) as Year,
    MONTH(c.ContributionDate) as Month,
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as Givers,
    COUNT(*) as Gifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionDate >= DATEADD(month, -12, GETDATE())
  AND c.ContributionStatusId = 0  -- Posted
GROUP BY YEAR(c.ContributionDate), MONTH(c.ContributionDate), cf.FundName
ORDER BY Year DESC, Month DESC, TotalAmount DESC

-- Registration POTENTIAL revenue (based on enrollment and fee structure)
-- Shows what should be collected based on current enrollments
SELECT 
    o.OrganizationName,
    o.RegFeePerPerson as FeePerPerson,
    o.RegDepositAmount as DepositRequired,
    COUNT(om.PeopleId) as CurrentEnrollment,
    o.RegFeePerPerson * COUNT(om.PeopleId) as TotalPotentialRevenue,
    CASE 
        WHEN o.RegistrationTypeId = 6 THEN 'Mission Trip'
        WHEN o.RegistrationTypeId = 8 THEN 'Event'
        ELSE 'Other'
    END as RegistrationType
FROM Organizations o
JOIN OrganizationMembers om ON o.OrganizationId = om.OrganizationId
WHERE o.RegFeePerPerson > 0 
  AND om.MemberTypeId NOT IN (310, 320)  -- Exclude leaders/assistants
  AND om.InactiveDate IS NULL  -- Active members only
GROUP BY o.OrganizationId, o.OrganizationName, o.RegFeePerPerson, 
         o.RegDepositAmount, o.RegistrationTypeId
ORDER BY TotalPotentialRevenue DESC

-- BEST: Actual payments received using TransactionSummary
-- This is what my payment management systems use and you need to be adding CSH CHK to the description prefix
-- Shows REAL money collected, not just online transactions.
SELECT 
    o.OrganizationName,
    COUNT(DISTINCT ts.PeopleId) as PayingParticipants,
    SUM(CASE WHEN t.amt > 0 THEN t.amt ELSE 0 END) as TotalPaid,
    COUNT(DISTINCT t.Id) as NumTransactions,
    MIN(t.TransactionDate) as FirstPayment,
    MAX(t.TransactionDate) as LastPayment,
    -- Payment type breakdown
    SUM(CASE WHEN t.Message LIKE 'CHK%' THEN t.amt ELSE 0 END) as CheckPayments,
    SUM(CASE WHEN t.Message LIKE 'CSH%' THEN t.amt ELSE 0 END) as CashPayments,
    SUM(CASE WHEN t.Message LIKE 'Response%' THEN t.amt ELSE 0 END) as CreditCardPayments
FROM TransactionSummary ts
JOIN Organizations o ON ts.OrganizationId = o.OrganizationId
LEFT JOIN [Transaction] t ON ts.RegId = t.OriginalId 
    AND t.amt > 0 
    AND t.Approved = 1
WHERE (ts.TotDue > 0 OR ts.TotPaid > 0)  -- Has financial activity
  AND t.TransactionDate >= DATEADD(year, -1, GETDATE())
GROUP BY o.OrganizationId, o.OrganizationName
HAVING SUM(CASE WHEN t.amt > 0 THEN t.amt ELSE 0 END) > 0
ORDER BY TotalPaid DESC</code></pre>
</div>

<div id="sms-communication" class="section">
    <h2>üì± SMS & Text Messaging System</h2>
    
    <h3>SMS System Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Records</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>SMSGroups</code></td>
            <td>Varies</td>
            <td>Text groups</td>
            <td>Id, Name, Description</td>
        </tr>
        <tr>
            <td><code>SMSGroupMembers</code></td>
            <td>Varies</td>
            <td>Group membership</td>
            <td>GroupId, PeopleId</td>
        </tr>
        <tr>
            <td><code>SMSItems</code></td>
            <td>332K+</td>
            <td>Individual messages</td>
            <td>Id, PeopleId, Message, Sent</td>
        </tr>
        <tr>
            <td><code>SMSList</code></td>
            <td>147K+</td>
            <td>Bulk messages</td>
            <td>Id, SenderId, Message, SendAt</td>
        </tr>
        <tr>
            <td><code>SmsReceived</code></td>
            <td>Varies</td>
            <td>Incoming texts</td>
            <td>FromPeopleId, Body, DateReceived</td>
        </tr>
    </table>

    <h3>SMS Queries</h3>
    <pre><code>-- SMS group activity summary
SELECT 
    sg.Name as GroupName,
    COUNT(DISTINCT sgm.PeopleId) as Members,
    COUNT(DISTINCT si.Id) as MessagesSent,
    MAX(si.Sent) as LastActivity
FROM SMSGroups sg
LEFT JOIN SMSGroupMembers sgm ON sg.Id = sgm.GroupId
LEFT JOIN SMSItems si ON sgm.PeopleId = si.PeopleId
GROUP BY sg.Name
ORDER BY Members DESC

-- Text messaging engagement
SELECT 
    p.Name,
    COUNT(DISTINCT sl.ID) as MessagesSent,
    COUNT(DISTINCT sr.ID) as MessagesReceived,
    MAX(sl.SendAt) as LastSent,
    MAX(sr.DateReceived) as LastReceived
FROM People p
LEFT JOIN SMSList sl ON p.PeopleId = sl.SenderID AND sl.Sent = 1
LEFT JOIN SmsReceived sr ON p.PeopleId = sr.FromPeopleId
WHERE sl.ID IS NOT NULL OR sr.ID IS NOT NULL
GROUP BY p.PeopleId, p.Name
HAVING COUNT(DISTINCT sl.ID) + COUNT(DISTINCT sr.ID) > 10
ORDER BY (COUNT(DISTINCT sl.ID) + COUNT(DISTINCT sr.ID)) DESC</code></pre>
</div>

<div id="security-users" class="section">
    <h2>üîê Security & User Management</h2>
    
    <h3>Users Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Security Notes</th>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>User ID</td>
            <td>Primary key</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person link</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Username</code></td>
            <td>nvarchar</td>
            <td>Login name</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>IsOnline</code></td>
            <td>bit</td>
            <td>Currently active</td>
            <td>Real-time status</td>
        </tr>
        <tr>
            <td><code>LastActivityDate</code></td>
            <td>datetime</td>
            <td>Last action</td>
            <td>Audit tracking</td>
        </tr>
        <tr>
            <td><code>FailedPasswordAttemptCount</code></td>
            <td>int</td>
            <td>Failed logins</td>
            <td>Security monitoring</td>
        </tr>
    </table>

    <h3>BackgroundChecks Table</h3>
    <table>
        <tr>
            <th>Purpose</th>
            <th>Key Fields</th>
            <th>Critical for</th>
        </tr>
        <tr>
            <td>Volunteer screening</td>
            <td>PeopleId, Status, DateCompleted, ExpirationDate</td>
            <td>Children's ministry, youth work</td>
        </tr>
    </table>

    <h3>Security Queries</h3>
    <pre><code>-- Active users with failed login attempts
SELECT 
    u.Username,
    p.Name,
    u.LastActivityDate,
    u.FailedPasswordAttemptCount,
    u.IsLockedOut,
    DATEDIFF(day, u.LastActivityDate, GETDATE()) as DaysSinceActive
FROM Users u
JOIN People p ON u.PeopleId = p.PeopleId
WHERE u.FailedPasswordAttemptCount > 0
   OR u.IsLockedOut = 1
ORDER BY u.FailedPasswordAttemptCount DESC

-- Background check status for volunteers
SELECT 
    p.Name,
    bc.Status,
    bc.DateCompleted,
    bc.ExpirationDate,
    DATEDIFF(day, GETDATE(), bc.ExpirationDate) as DaysUntilExpiry,
    STRING_AGG(o.OrganizationName, ', ') as VolunteerRoles
FROM BackgroundChecks bc
JOIN People p ON bc.PeopleId = p.PeopleId
LEFT JOIN OrganizationMembers om ON p.PeopleId = om.PeopleId
LEFT JOIN Organizations o ON om.OrganizationId = o.OrganizationId
WHERE om.MemberTypeId IN (140, 150, 160, 710)  -- Leader/volunteer types
  AND om.InactiveDate IS NULL
GROUP BY p.Name, bc.Status, bc.DateCompleted, bc.ExpirationDate
ORDER BY bc.ExpirationDate</code></pre>
</div>

<div id="registration-system" class="section">
    <h2>üìù Registration & Event Management</h2>
    
    <h3>Registration Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Records</th>
            <th>Purpose</th>
            <th>Key Relationships</th>
        </tr>
        <tr>
            <td><code>RecReg</code></td>
            <td>Varies</td>
            <td>Registration setup</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>RegistrationData</code></td>
            <td>179K+</td>
            <td>Form responses</td>
            <td>‚Üí People, Organizations</td>
        </tr>
        <tr>
            <td><code>RegPeople</code></td>
            <td>Varies</td>
            <td>Registrants</td>
            <td>‚Üí People, RecReg</td>
        </tr>
    </table>

    <h3>Registration Queries</h3>
    <pre><code>-- Event registration summary
SELECT 
    o.OrganizationName,
    COUNT(DISTINCT rd.PeopleId) as Registrants,
    COUNT(DISTINCT rd.Id) as TotalResponses,
    MIN(rd.Stamp) as FirstRegistration,
    MAX(rd.Stamp) as LastRegistration
FROM RegistrationData rd
JOIN Organizations o ON rd.OrganizationId = o.OrganizationId
WHERE rd.Stamp >= DATEADD(month, -6, GETDATE())
GROUP BY o.OrganizationName
ORDER BY Registrants DESC

-- Registration form field analysis
SELECT 
    rd.Field,
    COUNT(*) as ResponseCount,
    COUNT(DISTINCT rd.PeopleId) as UniqueResponders
FROM RegistrationData rd
WHERE rd.OrganizationId = 123  -- Specific event
GROUP BY rd.Field
ORDER BY ResponseCount DESC</code></pre>
</div>

<div id="resource-facilities" class="section">
    <h2>üè¢ Resource & Facility Management</h2>
    
    <h3>Resource System Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>Resource</code></td>
            <td>Resource definitions</td>
            <td>ResourceId, Name, Type, Capacity</td>
        </tr>
        <tr>
            <td><code>Reservable</code></td>
            <td>Reservation settings</td>
            <td>ResourceId, StartTime, EndTime</td>
        </tr>
        <tr>
            <td><code>Calendar</code></td>
            <td>Scheduled events</td>
            <td>Id, ResourceId, StartTime, EndTime</td>
        </tr>
    </table>

    <h3>Facility Queries</h3>
    <pre><code>-- Room utilization analysis
SELECT 
    r.Name as ResourceName,
    r.Type,
    r.Capacity,
    COUNT(c.Id) as TotalReservations,
    SUM(DATEDIFF(hour, c.StartTime, c.EndTime)) as TotalHours,
    AVG(DATEDIFF(hour, c.StartTime, c.EndTime)) as AvgHours
FROM Resource r
LEFT JOIN Calendar c ON r.ResourceId = c.ResourceId
WHERE c.StartTime >= DATEADD(month, -3, GETDATE())
GROUP BY r.Name, r.Type, r.Capacity
ORDER BY TotalReservations DESC</code></pre>
</div>

<div id="lookup-tables" class="section">
    <h2>üìã Critical Lookup Tables Reference</h2>
    
    <div class="info">
        <strong>Schema Note:</strong> Most lookup tables are in the <code>lookup</code> schema. Always use <code>lookup.TableName</code> when joining.
    </div>

    <h3>Key Lookup Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Common Values</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>lookup.AttendType</code></td>
            <td>10=Leader, 20=Volunteer, 30=Member, 60=Guest</td>
            <td>Attendance categories</td>
        </tr>
        <tr>
            <td><code>lookup.MemberType</code></td>
            <td>140=Leader, 220=Member, 230=Prospect, 500=Visitor</td>
            <td>Organization roles</td>
        </tr>
        <tr>
            <td><code>lookup.PositionInFamily</code></td>
            <td>10=Primary Adult (both spouses), 20=Secondary/Other Adult, 30=Child</td>
            <td>Family relationships</td>
        </tr>
        <tr>
            <td><code>lookup.MaritalStatus</code></td>
            <td>10=Single, 20=Married, 30=Divorced, 40=Widowed</td>
            <td>Marital status</td>
        </tr>
        <tr>
            <td><code>lookup.DecisionType</code></td>
            <td>10=Statement of Faith, 20=Baptism, 30=Membership</td>
            <td>Spiritual decisions</td>
        </tr>
        <tr>
            <td><code>lookup.BaptismStatus</code></td>
            <td>10=Scheduled, 20=Completed, 30=Cancelled</td>
            <td>Baptism tracking</td>
        </tr>
        <tr>
            <td><code>lookup.OrganizationStatus</code></td>
            <td>30=Active, 40=Inactive</td>
            <td>Org status</td>
        </tr>
        <tr>
            <td><code>lookup.ResidentCode</code></td>
            <td>10=Metro, 20=Marginal, 30=Non-Resident</td>
            <td>Geographic zones</td>
        </tr>
    </table>

    <h3>Lookup Usage Example</h3>
    <pre><code>-- Complete person profile with all lookups
-- Note: AttendType is NOT on People table - it's used in Attend table
SELECT 
    p.Name,
    fp.Description as FamilyPosition,
    ms.Description as MaritalStatus,
    mst.Description as MemberStatus,
    rc.Description as ResidenceZone,
    bs.Description as BaptismStatus,
    g.Description as Gender,
    c.Description as Campus
FROM People p
LEFT JOIN lookup.FamilyPosition fp ON p.PositionInFamilyId = fp.Id
LEFT JOIN lookup.MaritalStatus ms ON p.MaritalStatusId = ms.Id
LEFT JOIN lookup.MemberStatus mst ON p.MemberStatusId = mst.Id
LEFT JOIN lookup.ResidentCode rc ON p.ResCodeId = rc.Id
LEFT JOIN lookup.BaptismStatus bs ON p.BaptismStatusId = bs.Id
LEFT JOIN lookup.Gender g ON p.GenderId = g.Id
LEFT JOIN lookup.Campus c ON p.CampusId = c.Id
WHERE p.PeopleId = 12345</code></pre>
</div>

<div id="performance-warnings" class="section">
    <h2>‚ö†Ô∏è Performance-Critical Tables</h2>
    
    <div class="critical">
        <h3>üö® EXTREME CAUTION - Tables Over 1M Records</h3>
        <table>
            <tr>
                <th>Table</th>
                <th>Record Count</th>
                <th>Required Filters</th>
            </tr>
            <tr>
                <td><code>ActivityLog</code></td>
                <td>3.7M+</td>
                <td>ALWAYS use date filter</td>
            </tr>
            <tr>
                <td><code>PeopleSearchTokens</code></td>
                <td>1.7M+</td>
                <td>Use specific PeopleId</td>
            </tr>
            <tr>
                <td><code>EngagementScoreTag</code></td>
                <td>1.5M+</td>
                <td>Date range required</td>
            </tr>
            <tr>
                <td><code>EngagementScore</code></td>
                <td>1.4M+</td>
                <td>WeekDate filter mandatory</td>
            </tr>
            <tr>
                <td><code>Tag</code></td>
                <td>986K+</td>
                <td>Use specific TagId or Name</td>
            </tr>
            <tr>
                <td><code>Contribution</code></td>
                <td>687K+</td>
                <td>Date range required</td>
            </tr>
            <tr>
                <td><code>BundleDetail</code></td>
                <td>687K+</td>
                <td>Join through BundleHeader</td>
            </tr>
        </table>
    </div>

    <h3>Safe Query Patterns for Large Tables</h3>
    <pre><code>-- GOOD: ActivityLog with date filter
SELECT TOP 1000 * 
FROM ActivityLog 
WHERE ActivityDate >= DATEADD(day, -7, GETDATE())

-- BAD: Never do this!
-- SELECT * FROM ActivityLog

-- GOOD: EngagementScore with filters
SELECT es.* 
FROM EngagementScore es
WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())
  AND es.PeopleId IN (SELECT PeopleId FROM ...)

-- GOOD: Contribution with date range
SELECT c.*
FROM Contribution c
WHERE c.ContributionDate BETWEEN '2024-01-01' AND '2024-12-31'
  AND c.FundId = 1</code></pre>
</div>

<div id="users-roles" class="section">
    <h2>üîê Users, Roles & Permissions</h2>
    
    <div class="info">
        <p><strong>Critical:</strong> The Users table links system accounts to People records. This is how TouchPoint manages authentication and authorization.</p>
    </div>

    <h3>Users Table Structure</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique user identifier</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Link to People</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Username</code></td>
            <td>nvarchar(50)</td>
            <td>Login username</td>
            <td>Unique, case-insensitive</td>
        </tr>
        <tr>
            <td><code>Password</code></td>
            <td>nvarchar(128)</td>
            <td>Hashed password</td>
            <td>Never store plaintext</td>
        </tr>
        <tr>
            <td><code>IsApproved</code></td>
            <td>bit</td>
            <td>Account active</td>
            <td>1=active, 0=disabled</td>
        </tr>
        <tr>
            <td><code>IsLockedOut</code></td>
            <td>bit</td>
            <td>Account locked</td>
            <td>Too many failed attempts</td>
        </tr>
        <tr>
            <td><code>LastActivityDate</code></td>
            <td>datetime</td>
            <td>Last login/activity</td>
            <td>Track user engagement</td>
        </tr>
        <tr>
            <td><code>EmailConfirmed</code></td>
            <td>bit</td>
            <td>Email verified</td>
            <td>Two-factor auth status</td>
        </tr>
    </table>

    <h3>Common User Queries</h3>
    <pre><code>-- Active users with their person information
SELECT TOP 1000
    u.Username,
    p.Name,
    p.EmailAddress,
    u.LastActivityDate,
    DATEDIFF(day, u.LastActivityDate, GETDATE()) as DaysSinceLogin
FROM Users u
JOIN People p ON u.PeopleId = p.PeopleId
WHERE u.IsApproved = 1
  AND u.IsLockedOut = 0
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0
ORDER BY u.LastActivityDate DESC

-- Users by role
SELECT 
    r.RoleName,
    COUNT(ur.UserId) as UserCount
FROM Roles r
LEFT JOIN UserRole ur ON r.RoleId = ur.RoleId
GROUP BY r.RoleId, r.RoleName
ORDER BY UserCount DESC

-- Find users with admin privileges
SELECT 
    u.Username,
    p.Name,
    r.RoleName
FROM Users u
JOIN People p ON u.PeopleId = p.PeopleId
JOIN UserRole ur ON u.UserId = ur.UserId
JOIN Roles r ON ur.RoleId = r.RoleId
WHERE r.RoleName IN ('Admin', 'Administrator', 'Finance', 'Developer')
  AND u.IsApproved = 1
ORDER BY r.RoleName, p.Name</code></pre>

    <h3>Security Best Practices</h3>
    <ul>
        <li>Never query or display password fields</li>
        <li>Always check IsApproved and IsLockedOut status</li>
        <li>Join with People table for complete user information</li>
        <li>Monitor LastActivityDate for inactive accounts</li>
        <li>Use role-based queries for permission checks</li>
    </ul>
</div>

<div id="extra-values-tables" class="section">
    <h2>üéõÔ∏è Extra Value Tables (Custom Fields)</h2>
    
    <div class="info">
        <p><strong>Purpose:</strong> Extra Value tables allow churches to add custom fields without modifying the database schema</p>
    </div>

    <h3>PeopleExtra Table (213K+ records)</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Example Values</th>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Link to People</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Field</code></td>
            <td>nvarchar(50)</td>
            <td>Field name</td>
            <td>'Status', 'LifeStage', 'Interests'</td>
        </tr>
        <tr>
            <td><code>Data</code></td>
            <td>nvarchar(max)</td>
            <td>String value</td>
            <td>Any text data</td>
        </tr>
        <tr>
            <td><code>Date</code></td>
            <td>datetime</td>
            <td>Date value</td>
            <td>For date-type fields</td>
        </tr>
        <tr>
            <td><code>IntValue</code></td>
            <td>int</td>
            <td>Integer value</td>
            <td>For numeric fields</td>
        </tr>
        <tr>
            <td><code>BitValue</code></td>
            <td>bit</td>
            <td>Boolean value</td>
            <td>For yes/no fields</td>
        </tr>
        <tr>
            <td><code>Type</code></td>
            <td>nvarchar(10)</td>
            <td>Data type</td>
            <td>'Text', 'Date', 'Int', 'Bit'</td>
        </tr>
    </table>

    <h3>Common Extra Value Queries</h3>
    <pre><code>-- Get all custom fields for a person
SELECT 
    Field,
    CASE Type
        WHEN 'Text' THEN Data
        WHEN 'Date' THEN CONVERT(nvarchar, Date, 101)
        WHEN 'Int' THEN CAST(IntValue as nvarchar)
        WHEN 'Bit' THEN CASE BitValue WHEN 1 THEN 'Yes' ELSE 'No' END
    END as Value
FROM PeopleExtra
WHERE PeopleId = @PeopleId
ORDER BY Field

-- Find people by custom field value
SELECT TOP 1000
    p.Name,
    pe.Field,
    pe.Data as Value
FROM People p
JOIN PeopleExtra pe ON p.PeopleId = pe.PeopleId
WHERE pe.Field = 'MembershipClass'
  AND pe.Data = 'Completed'
  AND p.IsDeceased = 0 
  AND p.ArchivedFlag = 0

-- Summary of all custom fields in use
SELECT 
    Field,
    Type,
    COUNT(DISTINCT PeopleId) as PeopleCount,
    COUNT(*) as TotalRecords
FROM PeopleExtra
GROUP BY Field, Type
ORDER BY PeopleCount DESC</code></pre>

    <h3>OrganizationExtra & FamilyExtra</h3>
    <p>These tables follow the same structure as PeopleExtra but for Organizations and Families:</p>
    <ul>
        <li><code>OrganizationExtra</code> - Custom fields for organizations/groups</li>
        <li><code>FamilyExtra</code> - Custom fields for family units</li>
        <li><code>MeetingExtra</code> - Custom fields for meetings</li>
    </ul>
</div>

<div id="task-management-tables" class="section">
    <h2>üìù Task Management Tables</h2>
    
    <div class="info">
        <p><strong>Scale:</strong> TaskNote table contains 174K+ records for ministry follow-up and task tracking</p>
    </div>

    <h3>TaskNote Table Structure</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique task identifier</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Task about person</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>OwnerId</code></td>
            <td>int</td>
            <td>Task owner</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>DelegatedId</code></td>
            <td>int</td>
            <td>Delegated to</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>TaskListId</code></td>
            <td>int</td>
            <td>Task category</td>
            <td>‚Üí TaskList.Id</td>
        </tr>
        <tr>
            <td><code>CreatedOn</code></td>
            <td>datetime</td>
            <td>Created date</td>
            <td>Task creation timestamp</td>
        </tr>
        <tr>
            <td><code>Due</code></td>
            <td>datetime</td>
            <td>Due date</td>
            <td>When task should be done</td>
        </tr>
        <tr>
            <td><code>CompletedOn</code></td>
            <td>datetime</td>
            <td>Completion date</td>
            <td>NULL if not complete</td>
        </tr>
        <tr>
            <td><code>Notes</code></td>
            <td>nvarchar(max)</td>
            <td>Task description</td>
            <td>Detailed notes</td>
        </tr>
        <tr>
            <td><code>Priority</code></td>
            <td>int</td>
            <td>Priority level</td>
            <td>1=High, 2=Medium, 3=Low</td>
        </tr>
    </table>

    <h3>Common Task Queries</h3>
    <pre><code>-- Recently created open tasks (more useful than future due dates)
-- ‚ö†Ô∏è NOTE: Most TaskNote records have due dates in the past (162K+ overdue vs 1 future)
-- This query shows recently CREATED tasks regardless of due date
SELECT TOP 500
    owner.Name as Owner,
    about.Name as AboutPerson,
    tn.Notes,
    tn.DueDate,
    tn.CreatedDate,
    CASE 
        WHEN tn.DueDate > GETDATE() THEN DATEDIFF(day, GETDATE(), tn.DueDate)
        ELSE -DATEDIFF(day, tn.DueDate, GETDATE())
    END as DaysFromDue,
    ts.Description as TaskStatus
FROM TaskNote tn
JOIN People owner ON tn.OwnerId = owner.PeopleId
JOIN People about ON tn.AboutPersonId = about.PeopleId
LEFT JOIN lookup.TaskStatus ts ON tn.StatusId = ts.Id
WHERE tn.CompletedDate IS NULL
  AND tn.CreatedDate >= DATEADD(month, -3, GETDATE())  -- Created in last 3 months
ORDER BY tn.CreatedDate DESC

-- Recently overdue tasks (practical date range)
-- Filters to tasks due within last 2 years to avoid ancient tasks
SELECT TOP 100
    owner.Name as Owner,
    about.Name as AboutPerson,
    tn.Notes,
    tn.DueDate,
    DATEDIFF(day, tn.DueDate, GETDATE()) as DaysOverdue
FROM TaskNote tn
JOIN People owner ON tn.OwnerId = owner.PeopleId
JOIN People about ON tn.AboutPersonId = about.PeopleId
WHERE tn.CompletedDate IS NULL
  AND tn.DueDate < GETDATE()
  AND tn.DueDate > DATEADD(year, -2, GETDATE())  -- Due within last 2 years
ORDER BY tn.DueDate DESC

-- Task completion metrics
SELECT 
    YEAR(CreatedDate) as Year,
    MONTH(CreatedDate) as Month,
    COUNT(*) as TasksCreated,
    SUM(CASE WHEN CompletedDate IS NOT NULL THEN 1 ELSE 0 END) as TasksCompleted,
    AVG(DATEDIFF(day, CreatedDate, CompletedDate)) as AvgDaysToComplete
FROM TaskNote
WHERE CreatedDate >= DATEADD(year, -1, GETDATE())
GROUP BY YEAR(CreatedDate), MONTH(CreatedDate)
ORDER BY Year DESC, Month DESC

-- ENHANCED: Top task creators/owners/completers (from TaskNote Activity Dashboard)
-- Shows who is most active in the task system
SELECT TOP 20
    p.Name,
    COUNT(DISTINCT CASE WHEN tn.OwnerId = p.PeopleId THEN tn.TaskNoteId END) AS TasksCreated,
    COUNT(DISTINCT CASE WHEN tn.AssigneeId = p.PeopleId THEN tn.TaskNoteId END) AS TasksAssigned,
    COUNT(DISTINCT CASE WHEN tn.CompletedBy = p.PeopleId THEN tn.TaskNoteId END) AS TasksCompleted,
    COUNT(DISTINCT CASE WHEN tn.OwnerId = p.PeopleId AND tn.IsNote = 1 THEN tn.TaskNoteId END) AS NotesCreated
FROM People p
JOIN TaskNote tn ON p.PeopleId IN (tn.OwnerId, tn.AssigneeId, tn.CompletedBy)
WHERE tn.CreatedDate >= DATEADD(month, -3, GETDATE())
GROUP BY p.PeopleId, p.Name
ORDER BY (COUNT(DISTINCT CASE WHEN tn.OwnerId = p.PeopleId THEN tn.TaskNoteId END) + 
          COUNT(DISTINCT CASE WHEN tn.AssigneeId = p.PeopleId THEN tn.TaskNoteId END) + 
          COUNT(DISTINCT CASE WHEN tn.CompletedBy = p.PeopleId THEN tn.TaskNoteId END)) DESC

-- Overdue tasks by assignee with workload analysis
SELECT 
    p.Name AS Assignee,
    COUNT(*) AS OverdueTasks,
    MIN(tn.DueDate) AS OldestDueDate,
    DATEDIFF(day, MIN(tn.DueDate), GETDATE()) AS MaxDaysOverdue,
    AVG(DATEDIFF(day, tn.DueDate, GETDATE())) AS AvgDaysOverdue
FROM TaskNote tn
JOIN People p ON p.PeopleId = tn.AssigneeId
WHERE tn.DueDate IS NOT NULL
  AND tn.DueDate < GETDATE()
  AND tn.StatusId NOT IN (1, 5)  -- Not completed or archived
  AND tn.IsNote = 0  -- Tasks only, not notes
  AND tn.DueDate > DATEADD(year, -2, GETDATE())  -- Practical date range
GROUP BY p.PeopleId, p.Name
HAVING COUNT(*) > 0
ORDER BY COUNT(*) DESC

-- Task/Note activity trend by month
WITH MonthlyActivity AS (
    SELECT 
        FORMAT(CreatedDate, 'yyyy-MM') AS MonthYear,
        COUNT(CASE WHEN IsNote = 0 THEN 1 END) AS Tasks,
        COUNT(CASE WHEN IsNote = 1 THEN 1 END) AS Notes,
        COUNT(CASE WHEN CompletedDate IS NOT NULL AND IsNote = 0 THEN 1 END) AS TasksCompleted
    FROM TaskNote
    WHERE CreatedDate >= DATEADD(month, -12, GETDATE())
    GROUP BY FORMAT(CreatedDate, 'yyyy-MM')
)
SELECT 
    MonthYear,
    Tasks,
    Notes,
    TasksCompleted,
    CASE 
        WHEN Tasks > 0 THEN CAST(TasksCompleted AS float) / Tasks * 100 
        ELSE 0 
    END AS CompletionRate
FROM MonthlyActivity
ORDER BY MonthYear DESC</code></pre>
</div>

<div id="meeting-tables" class="section">
    <h2>üìÖ Meetings Table Details</h2>
    
    <div class="info">
        <p><strong>Scale:</strong> 61K+ meeting records tracking all gatherings and events</p>
    </div>

    <h3>Meetings Table Structure</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Notes</th>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique meeting identifier</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations.OrganizationId</td>
        </tr>
        <tr>
            <td><code>MeetingDate</code></td>
            <td>datetime</td>
            <td>Meeting date/time</td>
            <td>When meeting occurred</td>
        </tr>
        <tr>
            <td><code>NumPresent</code></td>
            <td>int</td>
            <td>Attendance count</td>
            <td>Total attendees</td>
        </tr>
        <tr>
            <td><code>NumMembers</code></td>
            <td>int</td>
            <td>Members present</td>
            <td>Member attendance</td>
        </tr>
        <tr>
            <td><code>NumGuests</code></td>
            <td>int</td>
            <td>Guests present</td>
            <td>Visitor count</td>
        </tr>
        <tr>
            <td><code>DidNotMeet</code></td>
            <td>bit</td>
            <td>Meeting cancelled</td>
            <td>1=cancelled, 0=occurred</td>
        </tr>
        <tr>
            <td><code>Description</code></td>
            <td>nvarchar(200)</td>
            <td>Meeting description</td>
            <td>Optional notes</td>
        </tr>
        <tr>
            <td><code>AttendCreditId</code></td>
            <td>int</td>
            <td>Attendance credit type</td>
            <td>‚Üí lookup.AttendCredit</td>
        </tr>
    </table>

    <h3>Meeting Queries</h3>
    <pre><code>-- Recent meetings by organization
SELECT TOP 100
    o.OrganizationName,
    m.MeetingDate,
    m.NumPresent,
    m.NumMembers,
    m.NumGuests,
    CASE m.DidNotMeet 
        WHEN 1 THEN 'Cancelled' 
        ELSE 'Occurred' 
    END as Status
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
WHERE m.MeetingDate >= DATEADD(week, -4, GETDATE())
  AND o.OrganizationStatusId = 30
ORDER BY m.MeetingDate DESC

-- Meeting attendance trends
SELECT 
    o.OrganizationName,
    AVG(m.NumPresent) as AvgAttendance,
    MAX(m.NumPresent) as MaxAttendance,
    MIN(m.NumPresent) as MinAttendance,
    COUNT(*) as MeetingCount
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
WHERE m.MeetingDate >= DATEADD(month, -6, GETDATE())
  AND m.DidNotMeet = 0
  AND o.OrganizationStatusId = 30
GROUP BY o.OrganizationId, o.OrganizationName
HAVING COUNT(*) >= 5
ORDER BY AVG(m.NumPresent) DESC</code></pre>
</div>

<div id="division-program-tables" class="section">
    <h2>üèõÔ∏è Program & Division Tables (Organizational Hierarchy)</h2>
    
    <div class="critical">
        <p><strong>Critical Relationship:</strong> Program (top) ‚Üí Division (middle) ‚Üí Organizations (bottom)</p>
        <p>This three-tier hierarchy organizes all groups, classes, and ministries</p>
    </div>

    <h3>Program Table</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Example</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>101</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(50)</td>
            <td>Program name</td>
            <td>'Adult Ministry'</td>
        </tr>
        <tr>
            <td><code>SortOrder</code></td>
            <td>int</td>
            <td>Display order</td>
            <td>1, 2, 3...</td>
        </tr>
        <tr>
            <td><code>IsActive</code></td>
            <td>bit</td>
            <td>Active status</td>
            <td>1=active</td>
        </tr>
    </table>

    <h3>Division Table</h3>
    <table>
        <tr>
            <th>Column</th>
            <th>Type</th>
            <th>Description</th>
            <th>Example</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>201</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(50)</td>
            <td>Division name</td>
            <td>'Small Groups'</td>
        </tr>
        <tr>
            <td><code>ProgId</code></td>
            <td>int</td>
            <td>Parent program</td>
            <td>‚Üí Program.Id</td>
        </tr>
        <tr>
            <td><code>SortOrder</code></td>
            <td>int</td>
            <td>Display order</td>
            <td>1, 2, 3...</td>
        </tr>
    </table>

    <h3>Hierarchy Queries</h3>
    <pre><code>-- Complete organizational structure
SELECT 
    p.Name as Program,
    d.Name as Division,
    o.OrganizationName,
    COUNT(om.PeopleId) as MemberCount
FROM Program p
JOIN Division d ON p.Id = d.ProgId
JOIN Organizations o ON d.Id = o.DivisionId
LEFT JOIN OrganizationMembers om ON o.OrganizationId = om.OrganizationId
    AND om.InactiveDate IS NULL
WHERE o.OrganizationStatusId = 30
GROUP BY p.Id, p.Name, d.Id, d.Name, o.OrganizationId, o.OrganizationName
ORDER BY p.SortOrder, d.SortOrder, o.OrganizationName

-- Programs with most participation
SELECT 
    p.Name as Program,
    COUNT(DISTINCT d.Id) as Divisions,
    COUNT(DISTINCT o.OrganizationId) as Organizations,
    COUNT(DISTINCT om.PeopleId) as TotalPeople
FROM Program p
LEFT JOIN Division d ON p.Id = d.ProgId
LEFT JOIN Organizations o ON d.Id = o.DivisionId
    AND o.OrganizationStatusId = 30
LEFT JOIN OrganizationMembers om ON o.OrganizationId = om.OrganizationId
    AND om.InactiveDate IS NULL
GROUP BY p.Id, p.Name
ORDER BY COUNT(DISTINCT om.PeopleId) DESC</code></pre>
</div>

</body>
</html> Notes</th>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique person identifier</td>
        </tr>
        <tr>
            <td><code>FirstName</code></td>
            <td>nvarchar(25)</td>
            <td>First name</td>
            <td>Legal first name</td>
        </tr>
        <tr>
            <td><code>LastName</code></td>
            <td>nvarchar(100)</td>
            <td>Last name</td>
            <td>Family name</td>
        </tr>
        <tr>
            <td><code>NickName</code></td>
            <td>nvarchar(25)</td>
            <td>Preferred name</td>
            <td>May override FirstName in displays</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(139)</td>
            <td>Full name (computed)</td>
            <td>‚úÖ USE FOR DISPLAY</td>
        </tr>
        <tr>
            <td><code>Name2</code></td>
            <td>nvarchar(139)</td>
            <td>Last, First format</td>
            <td>‚úÖ USE FOR SORTING</td>
        </tr>
        <tr>
            <td><code>AltName</code></td>
            <td>nvarchar(100)</td>
            <td>Alternative name</td>
            <td>Used for search optimization</td>
        </tr>
    </table>

    <h3>Demographics</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BirthDay</code></td>
            <td>int</td>
            <td>Day of birth</td>
            <td>1-31</td>
        </tr>
        <tr>
            <td><code>BirthMonth</code></td>
            <td>int</td>
            <td>Month of birth</td>
            <td>1-12</td>
        </tr>
        <tr>
            <td><code>BirthYear</code></td>
            <td>int</td>
            <td>Year of birth</td>
            <td>4-digit year</td>
        </tr>
        <tr>
            <td><code>BDate</code></td>
            <td>datetime</td>
            <td>Full birth date</td>
            <td>‚ö†Ô∏è Includes time, cast to date</td>
        </tr>
        <tr>
            <td><code>Age</code></td>
            <td>int</td>
            <td>Current age</td>
            <td>Computed, updated regularly</td>
        </tr>
        <tr>
            <td><code>GenderId</code></td>
            <td>int</td>
            <td>Gender</td>
            <td>‚Üí lookup.Gender (1=Male, 2=Female)</td>
        </tr>
        <tr>
            <td><code>MaritalStatusId</code></td>
            <td>int</td>
            <td>Marital status</td>
            <td>‚Üí lookup.MaritalStatus</td>
        </tr>
    </table>

    <h3>Family Relationships</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Family grouping</td>
            <td>‚Üí Families.FamilyId</td>
        </tr>
        <tr>
            <td><code>SpouseId</code></td>
            <td>int</td>
            <td>Spouse link</td>
            <td>‚Üí People.PeopleId (direct link)</td>
        </tr>
        <tr>
            <td><code>PositionInFamilyId</code></td>
            <td>int</td>
            <td>Family position</td>
            <td>‚Üí lookup.FamilyPosition</td>
        </tr>
    </table>

    <h3>Contact Information</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>EmailAddress</code></td>
            <td>nvarchar(150)</td>
            <td>Primary email</td>
            <td>Main contact email</td>
        </tr>
        <tr>
            <td><code>EmailAddress2</code></td>
            <td>nvarchar(150)</td>
            <td>Secondary email</td>
            <td>Alternative email</td>
        </tr>
        <tr>
            <td><code>SendEmailAddress1</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Email permission 1</td>
            <td>Check before emailing</td>
        </tr>
        <tr>
            <td><code>SendEmailAddress2</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Email permission 2</td>
            <td>Check before emailing</td>
        </tr>
        <tr>
            <td><code>CellPhone</code></td>
            <td>nvarchar(20)</td>
            <td>Cell phone</td>
            <td>Formatted number</td>
        </tr>
        <tr>
            <td><code>HomePhone</code></td>
            <td>nvarchar(20)</td>
            <td>Home phone</td>
            <td>10 digits</td>
        </tr>
        <tr>
            <td><code>WorkPhone</code></td>
            <td>nvarchar(20)</td>
            <td>Work phone</td>
            <td>Business number</td>
        </tr>
        <tr>
            <td><code>CellPhoneValidated</code></td>
            <td>bit</td>
            <td>Phone verified</td>
            <td>Verification status</td>
        </tr>
        <tr>
            <td><code>CellPhoneIsValid</code></td>
            <td>bit</td>
            <td>Phone working</td>
            <td>Active number check</td>
        </tr>
        <tr>
            <td><code>ReceiveSMS</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>SMS permission</td>
            <td>Check before texting</td>
        </tr>
    </table>

    <h3>Address Information</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>PrimaryAddress</code></td>
            <td>nvarchar(100)</td>
            <td>Street address</td>
            <td>‚úÖ Use for mailings</td>
        </tr>
        <tr>
            <td><code>PrimaryAddress2</code></td>
            <td>nvarchar(100)</td>
            <td>Apt/Suite</td>
            <td>Secondary line</td>
        </tr>
        <tr>
            <td><code>PrimaryCity</code></td>
            <td>nvarchar(30)</td>
            <td>City</td>
            <td>Primary city</td>
        </tr>
        <tr>
            <td><code>PrimaryState</code></td>
            <td>nvarchar(20)</td>
            <td>State</td>
            <td>State abbreviation</td>
        </tr>
        <tr>
            <td><code>PrimaryZip</code></td>
            <td>nvarchar(15)</td>
            <td>ZIP code</td>
            <td>Postal code</td>
        </tr>
        <tr>
            <td><code>PrimaryCountry</code></td>
            <td>nvarchar(40)</td>
            <td>Country</td>
            <td>Country name</td>
        </tr>
        <tr>
            <td><code>PrimaryBadAddrFlag</code></td>
            <td>bit</td>
            <td>Invalid address</td>
            <td>Filter bad addresses</td>
        </tr>
    </table>

    <h3>Church Membership</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MemberStatusId</code> <span class="badge badge-critical">Critical</span></td>
            <td>int</td>
            <td>Member status</td>
            <td>‚Üí lookup.MemberStatus</td>
        </tr>
        <tr>
            <td><code>JoinDate</code></td>
            <td>datetime</td>
            <td>Joined church</td>
            <td>Membership start</td>
        </tr>
        <tr>
            <td><code>DropDate</code></td>
            <td>datetime</td>
            <td>Left church</td>
            <td>Membership end</td>
        </tr>
        <tr>
            <td><code>DropCodeId</code></td>
            <td>int</td>
            <td>Reason left</td>
            <td>‚Üí lookup.DropType</td>
        </tr>
        <tr>
            <td><code>BaptismDate</code></td>
            <td>datetime</td>
            <td>Baptized date</td>
            <td>Baptism completion</td>
        </tr>
        <tr>
            <td><code>BaptismStatusId</code></td>
            <td>int</td>
            <td>Baptism status</td>
            <td>‚Üí lookup.BaptismStatus</td>
        </tr>
        <tr>
            <td><code>DecisionDate</code></td>
            <td>datetime</td>
            <td>Salvation date</td>
            <td>Faith decision</td>
        </tr>
        <tr>
            <td><code>NewMemberClassDate</code></td>
            <td>datetime</td>
            <td>Class completion</td>
            <td>New member training</td>
        </tr>
    </table>

    <h3>Communication Preferences</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>DoNotMailFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No postal mail</td>
            <td>Filter marketing</td>
        </tr>
        <tr>
            <td><code>DoNotCallFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No phone calls</td>
            <td>Filter campaigns</td>
        </tr>
        <tr>
            <td><code>DoNotVisitFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>No visits</td>
            <td>Filter assignments</td>
        </tr>
        <tr>
            <td><code>DoNotPublishPhones</code></td>
            <td>bit</td>
            <td>Directory privacy</td>
            <td>Hide from directory</td>
        </tr>
        <tr>
            <td><code>ElectronicStatement</code></td>
            <td>bit</td>
            <td>Email statements</td>
            <td>Prefers electronic</td>
        </tr>
    </table>

    <h3>System & Status Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>IsDeceased</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Person deceased</td>
            <td>ALWAYS filter = 0</td>
        </tr>
        <tr>
            <td><code>ArchivedFlag</code> <span class="badge badge-critical">Critical</span></td>
            <td>bit</td>
            <td>Record archived</td>
            <td>ALWAYS filter = 0</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Record created</td>
            <td>Creation timestamp</td>
        </tr>
        <tr>
            <td><code>CreatedBy</code></td>
            <td>int</td>
            <td>Created by</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>ModifiedDate</code></td>
            <td>datetime</td>
            <td>Last modified</td>
            <td>Update timestamp</td>
        </tr>
        <tr>
            <td><code>ModifiedBy</code></td>
            <td>int</td>
            <td>Modified by</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>CampusId</code></td>
            <td>int</td>
            <td>Campus</td>
            <td>‚Üí lookup.Campus</td>
        </tr>
    </table>

    <h3>Mobile & Check-in</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BlockMobileAccess</code></td>
            <td>bit</td>
            <td>Block mobile app</td>
            <td>Security restriction</td>
        </tr>
        <tr>
            <td><code>BarcodeId</code></td>
            <td>bigint</td>
            <td>Check-in barcode</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>BarcodeExpires</code></td>
            <td>datetime</td>
            <td>Barcode expiration</td>
            <td>Security timeout</td>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Profile photo</td>
            <td>‚Üí Picture.PictureId</td>
        </tr>
    </table>
</div>

<div id="family-structure" class="section">
    <h2>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Relationships & Household Management</h2>
    
    <h3>Understanding TouchPoint's Family Model</h3>
    <div class="highlight">
        <p><strong>TouchPoint uses dual relationship tracking:</strong></p>
        <ul>
            <li><strong>FamilyId:</strong> Groups all household members together</li>
            <li><strong>SpouseId:</strong> Direct link between married couples (more reliable than family grouping)</li>
            <li><strong>PositionInFamilyId:</strong> Defines role within household (10=Primary Adult for both spouses, 20=Secondary/Other Adult, 30=Child)</li>
        </ul>
    </div>

    <h3>Family Structure Query</h3>
    <pre><code>-- Complete family units with all members
-- Note: Both spouses are Primary Adults (10), distinguished by HeadOfHouseholdId/HeadOfHouseholdSpouseId
WITH FamilyStructure AS (
    SELECT TOP 500
        f.FamilyId,
        hoh.Name as HeadOfHousehold,
        spouse.Name as Spouse,
        STRING_AGG(CASE WHEN p.PositionInFamilyId = 30 THEN p.Name END, ', ') as Children,
        STRING_AGG(CASE WHEN p.PositionInFamilyId = 20 THEN p.Name END, ', ') as OtherAdults,
        COUNT(DISTINCT p.PeopleId) as FamilySize,
        COUNT(DISTINCT CASE WHEN p.PositionInFamilyId = 30 THEN p.PeopleId END) as NumChildren
    FROM Families f
    LEFT JOIN People hoh ON f.HeadOfHouseholdId = hoh.PeopleId
        AND hoh.IsDeceased = 0
    LEFT JOIN People spouse ON f.HeadOfHouseholdSpouseId = spouse.PeopleId
        AND spouse.IsDeceased = 0
    LEFT JOIN People p ON f.FamilyId = p.FamilyId
        AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
    GROUP BY f.FamilyId, hoh.Name, spouse.Name
)
SELECT 
    FamilyId,
    HeadOfHousehold,
    Spouse,
    Children,
    OtherAdults,
    FamilySize,
    NumChildren
FROM FamilyStructure
WHERE FamilySize > 1  -- Multi-person families only
ORDER BY FamilySize DESC, NumChildren DESC</code></pre>

    <h3>Spouse Relationships</h3>
    <pre><code>-- Direct spouse relationships (most reliable)
SELECT 
    p1.PeopleId as Person1Id,
    p1.Name as Person1,
    p2.PeopleId as Person2Id,
    p2.Name as Person2,
    p1.WeddingDate,
    DATEDIFF(year, p1.WeddingDate, GETDATE()) as YearsMarried
FROM People p1
JOIN People p2 ON p1.SpouseId = p2.PeopleId
WHERE p1.IsDeceased = 0 AND p1.ArchivedFlag = 0
  AND p2.IsDeceased = 0 AND p2.ArchivedFlag = 0
  AND p1.PeopleId < p2.PeopleId  -- Avoid duplicates
ORDER BY p1.Name</code></pre>

    <h3>Children and Parents</h3>
    
    <div class="info">
        <p><strong>‚ö†Ô∏è Important for Email Communications:</strong> When emailing "parents," TouchPoint targets Primary Adults (PositionInFamilyId = 10). 
        Since BOTH spouses are Primary Adults, both will receive emails. If someone is incorrectly marked as Secondary Adult (20) instead of Primary Adult, 
        they will NOT receive parent communications. Secondary Adult should only be used for non-nuclear family members like grandparents living with the family.</p>
    </div>
    
    <pre><code>-- Find all children with their parents
-- IMPORTANT: Both parents are Primary Adults (10), distinguished by HeadOfHouseholdId/HeadOfHouseholdSpouseId
-- Secondary Adult (20) is for non-nuclear family members (grandparents, adult siblings living with family)
SELECT TOP 500
    child.Name as ChildName,
    child.Age,
    primary_adult.Name as Parent1,
    secondary_adult.Name as Parent2,
    f.FamilyId
FROM People child
JOIN Families f ON child.FamilyId = f.FamilyId
LEFT JOIN People primary_adult ON primary_adult.PeopleId = f.HeadOfHouseholdId
    AND primary_adult.IsDeceased = 0 
LEFT JOIN People secondary_adult ON secondary_adult.PeopleId = f.HeadOfHouseholdSpouseId
    AND secondary_adult.IsDeceased = 0 
WHERE child.PositionInFamilyId = 30  -- Child
  AND child.Age < 18
  AND child.IsDeceased = 0 AND child.ArchivedFlag = 0
ORDER BY child.Age DESC, child.Name</code></pre>
</div>

<div id="contact-permissions" class="section">
    <h2>üìû Contact Information & Communication Permissions</h2>
    
    <div class="critical">
        <h3>‚ö†Ô∏è Critical: Always Check Permissions Before Communication</h3>
        <p>TouchPoint tracks detailed communication preferences. <strong>Violating these preferences can result in complaints and legal issues.</strong></p>
    </div>

    <h3>Safe Email List</h3>
    <pre><code>-- People who CAN receive emails
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.EmailAddress,
    p.EmailAddress2,
    CASE 
        WHEN p.SendEmailAddress1 = 1 AND p.EmailAddress IS NOT NULL THEN p.EmailAddress
        WHEN p.SendEmailAddress2 = 1 AND p.EmailAddress2 IS NOT NULL THEN p.EmailAddress2
        ELSE NULL
    END as PreferredEmail
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotMailFlag = 0  -- General mail permission
  AND (
    (p.SendEmailAddress1 = 1 AND p.EmailAddress IS NOT NULL AND p.EmailAddress != '')
    OR 
    (p.SendEmailAddress2 = 1 AND p.EmailAddress2 IS NOT NULL AND p.EmailAddress2 != '')
  )
  AND p.PrimaryBadAddrFlag = 0  -- Good address on file
ORDER BY p.Name</code></pre>

    <h3>Safe Text/SMS List</h3>
    <pre><code>-- People who CAN receive text messages
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.CellPhone,
    p.CellPhoneValidated,
    p.CellPhoneIsValid
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotCallFlag = 0      -- Can call/text
  AND p.ReceiveSMS = 1         -- SMS specifically allowed
  AND p.CellPhoneIsValid = 1   -- Valid phone number
  AND p.CellPhone IS NOT NULL AND p.CellPhone != ''
ORDER BY p.Name</code></pre>

    <h3>Safe Mailing List</h3>
    <pre><code>-- People who CAN receive postal mail
SELECT TOP 1000
    p.PeopleId,
    p.Name,
    p.PrimaryAddress,
    p.PrimaryAddress2,
    p.PrimaryCity,
    p.PrimaryState,
    p.PrimaryZip
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.DoNotMailFlag = 0        -- Mail allowed
  AND p.PrimaryBadAddrFlag = 0   -- Valid address
  AND p.PrimaryAddress IS NOT NULL AND p.PrimaryAddress != ''
ORDER BY p.PrimaryZip, p.Name</code></pre>

    <h3>Visitation List</h3>
    <pre><code>-- People who CAN be visited
  SELECT TOP 1000
      p.PeopleId,
      p.Name,
      p.PrimaryAddress,
      p.PrimaryCity,
      p.CellPhone,
      rc.Description as ResidentCode
  FROM People p
  LEFT JOIN lookup.ResidentCode rc ON p.ResCodeId = rc.Id
  WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
    AND p.DoNotVisitFlag = 0       -- Visits allowed
    AND p.PrimaryBadAddrFlag = 0   -- Valid address
    AND p.ResCodeId IN (10, 20)    -- Metro or Marginal (close enough to visit)
  ORDER BY p.PrimaryCity, p.Name</code></pre>
</div>

<div id="membership-workflow" class="section">
    <h2>üèõÔ∏è Church Membership Status & Workflow</h2>
    
    <h3>Membership Status Values</h3>
    <table>
        <tr>
            <th>Id</th>
            <th>Status</th>
            <th>Description</th>
            <th>Typical Use</th>
        </tr>
        <tr>
            <td>10</td>
            <td>Member</td>
            <td>Full church member</td>
            <td>Voting, leadership eligible</td>
        </tr>
        <tr>
            <td>20</td>
            <td>Prospect</td>
            <td>Potential member</td>
            <td>Follow-up, engagement tracking</td>
        </tr>
        <tr>
            <td>30</td>
            <td>Not Member</td>
            <td>Regular attender</td>
            <td>Non-member participant</td>
        </tr>
        <tr>
            <td>40</td>
            <td>Previous Member</td>
            <td>Former member</td>
            <td>Different communication approach</td>
        </tr>
        <tr>
            <td>50</td>
            <td>Just Added</td>
            <td>New record</td>
            <td>Needs data validation</td>
        </tr>
    </table>

    <h3>Membership Journey Tracking</h3>
    <pre><code>-- Complete membership journey analysis
SELECT TOP 500
    p.PeopleId,
    p.Name,
    ms.Description as CurrentStatus,
    
    -- Key Dates
    p.CreatedDate as FirstRecorded,
    p.DecisionDate,
    p.BaptismDate,
    p.NewMemberClassDate,
    p.JoinDate,
    p.DropDate,
    
    -- Status Details
    dt.Description as DecisionType,
    bs.Description as BaptismStatus,
    nmcs.Description as NewMemberClassStatus,
    drop_type.Description as DropReason,
    
    -- Journey Metrics
    DATEDIFF(day, p.CreatedDate, p.JoinDate) as DaysToMembership,
    DATEDIFF(day, p.DecisionDate, p.BaptismDate) as DaysToBaptism,
    CASE 
        WHEN p.DropDate IS NOT NULL THEN 'Inactive'
        WHEN p.JoinDate IS NOT NULL THEN 'Member'
        WHEN p.BaptismDate IS NOT NULL THEN 'Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN 'Decided'
        ELSE 'Exploring'
    END as JourneyStage
    
FROM People p
LEFT JOIN lookup.MemberStatus ms ON p.MemberStatusId = ms.Id
LEFT JOIN lookup.DecisionType dt ON p.DecisionTypeId = dt.Id
LEFT JOIN lookup.BaptismStatus bs ON p.BaptismStatusId = bs.Id
LEFT JOIN lookup.NewMemberClassStatus nmcs ON p.NewMemberClassStatusId = nmcs.Id
LEFT JOIN lookup.DropType drop_type ON p.DropCodeId = drop_type.Id
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.JoinDate DESC</code></pre>

    <h3>New Member Pipeline</h3>
    <pre><code>-- Track new member pipeline
SELECT TOP 500
    CASE 
        WHEN p.JoinDate IS NOT NULL THEN '5. Member'
        WHEN p.NewMemberClassDate IS NOT NULL THEN '4. Class Complete'
        WHEN p.BaptismDate IS NOT NULL THEN '3. Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN '2. Decision Made'
        WHEN p.MemberStatusId = 20 THEN '1. Prospect'
        ELSE '0. Visitor'
    END as Stage,
    COUNT(*) as PeopleCount,
    AVG(DATEDIFF(day, p.CreatedDate, GETDATE())) as AvgDaysInStage
FROM People p
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
  AND p.CreatedDate >= DATEADD(year, -1, GETDATE())
  AND p.MemberStatusId IN (20, 50)  -- Prospects and Just Added
GROUP BY 
    CASE 
        WHEN p.JoinDate IS NOT NULL THEN '5. Member'
        WHEN p.NewMemberClassDate IS NOT NULL THEN '4. Class Complete'
        WHEN p.BaptismDate IS NOT NULL THEN '3. Baptized'
        WHEN p.DecisionDate IS NOT NULL THEN '2. Decision Made'
        WHEN p.MemberStatusId = 20 THEN '1. Prospect'
        ELSE '0. Visitor'
    END
ORDER BY Stage</code></pre>
</div>

<div id="organizations-table" class="section">
    <h2>üèõÔ∏è Organizations Table (Involvements)</h2>
    
    <p><strong>Purpose:</strong> Groups, classes, ministries, events (called "Involvements" in UI)<br>
    <strong>Primary Key:</strong> <code>OrganizationId</code><br>
    <strong>Scale:</strong> 188 columns with 16 foreign key relationships<br>
    <strong>Hierarchy:</strong> Program ‚Üí Division ‚Üí Organization</p>

    <div class="info">
        <p><strong>Note:</strong> Organizations are called "Involvements" in the TouchPoint user interface</p>
    </div>

    <h3>Core Organization Fields</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique identifier</td>
        </tr>
        <tr>
            <td><code>OrganizationName</code></td>
            <td>nvarchar(100)</td>
            <td>Display name</td>
            <td>Public name</td>
        </tr>
        <tr>
            <td><code>Description</code></td>
            <td>ntext</td>
            <td>Detailed description</td>
            <td>Full text description</td>
        </tr>
        <tr>
            <td><code>OrganizationStatusId</code> <span class="badge badge-critical">Critical</span></td>
            <td>int</td>
            <td>Status</td>
            <td>30 = Active (not 1!)</td>
        </tr>
        <tr>
            <td><code>OrganizationTypeId</code></td>
            <td>int</td>
            <td>Type</td>
            <td>‚Üí lookup.OrganizationType</td>
        </tr>
        <tr>
            <td><code>DivisionId</code></td>
            <td>int</td>
            <td>Division</td>
            <td>‚Üí Division.Id</td>
        </tr>
        <tr>
            <td><code>CampusId</code></td>
            <td>int</td>
            <td>Campus</td>
            <td>‚Üí lookup.Campus</td>
        </tr>
    </table>

    <h3>Leadership & Management</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>LeaderId</code></td>
            <td>int</td>
            <td>Primary leader</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>LeaderName</code></td>
            <td>nvarchar(50)</td>
            <td>Leader name</td>
            <td>Computed field</td>
        </tr>
        <tr>
            <td><code>MainLeaderId</code></td>
            <td>int</td>
            <td>Main leader</td>
            <td>If different from Leader</td>
        </tr>
        <tr>
            <td><code>LeaderMemberTypeId</code></td>
            <td>int</td>
            <td>Leader role</td>
            <td>‚Üí lookup.MemberType</td>
        </tr>
    </table>

    <h3>Membership & Capacity</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MemberCount</code></td>
            <td>int</td>
            <td>Current members</td>
            <td>Auto-updated</td>
        </tr>
        <tr>
            <td><code>PrevMemberCount</code></td>
            <td>int</td>
            <td>Previous count</td>
            <td>Historical tracking</td>
        </tr>
        <tr>
            <td><code>ProspectCount</code></td>
            <td>int</td>
            <td>Prospects</td>
            <td>Potential members</td>
        </tr>
        <tr>
            <td><code>Limit</code></td>
            <td>int</td>
            <td>Max capacity</td>
            <td>Room/resource limit</td>
        </tr>
        <tr>
            <td><code>ClassFilled</code></td>
            <td>bit</td>
            <td>At capacity</td>
            <td>Registration closed</td>
        </tr>
    </table>

    <h3>Registration System Fields <span class="badge badge-new">Important</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegistrationTypeId</code></td>
            <td>int</td>
            <td>Registration type</td>
            <td>0=none, others=form types</td>
        </tr>
        <tr>
            <td><code>RegStart</code></td>
            <td>datetime</td>
            <td>Registration opens</td>
            <td>Start accepting signups</td>
        </tr>
        <tr>
            <td><code>RegEnd</code></td>
            <td>datetime</td>
            <td>Registration closes</td>
            <td>Stop accepting signups</td>
        </tr>
        <tr>
            <td><code>RegLimit</code></td>
            <td>int</td>
            <td>Registration limit</td>
            <td>Max registrations</td>
        </tr>
        <tr>
            <td><code>RegistrationClosed</code></td>
            <td>bit</td>
            <td>Manually closed</td>
            <td>Override dates</td>
        </tr>
        <tr>
            <td><code>RegFeePerPerson</code></td>
            <td>money</td>
            <td>Fee amount</td>
            <td>Cost per person</td>
        </tr>
        <tr>
            <td><code>RegFeeType</code></td>
            <td>int</td>
            <td>Fee type</td>
            <td>‚Üí lookup.ContributionType</td>
        </tr>
        <tr>
            <td><code>RegDepositAmount</code></td>
            <td>money</td>
            <td>Deposit required</td>
            <td>Upfront payment</td>
        </tr>
        <tr>
            <td><code>RegFundId</code></td>
            <td>int</td>
            <td>Payment fund</td>
            <td>‚Üí ContributionFund</td>
        </tr>
    </table>

    <h3>Check-In System Fields <span class="badge badge-new">Important</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>CanSelfCheckin</code></td>
            <td>bit</td>
            <td>Allow self check-in</td>
            <td>Kiosk enabled</td>
        </tr>
        <tr>
            <td><code>NumCheckInLabels</code></td>
            <td>int</td>
            <td>Labels per person</td>
            <td>Print count</td>
        </tr>
        <tr>
            <td><code>NumWorkerCheckInLabels</code></td>
            <td>int</td>
            <td>Worker labels</td>
            <td>Volunteer labels</td>
        </tr>
        <tr>
            <td><code>ShowOnlyRegisteredAtCheckIn</code></td>
            <td>bit</td>
            <td>Restrict check-in</td>
            <td>Members only</td>
        </tr>
        <tr>
            <td><code>AllowNonCampusCheckIn</code></td>
            <td>bit</td>
            <td>Cross-campus</td>
            <td>Other locations OK</td>
        </tr>
        <tr>
            <td><code>SuspendCheckin</code></td>
            <td>bit</td>
            <td>Disable check-in</td>
            <td>Temporary hold</td>
        </tr>
        <tr>
            <td><code>EarlyCheckin</code></td>
            <td>int</td>
            <td>Minutes early</td>
            <td>Before meeting time</td>
        </tr>
        <tr>
            <td><code>LateCheckin</code></td>
            <td>int</td>
            <td>Minutes late</td>
            <td>After meeting time</td>
        </tr>
    </table>

    <h3>Mobile App Integration <span class="badge badge-new">New</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>AllowMobileView</code></td>
            <td>bit</td>
            <td>Show in app</td>
            <td>Mobile visibility</td>
        </tr>
        <tr>
            <td><code>ShowInSites</code></td>
            <td>bit</td>
            <td>Show in sites</td>
            <td>Web visibility</td>
        </tr>
        <tr>
            <td><code>RecommendInMobile</code></td>
            <td>bit</td>
            <td>Recommend</td>
            <td>Featured in app</td>
        </tr>
        <tr>
            <td><code>CategoryMobileId</code></td>
            <td>int</td>
            <td>Mobile category</td>
            <td>App organization</td>
        </tr>
    </table>

    <h3>Mission Trips <span class="badge badge-new">Special</span></h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>IsMissionTrip</code></td>
            <td>bit</td>
            <td>Mission trip flag</td>
            <td>Special handling</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesEnable</code></td>
            <td>bit</td>
            <td>Funding pages</td>
            <td>Fundraising enabled</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesPublic</code></td>
            <td>bit</td>
            <td>Public funding</td>
            <td>External visibility</td>
        </tr>
        <tr>
            <td><code>TripFundingPagesShowAmounts</code></td>
            <td>bit</td>
            <td>Show amounts</td>
            <td>Display progress</td>
        </tr>
    </table>
</div>

<div id="organization-members" class="section">
    <h2>üë• Organization Membership & Roles</h2>
    
    <p><strong>Purpose:</strong> Links people to organizations with specific roles<br>
    <strong>Composite Key:</strong> <code>OrganizationId + PeopleId</code><br>
    <strong>Critical Rule:</strong> Use <code>InactiveDate IS NULL</code> for current members</p>

    <h3>OrganizationMembers Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>MemberTypeId</code></td>
            <td>int</td>
            <td>Role in org</td>
            <td>‚Üí lookup.MemberType</td>
        </tr>
        <tr>
            <td><code>EnrollmentDate</code></td>
            <td>datetime</td>
            <td>Joined date</td>
            <td>When enrolled</td>
        </tr>
        <tr>
            <td><code>InactiveDate</code></td>
            <td>datetime</td>
            <td>Left date</td>
            <td>NULL = active</td>
        </tr>
        <tr>
            <td><code>LastAttended</code></td>
            <td>datetime</td>
            <td>Last attendance</td>
            <td>Most recent</td>
        </tr>
        <tr>
            <td><code>AttendPct</code></td>
            <td>decimal</td>
            <td>Attendance %</td>
            <td>Engagement metric</td>
        </tr>
        <tr>
            <td><code>Pending</code></td>
            <td>bit</td>
            <td>Pending approval</td>
            <td>Awaiting confirmation</td>
        </tr>
        <tr>
            <td><code>Hidden</code></td>
            <td>bit</td>
            <td>Hide from lists</td>
            <td>Privacy setting</td>
        </tr>
    </table>

    <h3>Organization Roster Query</h3>
    <pre><code>-- Complete organization roster with roles
SELECT TOP 500
    o.OrganizationName,
    p.Name,
    mt.Description as Role,
    at.Description as RoleCategory,
    om.EnrollmentDate,
    om.LastAttended,
    om.AttendPct,
    CASE 
        WHEN at.Worker = 1 THEN 'Worker'
        WHEN at.Guest = 1 THEN 'Guest'
        ELSE 'Member'
    END as PersonType
FROM OrganizationMembers om
JOIN People p ON om.PeopleId = p.PeopleId
JOIN Organizations o ON om.OrganizationId = o.OrganizationId
JOIN lookup.MemberType mt ON om.MemberTypeId = mt.Id
JOIN lookup.AttendType at ON mt.AttendanceTypeId = at.Id
WHERE om.InactiveDate IS NULL  -- Current members only
  AND o.OrganizationStatusId = 30  -- Active orgs
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY o.OrganizationName, at.Worker DESC, p.Name</code></pre>

    <h3>Leadership Analysis</h3>
    <pre><code>  -- Find all leaders across organizations
  SELECT TOP 500
      p.Name as LeaderName,
      STRING_AGG(o.OrganizationName, ', ') as Organizations,
      COUNT(*) as LeadershipRoles
  FROM OrganizationMembers om
  JOIN People p ON om.PeopleId = p.PeopleId
  JOIN Organizations o ON om.OrganizationId = o.OrganizationId
  JOIN lookup.MemberType mt ON om.MemberTypeId = mt.Id
  WHERE om.InactiveDate IS NULL
    AND mt.AttendanceTypeId = 10  -- Leaders (not volunteers)
    AND o.OrganizationStatusId = 30
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name
  HAVING COUNT(*) > 1  -- Leading multiple orgs
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="program-hierarchy" class="section">
    <h2>üìä Program ‚Üí Division ‚Üí Organization Structure</h2>
    
    <div class="highlight">
        <h3>Three-Level Hierarchy</h3>
        <ul>
            <li><strong>Program:</strong> Top level (e.g., "Adult Ministry", "Children's Ministry")</li>
            <li><strong>Division:</strong> Second level (e.g., "Small Groups", "Sunday School")</li>
            <li><strong>Organization:</strong> Third level - actual groups/classes (e.g., "Men's Bible Study")</li>
        </ul>
    </div>

    <h3>Organization Structure View</h3>
    <pre><code>-- Complete organizational hierarchy
SELECT TOP 500
    Program,        -- Top level
    Division,       -- Second level
    Organization,   -- Third level (actual group)
    OrgStatus,
    Members,
    Previous,
    Vistors,
    Meetings,
    ProgId,         -- Program ID for joins
    DivId,          -- Division ID for joins
    OrgId           -- Organization ID for joins
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
ORDER BY Program, Division, Organization</code></pre>

    <h3>Program Summary</h3>
    <pre><code>-- Program-level statistics
SELECT TOP 500
    Program,
    COUNT(DISTINCT DivId) as Divisions,
    COUNT(DISTINCT OrgId) as Organizations,
    SUM(Members) as TotalMembers,
    SUM(Vistors) as TotalVisitors,
    SUM(Meetings) as TotalMeetings
FROM OrganizationStructure
WHERE OrgStatus = 'Active'
GROUP BY Program, ProgId
ORDER BY SUM(Members) DESC</code></pre>

    <h3>Division Analysis</h3>
    <pre><code>-- Division-level breakdown
SELECT TOP 500
    Program,
    Division,
    COUNT(OrgId) as OrgCount,
    SUM(Members) as TotalMembers,
    AVG(Members) as AvgOrgSize,
    MAX(Members) as LargestOrg,
    SUM(CASE WHEN Members >= Limit AND Limit > 0 THEN 1 ELSE 0 END) as AtCapacity
FROM OrganizationStructure os
JOIN Organizations o ON os.OrgId = o.OrganizationId
WHERE os.OrgStatus = 'Active'
GROUP BY Program, Division, DivId
ORDER BY Program, Division</code></pre>
</div>

<div id="attend-table" class="section">
    <h2>üìÖ Attend Table - The AttendanceFlag Rule</h2>
    
    <div class="critical">
        <h3>üö® CRITICAL RULE: AttendanceFlag = 1</h3>
        <p><strong>AttendanceFlag = 1</strong> means the person attended<br>
        <strong>AttendanceFlag = 0</strong> means the person was absent<br>
        <strong>ALWAYS filter WHERE AttendanceFlag = 1 for attendance counts</strong></p>
    </div>

    <h3>Attend Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>AttendId</code></td>
            <td>bigint</td>
            <td>Primary key</td>
            <td>Unique record ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Meeting</td>
            <td>‚Üí Meetings</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingDate</code></td>
            <td>datetime</td>
            <td>Meeting date/time</td>
            <td>When it occurred</td>
        </tr>
        <tr>
            <td><code>AttendanceFlag</code> <span class="badge badge-critical">CRITICAL</span></td>
            <td>bit</td>
            <td>Present/Absent</td>
            <td>1=present, 0=absent</td>
        </tr>
        <tr>
            <td><code>AttendanceTypeId</code></td>
            <td>int</td>
            <td>Attendance type</td>
            <td>‚Üí lookup.AttendType</td>
        </tr>
        <tr>
            <td><code>MemberTypeId</code></td>
            <td>int</td>
            <td>Detailed role</td>
            <td>‚Üí lookup.MemberType</td>
        </tr>
        <tr>
            <td><code>NoShow</code></td>
            <td>bit</td>
            <td>No-show flag</td>
            <td>Registered but absent</td>
        </tr>
        <tr>
            <td><code>SubGroupName</code></td>
            <td>nvarchar</td>
            <td>Sub-group</td>
            <td>Group within org</td>
        </tr>
        <tr>
            <td><code>Commitment</code></td>
            <td>int</td>
            <td>RSVP status</td>
            <td>99/NULL=uncommitted, 0=regrets, 1=attending</td>
        </tr>
    </table>

    <h3>Basic Attendance Query</h3>
    <pre><code>-- Attendance records with full details
SELECT TOP 500
    p.Name,
    o.OrganizationName,
    m.MeetingDate,
    m.Location,
    at.Description as AttendanceType,
    mt.Description as SpecificRole,
    a.SubGroupName,
    CASE a.Commitment
        WHEN 1 THEN 'Attending'
        WHEN 0 THEN 'Regrets'
        WHEN 2 THEN 'Find Sub'
        WHEN 3 THEN 'Sub Found'
        ELSE 'Uncommitted'
    END as CommitmentStatus
FROM Attend a
JOIN People p ON a.PeopleId = p.PeopleId
JOIN Organizations o ON a.OrganizationId = o.OrganizationId
JOIN Meetings m ON a.MeetingId = m.MeetingId
JOIN lookup.AttendType at ON a.AttendanceTypeId = at.Id
JOIN lookup.MemberType mt ON a.MemberTypeId = mt.Id
WHERE a.AttendanceFlag = 1  -- CRITICAL: Only actual attendance
  AND m.MeetingDate >= DATEADD(month, -1, GETDATE())
  AND m.DidNotMeet = 0  -- Meeting actually happened
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY m.MeetingDate DESC, o.OrganizationName, p.Name</code></pre>

    <h3>Attendance Patterns</h3>
    <pre><code>-- Individual attendance patterns
WITH AttendanceHistory AS (
    SELECT 
        p.PeopleId,
        p.Name,
        COUNT(*) as TimesAttended,
        COUNT(DISTINCT a.OrganizationId) as DifferentOrgs,
        COUNT(DISTINCT CAST(a.MeetingDate as DATE)) as UniqueDays,
        MIN(a.MeetingDate) as FirstAttended,
        MAX(a.MeetingDate) as LastAttended
    FROM Attend a
    JOIN People p ON a.PeopleId = p.PeopleId
    WHERE a.AttendanceFlag = 1
      AND a.MeetingDate >= DATEADD(month, -6, GETDATE())
      AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
    GROUP BY p.PeopleId, p.Name
)
SELECT 
    Name,
    TimesAttended,
    DifferentOrgs,
    UniqueDays,
    DATEDIFF(day, FirstAttended, LastAttended) as DaySpan,
    CAST(TimesAttended as float) / NULLIF(DATEDIFF(week, FirstAttended, LastAttended), 0) as AvgPerWeek
FROM AttendanceHistory
WHERE TimesAttended > 1
ORDER BY TimesAttended DESC</code></pre>
</div>

<div id="meetings-table" class="section">
    <h2>üìÖ Meetings & Scheduling</h2>
    
    <h3>Meetings Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique meeting ID</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingDate</code></td>
            <td>datetime</td>
            <td>Start time</td>
            <td>Meeting begins</td>
        </tr>
        <tr>
            <td><code>MeetingEnd</code></td>
            <td>datetime</td>
            <td>End time</td>
            <td>Meeting ends</td>
        </tr>
        <tr>
            <td><code>Location</code></td>
            <td>nvarchar</td>
            <td>Location</td>
            <td>Where held</td>
        </tr>
        <tr>
            <td><code>NumPresent</code></td>
            <td>int</td>
            <td>Total attendance</td>
            <td>Recorded count</td>
        </tr>
        <tr>
            <td><code>HeadCount</code></td>
            <td>int</td>
            <td>Manual count</td>
            <td>Override count</td>
        </tr>
        <tr>
            <td><code>NumMembers</code></td>
            <td>int</td>
            <td>Members present</td>
            <td>Regular members</td>
        </tr>
        <tr>
            <td><code>NumNewVisit</code></td>
            <td>int</td>
            <td>First-time visitors</td>
            <td>New guests</td>
        </tr>
        <tr>
            <td><code>NumRepeatVst</code></td>
            <td>int</td>
            <td>Repeat visitors</td>
            <td>Returning guests</td>
        </tr>
        <tr>
            <td><code>DidNotMeet</code> <span class="badge badge-critical">Important</span></td>
            <td>bit</td>
            <td>Cancelled</td>
            <td>1=cancelled, 0=held</td>
        </tr>
    </table>

    <h3>Meeting Schedule Query</h3>
    <pre><code>-- Upcoming meetings schedule
SELECT 
    o.OrganizationName,
    m.MeetingDate,
    m.MeetingEnd,
    m.Location,
    DATEDIFF(minute, m.MeetingDate, m.MeetingEnd) as DurationMinutes,
    p.Name as Leader
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
LEFT JOIN People p ON o.LeaderId = p.PeopleId
WHERE m.MeetingDate >= GETDATE()
  AND m.MeetingDate <= DATEADD(week, 2, GETDATE())
  AND m.DidNotMeet = 0  -- Not cancelled
  AND o.OrganizationStatusId = 30  -- Active orgs
ORDER BY m.MeetingDate</code></pre>

    <h3>Meeting Analytics</h3>
    <pre><code>-- Meeting attendance analytics
SELECT 
    o.OrganizationName,
    COUNT(*) as MeetingsHeld,
    AVG(m.NumPresent) as AvgAttendance,
    MAX(m.NumPresent) as MaxAttendance,
    MIN(m.NumPresent) as MinAttendance,
    SUM(m.NumNewVisit) as TotalNewVisitors,
    SUM(m.NumRepeatVst) as TotalRepeatVisitors,
    AVG(CAST(m.NumPresent as float) / NULLIF(o.MemberCount, 0)) * 100 as AvgAttendancePct
FROM Meetings m
JOIN Organizations o ON m.OrganizationId = o.OrganizationId
WHERE m.MeetingDate >= DATEADD(month, -3, GETDATE())
  AND m.DidNotMeet = 0  -- Actually met
  AND o.OrganizationStatusId = 30
GROUP BY o.OrganizationId, o.OrganizationName, o.MemberCount
HAVING COUNT(*) > 3  -- At least 3 meetings
ORDER BY AVG(m.NumPresent) DESC</code></pre>
</div>

<div id="contribution-table" class="section">
    <h2>üí∞ Contribution Table - The TypeId‚â†99 Rule</h2>
    
    <div class="critical">
        <h3>üö® CRITICAL RULES: Exclude Non-Charitable Contributions</h3>
        <p><strong>ContributionTypeId = 99</strong> represents EVENT REGISTRATION FEES<br>
        <strong>ContributionTypeId = 8</strong> represents PLEDGES (not actual contributions)<br>
        <strong>PledgeFlag = 1</strong> also indicates pledges<br>
        <strong>ALWAYS exclude these from giving reports:</strong> <code>WHERE ContributionTypeId NOT IN (8, 99) AND (PledgeFlag IS NULL OR PledgeFlag = 0)</code></p>
        <p class="info"><strong>üí° TIP:</strong> Consider using the <code>Contributions2</code> function instead of the Contribution table directly. It automatically excludes non-contributions and pledges (when configured), and makes counting spouses who give together easier to report on.</p>
    </div>

    <h3>Contribution Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>ContributionId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Unique gift ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Giver</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>ContributionAmount</code></td>
            <td>money</td>
            <td>Gift amount</td>
            <td>Dollar value</td>
        </tr>
        <tr>
            <td><code>ContributionDate</code></td>
            <td>datetime</td>
            <td>Gift date</td>
            <td>When received</td>
        </tr>
        <tr>
            <td><code>FundId</code></td>
            <td>int</td>
            <td>Fund designation</td>
            <td>‚Üí ContributionFund</td>
        </tr>
        <tr>
            <td><code>ContributionTypeId</code> <span class="badge badge-critical">CRITICAL</span></td>
            <td>int</td>
            <td>Gift type</td>
            <td>99 = event fee!</td>
        </tr>
        <tr>
            <td><code>ContributionStatusId</code></td>
            <td>int</td>
            <td>Processing status</td>
            <td>‚Üí lookup.ContributionStatus</td>
        </tr>
        <tr>
            <td><code>CheckNo</code></td>
            <td>nvarchar</td>
            <td>Check number</td>
            <td>Payment reference</td>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Batch ID</td>
            <td>‚Üí BundleHeader</td>
        </tr>
    </table>

    <h3>Giving Analysis Query</h3>
    <pre><code>-- Individual giving summary
SELECT 
    g.Name,
    COUNT(*) AS GiftCount,
    SUM(g.ContributionAmount) AS TotalGiven,
    AVG(g.ContributionAmount) AS AvgGift,
    MIN(g.ContributionDate) AS FirstGift,
    MAX(g.ContributionDate) AS LastGift,
    STRING_AGG(CAST(df.FundName AS nvarchar(max)), ',') AS Funds
FROM (
    -- All gift rows for normal counts/sums
    SELECT 
        p.PeopleId,
        p.Name,
        c.ContributionAmount,
        c.ContributionDate,
        cf.FundName
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    JOIN ContributionFund cf ON c.FundId = cf.FundId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0
      AND p.ArchivedFlag = 0
) AS g
JOIN (
    -- Distinct funds per person
    SELECT DISTINCT 
        p.PeopleId,
        cf.FundName
    FROM Contribution c
    JOIN People p ON c.PeopleId = p.PeopleId
    JOIN ContributionFund cf ON c.FundId = cf.FundId
    WHERE c.ContributionTypeId != 99
      AND c.ContributionDate >= DATEADD(year, -1, GETDATE())
      AND p.IsDeceased = 0
      AND p.ArchivedFlag = 0
) AS df
    ON g.PeopleId = df.PeopleId
GROUP BY g.PeopleId, g.Name
HAVING SUM(g.ContributionAmount) > 0
ORDER BY SUM(g.ContributionAmount) DESC;
</code></pre>

    <h3>Fund Analysis</h3>
    <pre><code>-- Giving by fund
SELECT 
    cf.FundName,
    COUNT(DISTINCT c.PeopleId) as Givers,
    COUNT(*) as Gifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift,
    MAX(c.ContributionAmount) as LargestGift
FROM Contribution c
JOIN ContributionFund cf ON c.FundId = cf.FundId
WHERE c.ContributionTypeId != 99
  AND c.ContributionDate >= DATEADD(month, -3, GETDATE())
GROUP BY cf.FundId, cf.FundName
ORDER BY SUM(c.ContributionAmount) DESC</code></pre>

    <h3>Giving Trends</h3>
    <pre><code>-- Monthly giving trends
SELECT 
    YEAR(c.ContributionDate) as Year,
    MONTH(c.ContributionDate) as Month,
    DATENAME(month, c.ContributionDate) as MonthName,
    COUNT(DISTINCT c.PeopleId) as UniqueGivers,
    COUNT(*) as TotalGifts,
    SUM(c.ContributionAmount) as TotalAmount,
    AVG(c.ContributionAmount) as AvgGift
FROM Contribution c
WHERE c.ContributionTypeId != 99
  AND c.ContributionDate >= DATEADD(year, -2, GETDATE())
GROUP BY YEAR(c.ContributionDate), MONTH(c.ContributionDate), DATENAME(month, c.ContributionDate)
ORDER BY Year DESC, Month DESC</code></pre>
</div>

<div id="registration-system" class="section">
    <h2>üìù Registration System Architecture</h2>
    
    <div class="highlight">
        <h3>Registration Flow</h3>
        <p><strong>Registration</strong> ‚Üí <strong>RegPeople</strong> ‚Üí <strong>RegAnswer</strong></p>
        <ul>
            <li><strong>Registration:</strong> Overall registration transaction</li>
            <li><strong>RegPeople:</strong> Individual people in the registration</li>
            <li><strong>RegAnswer:</strong> Their answers to custom questions</li>
            <li><strong>RegQuestion:</strong> The questions being answered</li>
        </ul>
    </div>

    <h3>Registration Tables</h3>
    
    <h4>Registration Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegistrationId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Registration ID</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Event/Org</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Registrant</td>
            <td>Person who registered</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Started</td>
            <td>Registration begun</td>
        </tr>
        <tr>
            <td><code>CompletedDate</code></td>
            <td>datetime</td>
            <td>Completed</td>
            <td>Registration finished</td>
        </tr>
    </table>

    <h4>RegPeople Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RegPeopleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Person in registration</td>
        </tr>
        <tr>
            <td><code>RegistrationId</code></td>
            <td>int</td>
            <td>Registration</td>
            <td>‚Üí Registration</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>FirstName</code></td>
            <td>nvarchar</td>
            <td>First name</td>
            <td>As entered</td>
        </tr>
        <tr>
            <td><code>LastName</code></td>
            <td>nvarchar</td>
            <td>Last name</td>
            <td>As entered</td>
        </tr>
        <tr>
            <td><code>Email</code></td>
            <td>nvarchar</td>
            <td>Email</td>
            <td>Contact email</td>
        </tr>
        <tr>
            <td><code>Fee</code></td>
            <td>money</td>
            <td>Fee amount</td>
            <td>Cost for this person</td>
        </tr>
    </table>

    <h3>Registration Report Query</h3>
    <pre><code>-- Event registration details
SELECT TOP 500
    o.OrganizationName as Event,
    r.RegistrationId,
    registrant.Name as RegisteredBy,
    r.CreatedDate as RegistrationStarted,
    r.CompletedDate as RegistrationCompleted,
    rp.FirstName + ' ' + rp.LastName as Participant,
    rp.Email,
    rp.Fee,
    CASE 
        WHEN rp.CompletedDate IS NOT NULL THEN 'Complete'
        ELSE 'Incomplete'
    END as Status
FROM Registration r
JOIN Organizations o ON r.OrganizationId = o.OrganizationId
JOIN People registrant ON r.PeopleId = registrant.PeopleId
JOIN RegPeople rp ON r.RegistrationId = rp.RegistrationId
WHERE o.RegistrationTypeId > 0  -- Has registration
  AND r.CreatedDate >= DATEADD(month, -3, GETDATE())
ORDER BY r.CreatedDate DESC</code></pre>

    <h3>Registration Questions & Answers</h3>
    <pre><code>-- Custom form responses
SELECT TOP 1000
    o.OrganizationName,
    p.Name as Participant,
    rq.Label as Question,
    rq.[Order] as QuestionOrder,
    ra.AnswerValue as Answer,
    CASE 
        WHEN rq.IsRequired = 1 THEN 'Required'
        ELSE 'Optional'
    END as QuestionType
FROM RegAnswer ra
JOIN RegPeople rp ON ra.RegPeopleId = rp.RegPeopleId
JOIN People p ON rp.PeopleId = p.PeopleId
JOIN RegQuestion rq ON ra.RegQuestionId = rq.RegQuestionId
JOIN Registration r ON rp.RegistrationId = r.RegistrationId
JOIN Organizations o ON r.OrganizationId = o.OrganizationId
WHERE r.CompletedDate >= DATEADD(month, -1, GETDATE())
ORDER BY o.OrganizationName, p.Name, rq.[Order]</code></pre>
</div>

<div id="checkin-overview" class="section">
    <h2>üé´ Check-In System Overview</h2>
    
    <p>TouchPoint's check-in system provides secure child and event check-in with barcode scanning, security labels, and real-time tracking.</p>

    <h3>Check-In Tables</h3>
    
    <h4>CheckInActivities Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Activity record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>CheckInTime</code></td>
            <td>datetime</td>
            <td>Check-in time</td>
            <td>When checked in</td>
        </tr>
        <tr>
            <td><code>CheckInBy</code></td>
            <td>int</td>
            <td>Checked in by</td>
            <td>‚Üí People (worker)</td>
        </tr>
    </table>

    <h4>CheckInTimes Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Time record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>OrganizationId</code></td>
            <td>int</td>
            <td>Organization</td>
            <td>‚Üí Organizations</td>
        </tr>
        <tr>
            <td><code>MeetingId</code></td>
            <td>int</td>
            <td>Meeting</td>
            <td>‚Üí Meetings</td>
        </tr>
        <tr>
            <td><code>CheckInTime</code></td>
            <td>datetime</td>
            <td>Time stamp</td>
            <td>Exact check-in</td>
        </tr>
    </table>

    <h3>Check-In Activity Query</h3>
    <pre><code>  -- Recent check-in activity
  SELECT TOP 100
      cia.Name as PersonName,
      o.OrganizationName,
      cia.CheckInTime,
      cia.AccessType,
      cia.Location,
      DATEDIFF(minute, cia.ActivityTime, cia.CheckInTime) as MinutesEarlyLate
  FROM CheckInActivities cia
  JOIN Organizations o ON cia.OrganizationId = o.OrganizationId
  WHERE cia.CheckInTime >= DATEADD(day, -7, GETDATE())
  ORDER BY cia.CheckInTime DESC</code></pre>

    <h3>Check-In Statistics</h3>
    <pre><code>  -- Check-in statistics by organization
  SELECT TOP 500
      o.OrganizationName,
      COUNT(DISTINCT cia.PeopleId) as UniqueCheckIns,
      COUNT(*) as TotalCheckIns,
      MIN(cia.CheckInTime) as EarliestCheckIn,
      MAX(cia.CheckInTime) as LatestCheckIn
  FROM CheckInActivities cia
  JOIN Organizations o ON cia.OrganizationId = o.OrganizationId
  WHERE cia.CheckInTime >= DATEADD(month, -1, GETDATE())
  GROUP BY o.OrganizationId, o.OrganizationName
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="email-system" class="section">
    <h2>üìß Email Marketing System</h2>
    
    <div class="warning">
        <h3>‚ö†Ô∏è Performance Warning</h3>
        <p>Email tables contain millions of records. <strong>Always use date filters and TOP clauses:</strong></p>
        <ul>
            <li>EmailResponses: 3.9M+ records</li>
            <li>EmailQueueTo: 3.8M+ records</li>
        </ul>
    </div>

    <h3>Email System Tables</h3>
    
    <h4>EmailQueue Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Email campaign ID</td>
        </tr>
        <tr>
            <td><code>Subject</code></td>
            <td>nvarchar(100)</td>
            <td>Email subject</td>
            <td>Subject line</td>
        </tr>
        <tr>
            <td><code>Body</code></td>
            <td>ntext</td>
            <td>Email content</td>
            <td>HTML/text body</td>
        </tr>
        <tr>
            <td><code>FromAddress</code></td>
            <td>nvarchar(50)</td>
            <td>From email</td>
            <td>Sender address</td>
        </tr>
        <tr>
            <td><code>QueuedBy</code></td>
            <td>int</td>
            <td>Queued by</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>SendAt</code></td>
            <td>datetime</td>
            <td>Send time</td>
            <td>Scheduled/sent</td>
        </tr>
    </table>

    <h3>Email Campaign Analytics</h3>
    <pre><code> -- Email campaign performance (with date filter for performance)
  SELECT TOP 100
      eq.Id,
      eq.Subject,
      eq.SendWhen,
      sender.Name as SentBy,
      COUNT(DISTINCT eqt.PeopleId) as Recipients,
      COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN er.PeopleId END) as UniqueOpens,
      COUNT(DISTINCT CASE WHEN eqt.Bounced = 1 THEN eqt.PeopleId END) as Bounces,
      CAST(COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN er.PeopleId END) as float) /
          NULLIF(COUNT(DISTINCT eqt.PeopleId), 0) * 100 as OpenRate
  FROM EmailQueue eq
  JOIN People sender ON eq.QueuedBy = sender.PeopleId
  LEFT JOIN EmailQueueTo eqt ON eq.Id = eqt.Id
  LEFT JOIN EmailResponses er ON eq.Id = er.EmailQueueId
  WHERE eq.SendWhen >= DATEADD(month, -1, GETDATE())  -- REQUIRED for performance
  GROUP BY eq.Id, eq.Subject, eq.SendWhen, sender.Name
  ORDER BY eq.SendWhen DESC</code></pre>

    <h3>Email Engagement by Person</h3>
    <pre><code>-- Individual email engagement (limited timeframe for performance)
  SELECT TOP 500
      p.Name,
      p.EmailAddress,
      COUNT(DISTINCT eq.Id) as EmailsReceived,
      COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) as EmailsOpened,
      MAX(CASE WHEN er.Type = 'o' THEN er.Dt END) as LastOpened,
      CAST(CASE
          WHEN COUNT(DISTINCT eq.Id) > 0
          THEN COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) * 100.0 / COUNT(DISTINCT eq.Id)
          ELSE 0
      END AS DECIMAL(5,2)) as OpenRate
  FROM People p
  JOIN EmailQueueTo eqt ON p.PeopleId = eqt.PeopleId
  JOIN EmailQueue eq ON eqt.Id = eq.Id
  LEFT JOIN EmailResponses er ON eq.Id = er.EmailQueueId AND p.PeopleId = er.PeopleId
  WHERE eq.SendWhen >= DATEADD(month, -3, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name, p.EmailAddress
  HAVING COUNT(DISTINCT eq.Id) > 0
  ORDER BY COUNT(DISTINCT CASE WHEN er.Type = 'o' THEN eq.Id END) DESC</code></pre>
</div>

<div id="engagement-scoring" class="section">
    <h2>üìä Engagement Scoring System</h2>
    
    <div class="warning">
        <p><strong>‚ö†Ô∏è Performance Note:</strong> EngagementScoreTag has 1.4M+ records. Always filter by WeekDate.</p>
    </div>

    <h3>Engagement Tables</h3>
    
    <h4>EngagementScore Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Score record</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person</td>
            <td>‚Üí People</td>
        </tr>
        <tr>
            <td><code>WeekDate</code></td>
            <td>datetime</td>
            <td>Week</td>
            <td>Week of scoring</td>
        </tr>
        <tr>
            <td><code>TotalScore</code></td>
            <td>int</td>
            <td>Total points</td>
            <td>Week's total</td>
        </tr>
    </table>

    <h3>Engagement Analysis</h3>
    <pre><code>  -- Top engaged members (recent)
  SELECT TOP 100
      p.Name,
      SUM(es.TotalScore) as TotalEngagement,
      AVG(es.TotalScore) as AvgWeeklyScore,
      COUNT(DISTINCT es.WeekDate) as ActiveWeeks,
      STRING_AGG(sfl.Name, ', ') as Activities
  FROM EngagementScore es
  JOIN People p ON es.PeopleId = p.PeopleId
  LEFT JOIN EngagementScoreTag est ON es.Id = est.EngagementScoreId
  LEFT JOIN StatusFlagList sfl ON est.StatusFlagId = sfl.Flag
  WHERE es.WeekDate >= DATEADD(month, -3, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  GROUP BY p.PeopleId, p.Name
  HAVING SUM(es.TotalScore) > 0</code></pre>

    <h3>Engagement Trends</h3>
    <pre><code>-- Weekly engagement trends
SELECT 
    es.WeekDate,
    COUNT(DISTINCT es.PeopleId) as EngagedPeople,
    SUM(es.TotalScore) as TotalPoints,
    AVG(es.TotalScore) as AvgScore,
    MAX(es.TotalScore) as MaxScore
FROM EngagementScore es
WHERE es.WeekDate >= DATEADD(month, -6, GETDATE())
GROUP BY es.WeekDate
ORDER BY es.WeekDate DESC</code></pre>
</div>

<div id="tag-system" class="section">
    <h2>üè∑Ô∏è Tag System</h2>
    
    <div class="critical">
        <h3>üö® EXTREME PERFORMANCE WARNING</h3>
        <p><strong>TagPerson table contains 138 MILLION+ records!</strong></p>
        <p><strong>NEVER query without:</strong></p>
        <ul>
            <li>TOP clause (TOP 100 or less)</li>
            <li>Date filter on DateCreated</li>
            <li>Specific TagId or PeopleId filter</li>
        </ul>
    </div>

    <h3>Tag System Tables</h3>
    
    <h4>Tag Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Tag ID</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar(100)</td>
            <td>Tag name</td>
            <td>Display name</td>
        </tr>
        <tr>
            <td><code>TypeId</code></td>
            <td>int</td>
            <td>Tag type</td>
            <td>‚Üí TagType</td>
        </tr>
        <tr>
            <td><code>Owner</code></td>
            <td>int</td>
            <td>Tag owner</td>
            <td>‚Üí People</td>
        </tr>
    </table>

    <h3>Safe Tag Query Pattern</h3>
    <pre><code>-- SAFE: Query specific tag with date filter
  SELECT TOP 100
      t.Name as TagName,
      p.Name as PersonName,
      tp.DateCreated
  FROM TagPerson tp
  JOIN Tag t ON tp.Id = t.Id
  JOIN People p ON tp.PeopleId = p.PeopleId
  WHERE t.Name = 'Volunteer'  -- Specific tag
    AND tp.DateCreated >= DATEADD(month, -1, GETDATE())  -- REQUIRED
    AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
  ORDER BY tp.DateCreated DESC

-- NEVER DO THIS:
-- SELECT * FROM TagPerson  -- 138M+ records!</code></pre>

    <h3>Tag Summary</h3>
    <pre><code> -- Tag usage summary (aggregated, not detail)
  SELECT TOP 50
      t.Name as TagName,
      COUNT(*) as PeopleTagged,
      MIN(tp.DateCreated) as FirstUsed,
      MAX(tp.DateCreated) as LastUsed
  FROM Tag t
  JOIN TagPerson tp ON t.Id = tp.Id
  WHERE tp.DateCreated >= DATEADD(month, -6, GETDATE())  -- REQUIRED
  GROUP BY t.Id, t.Name
  HAVING COUNT(*) > 10
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="extra-values-complete" class="section">
    <h2>üéõÔ∏è Extra Value Tables (Custom Fields) - Complete</h2>
    
    <p>TouchPoint provides 17 Extra Value tables allowing churches to add unlimited custom fields without modifying the database schema.</p>

    <h3>Extra Value Table Types</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Data Type</th>
            <th>Usage</th>
        </tr>
        <tr>
            <td><code>PeopleExtra</code></td>
            <td>Mixed</td>
            <td>Person-specific custom fields (most common)</td>
        </tr>
        <tr>
            <td><code>ExtraValueBit</code></td>
            <td>Boolean</td>
            <td>Yes/No checkbox fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueDate</code></td>
            <td>DateTime</td>
            <td>Date picker fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueInt</code></td>
            <td>Integer</td>
            <td>Whole number fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueText</code></td>
            <td>Text</td>
            <td>Free text fields</td>
        </tr>
        <tr>
            <td><code>ExtraValueCode</code></td>
            <td>Code</td>
            <td>Dropdown/lookup fields</td>
        </tr>
        <tr>
            <td><code>OrgExtra</code></td>
            <td>Mixed</td>
            <td>Organization-specific custom fields</td>
        </tr>
        <tr>
            <td><code>MeetingExtra</code></td>
            <td>Mixed</td>
            <td>Meeting-specific custom fields</td>
        </tr>
        <tr>
            <td><code>ContributionExtra</code></td>
            <td>Mixed</td>
            <td>Contribution custom fields</td>
        </tr>
        <tr>
            <td><code>FamilyExtra</code></td>
            <td>Mixed</td>
            <td>Family-level custom fields</td>
        </tr>
        <tr>
            <td><code>ContactExtra</code></td>
            <td>Mixed</td>
            <td>Contact-specific fields</td>
        </tr>
        <tr>
            <td><code>TaskExtra</code></td>
            <td>Mixed</td>
            <td>Task custom fields</td>
        </tr>
        <tr>
            <td><code>VolunteerExtra</code></td>
            <td>Mixed</td>
            <td>Volunteer-specific fields</td>
        </tr>
        <tr>
            <td><code>MemberExtra</code></td>
            <td>Mixed</td>
            <td>Membership custom fields</td>
        </tr>
        <tr>
            <td><code>ResourceExtra</code></td>
            <td>Mixed</td>
            <td>Resource tracking fields</td>
        </tr>
        <tr>
            <td><code>EventExtra</code></td>
            <td>Mixed</td>
            <td>Event-specific fields</td>
        </tr>
        <tr>
            <td><code>AdminExtra</code></td>
            <td>Mixed</td>
            <td>Administrative custom fields</td>
        </tr>
    </table>

    <h3>Discovering Custom Fields in Your Database</h3>
    <pre><code>-- Find all custom fields in use
SELECT 
    'PeopleExtra' as TableType,
    Field,
    COUNT(*) as RecordCount,
    COUNT(DISTINCT PeopleId) as PeopleWithValue,
    MIN(TransactionTime) as FirstUsed,
    MAX(TransactionTime) as LastUsed
FROM PeopleExtra
GROUP BY Field
HAVING COUNT(*) > 10  -- Only show fields with significant usage
ORDER BY COUNT(*) DESC

-- Find custom fields for a specific person
SELECT 
    p.Name,
    'PeopleExtra' as Source,
    pev.Field,
    pev.Data as Value,
    pev.TransactionTime as LastUpdated
FROM People p
JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE p.PeopleId = 12345  -- Specific person
ORDER BY pev.Field</code></pre>

    <h3>Working with Custom Fields</h3>
    <pre><code>-- Example: Church-specific membership covenant field
SELECT TOP 500
    p.Name,
    p.MemberStatusId,
    pev.Data as MembershipCovenantDate
FROM People p
LEFT JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId 
    AND pev.Field = 'MembershipCovenant'
WHERE p.MemberStatusId = 10  -- Members only
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name

-- Example: Multiple custom fields
SELECT 
    p.Name,
    MAX(CASE WHEN pev.Field = 'BackgroundCheck' THEN pev.Data END) as BackgroundCheckDate,
    MAX(CASE WHEN pev.Field = 'SafetyTraining' THEN pev.Data END) as SafetyTrainingDate,
    MAX(CASE WHEN pev.Field = 'VolunteerAgreement' THEN pev.Data END) as VolunteerAgreement
FROM People p
LEFT JOIN PeopleExtra pev ON p.PeopleId = pev.PeopleId
WHERE pev.Field IN ('BackgroundCheck', 'SafetyTraining', 'VolunteerAgreement')
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY p.PeopleId, p.Name
HAVING MAX(CASE WHEN pev.Field = 'BackgroundCheck' THEN pev.Data END) IS NOT NULL</code></pre>

    <h3>Organization Extra Values</h3>
    <pre><code>  -- Find custom fields on organizations
  SELECT
      o.OrganizationName,
      oev.Field,
      oev.Data,
      oev.StrValue,
      oev.DateValue,
      oev.IntValue,
      oev.BitValue,
      oev.TransactionTime
  FROM Organizations o
  JOIN OrganizationExtra oev ON o.OrganizationId = oev.OrganizationId
  WHERE o.OrganizationStatusId = 30
  ORDER BY o.OrganizationName, oev.Field</code></pre>
</div>

<div id="sms-system-complete" class="section">
    <h2>üì± SMS/Text Messaging System</h2>
    
    <h3>SMS System Tables</h3>
    
    <h4>SMSList Table (Sent Messages)</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>ID</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Message batch ID</td>
        </tr>
        <tr>
            <td><code>SenderID</code></td>
            <td>int</td>
            <td>Sender</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Message</code></td>
            <td>ntext</td>
            <td>SMS content</td>
            <td>Message text</td>
        </tr>
        <tr>
            <td><code>SendAt</code></td>
            <td>datetime</td>
            <td>Send timestamp</td>
            <td>When sent</td>
        </tr>
        <tr>
            <td><code>SentSMS</code></td>
            <td>int</td>
            <td>Count sent</td>
            <td>Number of recipients</td>
        </tr>
        <tr>
            <td><code>Sent</code></td>
            <td>bit</td>
            <td>Sent flag</td>
            <td>Successfully sent</td>
        </tr>
    </table>

    <h4>SmsReceived Table (Incoming Messages)</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Received message ID</td>
        </tr>
        <tr>
            <td><code>FromPeopleId</code></td>
            <td>int</td>
            <td>Sender</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>FromNumber</code></td>
            <td>nvarchar(15)</td>
            <td>Sender phone</td>
            <td>Phone number</td>
        </tr>
        <tr>
            <td><code>Body</code></td>
            <td>ntext</td>
            <td>Message content</td>
            <td>Text received</td>
        </tr>
        <tr>
            <td><code>DateReceived</code></td>
            <td>datetime</td>
            <td>Received timestamp</td>
            <td>When received</td>
        </tr>
    </table>

    <h3>SMS Analytics Query</h3>
    <pre><code>-- SMS engagement analytics
WITH SMSMetrics AS (
    SELECT 
        -- Sent messages
        (SELECT COUNT(*) FROM SMSList WHERE Sent = 1 AND SendAt >= DATEADD(month, -1, GETDATE())) as MessagesSent,
        (SELECT SUM(SentSMS) FROM SMSList WHERE Sent = 1 AND SendAt >= DATEADD(month, -1, GETDATE())) as TotalRecipients,
        
        -- Received messages
        (SELECT COUNT(*) FROM SmsReceived WHERE DateReceived >= DATEADD(month, -1, GETDATE())) as MessagesReceived,
        (SELECT COUNT(DISTINCT FromPeopleId) FROM SmsReceived WHERE DateReceived >= DATEADD(month, -1, GETDATE()) AND FromPeopleId IS NOT NULL) as UniqueResponders
)
SELECT 
    MessagesSent,
    TotalRecipients,
    MessagesReceived,
    UniqueResponders,
    CASE 
        WHEN TotalRecipients > 0 
        THEN CAST(UniqueResponders as float) / TotalRecipients * 100 
        ELSE 0 
    END as ResponseRate
FROM SMSMetrics</code></pre>

    <h3>Text Conversation Threading</h3>
    <pre><code>-- SMS conversation history for a person
SELECT TOP 100
    COALESCE(p.Name, 'Unknown') as Person,
    CASE 
        WHEN sl.ID IS NOT NULL THEN 'Sent'
        ELSE 'Received'
    END as Direction,
    COALESCE(sl.Message, sr.Body) as Message,
    COALESCE(sl.SendAt, sr.DateReceived) as MessageTime
FROM (
    SELECT SenderID as PeopleId, Message, SendAt, NULL as DateReceived 
    FROM SMSList 
    WHERE Sent = 1 AND SendAt >= DATEADD(month, -6, GETDATE())
    UNION ALL
    SELECT FromPeopleId, Body, NULL, DateReceived 
    FROM SmsReceived
    WHERE DateReceived >= DATEADD(month, -6, GETDATE())
) messages
LEFT JOIN People p ON messages.PeopleId = p.PeopleId
LEFT JOIN SMSList sl ON messages.SendAt IS NOT NULL
LEFT JOIN SmsReceived sr ON messages.DateReceived IS NOT NULL
WHERE p.PeopleId = 12345  -- Specific person
ORDER BY MessageTime DESC</code></pre>
</div>

<div id="task-system-complete" class="section">
    <h2>üìã Tasks & Ministry Communication</h2>
    
    <h3>TaskNote Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>TaskNoteId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Task/Note ID</td>
        </tr>
        <tr>
            <td><code>AboutPersonId</code></td>
            <td>int</td>
            <td>Subject person</td>
            <td>‚Üí People (about whom)</td>
        </tr>
        <tr>
            <td><code>OwnerId</code></td>
            <td>int</td>
            <td>Task owner</td>
            <td>‚Üí People (responsible)</td>
        </tr>
        <tr>
            <td><code>AssigneeId</code></td>
            <td>int</td>
            <td>Assigned to</td>
            <td>‚Üí People (doing task)</td>
        </tr>
        <tr>
            <td><code>IsNote</code></td>
            <td>bit</td>
            <td>Type flag</td>
            <td>1=note, 0=task</td>
        </tr>
        <tr>
            <td><code>StatusId</code></td>
            <td>int</td>
            <td>Task status</td>
            <td>‚Üí lookup.TaskStatus</td>
        </tr>
        <tr>
            <td><code>Instructions</code></td>
            <td>ntext</td>
            <td>Task description</td>
            <td>What to do</td>
        </tr>
        <tr>
            <td><code>Notes</code></td>
            <td>ntext</td>
            <td>Additional notes</td>
            <td>Extra information</td>
        </tr>
        <tr>
            <td><code>DueDate</code></td>
            <td>datetime</td>
            <td>Due date</td>
            <td>Task deadline</td>
        </tr>
        <tr>
            <td><code>CompletedDate</code></td>
            <td>datetime</td>
            <td>Completion date</td>
            <td>When finished</td>
        </tr>
    </table>

    <h3>Task Management Queries</h3>
    <pre><code>-- Open tasks by assignee
 SELECT TOP 500
      assignee.Name as AssignedTo,
      owner.Name as TaskOwner,
      about.Name as AboutPerson,
      tn.Instructions,
      tn.DueDate,
      CASE
          WHEN tn.DueDate IS NULL THEN NULL
          WHEN tn.DueDate >= GETDATE() THEN DATEDIFF(day, GETDATE(), tn.DueDate)
          ELSE -DATEDIFF(day, tn.DueDate, GETDATE())
      END as DaysTillDue,
      ts.Description as Status
  FROM TaskNote tn
  JOIN People assignee ON tn.AssigneeId = assignee.PeopleId
  JOIN People owner ON tn.OwnerId = owner.PeopleId
  LEFT JOIN People about ON tn.AboutPersonId = about.PeopleId
  LEFT JOIN lookup.TaskStatus ts ON tn.StatusId = ts.Id
  WHERE tn.IsNote = 0  -- Tasks only
    AND tn.CompletedDate IS NULL  -- Not completed
  ORDER BY
      CASE WHEN tn.DueDate IS NULL THEN 1 ELSE 0 END,  -- NULL dates last
      tn.DueDate,
      assignee.Name

-- Overdue tasks
SELECT TOP 500
    assignee.Name as AssignedTo,
    tn.Instructions,
    tn.DueDate,
    DATEDIFF(day, tn.DueDate, GETDATE()) as DaysOverdue,
    owner.Name as TaskOwner
FROM TaskNote tn
JOIN People assignee ON tn.AssigneeId = assignee.PeopleId
JOIN People owner ON tn.OwnerId = owner.PeopleId
WHERE tn.IsNote = 0  -- Tasks only
  AND tn.CompletedDate IS NULL  -- Not completed
  AND tn.DueDate < GETDATE()  -- Overdue
ORDER BY tn.DueDate</code></pre>

    <h3>Ministry Notes</h3>
    <pre><code>-- Recent notes about people
SELECT TOP 500
    about.Name as AboutPerson,
    creator.Name as CreatedBy,
    tn.CreatedDate,
    tn.Instructions as NoteContent,
    tn.Notes as AdditionalInfo
FROM TaskNote tn
JOIN People about ON tn.AboutPersonId = about.PeopleId
JOIN People creator ON tn.CreatedBy = creator.PeopleId
WHERE tn.IsNote = 1  -- Notes only
  AND tn.CreatedDate >= DATEADD(month, -1, GETDATE())
ORDER BY tn.CreatedDate DESC</code></pre>
</div>

<div id="mobile-app-complete" class="section">
    <h2>üì± Mobile App Configuration</h2>
    
    <h3>Mobile Configuration Tables</h3>
    <table>
        <tr>
            <th>Table</th>
            <th>Purpose</th>
            <th>Key Fields</th>
        </tr>
        <tr>
            <td><code>lookup.CategoryMobile</code></td>
            <td>Mobile app categories</td>
            <td>Id, Code, Description, SortOrder</td>
        </tr>
        <tr>
            <td><code>LocationMobile</code></td>
            <td>Mobile location types</td>
            <td>Id, Description, Address</td>
        </tr>
        <tr>
            <td><code>RegistrationMobile</code></td>
            <td>Mobile registration types</td>
            <td>Id, Type, Settings</td>
        </tr>
        <tr>
            <td><code>AnswersMobileSettings</code></td>
            <td>Mobile form answers</td>
            <td>Id, QuestionId, Answer</td>
        </tr>
        <tr>
            <td><code>QuestionsMobileSettings</code></td>
            <td>Mobile form questions</td>
            <td>Id, Question, Type</td>
        </tr>
    </table>

    <h3>Mobile-Enabled Organizations</h3>
    <pre><code>  -- Organizations visible in mobile app
  SELECT TOP 500
      o.OrganizationName,
      cm.Description as MobileCategory,
      o.AllowMobileView,
      o.RecommendInMobile,
      o.ShowInSites,
      o.ShowMobileRegStart,
      o.ShowMobileRegEnd,
      o.ShowMobileButtonText
  FROM Organizations o
  LEFT JOIN lookup.CategoryMobile cm ON o.CategoryMobileId = cm.Id
  WHERE o.AllowMobileView = 1
    AND o.OrganizationStatusId = 30
  ORDER BY cm.SortOrder, o.OrganizationName</code></pre>
</div>

<div id="picture-system-complete" class="section">
    <h2>üñºÔ∏è Picture & Media Management</h2>
    
    <h3>Picture Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>PictureId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Picture ID</td>
        </tr>
        <tr>
            <td><code>ThumbUrl</code></td>
            <td>nvarchar</td>
            <td>Thumbnail URL</td>
            <td>Small preview</td>
        </tr>
        <tr>
            <td><code>SmallUrl</code></td>
            <td>nvarchar</td>
            <td>Small size URL</td>
            <td>Mobile size</td>
        </tr>
        <tr>
            <td><code>MediumUrl</code></td>
            <td>nvarchar</td>
            <td>Medium size URL</td>
            <td>Standard display</td>
        </tr>
        <tr>
            <td><code>LargeUrl</code></td>
            <td>nvarchar</td>
            <td>Large size URL</td>
            <td>Full resolution</td>
        </tr>
    </table>

    <div class="warning">
        <p><strong>Note:</strong> When a picture is uploaded, it takes up to 15 minutes for ThumbUrl, SmallUrl, and MediumUrl to be generated</p>
    </div>

    <h3>Picture Usage Query</h3>
    <pre><code>-- People with pictures
SELECT TOP 1000
    p.Name,
    pic.PictureId,
    pic.ThumbUrl,
    pic.MediumUrl,
    pic.LargeUrl,
    CASE 
        WHEN pic.ThumbUrl IS NOT NULL THEN 'Processed'
        ELSE 'Processing'
    END as Status
FROM People p
JOIN Picture pic ON p.PictureId = pic.PictureId
WHERE p.IsDeceased = 0 AND p.ArchivedFlag = 0
ORDER BY p.Name</code></pre>
</div>

<div id="users-roles-complete" class="section">
    <h2>üîê Users, Roles & Permissions</h2>
    
    <h3>Users Table Structure</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>User account ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person link</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Username</code></td>
            <td>nvarchar</td>
            <td>Login name</td>
            <td>Unique username</td>
        </tr>
        <tr>
            <td><code>Name</code></td>
            <td>nvarchar</td>
            <td>Display name</td>
            <td>User's full name</td>
        </tr>
        <tr>
            <td><code>EmailAddress</code></td>
            <td>nvarchar</td>
            <td>Login email</td>
            <td>Authentication email</td>
        </tr>
        <tr>
            <td><code>IsApproved</code></td>
            <td>bit</td>
            <td>Account active</td>
            <td>Can login</td>
        </tr>
        <tr>
            <td><code>LastLoginDate</code></td>
            <td>datetime</td>
            <td>Last login</td>
            <td>Most recent access</td>
        </tr>
        <tr>
            <td><code>MustChangePassword</code></td>
            <td>bit</td>
            <td>Password reset</td>
            <td>Force change</td>
        </tr>
        <tr>
            <td><code>MFAEnabled</code></td>
            <td>bit</td>
            <td>2FA enabled</td>
            <td>Multi-factor auth</td>
        </tr>
    </table>

    <h3>Roles Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>RoleId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Role ID</td>
        </tr>
        <tr>
            <td><code>RoleName</code></td>
            <td>nvarchar</td>
            <td>Role name</td>
            <td>Admin, Finance, etc.</td>
        </tr>
    </table>

    <h3>User Security Report</h3>
    <pre><code>-- Active users with roles
SELECT TOP 500
    u.UserId,
    u.Username,
    u.Name,
    u.EmailAddress,
    u.LastLoginDate,
    DATEDIFF(day, u.LastLoginDate, GETDATE()) as DaysSinceLogin,
    u.MFAEnabled,
    STRING_AGG(r.RoleName, ', ') as Roles
FROM Users u
LEFT JOIN UserRole ur ON u.UserId = ur.UserId
LEFT JOIN Roles r ON ur.RoleId = r.RoleId
WHERE u.IsApproved = 1
GROUP BY u.UserId, u.Username, u.Name, u.EmailAddress, u.LastLoginDate, u.MFAEnabled
ORDER BY u.LastLoginDate DESC

-- Users who haven't logged in recently
SELECT TOP 100
    u.Name,
    u.Username,
    u.LastLoginDate,
    DATEDIFF(day, u.LastLoginDate, GETDATE()) as DaysInactive
FROM Users u
WHERE u.IsApproved = 1
  AND u.LastLoginDate < DATEADD(month, -3, GETDATE())
ORDER BY u.LastLoginDate</code></pre>
</div>

<div id="activity-logging-complete" class="section">
    <h2>üìù Activity Logging & Audit Trail</h2>
    
    <div class="warning">
        <p><strong>‚ö†Ô∏è Performance Warning:</strong> ActivityLog contains 3.4M+ records. Always use date filters.</p>
    </div>

    <h3>ActivityLog Table</h3>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>bigint</td>
            <td>Primary key</td>
            <td>Activity ID</td>
        </tr>
        <tr>
            <td><code>ActivityDate</code></td>
            <td>datetime</td>
            <td>When occurred</td>
            <td>Timestamp</td>
        </tr>
        <tr>
            <td><code>UserId</code></td>
            <td>int</td>
            <td>User</td>
            <td>‚Üí Users.UserId</td>
        </tr>
        <tr>
            <td><code>ActivityType</code></td>
            <td>nvarchar(50)</td>
            <td>Activity type</td>
            <td>Login, Update, etc.</td>
        </tr>
        <tr>
            <td><code>Machine</code></td>
            <td>nvarchar(50)</td>
            <td>Computer/device</td>
            <td>Client info</td>
        </tr>
        <tr>
            <td><code>Activity</code></td>
            <td>ntext</td>
            <td>Activity details</td>
            <td>Full description</td>
        </tr>
    </table>

    <h3>Audit Queries</h3>
    <pre><code>  -- Recent user activity (MUST have date filter)
  SELECT TOP 100
      al.ActivityDate,
      u.Name as UserName,  -- Changed from 'User' to avoid reserved keyword
      al.Activity,
      al.Machine,
      al.PageUrl
  FROM ActivityLog al
  LEFT JOIN Users u ON al.UserId = u.UserId
  WHERE al.ActivityDate >= DATEADD(day, -7, GETDATE())  -- REQUIRED
  ORDER BY al.ActivityDate DESC

  -- Activity summary
  SELECT
      al.Activity,
      COUNT(*) as ActivityCount,
      COUNT(DISTINCT al.UserId) as UniqueUsers,
      MIN(al.ActivityDate) as FirstOccurrence,
      MAX(al.ActivityDate) as LastOccurrence
  FROM ActivityLog al
  WHERE al.ActivityDate >= DATEADD(month, -1, GETDATE())  -- REQUIRED
  GROUP BY al.Activity
  ORDER BY COUNT(*) DESC</code></pre>
</div>

<div id="change-tracking-complete" class="section">
    <h2>üîÑ Change Tracking & History</h2>
    
    <h3>Change Tracking Tables</h3>
    
    <h4>ChangeLog Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Change ID</td>
        </tr>
        <tr>
            <td><code>PeopleId</code></td>
            <td>int</td>
            <td>Person changed</td>
            <td>‚Üí People.PeopleId (NULL for non-person changes)</td>
        </tr>
        <tr>
            <td><code>FamilyId</code></td>
            <td>int</td>
            <td>Family changed</td>
            <td>‚Üí Family.FamilyId (NULL for non-family changes)</td>
        </tr>
        <tr>
            <td><code>UserPeopleId</code></td>
            <td>int</td>
            <td>Who made the change</td>
            <td>‚Üí People.PeopleId</td>
        </tr>
        <tr>
            <td><code>Created</code></td>
            <td>datetime</td>
            <td>When changed</td>
            <td>Timestamp of change</td>
        </tr>
        <tr>
            <td><code>Field</code></td>
            <td>nvarchar</td>
            <td>Field changed</td>
            <td>Column name that was modified</td>
        </tr>
        <tr>
            <td><code>Data</code></td>
            <td>nvarchar</td>
            <td>Additional data</td>
            <td>Extra context about the change</td>
        </tr>
        <tr>
            <td><code>Before</code></td>
            <td>nvarchar</td>
            <td>Old value</td>
            <td>Previous data</td>
        </tr>
        <tr>
            <td><code>After</code></td>
            <td>nvarchar</td>
            <td>New value</td>
            <td>Updated data</td>
        </tr>
    </table>

    <div class="info">
        <strong>Note:</strong> TouchPoint stores all change information in a single ChangeLog table. The ChangeDetails table exists but is not used in the standard change tracking queries. All change data (before/after values) is stored directly in the ChangeLog table.
    </div>

    <h3>Change History Queries</h3>
    <pre><code>-- Recent changes to People records
  SELECT TOP 100
      cl.Created,
      p.Name as ChangedBy,
      cl.Field,
      cl.Before,
      cl.After
  FROM ChangeLog cl
  JOIN People p ON cl.UserPeopleId = p.PeopleId
  WHERE cl.PeopleId IS NOT NULL  -- Changes to people records
    AND cl.Created >= DATEADD(day, -7, GETDATE())
  ORDER BY cl.Created DESC

  -- Track specific person's history
  SELECT
      cl.Created,
      modifier.Name as ModifiedBy,
      cl.Field,
      cl.Before,
      cl.After
  FROM ChangeLog cl
  LEFT JOIN People modifier ON cl.UserPeopleId = modifier.PeopleId
  WHERE cl.PeopleId = 12345  -- Specific PeopleId
  ORDER BY cl.Created DESC</code></pre>
</div>

<div id="financial-system-complete" class="section">
    <h2>üí≥ Financial System Details</h2>
    
    <h3>Bundle System (Batch Processing)</h3>
    
    <h4>BundleHeader Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Batch ID</td>
        </tr>
        <tr>
            <td><code>ContributionDate</code></td>
            <td>datetime</td>
            <td>Contribution date</td>
            <td>When received</td>
        </tr>
        <tr>
            <td><code>DepositDate</code></td>
            <td>datetime</td>
            <td>Bank deposit</td>
            <td>When deposited</td>
        </tr>
        <tr>
            <td><code>TotalCash</code></td>
            <td>money</td>
            <td>Cash total</td>
            <td>Cash in batch</td>
        </tr>
        <tr>
            <td><code>TotalChecks</code></td>
            <td>money</td>
            <td>Check total</td>
            <td>Checks in batch</td>
        </tr>
        <tr>
            <td><code>TotalEnvelopes</code></td>
            <td>int</td>
            <td>Envelope count</td>
            <td>Number processed</td>
        </tr>
    </table>

    <h4>BundleDetail Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>BundleDetailId</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Detail ID</td>
        </tr>
        <tr>
            <td><code>BundleHeaderId</code></td>
            <td>int</td>
            <td>Batch</td>
            <td>‚Üí BundleHeader</td>
        </tr>
        <tr>
            <td><code>ContributionId</code></td>
            <td>int</td>
            <td>Contribution</td>
            <td>‚Üí Contribution</td>
        </tr>
        <tr>
            <td><code>CreatedDate</code></td>
            <td>datetime</td>
            <td>Entry date</td>
            <td>When entered</td>
        </tr>
    </table>

    <h3>Batch Processing Queries</h3>
    <pre><code>-- Recent batch summary
SELECT TOP 500
    bh.BundleHeaderId,
    bh.ContributionDate,
    bh.DepositDate,
    bh.TotalCash + bh.TotalChecks as TotalAmount,
    bh.TotalEnvelopes,
    COUNT(bd.BundleDetailId) as ContributionCount
FROM BundleHeader bh
LEFT JOIN BundleDetail bd ON bh.BundleHeaderId = bd.BundleHeaderId
WHERE bh.ContributionDate >= DATEADD(month, -1, GETDATE())
GROUP BY bh.BundleHeaderId, bh.ContributionDate, bh.DepositDate, 
         bh.TotalCash, bh.TotalChecks, bh.TotalEnvelopes
ORDER BY bh.ContributionDate DESC</code></pre>
</div>

<div id="transaction-system-complete" class="section">
    <h2>üí∞ Transactions & Outstanding Balances</h2>
    
    <h3>Transaction Tables</h3>
    
    <h4>Transaction Table</h4>
    <table class="field-table">
        <tr>
            <th>Field</th>
            <th>Type</th>
            <th>Description</th>
            <th>Usage Notes</th>
        </tr>
        <tr>
            <td><code>Id</code></td>
            <td>int</td>
            <td>Primary key</td>
            <td>Transaction ID</td>
        </tr>
        <tr>
            <td><code>TransactionDate</code></td>
            <td>datetime</td>
            <td>Date</td>
            <td>When occurred</td>
        </tr>
        <tr>
            <td><code>amt</code></td>
            <td>money</td>
            <td>Amount</td>
            <td>Total amount</td>
        </tr>
        <tr>
            <td><code>amtdue</code></td>
            <td>money</td>
            <td>Amount due</td>
            <td>Outstanding balance</td>
        </tr>
        <tr>
            <td><code>Description</code></td>
            <td>nvarchar</td>
            <td>Description</td>
            <td>Transaction details</td>
        </tr>
    </table>

    <h3>Outstanding Balance Query</h3>
    <pre><code>-- People with outstanding balances
SELECT TOP 500
    p.Name,
    SUM(t.amtdue) as TotalDue,
    COUNT(*) as OpenTransactions,
    MIN(t.TransactionDate) as OldestTransaction,
    DATEDIFF(day, MIN(t.TransactionDate), GETDATE()) as DaysOutstanding
FROM TransactionPeople tp
JOIN People p ON tp.PeopleId = p.PeopleId
JOIN [Transaction] t ON tp.Id = t.Id
WHERE t.amtdue > 0
  AND p.IsDeceased = 0 AND p.ArchivedFlag = 0
GROUP BY p.PeopleId, p.Name
HAVING SUM(t.amtdue) > 0
ORDER BY SUM(t.amtdue) DESC</code></pre>
</div>

<!-- Add the complete JavaScript section -->
<script>
// Complete JavaScript for all interactive features
document.addEventListener('DOMContentLoaded', function() {
    // Add copy buttons to all code blocks
    const codeBlocks = document.querySelectorAll('pre');
    
    codeBlocks.forEach(function(block) {
        // Create copy button
        const button = document.createElement('button');
        button.className = 'copy-button';
        button.textContent = 'Copy';
        button.style.position = 'absolute';
        button.style.top = '10px';
        button.style.right = '10px';
        button.style.background = '#4299e1';
        button.style.color = 'white';
        button.style.border = 'none';
        button.style.padding = '6px 12px';
        button.style.borderRadius = '4px';
        button.style.cursor = 'pointer';
        button.style.fontSize = '12px';
        button.style.fontWeight = '500';
        
        // Make pre position relative for absolute button positioning
        block.style.position = 'relative';
        
        // Add click handler
        button.addEventListener('click', function() {
            const code = block.querySelector('code');
            const text = code ? code.textContent : block.textContent;
            
            // Try modern clipboard API first
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function() {
                    button.textContent = 'Copied!';
                    button.style.background = '#38a169';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                }).catch(function(err) {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
            
            function fallbackCopy(text) {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    button.textContent = 'Copied!';
                    button.style.background = '#38a169';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                } catch (err) {
                    button.textContent = 'Failed';
                    button.style.background = '#e53e3e';
                    setTimeout(function() {
                        button.textContent = 'Copy';
                        button.style.background = '#4299e1';
                    }, 2000);
                }
                document.body.removeChild(textarea);
            }
        });
        
        block.appendChild(button);
    });
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            if (targetId === '#') {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            } else {
                const target = document.querySelector(targetId);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });
    });
    
    // Back to top button visibility
    const backToTop = document.querySelector('.back-to-top');
    if (backToTop) {
        // Hide initially
        backToTop.style.display = 'none';
        
        // Show/hide based on scroll position
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                backToTop.style.display = 'block';
            } else {
                backToTop.style.display = 'none';
            }
        });
    }
    
    // Add table of contents highlighting based on scroll position
    const sections = document.querySelectorAll('.section[id]');
    const tocLinks = document.querySelectorAll('.toc a[href^="#"]');
    
    window.addEventListener('scroll', function() {
        let current = '';
        
        sections.forEach(section => {
            const sectionTop = section.offsetTop;
            const sectionHeight = section.clientHeight;
            if (pageYOffset >= sectionTop - 100) {
                current = section.getAttribute('id');
            }
        });
        
        tocLinks.forEach(link => {
            link.style.fontWeight = '500';
            link.style.background = 'transparent';
            if (link.getAttribute('href') === '#' + current) {
                link.style.fontWeight = '700';
                link.style.background = '#ebf8ff';
                link.style.padding = '5px 10px';
                link.style.borderRadius = '5px';
            }
        });
    });
});
</script>

<!-- CSS for missing styles -->
<style>
.section {
    background: white;
    padding: 30px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 30px;
}

.field-table {
    font-size: 0.95em;
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

.field-table th {
    background: #edf2f7;
    font-weight: 600;
    padding: 12px;
    text-align: left;
    border: 1px solid #e2e8f0;
}

.field-table td {
    padding: 10px 12px;
    border: 1px solid #e2e8f0;
}

.field-table th:first-child {
    width: 25%;
}

.field-table th:nth-child(2) {
    width: 15%;
}

.field-table code {
    background: #f7fafc !important;
    color: #e53e3e !important;
    padding: 2px 6px !important;
    border-radius: 3px !important;
    font-size: 0.9em !important;
}

.warning {
    background: #fed7e2;
    border: 2px solid #e53e3e;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
}

.info {
    background: #bee3f8;
    border: 2px solid #3182ce;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
}

.highlight {
    background: #fef5e7;
    border-left: 5px solid #ed8936;
    padding: 15px;
    margin: 20px 0;
    border-radius: 0 8px 8px 0;
}

.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 4px;
    font-size: 0.85em;
    font-weight: 600;
    margin-left: 8px;
}

.badge-critical {
    background: #fed7e2;
    color: #c53030;
}

.badge-new {
    background: #c6f6d5;
    color: #22543d;
}

.badge-performance {
    background: #fef5e7;
    color: #c05621;
}
</style>
